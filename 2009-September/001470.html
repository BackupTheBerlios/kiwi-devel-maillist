<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Kiwi-devel] [Git]Project kiwi at BerliOS branch, master,	updated. 05627a31c19d6c1da877a2fb06b86ea84110dbcf
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/kiwi-devel/2009-September/index.html" >
   <LINK REL="made" HREF="mailto:kiwi-devel%40lists.berlios.de?Subject=Re%3A%20%5BKiwi-devel%5D%20%5BGit%5DProject%20kiwi%20at%20BerliOS%20branch%2C%20master%2C%0A%09updated.%2005627a31c19d6c1da877a2fb06b86ea84110dbcf&In-Reply-To=%3C200909301319.n8UDJ42b009560%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001469.html">
   
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Kiwi-devel] [Git]Project kiwi at BerliOS branch, master,	updated. 05627a31c19d6c1da877a2fb06b86ea84110dbcf</H1>
    <B>marcus_schaefer at BerliOS</B> 
    <A HREF="mailto:kiwi-devel%40lists.berlios.de?Subject=Re%3A%20%5BKiwi-devel%5D%20%5BGit%5DProject%20kiwi%20at%20BerliOS%20branch%2C%20master%2C%0A%09updated.%2005627a31c19d6c1da877a2fb06b86ea84110dbcf&In-Reply-To=%3C200909301319.n8UDJ42b009560%40sheep.berlios.de%3E"
       TITLE="[Kiwi-devel] [Git]Project kiwi at BerliOS branch, master,	updated. 05627a31c19d6c1da877a2fb06b86ea84110dbcf">marcus_schaefer at mail.berlios.de
       </A><BR>
    <I>Wed Sep 30 15:19:04 CEST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="001469.html">[Kiwi-devel] [Git]Project kiwi at BerliOS branch, master,	updated. 84f8675add2605c104d7c18e568be982a3efd39d
</A></li>
        
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1470">[ date ]</a>
              <a href="thread.html#1470">[ thread ]</a>
              <a href="subject.html#1470">[ subject ]</a>
              <a href="author.html#1470">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>This is an automated email from the git hooks/post-receive script. It was
generated because a ref change was pushed to the repository containing
the project &quot;Project kiwi at BerliOS&quot;.

The branch, master has been updated
       via  05627a31c19d6c1da877a2fb06b86ea84110dbcf (commit)
      from  84f8675add2605c104d7c18e568be982a3efd39d (commit)

Those revisions listed above that are new to this repository have
not appeared on any other notification email; so we list those
revisions in full, below.

- Log -----------------------------------------------------------------
commit 05627a31c19d6c1da877a2fb06b86ea84110dbcf
Author: Marcus Sch&#195;&#164;fer &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/kiwi-devel">ms at novell.com</A>&gt;
Date:   Wed Sep 30 15:19:28 2009 +0200

    - oemboot: re-install grub bootloader into partition if the
      partition contains a bootloader signature already (bnc #543123)
    - added backup diff in recovery mode. This will add a file~
      diff file for each file changed according to the recovery
      contents.

-----------------------------------------------------------------------

Summary of changes:
diff --git a/locale/ar/LC_MESSAGES/kiwi.po b/locale/ar/LC_MESSAGES/kiwi.po
index ee1ba08..6dac691 100644
--- a/locale/ar/LC_MESSAGES/kiwi.po
+++ b/locale/ar/LC_MESSAGES/kiwi.po
@@ -42,6 +42,9 @@ msgstr &quot;&#217;&#133;&#216;&#179;&#216;&#173; &#216;&#180;&#216;&#167;&#217;&#133;&#217;&#132;...&quot;
 msgid &quot;%1 files from %2 restored...&quot;
 msgstr &quot;&#216;&#170;&#217;&#133;&#216;&#170; &#216;&#167;&#216;&#179;&#216;&#170;&#216;&#185;&#216;&#167;&#216;&#175;&#216;&#169; %2 &#217;&#133;&#217;&#132;&#217;&#129;&#216;&#167;&#216;&#170; &#217;&#133;&#217;&#134; %1...&quot;
 
+msgid &quot;backing up: %1...&quot;
+msgstr &quot;&quot;
+
 msgid &quot;Yes&quot;
 msgstr &quot;&#217;&#134;&#216;&#185;&#217;&#133;&quot;
 
diff --git a/locale/cs/LC_MESSAGES/kiwi.po b/locale/cs/LC_MESSAGES/kiwi.po
index 89f9047..89e5115 100644
--- a/locale/cs/LC_MESSAGES/kiwi.po
+++ b/locale/cs/LC_MESSAGES/kiwi.po
@@ -42,6 +42,9 @@ msgstr &quot;&#195;&#154;pln&#195;&#169; vy&#196;&#141;i&#197;&#161;t&#196;&#155;n&#195;&#173;&#226;&#128;&#166;&quot;
 msgid &quot;%1 files from %2 restored...&quot;
 msgstr &quot;Po&#196;&#141;et obnoven&#195;&#189;ch soubor&#197;&#175;: %1 z %2&quot;
 
+msgid &quot;backing up: %1...&quot;
+msgstr &quot;&quot;
+
 msgid &quot;Yes&quot;
 msgstr &quot;Ano&quot;
 
diff --git a/locale/de/LC_MESSAGES/kiwi.po b/locale/de/LC_MESSAGES/kiwi.po
index 5007a95..9ea221e 100644
--- a/locale/de/LC_MESSAGES/kiwi.po
+++ b/locale/de/LC_MESSAGES/kiwi.po
@@ -42,6 +42,9 @@ msgstr &quot;Bereinigen&#226;&#128;&#166;&quot;
 msgid &quot;%1 files from %2 restored...&quot;
 msgstr &quot;%1 Dateien aus %2 wiederhergestellt&#226;&#128;&#166;&quot;
 
+msgid &quot;backing up: %1...&quot;
+msgstr &quot;&quot;
+
 msgid &quot;Yes&quot;
 msgstr &quot;Ja&quot;
 
diff --git a/locale/el/LC_MESSAGES/kiwi.po b/locale/el/LC_MESSAGES/kiwi.po
index 8c0d5b8..511e3f9 100644
--- a/locale/el/LC_MESSAGES/kiwi.po
+++ b/locale/el/LC_MESSAGES/kiwi.po
@@ -42,6 +42,9 @@ msgstr &quot;&#206;&#147;&#206;&#175;&#206;&#189;&#206;&#181;&#207;&#132;&#206;&#177;&#206;&#185; &#206;&#186;&#206;&#177;&#206;&#184;&#206;&#172;&#207;&#129;&#206;&#185;&#207;&#131;&#206;&#188;&#206;&#177;...&quot;
 msgid &quot;%1 files from %2 restored...&quot;
 msgstr &quot;&#206;&#136;&#206;&#179;&#206;&#185;&#206;&#189;&#206;&#181; &#206;&#181;&#207;&#128;&#206;&#177;&#206;&#189;&#206;&#177;&#207;&#134;&#206;&#191;&#207;&#129;&#206;&#172; %1 &#206;&#177;&#207;&#129;&#207;&#135;&#206;&#181;&#206;&#175;&#207;&#137;&#206;&#189; &#206;&#177;&#207;&#128;&#207;&#140; %2...&quot;
 
+msgid &quot;backing up: %1...&quot;
+msgstr &quot;&quot;
+
 msgid &quot;Yes&quot;
 msgstr &quot;&#206;&#157;&#206;&#177;&#206;&#185;&quot;
 
diff --git a/locale/es/LC_MESSAGES/kiwi.po b/locale/es/LC_MESSAGES/kiwi.po
index e84ef81..5756814 100644
--- a/locale/es/LC_MESSAGES/kiwi.po
+++ b/locale/es/LC_MESSAGES/kiwi.po
@@ -42,6 +42,9 @@ msgstr &quot;Borrando&#226;&#128;&#166;&quot;
 msgid &quot;%1 files from %2 restored...&quot;
 msgstr &quot;%1 de %2 archivos restaurados...&quot;
 
+msgid &quot;backing up: %1...&quot;
+msgstr &quot;&quot;
+
 msgid &quot;Yes&quot;
 msgstr &quot;S&#195;&#173;&quot;
 
diff --git a/locale/fi/LC_MESSAGES/kiwi.po b/locale/fi/LC_MESSAGES/kiwi.po
index 3efdc32..5a7c676 100644
--- a/locale/fi/LC_MESSAGES/kiwi.po
+++ b/locale/fi/LC_MESSAGES/kiwi.po
@@ -42,6 +42,9 @@ msgstr &quot;Puhdas l&#195;&#164;pik&#195;&#164;ynti...&quot;
 msgid &quot;%1 files from %2 restored...&quot;
 msgstr &quot;Palautettiin %1 tiedostoa kohteesta %2...&quot;
 
+msgid &quot;backing up: %1...&quot;
+msgstr &quot;&quot;
+
 msgid &quot;Yes&quot;
 msgstr &quot;Kyll&#195;&#164;&quot;
 
diff --git a/locale/fr/LC_MESSAGES/kiwi.po b/locale/fr/LC_MESSAGES/kiwi.po
index 530108f..e428742 100644
--- a/locale/fr/LC_MESSAGES/kiwi.po
+++ b/locale/fr/LC_MESSAGES/kiwi.po
@@ -42,6 +42,9 @@ msgstr &quot;Nettoyage...&quot;
 msgid &quot;%1 files from %2 restored...&quot;
 msgstr &quot;%1 fichiers de %2 restaur&#195;&#169;s...&quot;
 
+msgid &quot;backing up: %1...&quot;
+msgstr &quot;&quot;
+
 msgid &quot;Yes&quot;
 msgstr &quot;Oui&quot;
 
diff --git a/locale/hu/LC_MESSAGES/kiwi.po b/locale/hu/LC_MESSAGES/kiwi.po
index 7d220c6..aaa9a9a 100644
--- a/locale/hu/LC_MESSAGES/kiwi.po
+++ b/locale/hu/LC_MESSAGES/kiwi.po
@@ -42,6 +42,9 @@ msgstr &quot;Megtiszt&#195;&#173;t&#195;&#161;s...&quot;
 msgid &quot;%1 files from %2 restored...&quot;
 msgstr &quot;%1 f&#195;&#161;jl helyre&#195;&#161;ll&#195;&#173;tva (&#195;&#182;sszesen: %2)...&quot;
 
+msgid &quot;backing up: %1...&quot;
+msgstr &quot;&quot;
+
 msgid &quot;Yes&quot;
 msgstr &quot;Igen&quot;
 
diff --git a/locale/it/LC_MESSAGES/kiwi.po b/locale/it/LC_MESSAGES/kiwi.po
index fa12116..eebea0d 100644
--- a/locale/it/LC_MESSAGES/kiwi.po
+++ b/locale/it/LC_MESSAGES/kiwi.po
@@ -42,6 +42,9 @@ msgstr &quot;Pulizia in corso...&quot;
 msgid &quot;%1 files from %2 restored...&quot;
 msgstr &quot;%1 file su %2 ripristinati...&quot;
 
+msgid &quot;backing up: %1...&quot;
+msgstr &quot;&quot;
+
 msgid &quot;Yes&quot;
 msgstr &quot;S&#195;&#172;&quot;
 
diff --git a/locale/ja/LC_MESSAGES/kiwi.po b/locale/ja/LC_MESSAGES/kiwi.po
index d5d8a9e..cd43b01 100644
--- a/locale/ja/LC_MESSAGES/kiwi.po
+++ b/locale/ja/LC_MESSAGES/kiwi.po
@@ -42,6 +42,9 @@ msgstr &quot;&#227;&#130;&#175;&#227;&#131;&#170;&#227;&#131;&#188;&#227;&#131;&#179;&#227;&#130;&#185;&#227;&#130;&#164;&#227;&#131;&#188;&#227;&#131;&#151;...&quot;
 msgid &quot;%1 files from %2 restored...&quot;
 msgstr &quot;%2 &#227;&#129;&#139;&#227;&#130;&#137;&#227;&#129;&#174; %1  &#229;&#128;&#139;&#227;&#129;&#174;&#227;&#131;&#149;&#227;&#130;&#161;&#227;&#130;&#164;&#227;&#131;&#171;&#227;&#129;&#140;&#229;&#190;&#169;&#229;&#133;&#131;&#227;&#129;&#149;&#227;&#130;&#140;&#227;&#129;&#190;&#227;&#129;&#151;&#227;&#129;&#159;...&quot;
 
+msgid &quot;backing up: %1...&quot;
+msgstr &quot;&quot;
+
 msgid &quot;Yes&quot;
 msgstr &quot;&#227;&#129;&#175;&#227;&#129;&#132;&quot;
 
diff --git a/locale/kiwi-template/kiwi.pot b/locale/kiwi-template/kiwi.pot
index 812e017..ab9a5dc 100644
--- a/locale/kiwi-template/kiwi.pot
+++ b/locale/kiwi-template/kiwi.pot
@@ -44,6 +44,9 @@ msgstr &quot;&quot;
 msgid &quot;%1 files from %2 restored...&quot;
 msgstr &quot;&quot;
 
+msgid &quot;backing up: %1...&quot;
+msgstr &quot;&quot;
+
 msgid &quot;Yes&quot;
 msgstr &quot;&quot;
 
diff --git a/locale/ko/LC_MESSAGES/kiwi.po b/locale/ko/LC_MESSAGES/kiwi.po
index 0271fb3..b1995c6 100644
--- a/locale/ko/LC_MESSAGES/kiwi.po
+++ b/locale/ko/LC_MESSAGES/kiwi.po
@@ -42,6 +42,9 @@ msgstr &quot;&#236;&#153;&#132;&#236;&#160;&#132; &#236;&#130;&#173;&#236;&#160;&#156;...&quot;
 msgid &quot;%1 files from %2 restored...&quot;
 msgstr &quot;%2&#236;&#151;&#144;&#236;&#132;&#156; %1&#234;&#176;&#156;&#236;&#157;&#152; &#237;&#140;&#140;&#236;&#157;&#188;&#236;&#157;&#180; &#235;&#179;&#181;&#236;&#155;&#144;&#235;&#144;&#152;&#236;&#151;&#136;&#236;&#138;&#181;&#235;&#139;&#136;&#235;&#139;&#164;&#226;&#128;&#166;&quot;
 
+msgid &quot;backing up: %1...&quot;
+msgstr &quot;&quot;
+
 msgid &quot;Yes&quot;
 msgstr &quot;&#236;&#152;&#136;&quot;
 
diff --git a/locale/nl/LC_MESSAGES/kiwi.po b/locale/nl/LC_MESSAGES/kiwi.po
index 080d6df..fdf0558 100644
--- a/locale/nl/LC_MESSAGES/kiwi.po
+++ b/locale/nl/LC_MESSAGES/kiwi.po
@@ -42,6 +42,9 @@ msgstr &quot;Alles herstellen&#226;&#128;&#166;&quot;
 msgid &quot;%1 files from %2 restored...&quot;
 msgstr &quot;%1 bestanden van %2 hersteld&#226;&#128;&#166;&quot;
 
+msgid &quot;backing up: %1...&quot;
+msgstr &quot;&quot;
+
 msgid &quot;Yes&quot;
 msgstr &quot;Ja&quot;
 
diff --git a/locale/pl/LC_MESSAGES/kiwi.po b/locale/pl/LC_MESSAGES/kiwi.po
index 65ef875..161f571 100644
--- a/locale/pl/LC_MESSAGES/kiwi.po
+++ b/locale/pl/LC_MESSAGES/kiwi.po
@@ -43,6 +43,9 @@ msgstr &quot;Wyczy&#197;&#155;&#196;&#135;...&quot;
 msgid &quot;%1 files from %2 restored...&quot;
 msgstr &quot;Liczba przywr&#195;&#179;conych plik&#195;&#179;w: %1 z %2...&quot;
 
+msgid &quot;backing up: %1...&quot;
+msgstr &quot;&quot;
+
 msgid &quot;Yes&quot;
 msgstr &quot;Tak&quot;
 
diff --git a/locale/pt_BR/LC_MESSAGES/kiwi.po b/locale/pt_BR/LC_MESSAGES/kiwi.po
index 0377cac..7280f46 100644
--- a/locale/pt_BR/LC_MESSAGES/kiwi.po
+++ b/locale/pt_BR/LC_MESSAGES/kiwi.po
@@ -42,6 +42,9 @@ msgstr &quot;Limpeza...&quot;
 msgid &quot;%1 files from %2 restored...&quot;
 msgstr &quot;%1 arquivos de %2 foram recuperados...&quot;
 
+msgid &quot;backing up: %1...&quot;
+msgstr &quot;&quot;
+
 msgid &quot;Yes&quot;
 msgstr &quot;Sim&quot;
 
diff --git a/locale/ru/LC_MESSAGES/kiwi.po b/locale/ru/LC_MESSAGES/kiwi.po
index 7e1535b..3af4062 100644
--- a/locale/ru/LC_MESSAGES/kiwi.po
+++ b/locale/ru/LC_MESSAGES/kiwi.po
@@ -43,6 +43,9 @@ msgstr &quot;&#208;&#158;&#209;&#135;&#208;&#184;&#209;&#129;&#209;&#130;&#208;&#186;&#208;&#176;&#226;&#128;&#166;&quot;
 msgid &quot;%1 files from %2 restored...&quot;
 msgstr &quot;&#208;&#146;&#208;&#190;&#209;&#129;&#209;&#129;&#209;&#130;&#208;&#176;&#208;&#189;&#208;&#190;&#208;&#178;&#208;&#187;&#208;&#181;&#208;&#189;&#208;&#190; &#209;&#132;&#208;&#176;&#208;&#185;&#208;&#187;&#208;&#190;&#208;&#178; &#208;&#184;&#208;&#183; &#208;&#184;&#209;&#129;&#209;&#130;&#208;&#190;&#209;&#135;&#208;&#189;&#208;&#184;&#208;&#186;&#208;&#176; %2: %1.&quot;
 
+msgid &quot;backing up: %1...&quot;
+msgstr &quot;&quot;
+
 msgid &quot;Yes&quot;
 msgstr &quot;&#208;&#148;&#208;&#176;&quot;
 
diff --git a/locale/sv/LC_MESSAGES/kiwi.po b/locale/sv/LC_MESSAGES/kiwi.po
index 853be9f..fa47497 100644
--- a/locale/sv/LC_MESSAGES/kiwi.po
+++ b/locale/sv/LC_MESSAGES/kiwi.po
@@ -42,6 +42,9 @@ msgstr &quot;Rensa...&quot;
 msgid &quot;%1 files from %2 restored...&quot;
 msgstr &quot;%1 filer fr&#195;&#165;n %2 har &#195;&#165;terst&#195;&#164;llts...&quot;
 
+msgid &quot;backing up: %1...&quot;
+msgstr &quot;&quot;
+
 msgid &quot;Yes&quot;
 msgstr &quot;Ja&quot;
 
diff --git a/locale/tr/LC_MESSAGES/kiwi.po b/locale/tr/LC_MESSAGES/kiwi.po
index b486b33..2c6112d 100644
--- a/locale/tr/LC_MESSAGES/kiwi.po
+++ b/locale/tr/LC_MESSAGES/kiwi.po
@@ -42,6 +42,9 @@ msgstr &quot;Tam silme&#226;&#128;&#166;&quot;
 msgid &quot;%1 files from %2 restored...&quot;
 msgstr &quot;%1/%2 dosya geri y&#195;&#188;klendi...&quot;
 
+msgid &quot;backing up: %1...&quot;
+msgstr &quot;&quot;
+
 msgid &quot;Yes&quot;
 msgstr &quot;Evet&quot;
 
diff --git a/locale/uk/LC_MESSAGES/kiwi.po b/locale/uk/LC_MESSAGES/kiwi.po
index c47dd10..67f661d 100644
--- a/locale/uk/LC_MESSAGES/kiwi.po
+++ b/locale/uk/LC_MESSAGES/kiwi.po
@@ -43,6 +43,9 @@ msgstr &quot;&#208;&#158;&#209;&#135;&#208;&#184;&#209;&#129;&#209;&#130;&#208;&#186;&#208;&#176;&#226;&#128;&#166;&quot;
 msgid &quot;%1 files from %2 restored...&quot;
 msgstr &quot;%1 &#209;&#132;&#208;&#176;&#208;&#185;&#208;&#187;&#209;&#150;&#208;&#178; &#209;&#150;&#208;&#183; %2 &#208;&#178;&#209;&#150;&#208;&#180;&#208;&#189;&#208;&#190;&#208;&#178;&#208;&#187;&#208;&#181;&#208;&#189;&#208;&#190;...&quot;
 
+msgid &quot;backing up: %1...&quot;
+msgstr &quot;&quot;
+
 msgid &quot;Yes&quot;
 msgstr &quot;&#208;&#162;&#208;&#176;&#208;&#186;&quot;
 
diff --git a/locale/zh_CN/LC_MESSAGES/kiwi.po b/locale/zh_CN/LC_MESSAGES/kiwi.po
index 90fbd94..6a45f8a 100644
--- a/locale/zh_CN/LC_MESSAGES/kiwi.po
+++ b/locale/zh_CN/LC_MESSAGES/kiwi.po
@@ -42,6 +42,9 @@ msgstr &quot;&#229;&#191;&#171;&#233;&#128;&#159;&#230;&#149;&#180;&#231;&#144;&#134;&quot;
 msgid &quot;%1 files from %2 restored...&quot;
 msgstr &quot;&#229;&#183;&#178;&#230;&#129;&#162;&#229;&#164;&#141; %1 &#228;&#184;&#170;&#230;&#150;&#135;&#228;&#187;&#182;&#239;&#188;&#140;&#229;&#133;&#177; %2 &#228;&#184;&#170;&#230;&#150;&#135;&#228;&#187;&#182;...&quot;
 
+msgid &quot;backing up: %1...&quot;
+msgstr &quot;&quot;
+
 msgid &quot;Yes&quot;
 msgstr &quot;&#230;&#152;&#175;&quot;
 
diff --git a/locale/zh_TW/LC_MESSAGES/kiwi.po b/locale/zh_TW/LC_MESSAGES/kiwi.po
index 11a529e..c81cdf2 100644
--- a/locale/zh_TW/LC_MESSAGES/kiwi.po
+++ b/locale/zh_TW/LC_MESSAGES/kiwi.po
@@ -42,6 +42,9 @@ msgstr &quot;&#230;&#173;&#163;&#229;&#156;&#168;&#230;&#184;&#133;&#231;&#144;&#134;&#231;&#161;&#172;&#231;&#162;&#159;...&quot;
 msgid &quot;%1 files from %2 restored...&quot;
 msgstr &quot;&#229;&#183;&#178;&#233;&#130;&#132;&#229;&#142;&#159; %2 &#228;&#184;&#173;&#231;&#154;&#132; %1 &#229;&#128;&#139;&#230;&#170;&#148;&#230;&#161;&#136;&#226;&#128;&#166;&quot;
 
+msgid &quot;backing up: %1...&quot;
+msgstr &quot;&quot;
+
 msgid &quot;Yes&quot;
 msgstr &quot;&#230;&#152;&#175;&quot;
 
diff --git a/modules/KIWIBoot.pm b/modules/KIWIBoot.pm
index 3a4a290..063342f 100644
--- a/modules/KIWIBoot.pm
+++ b/modules/KIWIBoot.pm
@@ -3965,7 +3965,7 @@ sub installBootLoader {
 				return undef;
 			}
 			$status = qxx (
-				&quot;dd if=$bmbr of=$diskname bs=1 count=512 seek=0x800 $opt 2&gt;&amp;1&quot;
+				&quot;dd if=$bmbr of=$diskname bs=512 count=1 seek=3 skip=0 $opt 2&gt;&amp;1&quot;
 			);
 			unlink $bmbr;
 			#==========================================
diff --git a/modules/KIWIConfig.sh b/modules/KIWIConfig.sh
index af18bea..3c79bdc 100644
--- a/modules/KIWIConfig.sh
+++ b/modules/KIWIConfig.sh
@@ -952,7 +952,7 @@ function suseStripInitrd {
 		pvchange pvresize pvscan vgscan vgchange vgextend vgdisplay
 		lvchange lvresize lvextend lvcreate grub dcounter tty
 		dmsetup dialog awk gawk clicfs cryptsetup clear blkid fbiterm
-		gettext
+		gettext diff
 	&quot;
 	tools=&quot;$tools $@&quot;
 	for path in /sbin /usr/sbin /usr/bin /bin;do
diff --git a/modules/KIWILinuxRC.sh b/modules/KIWILinuxRC.sh
index ee5e0c0..d55a73f 100644
--- a/modules/KIWILinuxRC.sh
+++ b/modules/KIWILinuxRC.sh
@@ -1030,6 +1030,7 @@ function setupBootLoaderGrub {
 	local conf=$destsPrefix/etc/grub.conf
 	local dmap=$destsPrefix/boot/grub/device.map
 	local sysb=$destsPrefix/etc/sysconfig/bootloader
+	local stage=/boot/grub/stage2
 	local console=&quot;&quot;
 	local kname=&quot;&quot;
 	local kernel=&quot;&quot;
@@ -1213,12 +1214,13 @@ function setupBootLoaderGrub {
 	#======================================
 	# create grub.conf file
 	#--------------------------------------
-	echo -en &quot;root $gdev\ninstall&quot;           &gt; $conf
-	echo -n &quot; --stage2=/boot/grub/stage2&quot;   &gt;&gt; $conf
-	echo -n &quot; /boot/grub/stage1 d (hd0)&quot;    &gt;&gt; $conf
-	echo -n &quot; /boot/grub/stage2 0x8000&quot;     &gt;&gt; $conf
-	echo &quot; $gdev/boot/grub/menu.lst&quot;        &gt;&gt; $conf
-	echo &quot;quit&quot;                             &gt;&gt; $conf
+	echo &quot;root $gdev&quot; &gt; $conf
+	if dd if=$rdev bs=1 count=512 | file - | grep -q Bootloader;then
+		echo &quot;setup --stage2=$stage $gdev&quot; &gt;&gt; $conf
+	else
+		echo &quot;setup --stage2=$stage (hd0)&quot; &gt;&gt; $conf
+	fi
+	echo &quot;quit&quot; &gt;&gt; $conf
 	#======================================
 	# create grub device map
 	#--------------------------------------
diff --git a/rpm/kiwi.changes b/rpm/kiwi.changes
index a2305b3..98c2985 100644
--- a/rpm/kiwi.changes
+++ b/rpm/kiwi.changes
@@ -1,4 +1,13 @@
 -------------------------------------------------------------------
+Wed Sep 30 10:23:13 CEST 2009 - <A HREF="https://lists.berlios.de/mailman/listinfo/kiwi-devel">ms at suse.de</A>
+
+- oemboot: re-install grub bootloader into partition if the
+  partition contains a bootloader signature already (bnc #543123)
+- added backup diff in recovery mode. This will add a file~
+  diff file for each file changed according to the recovery
+  contents.
+
+-------------------------------------------------------------------
 Tue Sep 29 11:17:49 CEST 2009 - <A HREF="https://lists.berlios.de/mailman/listinfo/kiwi-devel">ms at suse.de</A>
 
 - improved restore feature which also restores the filesystem
diff --git a/system/boot/ix86/oemboot/suse-linuxrc b/system/boot/ix86/oemboot/suse-linuxrc
index 9d38433..eb2877b 100755
--- a/system/boot/ix86/oemboot/suse-linuxrc
+++ b/system/boot/ix86/oemboot/suse-linuxrc
@@ -357,6 +357,9 @@ if [ ! -z &quot;$KIWI_RECOVERY&quot; ];then
 	#--------------------------------------
 	mkfifo /progress &amp;&amp; cp /usr/bin/tail /usr/bin/mst
 	(
+		#======================================
+		# recreate filesystem in restore mode
+		#--------------------------------------
 		if [ ! -z &quot;$RESTORE&quot; ];then
 			getText &quot;Clean sweep...&quot; &gt; /progress
 			fstype=$(cat /reco-save/recovery.tar.filesystem)
@@ -379,15 +382,43 @@ if [ ! -z &quot;$KIWI_RECOVERY&quot; ];then
 			done
 		fi
 		cd /mnt
+		#======================================
+		# extract root archive
+		#--------------------------------------
 		rFiles=$(cat /reco-save/recovery.tar.files)
-		tar --numeric-owner -xvpf /reco-save/recovery.tar.gz &gt;/tmp/rFiles &amp;
+		if [ ! -z &quot;$RESTORE&quot; ];then
+			tar --numeric-owner -xvpf /reco-save/recovery.tar.gz &gt;/tmp/rFiles &amp;
+		else
+			tar --numeric-owner -xvpf /reco-save/recovery.tar.gz \
+				--backup=simple &gt;/tmp/rFiles &amp;
+		fi
 		rPID=$!
 		while kill -0 $rPID &amp;&gt;/dev/null;do
-			rReady=$(cat /tmp/rFiles | wc -l)
+			rReady=$(cat /tmp/rFiles | grep -v ^Renaming | wc -l)
 			#Echo -e -n &quot;$rReady files from $rFiles restored...\r&quot;
 			getText &quot;%1 files from %2 restored...&quot; $rReady $rFiles &gt; /progress
 			sleep 1
 		done
+		#======================================
+		# create backup files
+		#--------------------------------------
+		if [ -z &quot;$RESTORE&quot; ];then
+			rReady=0
+			getText &quot;backing up: %1...&quot; &quot;0%&quot; &gt; /progress
+			for backup in $(find -type f -name &quot;*~&quot;);do
+				origin=$(echo $backup | tr -d &quot;~&quot;)
+				txdiff=$(diff -u $origin $backup 2&gt;/dev/null)
+				if [ $? = 1 ];then
+					printf &quot;%s\n&quot; &quot;$txdiff&quot; &gt; $backup
+				else
+					rm $backup
+				fi
+				rReady=$((rReady + 1))
+				rPDone=$((rFiles / rReady))
+				rPDone=$((100 / rPDone))
+				getText &quot;backing up: %1...&quot; &quot;$rPDone%&quot; &gt; /progress
+			done
+		fi
 		dPID=$(pidof mst)
 		kill $dPID
 	)&amp;


hooks/post-receive
-- 
Project kiwi at BerliOS

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001469.html">[Kiwi-devel] [Git]Project kiwi at BerliOS branch, master,	updated. 84f8675add2605c104d7c18e568be982a3efd39d
</A></li>
	
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1470">[ date ]</a>
              <a href="thread.html#1470">[ thread ]</a>
              <a href="subject.html#1470">[ subject ]</a>
              <a href="author.html#1470">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/kiwi-devel">More information about the Kiwi-devel
mailing list</a><br>
</body></html>

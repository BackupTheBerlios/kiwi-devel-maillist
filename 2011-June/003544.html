<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Kiwi-devel] [Git]Project kiwi at BerliOS branch, master,	updated. 3ecfe97b0d3c411bdf86c8e03cd2d8cdba311900
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/kiwi-devel/2011-June/index.html" >
   <LINK REL="made" HREF="mailto:kiwi-devel%40lists.berlios.de?Subject=Re%3A%20%5BKiwi-devel%5D%20%5BGit%5DProject%20kiwi%20at%20BerliOS%20branch%2C%20master%2C%0A%09updated.%203ecfe97b0d3c411bdf86c8e03cd2d8cdba311900&In-Reply-To=%3C20110616205226.37FA6481297%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="003538.html">
   <LINK REL="Next"  HREF="003545.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Kiwi-devel] [Git]Project kiwi at BerliOS branch, master,	updated. 3ecfe97b0d3c411bdf86c8e03cd2d8cdba311900</H1>
    <B>marcus_schaefer at BerliOS</B> 
    <A HREF="mailto:kiwi-devel%40lists.berlios.de?Subject=Re%3A%20%5BKiwi-devel%5D%20%5BGit%5DProject%20kiwi%20at%20BerliOS%20branch%2C%20master%2C%0A%09updated.%203ecfe97b0d3c411bdf86c8e03cd2d8cdba311900&In-Reply-To=%3C20110616205226.37FA6481297%40sheep.berlios.de%3E"
       TITLE="[Kiwi-devel] [Git]Project kiwi at BerliOS branch, master,	updated. 3ecfe97b0d3c411bdf86c8e03cd2d8cdba311900">marcus_schaefer at mail.berlios.de
       </A><BR>
    <I>Thu Jun 16 22:52:24 CEST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="003538.html">[Kiwi-devel] [Git]Project kiwi at BerliOS branch,	KIWI-374-SuSE-11-1-SLE-SP-Devel,	updated. a2dfb53b39cbe9439375ce2116ffb622f9118b16
</A></li>
        <LI>Next message: <A HREF="003545.html">[Kiwi-devel] obs links issue and proposed patch
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3544">[ date ]</a>
              <a href="thread.html#3544">[ thread ]</a>
              <a href="subject.html#3544">[ subject ]</a>
              <a href="author.html#3544">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>This is an automated email from the git hooks/post-receive script. It was
generated because a ref change was pushed to the repository containing
the project &quot;Project kiwi at BerliOS&quot;.

The branch, master has been updated
       via  3ecfe97b0d3c411bdf86c8e03cd2d8cdba311900 (commit)
       via  7e22468da41402d22ba134509d5548bf073d359d (commit)
       via  19b58038380336bca768dcc912ead2499aae67e5 (commit)
      from  f906db3e38127c5a22bdfb8b25f55b7c4f441a81 (commit)

Those revisions listed above that are new to this repository have
not appeared on any other notification email; so we list those
revisions in full, below.

- Log -----------------------------------------------------------------
commit 3ecfe97b0d3c411bdf86c8e03cd2d8cdba311900
Author: Marcus Sch&#195;&#164;fer &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/kiwi-devel">ms at novell.com</A>&gt;
Date:   Thu Jun 16 22:45:35 2011 +0200

    - fixed build on Centos/Redhat, recommended packages like
      jing or zypper does not exist there so we had to check
      the distro in that case

commit 7e22468da41402d22ba134509d5548bf073d359d
Author: Marcus Sch&#195;&#164;fer &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/kiwi-devel">ms at novell.com</A>&gt;
Date:   Thu Jun 16 22:42:01 2011 +0200

    - fixed the patternType validation bug reported by John Lund
      on the users list. The patch also adds a new test case xml
      file for the KIWIXMLValidator unit test.

commit 19b58038380336bca768dcc912ead2499aae67e5
Author: Marcus Sch&#195;&#164;fer &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/kiwi-devel">ms at novell.com</A>&gt;
Date:   Thu Jun 16 22:33:37 2011 +0200

    - added a new example for 11.3, 11.4, and 12.1. This example
      demonstrates the use of Kiwi to create cloud setup images
      and a guest images for clouds based on the OpenNebula
      infrastructure.

-----------------------------------------------------------------------

Summary of changes:
diff --git a/doc/examples/extras/suse-11.3/suse-nebula-cloud.readme b/doc/examples/extras/suse-11.3/suse-nebula-cloud.readme
new file mode 100644
index 0000000..00599e6
--- /dev/null
+++ b/doc/examples/extras/suse-11.3/suse-nebula-cloud.readme
@@ -0,0 +1,68 @@
+KIWI Image Description Example
+==============================
+* This example provides the configuration for a cloud setup based on the
+  OpenNebula project. The example contains three configuration trees, one
+  for the cloud head node, one for a cloud node, and one for a guest that
+  can be setup to run on the cloud.
+
+  The guest configuration example is slightly specialized to also function
+  as a basic test image for coud setup verification. The name of the resulting
+  image is incoded in the file /home/ctester/testVM.one. Also the config.sh
+  script modifies the dhcp client configuration file such that a DHCP lease
+  is only accepted from a server that can provide the &quot;suse-nebula&quot; feature.
+  The &quot;suse-nebula&quot; feature is the default setting in the YaST setup module
+  executed on firstboot after the head node installation.
+
+  Both the head node and cloud node images are oem images targeted to be
+  deployed from a USB stick. Both images will shutdown the machine after the
+  deployment is complete, a sign that the USB stick can be removed.
+
+  A keyboard and monitor need to be connected to the head node on firstboot
+  to complete the configuration. After the head node is configured cloud nodes 
+  can be deployed, or if deployed already be turned on. Cloud nodes will self
+  configure on first boot and register themselves with the cloud infrastructure
+  running on the head node.
+
+  The head node contains a /home/ctester directory that is setup to deploy the
+  guest image built with the cloud_guest tree. See the testVM.README file for
+  additional details.
+
+  For administration of the cloud infrastrusture see the documentation provided
+  by the OpenNebula project.
+
+  <A HREF="http://opennebula.org/documentation">http://opennebula.org/documentation</A>
+
+How to build this Example
+==============================
+
+* Head Node
+    kiwi -p /usr/share/doc/packages/kiwi/examples/extras/suse-11.3/suse-nebula-cloud/cloud_head --root /tmp/neb_head_unpacked
+
+    kiwi --create /tmp/neb_head_unpacked -d /tmp/neb_head_image
+
+* Cloud Node
+    kiwi -p /usr/share/doc/packages/kiwi/examples/extras/suse-11.3/suse-nebula-cloud/cloud_cloud --root /tmp/neb_cloud_unpacked
+
+    kiwi --create /tmp/neb_cloud_unpacked -d /tmp/neb_cloud_img
+
+* Guest
+    kiwi -p /usr/share/doc/packages/kiwi/examples/extras/suse-11.3/suse-nebula-cloud/cloud_guest --root /tmp/neb_guest_unpacked
+
+    kiwi --create /tmp/neb_guest_unpacked -d /tmp/neb_guest_img
+  
+How to test this Example
+==============================
+* The OEM images for the head node and cloud node can be dumped onto a USB
+  stick. Then appropriate machines can be booted from the stick. The head
+  node can run inside a VM. Cloud node machines for this example must have
+  processor(s) that support virtualization instructions as the example uses
+  KVM. You can modify the example to use Xen, if this is your preferred
+  hypervisor solution.
+
+Login Details Head and Cloud
+==============================
+* As configured during firstboot of the head node
+
+Login Details Guest
+==============================
+* User root pwd: linux
diff --git a/doc/examples/suse-11.3/suse-xen-guest/config.sh b/doc/examples/extras/suse-11.3/suse-nebula-cloud/cloud_cloud/config.sh
similarity index 67%
copy from doc/examples/suse-11.3/suse-xen-guest/config.sh
copy to doc/examples/extras/suse-11.3/suse-nebula-cloud/cloud_cloud/config.sh
index 098002e..b069be0 100755
--- a/doc/examples/suse-11.3/suse-xen-guest/config.sh
+++ b/doc/examples/extras/suse-11.3/suse-nebula-cloud/cloud_cloud/config.sh
@@ -5,12 +5,12 @@
 # PROJECT       : OpenSuSE KIWI Image System
 # COPYRIGHT     : (c) 2006 SUSE LINUX Products GmbH. All rights reserved
 #               :
-# AUTHOR        : Marcus Schaefer &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/kiwi-devel">ms at suse.de</A>&gt;
+# AUTHOR        : Robert Scwheikert &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/kiwi-devel">rschweikert at novell.com</A>&gt;
 #               :
 # BELONGS TO    : Operating System images
 #               :
 # DESCRIPTION   : configuration script for SUSE based
-#               : operating systems
+#               : OpenNebula cloud node
 #               :
 #               :
 # STATUS        : BETA
@@ -37,16 +37,26 @@ suseSetupProduct
 suseActivateDefaultServices
 suseInsertService boot.device-mapper
 suseInsertService sshd
+suseInsertService libvirtd
 
 #======================================
 # SuSEconfig
 #--------------------------------------
+baseUpdateSysConfig /etc/sysconfig/network/dhcp DHCLIENT_BIN dhclient
+# Disable IPv6
+baseUpdateSysConfig /etc/sysconfig/network/dhcp DHCLIENT6_BIN /bin/false
+echo &#226;&#128;&#156;alias net-pf-10 off&#226;&#128;&#157; &gt;&gt; /etc/modprobe.conf.local
+echo &#226;&#128;&#156;alias ipv6 off&#226;&#128;&#157; &gt;&gt; /etc/modprobe.conf.local
+sed -i &quot;s/#net.ipv6.conf.all.disable_ipv6 = 1/net.ipv6.conf.all.disable_ipv6 = 1&quot; /etc/sysctl.conf
+# Configure libvirt settings
+sed -i &quot;s/#listen_tcp = 1/listen_tcp = 1/&quot; /etc/libvirt/libvirtd.conf
+
 suseConfig
 
 #======================================
-# clone runlevel 3 to 4
+# Misc
 #--------------------------------------
-suseCloneRunlevel 4
+ln -s /usr/bin/qemu-kvm /usr/bin/kvm
 
 #======================================
 # Umount kernel filesystems
diff --git a/doc/examples/extras/suse-11.3/suse-nebula-cloud/cloud_cloud/config.xml b/doc/examples/extras/suse-11.3/suse-nebula-cloud/cloud_cloud/config.xml
new file mode 100644
index 0000000..cd6f05b
--- /dev/null
+++ b/doc/examples/extras/suse-11.3/suse-nebula-cloud/cloud_cloud/config.xml
@@ -0,0 +1,65 @@
+&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
+&lt;image schemaversion=&quot;5.2&quot; name=&quot;suse-11.3-OpenNebula-Cloud-Node&quot;&gt;
+	&lt;description type=&quot;system&quot;&gt;
+		&lt;author&gt;Robert Schweikert&lt;/author&gt;
+		&lt;contact&gt;<A HREF="https://lists.berlios.de/mailman/listinfo/kiwi-devel">rschweikert at novell.com</A>&lt;/contact&gt;
+		&lt;specification&gt;OpenNebula Cloud Node configuration&lt;/specification&gt;
+    &lt;/description&gt;
+    &lt;preferences&gt;
+        &lt;type image=&quot;oem&quot; filesystem=&quot;ext3&quot; boot=&quot;oemboot/suse-11.3&quot; installstick=&quot;true&quot; installboot=&quot;install&quot; boottimeout=&quot;2&quot;&gt;
+			&lt;oemconfig&gt;
+				&lt;oem-boot-title&gt;OpenNebula Cloud Node&lt;/oem-boot-title&gt;
+				&lt;oem-shutdown&gt;true&lt;/oem-shutdown&gt;
+				&lt;oem-swap&gt;true&lt;/oem-swap&gt;
+				&lt;oem-swapsize&gt;2048&lt;/oem-swapsize&gt;
+                &lt;oem-unattended&gt;true&lt;/oem-unattended&gt;
+			&lt;/oemconfig&gt;
+		&lt;/type&gt;
+		&lt;version&gt;1.1.0&lt;/version&gt;
+		&lt;packagemanager&gt;zypper&lt;/packagemanager&gt;
+		&lt;rpm-check-signatures&gt;false&lt;/rpm-check-signatures&gt;
+		&lt;rpm-force&gt;true&lt;/rpm-force&gt;
+		&lt;locale&gt;en_US&lt;/locale&gt;
+		&lt;keytable&gt;us.map.gz&lt;/keytable&gt;
+	&lt;/preferences&gt;
+	&lt;users group=&quot;root&quot;&gt;
+		&lt;user pwd=&quot;cloudDemo&quot; pwdformat=&quot;plain&quot; home=&quot;/root&quot; name=&quot;root&quot;/&gt;
+	&lt;/users&gt;
+	&lt;repository type=&quot;yast2&quot;&gt;
+		&lt;source path=&quot;<A HREF="opensuse://11.3/repo/oss/">opensuse://11.3/repo/oss/</A>&quot;/&gt;
+	&lt;/repository&gt;
+    &lt;repository type=&quot;rpm-md&quot;&gt;
+        &lt;source path=&quot;<A HREF="http://download.opensuse.org/repositories/Virtualization:/Cloud:/OpenNebula/openSUSE_11.3">http://download.opensuse.org/repositories/Virtualization:/Cloud:/OpenNebula/openSUSE_11.3</A>&quot;/&gt;
+    &lt;/repository&gt;
+	&lt;packages type=&quot;image&quot; patternType=&quot;plusRecommended&quot;&gt;
+		&lt;opensusePattern name=&quot;base&quot;/&gt;
+		&lt;package name=&quot;bootsplash&quot;/&gt;
+        &lt;package name=&quot;bootsplash-branding-openSUSE&quot; bootinclude=&quot;true&quot; bootdelete=&quot;true&quot;/&gt;
+		&lt;package name=&quot;bridge-utils&quot;/&gt;
+		&lt;package name=&quot;dhcp-client&quot;/&gt;
+        &lt;package name=&quot;gfxboot-branding-openSUSE&quot; bootinclude=&quot;true&quot; bootdelete=&quot;true&quot;/&gt;
+		&lt;package name=&quot;ifplugd&quot;/&gt;
+		&lt;package name=&quot;iptables&quot;/&gt;
+		&lt;package name=&quot;iputils&quot;/&gt;
+		&lt;package name=&quot;kernel-default&quot;/&gt;
+        &lt;package name=&quot;kvm&quot;/&gt;
+        &lt;package name=&quot;libvirt&quot;/&gt;
+        &lt;package name=&quot;nfs-client&quot;/&gt;
+        &lt;package name=&quot;openssh&quot;/&gt;
+        &lt;package name=&quot;openssl&quot;/&gt;
+        &lt;package name=&quot;qemu&quot;/&gt;
+		&lt;package name=&quot;rsyslog&quot;/&gt;
+        &lt;package name=&quot;ruby&quot;/&gt;
+        &lt;package name=&quot;rubygems&quot;/&gt;
+        &lt;package name=&quot;rubygem-libxml-ruby&quot;/&gt;
+        &lt;package name=&quot;rubygem-nokogiri&quot;/&gt;
+        &lt;package name=&quot;terminfo&quot;/&gt;
+		&lt;package name=&quot;vi&quot;/&gt;
+        &lt;package name=&quot;xmlrpc-c&quot;/&gt;
+        &lt;package name=&quot;yast2-nfs-client&quot;/&gt;
+	&lt;/packages&gt;
+	&lt;packages type=&quot;bootstrap&quot;&gt;
+		&lt;package name=&quot;filesystem&quot;/&gt;
+		&lt;package name=&quot;glibc-locale&quot;/&gt;
+	&lt;/packages&gt;
+&lt;/image&gt;
diff --git a/doc/examples/extras/suse-11.3/suse-nebula-cloud/cloud_cloud/root/etc/HOSTNAME b/doc/examples/extras/suse-11.3/suse-nebula-cloud/cloud_cloud/root/etc/HOSTNAME
new file mode 100644
index 0000000..6cfc2eb
--- /dev/null
+++ b/doc/examples/extras/suse-11.3/suse-nebula-cloud/cloud_cloud/root/etc/HOSTNAME
@@ -0,0 +1 @@
+node1.SUSENebula
diff --git a/doc/examples/extras/suse-11.3/suse-nebula-cloud/cloud_cloud/root/etc/init.d/boot.local b/doc/examples/extras/suse-11.3/suse-nebula-cloud/cloud_cloud/root/etc/init.d/boot.local
new file mode 100755
index 0000000..45c6d97
--- /dev/null
+++ b/doc/examples/extras/suse-11.3/suse-nebula-cloud/cloud_cloud/root/etc/init.d/boot.local
@@ -0,0 +1,6 @@
+#!/bin/sh
+
+if [ -f /var/lib/firstboot ]; then
+    /usr/share/firstboot/scripts/cloudNodeConfig
+    rm /var/lib/firstboot
+fi
diff --git a/doc/examples/extras/suse-11.3/suse-nebula-cloud/cloud_cloud/root/etc/polkit-1/localauthority/50-local.d/60-suseNebula-access.pkla b/doc/examples/extras/suse-11.3/suse-nebula-cloud/cloud_cloud/root/etc/polkit-1/localauthority/50-local.d/60-suseNebula-access.pkla
new file mode 100644
index 0000000..b5a2ef4
--- /dev/null
+++ b/doc/examples/extras/suse-11.3/suse-nebula-cloud/cloud_cloud/root/etc/polkit-1/localauthority/50-local.d/60-suseNebula-access.pkla
@@ -0,0 +1,6 @@
+[Remote libvirt SSH access]
+ Identity=unix-user:oneadmin
+ Action=org.libvirt.unix.manage
+ ResultAny=yes
+ ResultInactive=yes
+ ResultActive=yes
diff --git a/doc/examples/extras/suse-11.3/suse-nebula-cloud/cloud_cloud/root/usr/share/firstboot/scripts/cloudNodeConfig b/doc/examples/extras/suse-11.3/suse-nebula-cloud/cloud_cloud/root/usr/share/firstboot/scripts/cloudNodeConfig
new file mode 100755
index 0000000..bc1da61
--- /dev/null
+++ b/doc/examples/extras/suse-11.3/suse-nebula-cloud/cloud_cloud/root/usr/share/firstboot/scripts/cloudNodeConfig
@@ -0,0 +1,372 @@
+#!/usr/bin/python
+
+&quot;&quot;&quot;SUSENebula cloud node configurator.&quot;&quot;&quot;
+
+import glob
+import os
+import re
+import socket
+import sys
+import syslog
+import time
+
+#------------------------------------------------------------------------
+def configureNode(confSettings):
+    &quot;&quot;&quot;Configure this node.&quot;&quot;&quot;
+    # Setup keyboard layout
+    layout = confSettings['keyLayout']
+    msg = 'Setting keyboard layout to: %s\n' %layout
+    syslog.syslog(syslog.LOG_INFO, msg)
+    os.system('/sbin/yast2 keyboard set layout=%s' %layout)
+    # Setup the timezone
+    zone = confSettings['timezone']
+    hwc = confSettings['hwclock'].lower()
+    msg = 'Setting timezone and hwclock to: %s, %s' %(zone, hwc)
+    syslog.syslog(syslog.LOG_INFO, msg)
+    os.system('/sbin/yast2 timezone set timezone=%s hwclock=%s' %(zone, hwc))
+        # Setup hostname
+    domain = confSettings['domainname']
+    name = confSettings['hostname']
+    host = '%s.%s' %(name, domain)
+    msg = 'Setting hostname to: %s\n' %host
+    hf = open('/etc/HOSTNAME', 'w')
+    hf.write(host)
+    hf.close()
+    # Add the hostname to the dhcp configuration info
+    lines = open('/etc/sysconfig/network/dhcp', 'r').readlines()
+    dhf = open('/etc/sysconfig/network/dhcp', 'w')
+    for ln in lines:
+        if ln.find('DHCLIENT_HOSTNAME_OPTION') != -1:
+            dhf.write('DHCLIENT_HOSTNAME_OPTION=&quot;%s&quot;' %name)
+            continue
+        dhf.write(ln)
+    dhf.close()
+    # Add the dhcp feature to avoid dhcp acceptance from servers other than
+    # the head node
+    feature = confSettings['dhcpFeature']
+    msg = 'Setting dhclient required feature to: %s\n' %feature
+    syslog.syslog(syslog.LOG_INFO, msg)
+    dhcf = open('/etc/dhclient.conf','a')
+    dhcf.write('option %s code 239 = ip-address;\n' %feature)
+    dhcf.write('request %s;\n' %feature)
+    dhcf.write('require %s;\n' %feature)
+    dhcf.close()
+    # Setup the name resolution
+    syslog.syslog(syslog.LOG_INFO, 'Setting up resolve.conf\n')
+    res = open('/etc/resolv.conf', 'w')
+    res.write(confSettings['resolve'])
+    res.close()
+    # Setup the routes
+    syslog.syslog(syslog.LOG_INFO, 'Setting up routes\n')
+    routes = open('/etc/sysconfig/network/routes', 'w')
+    routes.write(confSettings['routes'])
+    routes.close()
+    # Setup the root password
+    syslog.syslog(syslog.LOG_INFO, 'Setting root password\n')
+    lines = open('/etc/shadow', 'r').readlines()
+    shadow = open('/etc/shadow','w')
+    for ln in lines:
+        if ln[:4] == 'root':
+            shadow.write('root:')
+            shadow.write(confSettings['rootpass'])
+            shadow.write(':')
+            shadow.write(ln.split(':')[2])
+            shadow.write('::::::\n')
+            continue
+        shadow.write(ln)
+    shadow.close()
+    # Setup the cloud administartor acount
+    # Use eval; convert strings to tuple
+    gname, gid = eval(confSettings['groupID'])
+    uname, uid, pwd = eval(confSettings['userID'])
+    msg = 'Setting up %s with uid, gid: %s, %s\n' %(uname,uid,gid)
+    syslog.syslog(syslog.LOG_INFO, msg)
+    res = os.system('/usr/sbin/groupadd -g %s %s' %(gid, gname))
+    if res:
+        msg = 'Could not add %s group. ' %gname
+        msg += 'Incomplete configuration\n'
+        syslog.syslog(syslog.LOG_INFO, msg)
+        return -1
+    res = os.system(
+        '/usr/sbin/useradd -c &quot;%s&quot; -d %s -g %s -G %s -u %s -p %s -m %s'
+        %('Cloud admin', '/var/lib/one', gid, 'kvm,root', uid, pwd, uname))
+    if res:
+        msg = 'Could not add %s user. ' %uname
+        msg += 'Incomplete configuration\n'
+        syslog.syslog(syslog.LOG_INFO, msg)
+        return -1
+    # Setup nfs mount in fstab
+    syslog.syslog(syslog.LOG_INFO, 'Setting up NFS mount in fstab\n')
+    fst = open('/etc/fstab', 'a')
+    fst.write(confSettings['serverIP'])
+    fst.write(':/var/lib/one')
+    fst.write('\t/var/lib/one\tnfs\tdefaults\t1 1\n')
+    fst.close()
+            
+    return 1
+
+#----------------------------------------------------------------------------
+def getConfigFromServer():
+    &quot;&quot;&quot;Get the configuration from the service running on the head node.&quot;&quot;&quot;
+    syslog.syslog(syslog.LOG_INFO, 'Obtain node configuration from head\n')
+    s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
+    try:
+        s.connect(('169.254.1.1',  8445))
+    except:
+        msg = 'Could not connect to head node at 169.254.1.1 port  8445\n'
+        syslog.syslog(syslog.LOG_INFO, msg)
+        return -1
+    # Request the configuration info from the head node
+    s.send('PROVIDE_CONFIG')
+    confSettings = {}
+    confData = ''
+    # Read the configuration data from the socket
+    while 1:
+        data = s.recv(4096)
+        confData += data
+        if confData.find('COMPLETE') != -1:
+            break
+    s.close()
+    # Populate the configuration data dict
+    for confItem in confData.split(';'):
+        key, value = confItem.split('=', 1)
+        if key != 'COMPLETE':
+            confSettings[key] = value
+    return confSettings
+
+#----------------------------------------------------------------------------
+def getFirstConnectedInterface():
+    &quot;&quot;&quot;Find the interface that has a cable connected.&quot;&quot;&quot;
+    iFaceInfo = os.popen('/usr/sbin/hwinfo').readlines()
+    iFaceName = None
+    processBlock = None
+    for ln in iFaceInfo:
+        if ln.strip() == '':
+            processBlock = None
+            continue
+        if processBlock:
+            if ln.find('SysFS ID') != -1:
+                iFaceName = ln.split(':')[-1].split('/')[-1].strip()
+                continue
+            if ln.find('Link detected') != -1:
+                carrier = ln.split(':')[-1].strip()
+                if carrier == 'yes':
+                    if iFaceName:
+                        return iFaceName
+                else:
+                    continue
+        if re.match(r'^\d+:.*Ethernet$',ln):
+            processBlock = 1
+            continue
+
+    return -1 # No network interface is connected 
+
+#----------------------------------------------------------------------------
+def registerNode():
+    &quot;&quot;&quot;Register this node with the head node.&quot;&quot;&quot;
+    syslog.syslog(syslog.LOG_INFO, 'Register the node with the head node.\n')
+    # Get the IP and MAC Address of this node
+    ipInfo = os.popen('/sbin/ifconfig').readlines()
+    processBlk = None
+    ipAddr = None
+    macAddr = None
+    for ln in ipInfo:
+        if ipAddr and macAddr:
+            break
+        if processBlk:
+            if ln.find('inet addr') != -1:
+                ipAddr = ln.split(':')[1].split()[0].strip()
+                continue
+        # We always setup br0, see setupCloudNetwork()
+        if ln.find('br0') != -1:
+            processBlk = 1
+            macAddr = ln.split()[-1].strip()
+    if not ipAddr:
+        msg = 'Could not determine IP of this node. '
+        msg += 'Unable to gergister node.\n'
+        syslog.syslog(syslog.LOG_INFO, msg)
+        return -1
+    if not macAddr:
+        msg = 'Could not determine MAC of this node. '
+        msg += 'Unable to gergister node.\n'
+        syslog.syslog(syslog.LOG_INFO, msg)
+        return -1
+    # Get the server IP from fstab, see configureNode()
+    fst = open('/etc/fstab','r').readlines()
+    servIP = None
+    for ln in fst:
+        if ln.find('/var/lib/one') != -1:
+            servIP = ln.split(':')[0].strip()
+    if not servIP:
+        msg = 'Could not determine head node IP from /etc/fstab. '
+        msg += 'Unable to gergister node.\n'
+        syslog.syslog(syslog.LOG_INFO, msg)
+        return -1
+    # Hostname
+    myName = open('/etc/HOSTNAME', 'r').read().split('.')[0].strip()
+    # Connect to server and register
+    s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
+    try:
+        s.connect((servIP,  8445))
+    except:
+        msg = 'Could not connect to head node at %s port  8445\n' %servIP
+        syslog.syslog(syslog.LOG_INFO, msg)
+        return -1
+    regInfo = '%s;%s;%s' %(macAddr, ipAddr, myName)
+    s.send(regInfo)
+    s.close()
+
+    return 1
+    
+#----------------------------------------------------------------------------
+def removeConfNetworkSetting(iFace):
+    &quot;&quot;&quot;Shutdown the configuration network and remove the configuration.&quot;&quot;&quot;
+    syslog.syslog(syslog.LOG_INFO, 'Shutdown configuartion network\n')
+    os.system('/sbin/ifdown %s' %iFace)
+    msg = 'Remove configuration network interface config\n'
+    syslog.syslog(syslog.LOG_INFO, msg)
+    os.remove('/etc/sysconfig/network/ifcfg-%s' %iFace)
+
+#----------------------------------------------------------------------------
+def setupCloudNetwork(iFace):
+    &quot;&quot;&quot;Setup the configuration for the cloud network and fire it up.&quot;&quot;&quot;
+    msg = 'Setup cloud network configuration as br0\n'
+    syslog.syslog(syslog.LOG_INFO, msg)
+    cfgF = open('/etc/sysconfig/network/ifcfg-br0', 'w')
+    cfgF.write(&quot;BOOTPROTO='dhcp'\n&quot;)
+    cfgF.write(&quot;BRIDGE='yes'\n&quot;)
+    cfgF.write(&quot;BRIDGE_FORWARDDELAY='0'\n&quot;)
+    cfgF.write(&quot;BRIDGE_PORTS='%s'\n&quot; %iFace)
+    cfgF.write(&quot;BRIDGE_STP='off'\n&quot;)
+    cfgF.write(&quot;BROADCAST=''\n&quot;)
+    cfgF.write(&quot;ETHTOOL_OPTIONS=''\n&quot;)
+    cfgF.write(&quot;MTU=''\n&quot;)
+    cfgF.write(&quot;NAME=''\n&quot;)
+    cfgF.write(&quot;NETWORK=''\n&quot;)
+    cfgF.write(&quot;REMOTE_IPADDR=''\n&quot;)
+    cfgF.write(&quot;STARTMODE='auto'\n&quot;)
+    cfgF.write(&quot;USERCONTROL='no'&quot;)
+    cfgF.close()
+    
+#----------------------------------------------------------------------------
+def setupConfNetwork(iFace):
+    &quot;&quot;&quot;Setup the interface provided as the configuration network with a
+       static IP.&quot;&quot;&quot;
+    syslog.syslog(syslog.LOG_INFO, 'Setup configuration network 169.254.1.2\n')
+    cfgF = open('/etc/sysconfig/network/ifcfg-%s' %iFace, 'w')
+    cfgF.write(&quot;BOOTPROTO='static'\n&quot;)
+    cfgF.write(&quot;BROADCAST=''\n&quot;)
+    cfgF.write(&quot;ETHTOOL_OPTIONS=''\n&quot;)
+    cfgF.write(&quot;IPADDR='169.254.1.2/24'\n&quot;)
+    cfgF.write(&quot;MTU=''\n&quot;)
+    cfgF.write(&quot;NAME='Cloud configuration network'\n&quot;)
+    cfgF.write(&quot;NETWORK=''\n&quot;)
+    cfgF.write(&quot;REMOTE_IPADDR=''\n&quot;)
+    cfgF.write(&quot;STARTMODE='auto'\n&quot;)
+    cfgF.write(&quot;USERCONTROL='no'&quot;)
+    cfgF.close()
+
+#----------------------------------------------------------------------------
+def startCloudNetwork():
+    &quot;&quot;&quot;Start the cloud network.&quot;&quot;&quot;
+    syslog.syslog(syslog.LOG_INFO, 'Starting cloud network\n')
+    os.system('/sbin/ifup br0')
+    cnt = 0
+    # Cannot depend on the ifup exit status as we need to play a trick to
+    # disable IPv6 which always leads to a non zero exit status
+    # Therefore we probe whether or not we get an IP address assigned
+    while cnt &lt; 10:
+        time.sleep(15) # give dhcp a chance to get an address
+        processBlock = None
+        ifaceInfo = os.popen('/sbin/ifconfig').readlines()
+        for ln in ifaceInfo:
+            if ln.find('br0') != -1:
+                processBlock = 1
+                continue
+            if processBlock and ln.find('inet addr') != -1:
+                addr = ln.split(':')[1].split()[0].strip()
+                if addr.find('.') != -1:
+                    cnt = 99
+                    break
+        cnt += 1
+    if cnt != 100:
+        return -1
+
+    return 1
+
+#----------------------------------------------------------------------------
+def startNetwork(iFace, type):
+    &quot;&quot;&quot;Start the specified network interface.&quot;&quot;&quot;
+    msg = 'Start %s network interface on %s\n' %(type, iFace)
+    syslog.syslog(syslog.LOG_INFO, msg)
+    res = os.system('/sbin/ifup %s' %iFace)
+    if res:
+        return -1
+
+    return 1
+
+#----------------------------------------------------------------------------
+if __name__ == &quot;__main__&quot;:
+    # Triggered from boot.local, thus this runs prior to services being started
+    # Start the syslog service to make sure our messages are recorded
+    os.system('/etc/init.d/syslog start &gt;&amp; /dev/null')
+    syslog.openlog('[CLOUD_NODE_SETUP]', syslog.LOG_PID, syslog.LOG_DAEMON)
+    syslog.syslog(syslog.LOG_INFO, 'Start node registration and setup\n')
+    iFace = getFirstConnectedInterface()
+    if iFace == -1:
+        msg = 'Could not determine connected network interface aborting'
+        msg += ' node configuration\n'
+        syslog.syslog(syslog.LOG_INFO, msg)
+        syslog.closelog()
+        sys.exit(1)
+    setupConfNetwork(iFace)
+    res = startNetwork(iFace, 'configuration')
+    if res == -1:
+        msg = 'Could not start the network interface to configure the '
+        msg += 'cloud node, manual configuration required.\n'
+        syslog.syslog(syslog.LOG_INFO, msg)
+        syslog.closelog()
+        sys.exit(1)
+    confDict = getConfigFromServer()
+    if confDict == -1:
+        msg = 'Could not connect to configuration server at 169.254.1.1 '
+        msg += 'cloud node, manual configuration required.\n'
+        msg += 'This IP:  169.254.1.2\n'
+        syslog.syslog(syslog.LOG_INFO, msg)
+        syslog.closelog()
+        sys.exit(1)
+    removeConfNetworkSetting(iFace)
+    setupCloudNetwork(iFace)
+    res = configureNode(confDict)
+    if res == -1:
+        msg = 'Configuration failure. Manual configuration requires.\n'
+        syslog.syslog(syslog.LOG_INFO, msg)
+        syslog.closelog()
+        sys.exit(1)
+    # Setup cloud network
+    res = startCloudNetwork()
+    if res == -1:
+        msg = 'Cloud network setup and start up failed. Manual configuration '
+        msg += 'required\n'
+        syslog.syslog(syslog.LOG_INFO, msg)
+        syslog.closelog()
+        sys.exit(1)
+    # NFS setup
+    syslog.syslog(syslog.LOG_INFO, 'Insert nfs and start service\n')
+    os.system('/sbin/insserv nfs')
+    # Register the node with the head node
+    res = registerNode()
+    if res == -1:
+        msg = 'Could not register the node. Manual registration on head node '
+        msg += 'required. (dhcp and one)\n'
+        syslog.syslog(syslog.LOG_INFO, msg)
+        syslog.closelog()
+        sys.exit(1)
+    # Stop the network interface, will be started during service startup
+    os.system('/sbin/ifdown br0')
+    msg = 'Cloud node configuration completed with success.\n'
+    syslog.syslog(syslog.LOG_INFO, msg)
+    syslog.closelog()
+    # Stop the syslog service, will be started again during service startup
+    os.system('/etc/init.d/syslog stop &gt;&amp; /dev/null')
+
diff --git a/tools/burner/INSTALL b/doc/examples/extras/suse-11.3/suse-nebula-cloud/cloud_cloud/root/var/lib/firstboot
similarity index 100%
copy from tools/burner/INSTALL
copy to doc/examples/extras/suse-11.3/suse-nebula-cloud/cloud_cloud/root/var/lib/firstboot
diff --git a/doc/examples/suse-11.3/suse-xen-guest/config.sh b/doc/examples/extras/suse-11.3/suse-nebula-cloud/cloud_guest/config.sh
similarity index 63%
copy from doc/examples/suse-11.3/suse-xen-guest/config.sh
copy to doc/examples/extras/suse-11.3/suse-nebula-cloud/cloud_guest/config.sh
index 098002e..6dc8de5 100755
--- a/doc/examples/suse-11.3/suse-xen-guest/config.sh
+++ b/doc/examples/extras/suse-11.3/suse-nebula-cloud/cloud_guest/config.sh
@@ -3,9 +3,9 @@
 # FILE          : config.sh
 #----------------
 # PROJECT       : OpenSuSE KIWI Image System
-# COPYRIGHT     : (c) 2006 SUSE LINUX Products GmbH. All rights reserved
+# COPYRIGHT     : (c) 2011 SUSE LINUX Products GmbH. All rights reserved
 #               :
-# AUTHOR        : Marcus Schaefer &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/kiwi-devel">ms at suse.de</A>&gt;
+# AUTHOR        : Robert Schweikert
 #               :
 # BELONGS TO    : Operating System images
 #               :
@@ -41,12 +41,19 @@ suseInsertService sshd
 #======================================
 # SuSEconfig
 #--------------------------------------
-suseConfig
+baseUpdateSysConfig /etc/sysconfig/bootloader LOADER_LOCATION mbr
+baseUpdateSysConfig /etc/sysconfig/network/dhcp DHCLIENT_BIN dhclient
+# Disable IPv6
+baseUpdateSysConfig /etc/sysconfig/network/dhcp DHCLIENT6_BIN /bin/false
+echo &#226;&#128;&#156;alias net-pf-10 off&#226;&#128;&#157; &gt;&gt; /etc/modprobe.conf.local
+echo &#226;&#128;&#156;alias ipv6 off&#226;&#128;&#157; &gt;&gt; /etc/modprobe.conf.local
+sed -i &quot;s/#net.ipv6.conf.all.disable_ipv6 = 1/net.ipv6.conf.all.disable_ipv6 = 1&quot; /etc/sysctl.conf
 
-#======================================
-# clone runlevel 3 to 4
-#--------------------------------------
-suseCloneRunlevel 4
+echo &quot;option suse-nebula code 239 = ip-address;&quot; &gt;&gt; /etc/dhclient.conf
+echo &quot;require suse-nebula;&quot; &gt;&gt; /etc/dhclient.conf
+echo &quot;request suse-nebula;&quot; &gt;&gt; /etc/dhclient.conf
+
+suseConfig
 
 #======================================
 # Umount kernel filesystems
diff --git a/doc/examples/suse-11.3/suse-vm-guest/config.xml b/doc/examples/extras/suse-11.3/suse-nebula-cloud/cloud_guest/config.xml
similarity index 78%
copy from doc/examples/suse-11.3/suse-vm-guest/config.xml
copy to doc/examples/extras/suse-11.3/suse-nebula-cloud/cloud_guest/config.xml
index 932eecc..36226d4 100644
--- a/doc/examples/suse-11.3/suse-vm-guest/config.xml
+++ b/doc/examples/extras/suse-11.3/suse-nebula-cloud/cloud_guest/config.xml
@@ -1,18 +1,14 @@
 &lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
 
-&lt;image schemaversion=&quot;5.2&quot; name=&quot;suse-11.3-vm-guest&quot;&gt;
+&lt;image schemaversion=&quot;5.2&quot; name=&quot;suse-11.3-SUSENebula-guest&quot;&gt;
 	&lt;description type=&quot;system&quot;&gt;
-		&lt;author&gt;Marcus Sch&#195;&#164;fer&lt;/author&gt;
-		&lt;contact&gt;<A HREF="https://lists.berlios.de/mailman/listinfo/kiwi-devel">ms at novell.com</A>&lt;/contact&gt;
+		&lt;author&gt;Robert Schweikert&lt;/author&gt;
+		&lt;contact&gt;<A HREF="https://lists.berlios.de/mailman/listinfo/kiwi-devel">rschweikert at novell.com</A>&lt;/contact&gt;
 		&lt;specification&gt;openSUSE 11.3 virtual disk system&lt;/specification&gt;
 	&lt;/description&gt;
 	&lt;preferences&gt;
-		&lt;type image=&quot;vmx&quot; primary=&quot;true&quot; filesystem=&quot;ext4&quot; boot=&quot;vmxboot/suse-11.3&quot; format=&quot;vmdk&quot;&gt;
-			&lt;machine memory=&quot;512&quot;&gt;
-				&lt;vmdisk controller=&quot;ide&quot; id=&quot;0&quot;/&gt;
-			&lt;/machine&gt;
-		&lt;/type&gt;
-		&lt;version&gt;1.1.2&lt;/version&gt;
+		&lt;type image=&quot;vmx&quot; primary=&quot;true&quot; filesystem=&quot;ext4&quot; boot=&quot;vmxboot/suse-11.3&quot; format=&quot;qcow2&quot;/&gt;
+		&lt;version&gt;1.0.0&lt;/version&gt;
 		&lt;packagemanager&gt;zypper&lt;/packagemanager&gt;
 		&lt;rpm-check-signatures&gt;false&lt;/rpm-check-signatures&gt;
 		&lt;rpm-force&gt;true&lt;/rpm-force&gt;
@@ -30,10 +26,10 @@
 		&lt;package name=&quot;gfxboot-branding-openSUSE&quot; bootinclude=&quot;true&quot; bootdelete=&quot;true&quot;/&gt;
 		&lt;package name=&quot;kernel-default&quot;/&gt;
 		&lt;package name=&quot;ifplugd&quot;/&gt;
+        &lt;package name=&quot;iputils&quot;/&gt;
 		&lt;package name=&quot;vim&quot;/&gt;
 		&lt;opensusePattern name=&quot;base&quot;/&gt;
 	&lt;/packages&gt;
-	&lt;packages type=&quot;vmx&quot;/&gt;
 	&lt;packages type=&quot;bootstrap&quot;&gt;
 		&lt;package name=&quot;filesystem&quot;/&gt;
 		&lt;package name=&quot;glibc-locale&quot;/&gt;
diff --git a/doc/examples/suse-11.3/suse-vm-guest/root/etc/init.d/boot b/doc/examples/extras/suse-11.3/suse-nebula-cloud/cloud_guest/root/etc/init.d/boot
similarity index 99%
copy from doc/examples/suse-11.3/suse-vm-guest/root/etc/init.d/boot
copy to doc/examples/extras/suse-11.3/suse-nebula-cloud/cloud_guest/root/etc/init.d/boot
index 37c97f5..40f3352 100755
--- a/doc/examples/suse-11.3/suse-vm-guest/root/etc/init.d/boot
+++ b/doc/examples/extras/suse-11.3/suse-nebula-cloud/cloud_guest/root/etc/init.d/boot
@@ -308,7 +308,6 @@ if test -f /var/lib/YaST2/runme_at_boot ; then
 	rm -f /var/lib/YaST2/runme_at_boot
     fi
 fi
-# trigger firstboot mechanism if configured
 if test -f /var/lib/YaST2/reconfig_system ; then
     HOSTTYPE=$(uname -m)
     splashtrigger &quot;YaST&quot;
diff --git a/doc/examples/suse-11.3/suse-ec2-guest/root/etc/sysconfig/network/ifcfg-eth0 b/doc/examples/extras/suse-11.3/suse-nebula-cloud/cloud_guest/root/etc/sysconfig/network/ifcfg-eth0
similarity index 100%
copy from doc/examples/suse-11.3/suse-ec2-guest/root/etc/sysconfig/network/ifcfg-eth0
copy to doc/examples/extras/suse-11.3/suse-nebula-cloud/cloud_guest/root/etc/sysconfig/network/ifcfg-eth0
diff --git a/doc/examples/suse-11.3/suse-xen-guest/config.sh b/doc/examples/extras/suse-11.3/suse-nebula-cloud/cloud_head/config.sh
similarity index 66%
copy from doc/examples/suse-11.3/suse-xen-guest/config.sh
copy to doc/examples/extras/suse-11.3/suse-nebula-cloud/cloud_head/config.sh
index 098002e..6202091 100755
--- a/doc/examples/suse-11.3/suse-xen-guest/config.sh
+++ b/doc/examples/extras/suse-11.3/suse-nebula-cloud/cloud_head/config.sh
@@ -5,12 +5,12 @@
 # PROJECT       : OpenSuSE KIWI Image System
 # COPYRIGHT     : (c) 2006 SUSE LINUX Products GmbH. All rights reserved
 #               :
-# AUTHOR        : Marcus Schaefer &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/kiwi-devel">ms at suse.de</A>&gt;
+# AUTHOR        : Robert Scwheikert &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/kiwi-devel">rschweikert at novell.com</A>&gt;
 #               :
 # BELONGS TO    : Operating System images
 #               :
 # DESCRIPTION   : configuration script for SUSE based
-#               : operating systems
+#               : OpenNebula cloud head node
 #               :
 #               :
 # STATUS        : BETA
@@ -36,17 +36,29 @@ suseSetupProduct
 #--------------------------------------
 suseActivateDefaultServices
 suseInsertService boot.device-mapper
+suseInsertService nfsserver
 suseInsertService sshd
 
 #======================================
 # SuSEconfig
 #--------------------------------------
+baseUpdateSysConfig /etc/sysconfig/firstboot FIRSTBOOT_WELCOME_DIR /usr/share/susenebula
+# Disable IPv6
+echo &#226;&#128;&#156;alias net-pf-10 off&#226;&#128;&#157; &gt;&gt; /etc/modprobe.conf.local
+echo &#226;&#128;&#156;alias ipv6 off&#226;&#128;&#157; &gt;&gt; /etc/modprobe.conf.local
 suseConfig
 
 #======================================
-# clone runlevel 3 to 4
+# Cloud specific settings
 #--------------------------------------
-suseCloneRunlevel 4
+# Directory for authentication file must exist such that YaST module can
+# write the file
+mkdir /var/lib/one/.one
+# Set he desired permissions
+chown oneadmin:cloud /var/lib/one
+chown -R oneadmin:cloud /var/lib/one
+# The permissions for the testcase
+chown -R oneadmin:cloud /home/ctester
 
 #======================================
 # Umount kernel filesystems
diff --git a/doc/examples/extras/suse-11.3/suse-nebula-cloud/cloud_head/config.xml b/doc/examples/extras/suse-11.3/suse-nebula-cloud/cloud_head/config.xml
new file mode 100644
index 0000000..220cd8f
--- /dev/null
+++ b/doc/examples/extras/suse-11.3/suse-nebula-cloud/cloud_head/config.xml
@@ -0,0 +1,72 @@
+&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
+&lt;image schemaversion=&quot;5.2&quot; name=&quot;suse-11.3-OpenNebula-Head-Node&quot;&gt;
+	&lt;description type=&quot;system&quot;&gt;
+		&lt;author&gt;Robert Schweikert&lt;/author&gt;
+		&lt;contact&gt;<A HREF="https://lists.berlios.de/mailman/listinfo/kiwi-devel">rschweikert at novell.com</A>&lt;/contact&gt;
+		&lt;specification&gt;OpenNebula Head Node&lt;/specification&gt;
+    &lt;/description&gt;
+    &lt;preferences&gt;
+        &lt;type image=&quot;oem&quot; filesystem=&quot;ext3&quot; boot=&quot;oemboot/suse-11.3&quot; installstick=&quot;true&quot; installboot=&quot;install&quot; boottimeout=&quot;2&quot;&gt;
+			&lt;oemconfig&gt;
+				&lt;oem-boot-title&gt;OpenNebula Head Node&lt;/oem-boot-title&gt;
+				&lt;oem-shutdown&gt;true&lt;/oem-shutdown&gt;
+				&lt;oem-swap&gt;true&lt;/oem-swap&gt;
+				&lt;oem-swapsize&gt;2048&lt;/oem-swapsize&gt;
+                &lt;oem-unattended&gt;true&lt;/oem-unattended&gt;
+			&lt;/oemconfig&gt;
+		&lt;/type&gt;
+		&lt;version&gt;1.1.0&lt;/version&gt;
+		&lt;packagemanager&gt;zypper&lt;/packagemanager&gt;
+		&lt;rpm-check-signatures&gt;false&lt;/rpm-check-signatures&gt;
+		&lt;rpm-force&gt;true&lt;/rpm-force&gt;
+		&lt;locale&gt;en_US&lt;/locale&gt;
+		&lt;keytable&gt;us.map.gz&lt;/keytable&gt;
+	&lt;/preferences&gt;
+	&lt;users group=&quot;root&quot;&gt;
+		&lt;user pwd=&quot;cloudDemo&quot; pwdformat=&quot;plain&quot; home=&quot;/root&quot; name=&quot;root&quot;/&gt;
+	&lt;/users&gt;
+	&lt;repository type=&quot;yast2&quot;&gt;
+		&lt;source path=&quot;<A HREF="opensuse://11.3/repo/oss/">opensuse://11.3/repo/oss/</A>&quot;/&gt;
+	&lt;/repository&gt;
+    &lt;repository type=&quot;rpm-md&quot;&gt;
+        &lt;source path=&quot;<A HREF="http://download.opensuse.org/repositories/Virtualization:/Cloud:/OpenNebula/openSUSE_11.3">http://download.opensuse.org/repositories/Virtualization:/Cloud:/OpenNebula/openSUSE_11.3</A>&quot;/&gt;
+    &lt;/repository&gt;
+    &lt;repository type=&quot;rpm-md&quot;&gt;
+        &lt;source path=&quot;<A HREF="opensuse://11.3/repo/oss/suse/">opensuse://11.3/repo/oss/suse/</A>&quot;/&gt;
+    &lt;/repository&gt;
+	&lt;packages type=&quot;image&quot; patternType=&quot;plusRecommended&quot;&gt;
+		&lt;opensusePattern name=&quot;base&quot;/&gt;
+		&lt;package name=&quot;bootsplash&quot;/&gt;
+        &lt;package name=&quot;bootsplash-branding-openSUSE&quot; bootinclude=&quot;true&quot; bootdelete=&quot;true&quot;/&gt;
+		&lt;package name=&quot;bridge-utils&quot;/&gt;
+		&lt;package name=&quot;dhcp-server&quot;/&gt;
+        &lt;package name=&quot;gfxboot-branding-openSUSE&quot; bootinclude=&quot;true&quot; bootdelete=&quot;true&quot;/&gt;
+		&lt;package name=&quot;ifplugd&quot;/&gt;
+		&lt;package name=&quot;iptables&quot;/&gt;
+		&lt;package name=&quot;iputils&quot;/&gt;
+		&lt;package name=&quot;kernel-default&quot;/&gt;
+        &lt;package name=&quot;nfs-kernel-server&quot;/&gt;
+        &lt;package name=&quot;opennebula&quot;/&gt;
+        &lt;package name=&quot;openssh&quot;/&gt;
+        &lt;package name=&quot;openssl&quot;/&gt;
+        &lt;package name=&quot;python&quot;/&gt;
+		&lt;package name=&quot;rsyslog&quot;/&gt;
+        &lt;package name=&quot;ruby&quot;/&gt;
+        &lt;package name=&quot;rubygems&quot;/&gt;
+        &lt;package name=&quot;rubygem-libxml-ruby&quot;/&gt;
+        &lt;package name=&quot;rubygem-nokogiri&quot;/&gt;
+        &lt;package name=&quot;sqlite3&quot;/&gt;
+        &lt;package name=&quot;sudo&quot;/&gt;
+        &lt;package name=&quot;terminfo&quot;/&gt;
+		&lt;package name=&quot;vi&quot;/&gt;
+        &lt;package name=&quot;xmlrpc-c&quot;/&gt;
+        &lt;package name=&quot;yast2-dhcp-server&quot;/&gt;
+        &lt;package name=&quot;yast2-firstboot&quot;/&gt;
+        &lt;package name=&quot;yast2-network&quot;/&gt;
+        &lt;package name=&quot;yast2-nfs-server&quot;/&gt;
+	&lt;/packages&gt;
+	&lt;packages type=&quot;bootstrap&quot;&gt;
+		&lt;package name=&quot;filesystem&quot;/&gt;
+		&lt;package name=&quot;glibc-locale&quot;/&gt;
+	&lt;/packages&gt;
+&lt;/image&gt;
diff --git a/doc/examples/extras/suse-11.3/suse-nebula-cloud/cloud_head/root/etc/YaST2/firstboot.xml b/doc/examples/extras/suse-11.3/suse-nebula-cloud/cloud_head/root/etc/YaST2/firstboot.xml
new file mode 100644
index 0000000..4d3a60b
--- /dev/null
+++ b/doc/examples/extras/suse-11.3/suse-nebula-cloud/cloud_head/root/etc/YaST2/firstboot.xml
@@ -0,0 +1,65 @@
+&lt;?xml version=&quot;1.0&quot;?&gt;
+&lt;productDefines  xmlns=&quot;<A HREF="http://www.suse.com/1.0/yast2ns">http://www.suse.com/1.0/yast2ns</A>&quot;
+    xmlns:config=&quot;<A HREF="http://www.suse.com/1.0/configns">http://www.suse.com/1.0/configns</A>&quot;&gt;
+
+    &lt;textdomain&gt;firstboot&lt;/textdomain&gt;
+
+    &lt;workflows  config:type=&quot;list&quot;&gt;
+        &lt;workflow&gt;
+            &lt;defaults&gt;
+                &lt;enable_back&gt;yes&lt;/enable_back&gt;
+                &lt;enable_next&gt;yes&lt;/enable_next&gt;
+                &lt;archs&gt;all&lt;/archs&gt;
+            &lt;/defaults&gt;
+            &lt;stage&gt;firstboot&lt;/stage&gt;
+            &lt;label&gt;Configuration&lt;/label&gt;
+            &lt;mode&gt;installation&lt;/mode&gt;
+            &lt;modules  config:type=&quot;list&quot;&gt;
+
+                &lt;module&gt;
+                    &lt;label&gt;Welcome&lt;/label&gt;
+                    &lt;name&gt;firstboot_welcome&lt;/name&gt;
+                &lt;/module&gt;
+                &lt;module&gt;
+                    &lt;label&gt;License Agreements&lt;/label&gt;
+                    &lt;enabled config:type=&quot;boolean&quot;&gt;true&lt;/enabled&gt;
+                    &lt;name&gt;firstboot_licenses&lt;/name&gt;
+                &lt;/module&gt;
+                &lt;module&gt;
+                    &lt;label&gt;Keyboard Layout&lt;/label&gt;
+                    &lt;enabled config:type=&quot;boolean&quot;&gt;true&lt;/enabled&gt;
+                    &lt;name&gt;firstboot_keyboard&lt;/name&gt;
+                &lt;/module&gt;
+                &lt;module&gt;
+                    &lt;label&gt;Time and Date&lt;/label&gt;
+                    &lt;enabled config:type=&quot;boolean&quot;&gt;true&lt;/enabled&gt;
+                    &lt;name&gt;firstboot_timezone&lt;/name&gt;
+                &lt;/module&gt;
+                &lt;module&gt;
+                    &lt;label&gt;Root Password&lt;/label&gt;
+                    &lt;enabled config:type=&quot;boolean&quot;&gt;true&lt;/enabled&gt;
+                    &lt;name&gt;inst_root&lt;/name&gt;
+                &lt;/module&gt;
+                &lt;module&gt;
+                    &lt;label&gt;Cloud Configuration&lt;/label&gt;
+                    &lt;enabled config:type=&quot;boolean&quot;&gt;true&lt;/enabled&gt;
+                    &lt;name&gt;opennebula&lt;/name&gt;
+                &lt;/module&gt;
+                &lt;module&gt;
+                    &lt;label&gt;Finish Setup&lt;/label&gt;
+                    &lt;name&gt;firstboot_write&lt;/name&gt;
+                    &lt;enable_back&gt;no&lt;/enable_back&gt;
+                    &lt;enable_next&gt;no&lt;/enable_next&gt;
+                &lt;/module&gt;
+                &lt;module&gt;
+                    &lt;label&gt;Finish Setup&lt;/label&gt;
+                    &lt;name&gt;inst_suseconfig&lt;/name&gt;
+                    &lt;enable_back&gt;no&lt;/enable_back&gt;
+                    &lt;enable_next&gt;no&lt;/enable_next&gt;
+                &lt;/module&gt;
+
+            &lt;/modules&gt;
+        &lt;/workflow&gt;
+    &lt;/workflows&gt;
+&lt;/productDefines&gt;
+
diff --git a/doc/examples/extras/suse-11.3/suse-nebula-cloud/cloud_head/root/etc/exports b/doc/examples/extras/suse-11.3/suse-nebula-cloud/cloud_head/root/etc/exports
new file mode 100644
index 0000000..8fec075
--- /dev/null
+++ b/doc/examples/extras/suse-11.3/suse-nebula-cloud/cloud_head/root/etc/exports
@@ -0,0 +1 @@
+/var/lib/one *(no_subtree_check,rw,root_squash,sync)
diff --git a/doc/examples/extras/suse-11.3/suse-nebula-cloud/cloud_head/root/etc/init.d/cloudinfo b/doc/examples/extras/suse-11.3/suse-nebula-cloud/cloud_head/root/etc/init.d/cloudinfo
new file mode 100755
index 0000000..c43dc01
--- /dev/null
+++ b/doc/examples/extras/suse-11.3/suse-nebula-cloud/cloud_head/root/etc/init.d/cloudinfo
@@ -0,0 +1,64 @@
+#! /bin/sh
+# Copyright (c) 2011 SUSE
+# All rights reserved.
+#
+# Author: Robert Schweikert
+#
+# /etc/init.d/cloudinfo
+#
+### BEGIN INIT INFO
+# Provides:       cloudinfo
+# Required-Start: $remote_fs $syslog network
+# Required-Stop:  $remote_fs $syslog
+# Default-Start:  3 5
+# Default-Stop:   0 1 2 6
+# Short-Description: Information service for cloud nodes
+# Description: Information service to allow cloud nodes to configure themselves
+### END INIT INFO
+
+# First reset status of this service
+. /etc/rc.status
+rc_reset
+
+# Return values acc. to LSB for all commands but status:
+# 0 - success
+# 1 - generic or unspecified error
+# 2 - invalid or excess argument(s)
+# 3 - unimplemented feature (e.g. &quot;reload&quot;)
+# 4 - insufficient privilege
+# 5 - program is not installed
+# 6 - program is not configured
+# 7 - program is not running
+
+SERVICE_BIN=&quot;/sbin/suseNebulaConfSrv&quot;
+SERVICE_PID=&quot;${CHROOT_PREFIX}/var/run/suseNebula/infoSrv.pid&quot;
+
+case &quot;$1&quot; in
+  start)
+    echo -n &quot;Starting cloud info service: &quot;
+    $SERVICE_BIN &amp;
+    rc_status -v
+  ;;
+  stop)
+    echo -n &quot;Stopping cloud info service: &quot;
+    pid=`cat ${SERVICE_PID}`
+    kill -TERM $pid
+    #killproc does not work, it insists that $SERVICE_BIN does not exist
+    # Suspect this has something to do with it being python
+    #killproc -p ${SERVICE_PID} -TERM $SERVICE_BIN
+    # Remember status and be quiet
+    rc_status -v
+  ;;
+  restart)
+    $0 stop
+    $0 start $2
+    rc_status
+  ;;
+  *)
+    echo &quot;Usage: $0 {start|stop|restart}&quot;
+    exit 1
+  ;;
+esac
+rc_exit
+
+
diff --git a/doc/examples/extras/suse-11.3/suse-nebula-cloud/cloud_head/root/etc/init.d/noderegistrar b/doc/examples/extras/suse-11.3/suse-nebula-cloud/cloud_head/root/etc/init.d/noderegistrar
new file mode 100755
index 0000000..b2ecaca
--- /dev/null
+++ b/doc/examples/extras/suse-11.3/suse-nebula-cloud/cloud_head/root/etc/init.d/noderegistrar
@@ -0,0 +1,66 @@
+#! /bin/sh
+# Copyright (c) 2011 SUSE
+# All rights reserved.
+#
+# Author: Robert Schweikert
+#
+# /etc/init.d/noderegistrar
+#
+### BEGIN INIT INFO
+# Provides:       noderegistrar
+# Required-Start: $remote_fs $syslog network
+# Required-Stop:  $remote_fs $syslog
+# Should-Start:   cloudinfo
+# Default-Start:  3 5
+# Default-Stop:   0 1 2 6
+# Short-Description: Registration service for cloud nodes
+# Description: Registration service to allow cloud nodes to 
+#              register themselves with the head node
+### END INIT INFO
+
+# First reset status of this service
+. /etc/rc.status
+rc_reset
+
+# Return values acc. to LSB for all commands but status:
+# 0 - success
+# 1 - generic or unspecified error
+# 2 - invalid or excess argument(s)
+# 3 - unimplemented feature (e.g. &quot;reload&quot;)
+# 4 - insufficient privilege
+# 5 - program is not installed
+# 6 - program is not configured
+# 7 - program is not running
+
+SERVICE_BIN=&quot;/sbin/suseNebulaRegSrv&quot;
+SERVICE_PID=&quot;${CHROOT_PREFIX}/var/run/suseNebula/regSrv.pid&quot;
+
+case &quot;$1&quot; in
+  start)
+    echo -n &quot;Starting cloud info service: &quot;
+    $SERVICE_BIN &amp;
+    rc_status -v
+  ;;
+  stop)
+    echo -n &quot;Stopping cloud info service: &quot;
+    pid=`cat ${SERVICE_PID}`
+    kill -TERM $pid
+    #killproc does not work, it insists that $SERVICE_BIN does not exist
+    # Suspect this has something to do with it being python
+    #killproc -p ${SERVICE_PID} -TERM $SERVICE_BIN
+    # Remember status and be quiet
+    rc_status -v
+  ;;
+  restart)
+    $0 stop
+    $0 start $2
+    rc_status
+  ;;
+  *)
+    echo &quot;Usage: $0 {start|stop|restart}&quot;
+    exit 1
+  ;;
+esac
+rc_exit
+
+
diff --git a/doc/examples/extras/suse-11.3/suse-nebula-cloud/cloud_head/root/home/ctester/startTestVM b/doc/examples/extras/suse-11.3/suse-nebula-cloud/cloud_head/root/home/ctester/startTestVM
new file mode 100755
index 0000000..7551d9c
--- /dev/null
+++ b/doc/examples/extras/suse-11.3/suse-nebula-cloud/cloud_head/root/home/ctester/startTestVM
@@ -0,0 +1,9 @@
+#!/bin/bash
+
+# Author   : Robert Schweikert
+# License  : GPLv2
+# Copyright: 2011 SUSE
+
+export ONE_AUTH=/var/lib/one/.one/one_auth
+/usr/bin/oneimage register testVM.one
+/usr/bin/onevm create testVM.vmd
diff --git a/doc/examples/extras/suse-11.3/suse-nebula-cloud/cloud_head/root/home/ctester/testVM.README b/doc/examples/extras/suse-11.3/suse-nebula-cloud/cloud_head/root/home/ctester/testVM.README
new file mode 100644
index 0000000..d36dece
--- /dev/null
+++ b/doc/examples/extras/suse-11.3/suse-nebula-cloud/cloud_head/root/home/ctester/testVM.README
@@ -0,0 +1,31 @@
+The startTestVM script is expected to be executed only once. It's sole purpose
+is to facilitate easy and quick verification that the images built using the
+OBS OpenNebula packages work as intended. The working condition is defined as:
+    - generated guest image can be registered
+    - registered image can be started
+   - it is possible to log into the running image (manual action)
+The script should only be run on initial setup of the cloud after the head
+node and at least one cloud node have been set up.
+
+Prior to executing the startTestVM script:
+- verify there is a registered host
+  # sudo -u oneadmin env ONE_AUTH=/var/lib/one/.one/one_auth onehost list
+- make sure you have an image that matches the output of 
+  # grep PATH testVM.one
+
+Then run the script as the oneadmin user
+
+# sudo -u oneadmin ./startTestVM
+
+Once the VM is up and running you can verify it's functionality by using
+vncviewer on a machine running X as follows:
+
+-&gt; vncviewer IP_ADDRESS_OF_CLOUD_NODE:5905
+
+The IP_ADDRESS_OF_CLOUD_NODE is shown by the `onevm list` command executed on
+the head node
+
+# sudo -u oneadmin env ONE_AUTH=/var/lib/one/.one/one_auth onevm list
+
+
+
diff --git a/doc/examples/extras/suse-11.3/suse-nebula-cloud/cloud_head/root/home/ctester/testVM.one b/doc/examples/extras/suse-11.3/suse-nebula-cloud/cloud_head/root/home/ctester/testVM.one
new file mode 100644
index 0000000..6e1f930
--- /dev/null
+++ b/doc/examples/extras/suse-11.3/suse-nebula-cloud/cloud_head/root/home/ctester/testVM.one
@@ -0,0 +1,5 @@
+NAME = &quot;openSUSE test image&quot;
+PATH = &quot;/home/ctester/suse-11.3-SUSENebula-guest.x86_64-1.0.0.qcow2&quot;
+PUBLIC = YES
+DESCRIPTION = &quot;A test image to test the basic functionality of the openSUSE based OpenNebula setup&quot;
+
diff --git a/doc/examples/extras/suse-11.3/suse-nebula-cloud/cloud_head/root/home/ctester/testVM.vmd b/doc/examples/extras/suse-11.3/suse-nebula-cloud/cloud_head/root/home/ctester/testVM.vmd
new file mode 100644
index 0000000..b8b3d0c
--- /dev/null
+++ b/doc/examples/extras/suse-11.3/suse-nebula-cloud/cloud_head/root/home/ctester/testVM.vmd
@@ -0,0 +1,17 @@
+NAME   = suse-test
+MEMORY = 512
+CPU    = 1
+
+OS     = [ ARCH = x86_64,
+           BOOT = hd,
+           ROOT = sda1 ]
+
+DISK   = [ IMAGE_ID  = 0,
+           DRIVER    = qcow2 ]
+
+NIC    = [ MAC = &quot;00:16:3e:7e:18:26&quot;,
+           BRIDGE = br0 ]
+
+GRAPHICS = [ TYPE   = &quot;vnc&quot;,
+             LISTEN = &quot;0.0.0.0&quot;,
+             PORT   = &quot;5905&quot; ]
diff --git a/doc/examples/extras/suse-11.3/suse-nebula-cloud/cloud_head/root/sbin/suseNebulaConfSrv b/doc/examples/extras/suse-11.3/suse-nebula-cloud/cloud_head/root/sbin/suseNebulaConfSrv
new file mode 100755
index 0000000..dc19017
--- /dev/null
+++ b/doc/examples/extras/suse-11.3/suse-nebula-cloud/cloud_head/root/sbin/suseNebulaConfSrv
@@ -0,0 +1,185 @@
+#!/usr/bin/python
+
+&quot;&quot;&quot;SUSENebula configuration service.&quot;&quot;&quot;
+
+# Author: Robert Schweikert
+# License: GPL v2
+# Copyright: SUSE
+
+import SocketServer
+import os
+import re
+import signal
+import sys
+import syslog
+
+ipPattern = r'\d{1,3}?\.\d{1,3}?\.\d{1,3}?\.\d{1,3}?'
+ipPat = re.compile(ipPattern)
+
+base = r'\d{0,2}?[A-F]{0,2}?:'
+macPattern = 5*base + r'\d{0,2}?[A-F]{0,2}?'
+macPat = re.compile(macPattern)
+
+#---------------------------------------------------------------------------
+class CloudConfigService(SocketServer.StreamRequestHandler):
+    &quot;&quot;&quot;Cloud head node information provider.&quot;&quot;&quot;
+    def __init__(self, request, client_address, server):
+        self.srvInfo = {}
+        # Collect the information we want to make propagate to the cloud node
+        # Keyboard layout
+        os.system('/sbin/yast2 keyboard summary &gt;&amp; /tmp/.kdb.info')
+        info = open('/tmp/.kdb.info', 'r').read()
+        os.remove('/tmp/.kdb.info')
+        self.srvInfo['keyLayout'] = info.split(':')[-1].strip()
+        # Timezone and HW clock setting (assume HW clock on nodes is set the
+        # same by default
+        os.system('/sbin/yast2 timezone summary &gt;&amp; /tmp/.tz.info')
+        info = open('/tmp/.tz.info', 'r').readlines()
+        os.remove('/tmp/.tz.info')
+        timezone = None
+        hwClockSet = None
+        for ln in info:
+            if ln.find('Current Time Zone') != -1:
+                timezone = ln.split(':')[-1].strip()
+            if ln.find('Hardware Clock') != -1:
+                hwClockSet = ln.split(':')[-1].strip()
+        self.srvInfo['timezone'] = timezone
+        self.srvInfo['hwclock'] = hwClockSet 
+        # Root passwd
+        lines = open('/etc/shadow', 'r').readlines()
+        passWd = None
+        for ln in lines:
+            if ln[0:4] == 'root':
+                passWd = ln.split(':')[1]
+        self.srvInfo['rootpass'] = passWd
+        # IP address
+        lines = open('/etc/sysconfig/network/ifcfg-br0', 'r').readlines()
+        ipAddr = None
+        for ln in lines:
+            if ln[0:7] == 'IPADDR=':
+                # [1:] at end removes leading quote
+                ipAddr = ln.split('=')[-1].split('/')[0].strip()[1:]
+        self.srvInfo['serverIP'] = ipAddr
+        # DHCP feature identifier
+        lines = open('/etc/dhcpd.conf','r').readlines()
+        dhcpFeature = None
+        domainname = None
+        for ln in lines:
+            if ln.find('domain-name') != -1:
+                # [1:-2] remove leading and trailing quotes and ; 
+                domainname = ln.split()[-1].strip()[1:-2]
+            # 239 is the assigned ID for the feature, hard coded in the YaST
+            # configuration module
+            if ln.find('code 239') != -1:
+                dhcpFeature = ln.split()[1].strip()
+        self.srvInfo['dhcpFeature'] = dhcpFeature
+        self.srvInfo['domainname'] = domainname
+        # Name resolution
+        self.srvInfo['resolve'] = open('/etc/resolv.conf', 'r').read()
+        # The configured routes
+        routes = open('/etc/sysconfig/network/routes', 'r').read()
+        self.srvInfo['routes'] = routes
+        # The one use ID
+        lines = open('/etc/passwd', 'r').readlines()
+        for ln in lines:
+            if ln.find('oneadmin') != -1:
+                self.srvInfo['userID'] = ('oneadmin', ln.split(':')[2],
+                                          ln.split(':')[1])
+                break
+        # The cloud group ID
+        lines = open('/etc/group', 'r').readlines()
+        for ln in lines:
+            if ln.find('cloud') != -1:
+                self.srvInfo['groupID'] = ('cloud', ln.split(':')[2])
+                break
+        SocketServer.StreamRequestHandler.__init__(self, request,
+                                                   client_address, server)
+        
+    #----------------------------------------------------------------------
+    def generateHostName(self):
+        &quot;&quot;&quot;Generate a new host name&quot;&quot;&quot;
+        # Create a host name for the host requesting the information
+        while (os.path.exists('/var/lock/nebula-hostname.lock')):
+            # We have to wait another cloud node is being configured
+            pass
+        os.system('touch /var/lock/nebula-hostname.lock')
+        cntr = None
+        if not os.path.exists('/var/lib/one/.nodecnt'):
+            cntr = 1
+            cntFl = open('/var/lib/one/.nodecnt', 'w')
+            cntFl.write('%d' %cntr)
+            cntFl.close()
+        if not cntr:
+            cntr = open('/var/lib/one/.nodecnt', 'r').read()
+            cntr = eval(cntr)
+            cntr += 1
+            cntFl = open('/var/lib/one/.nodecnt', 'w')
+            cntFl.write('%d' %cntr)
+            cntFl.close()
+        hostname = self.srvInfo['dhcpFeature'] + '-%d' %cntr
+        os.remove('/var/lock/nebula-hostname.lock')
+        return hostname
+
+    #----------------------------------------------------------------------
+    def handle(self):
+        &quot;&quot;&quot;Handle the information request&quot;&quot;&quot;
+        requestType = self.request.recv(512).strip()
+        if requestType == 'PROVIDE_CONFIG':
+            syslog.openlog('[CLOUD_INFO_SRV]',syslog.LOG_PID,syslog.LOG_DAEMON)
+            syslog.syslog(syslog.LOG_INFO, 'Provide cloud config info\n')
+            self.srvInfo['hostname'] = self.generateHostName()
+            for key in self.srvInfo.keys():
+                # Send a key value pair for each entry
+                self.request.send('%s=%s;' %(key,self.srvInfo[key]))
+            self.request.send('COMPLETE=finished')
+        syslog.closelog()
+
+#---------------------------------------------------------------------------
+def sigHandler(signum, frame):
+    &quot;&quot;&quot;Signal handler for termination&quot;&quot;&quot;
+    syslog.openlog('[CLOUD_INFO_SRV]',syslog.LOG_PID,syslog.LOG_DAEMON)
+    syslog.syslog(syslog.LOG_INFO, 'Terminating server on signal: %d' %signum)
+    syslog.closelog()
+    if os.path.exists('/var/lock/nebula-hostname.lock'):
+        os.remove('/var/lock/nebula-hostname.lock')
+    os.remove('/var/run/suseNebula/infoSrv.pid')
+    sys.exit(0)
+
+#---------------------------------------------------------------------------
+if __name__ == &quot;__main__&quot;:
+    syslog.openlog('[CLOUD_INFO_SRV]', syslog.LOG_PID, syslog.LOG_DAEMON)
+    syslog.syslog(syslog.LOG_INFO, 'Cloud Info Server start\n')
+
+    # Consistency check for pid file
+    if not os.path.exists('/var/run/suseNebula'):
+        os.system('mkdir -p /var/run/suseNebula')
+    if os.path.exists('/var/run/suseNebula/infoSrv.pid'):
+        msg = 'Found pid file, another server is running, not starting a '
+        msg += 'new one.'
+        syslog.syslog(syslog.LOG_ERR, msg)
+        syslog.closelog()
+        sys.exit(1)
+   
+    server = SocketServer.TCPServer(('169.254.1.1',  8445), CloudConfigService)
+
+    if not server:
+        syslog.syslog(syslog.LOG_ERR, 'Could not create server, exiting\n')
+        syslog.closelog()
+        sys.exit(1)
+
+    # Write pid to a file
+    pid = os.getpid()
+    pidFl = open('/var/run/suseNebula/infoSrv.pid', 'w');
+    pidFl.write('%d\n' %pid)
+    pidFl.close()
+
+    # Register signal handler
+    signal.signal(signal.SIGHUP, sigHandler)
+    signal.signal(signal.SIGTERM, sigHandler)
+    signal.signal(signal.SIGINT, sigHandler)
+
+    # No additional message will be printed, close the log
+    syslog.syslog(syslog.LOG_INFO, 'Cloud Info Server running\n')
+    syslog.closelog()
+    server.serve_forever()
+    
diff --git a/doc/examples/extras/suse-11.3/suse-nebula-cloud/cloud_head/root/sbin/suseNebulaRegSrv b/doc/examples/extras/suse-11.3/suse-nebula-cloud/cloud_head/root/sbin/suseNebulaRegSrv
new file mode 100755
index 0000000..748afdb
--- /dev/null
+++ b/doc/examples/extras/suse-11.3/suse-nebula-cloud/cloud_head/root/sbin/suseNebulaRegSrv
@@ -0,0 +1,145 @@
+#!/usr/bin/python
+
+&quot;&quot;&quot;SUSENebula Node Registration Service.&quot;&quot;&quot;
+
+# Author: Robert Schweikert
+# License: GPL v2
+# Copyright: SUSE
+
+import SocketServer
+import os
+import re
+import signal
+import sys
+import syslog
+
+ipPattern = r'\d{1,3}?\.\d{1,3}?\.\d{1,3}?\.\d{1,3}?'
+ipPat = re.compile(ipPattern)
+
+base = r'\d{0,2}?[A-F]{0,2}?:'
+macPattern = 5*base + r'\d{0,2}?[A-F]{0,2}?'
+macPat = re.compile(macPattern)
+
+#------------------------------------------------------------------------------
+class RegistrationHandler(SocketServer.BaseRequestHandler):
+    &quot;&quot;&quot;Cloud head node registration request handler.&quot;&quot;&quot;
+    def handle(self):
+        syslog.openlog('[NOD_REG]',syslog.LOG_PID, syslog.LOG_DAEMON)
+        syslog.syslog(syslog.LOG_INFO, 'Cloud node registration\n')
+        # self.request is the TCP socket connected to the client
+        macAddr, ipAddr, name = self.request.recv(1024).strip().split(';')
+        # Verify proper MAC Address format
+        if not macPat.match(macAddr):
+            msg = 'Received improper data for MAC Address '
+            msg += macAddr
+            msg += ' -&gt; skip registration\n'
+            syslog.syslog(syslog.LOG_ERR, msg)
+            syslog.closelog()
+            return
+        # Verify the IP address format
+        if not ipPat.match(ipAddr):
+             msg = 'Received improper data for IP Adress '
+             msg += ipAddr
+             msg += ' -&gt; skip registration\n'
+             syslog.syslog(syslog.LOG_ERR, msg)
+             syslog.closelog()
+             return
+        syslog.syslog(syslog.LOG_INFO, 'MAC Address: %s\n' %macAddr)
+        syslog.syslog(syslog.LOG_INFO, 'IP Address: %s\n' %ipAddr)
+        syslog.syslog(syslog.LOG_INFO, 'Node name: %s\n' %name)
+        # Setup the dhcp server to make sure the node being registered
+        # always gets the same IP address
+        lines = open('/etc/dhcpd.conf', 'r').readlines()
+        processBlock = None
+        for ln in lines:
+            if ln.find(name) != -1:
+                processBlock = 1
+                continue
+            if processBlock and ln.find('fixed-address') != -1:
+                setIP = ln.split()[-1].strip()[:-1]
+                if setIP != ipAddr:
+                    msg = 'Host with name &quot;%s&quot; already registered with ' %name
+                    msg += 'IP &quot;%s&quot;. Cannot register node.\n' %ipAddr
+                    syslog.syslog(syslog.LOG_INFO, msg)
+                    syslog.closelog()
+                    return
+        dhconf = open('/etc/dhcpd.conf', 'a')
+        dhconf.write('\n')
+        dhconf.write('host %s {\n' %name)
+        dhconf.write('    hardware ethernet %s;\n' %macAddr)
+        dhconf.write('    fixed-address %s;\n' %ipAddr)
+        dhconf.write('}\n')
+        dhconf.close()
+        # Restart the dhcp server as we just change the config
+        os.system('/etc/init.d/dhcpd restart  &gt;&amp; /dev/null')
+        # Create hosts entry
+        hosts = open('/etc/hosts', 'a')
+        hosts.write('%s    %s\n' %(ipAddr, name))
+        hosts.close()
+        # Register node with Nebula infrastructure
+        cmd = '/usr/bin/sudo env ONE_AUTH=/var/lib/one/.one/one_auth '
+        cmd += '/usr/bin/onehost create %s im_kvm vmm_kvm tm_nfs' %ipAddr
+        res = os.system(cmd)
+        if res:
+            msg = 'Registration failed, onehost command with non zero status\n'
+            syslog.syslog(syslog.LOG_ERR, msg)
+            syslog.closelog()
+            return
+        syslog.syslog(syslog.LOG_ERR, 'Node registration succesful.\n')
+        syslog.closelog()
+
+#------------------------------------------------------------------------------
+def sigHandler(signum, frame):
+    &quot;&quot;&quot;Signal handler for termination&quot;&quot;&quot;
+    syslog.openlog('[NOD_REG]',syslog.LOG_PID,syslog.LOG_DAEMON)
+    syslog.syslog(syslog.LOG_INFO, 'Terminating server on signal: %d' %signum)
+    syslog.closelog()
+    os.remove('/var/run/suseNebula/regSrv.pid')
+    sys.exit(0)
+
+#------------------------------------------------------------------------------
+if __name__ == &quot;__main__&quot;:
+    syslog.openlog('[NOD_REG]', syslog.LOG_PID, syslog.LOG_DAEMON)
+    syslog.syslog(syslog.LOG_INFO, 'Start node registration service\n')
+    # Determine the IP address of this host
+    inetInfo = os.popen('/sbin/ifconfig').readlines()
+    ipAddr = None
+    # Use the first IPv4 address found
+    for item in inetInfo:
+        if item.find('inet addr') != -1:
+            # Extract the IP address from line expected in following format
+            # inet addr:192.168.1.6  Bcast:192.168.1.255  Mask:255.255.255.0
+            ipAddr = item.strip().split()[1].split(':')[-1]
+            if ipPat.match(ipAddr):
+                break
+
+    if not ipAddr:
+        # No IP address found. Print a message to syslog and exit
+        syslog.syslog(syslog.LOG_ERR,
+                      'Could not determine IP address, exiting\n')
+        syslog.closelog()
+        sys.exit(1)
+        
+    server = SocketServer.TCPServer((ipAddr, 8445), RegistrationHandler)
+
+    if not server:
+        syslog.syslog(syslog.LOG_ERR, 'Could not create server, exiting\n')
+        syslog.closelog()
+        sys.exit(1)
+
+    # Write pid to a file
+    pid = os.getpid()
+    pidFl = open('/var/run/suseNebula/regSrv.pid', 'w');
+    pidFl.write('%d\n' %pid)
+    pidFl.close()
+
+    # Register signal handler
+    signal.signal(signal.SIGHUP, sigHandler)
+    signal.signal(signal.SIGTERM, sigHandler)
+    signal.signal(signal.SIGINT, sigHandler)
+
+    # No additional message will be printed, close the log
+    syslog.syslog(syslog.LOG_INFO, 'Cloud registration service  running\n')
+    syslog.closelog()
+    server.serve_forever()
+        
diff --git a/doc/examples/extras/suse-11.3/suse-nebula-cloud/cloud_head/root/usr/share/YaST2/clients/opennebula.ycp b/doc/examples/extras/suse-11.3/suse-nebula-cloud/cloud_head/root/usr/share/YaST2/clients/opennebula.ycp
new file mode 100644
index 0000000..6d82817
--- /dev/null
+++ b/doc/examples/extras/suse-11.3/suse-nebula-cloud/cloud_head/root/usr/share/YaST2/clients/opennebula.ycp
@@ -0,0 +1,365 @@
+/**
+ * File:        clients/opennebula.ycp
+ * Package:     Configuration of OpenNebula CLoud head node
+ * Authors:     Jiri Suchomel &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/kiwi-devel">jsuchome at suse.cz</A>&gt;
+ *              Robert Scwheikert &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/kiwi-devel">rschweikert at novell.com</A>&gt;
+ *
+ * License:     GPL v2
+ *
+ */
+
+{
+    textdomain &quot;susenebula&quot;;
+ 
+    import &quot;FileUtils&quot;;
+    import &quot;Hostname&quot;;
+    import &quot;IP&quot;;
+    import &quot;Label&quot;;
+    import &quot;Mode&quot;;
+    import &quot;Netmask&quot;;
+    import &quot;Popup&quot;;
+    import &quot;Report&quot;;
+    import &quot;Service&quot;;
+    import &quot;Wizard&quot;;
+ 
+    import &quot;YaPI::NETWORK&quot;;
+ 
+    string hostname = &quot;SUSENebula-Head&quot;;
+    string domain   = &quot;&quot;;
+    string ip       = &quot;192.168.1.2&quot;;
+    string netmask  = &quot;255.255.255.0&quot;;
+    string ip_min   = &quot;&quot;;
+    string ip_max   = &quot;&quot;;
+    string clustername  = &quot;SUSENebula&quot;;
+    string route    = &quot;&quot;;
+    string cadminp  = &quot;susenebula&quot;;
+    list&lt;string&gt; nameservers  = [];
+    list&lt;string&gt; searchdomains    = [];
+ 
+    // network export map
+    map network     = $[];
+    // dhcp server export map
+    map dhcp        = $[];
+ 
+    // write entered settings to the system
+    boolean WriteSettings () {
+ 
+    // 1. Write Network
+    map&lt;string,any&gt; write_network = $[
+        &quot;hostname&quot;  : network[&quot;hostname&quot;]:$[],
+        &quot;dns&quot;   : network[&quot;dns&quot;]:$[],
+    ];
+ 
+    write_network[&quot;hostname&quot;,&quot;domain&quot;]  = domain;
+    write_network[&quot;hostname&quot;,&quot;name&quot;]    = hostname;
+ 
+    write_network[&quot;dns&quot;,&quot;nameservers&quot;]  = nameservers;
+    write_network[&quot;dns&quot;,&quot;searches&quot;]     = searchdomains;
+ 
+    write_network[&quot;route&quot;]  = $[
+        &quot;default&quot;   : $[
+        &quot;via&quot;   : route
+        ]
+    ];
+ 
+    map interface   = network[&quot;interfaces&quot;]:$[];
+ 
+    // ip r|grep default|cut -d' ' -f5
+    if (haskey (interface, &quot;eth0&quot;))
+    {
+        interface[&quot;eth0&quot;,&quot;bootproto&quot;]   = &quot;static&quot;;
+        interface[&quot;eth0&quot;,&quot;ipaddr&quot;]  = sformat (&quot;%1/%2&quot;, ip, Netmask::ToBits (netmask));
+        write_network[&quot;interface&quot;]  = interface;
+    }
+    y2internal (&quot;network to write: %1&quot;, write_network);
+    map network_written = YaPI::NETWORK::Write (write_network);
+ 
+    Service::Restart (&quot;network&quot;);
+ 
+    // 2. Write DHCP server DhcpServer: settings/directives/range
+    // Min/Max IP -&gt; set the IP address range for dhcp server.
+ 
+    // Read DhcpServer after network is configured
+    /*
+    DhcpServer::Read ();
+    dhcp    = DhcpServer::Export ();
+    y2internal (&quot;dhcp: %1&quot;, dhcp);
+    */
+ 
+    string subnet_ip    = IP::ComputeNetwork (ip, netmask);
+ 
+    dhcp[&quot;allowed_interfaces&quot;]  = [&quot;eth0&quot;];
+    dhcp[&quot;start_service&quot;]       = true;
+    dhcp[&quot;use_ldap&quot;]        = false;
+    dhcp[&quot;settings&quot;]        = [
+      $[
+        &quot;children&quot;      : [],
+        &quot;directives&quot;    : [
+        $[
+            &quot;key&quot;       : &quot;default-lease-time&quot;,
+            &quot;type&quot;      : &quot;directive&quot;,
+            &quot;value&quot;     : &quot;14400&quot;
+        ],
+        $[
+            &quot;key&quot;       : &quot;max-lease-time&quot;,
+            &quot;type&quot;      : &quot;directive&quot;,
+            &quot;value&quot;     : &quot;172800&quot;
+        ],
+        $[
+             &quot;key&quot;      : &quot;range&quot;,
+            &quot;type&quot;      : &quot;directive&quot;,
+            &quot;value&quot;     : sformat (&quot;%1 %2&quot;, ip_min, ip_max)
+        ]
+        ],
+        &quot;id&quot;        : sformat (&quot;%1 netmask %2&quot;, subnet_ip, netmask),
+        &quot;options&quot;       : [],
+        &quot;parent_id&quot;     : &quot;&quot;,
+        &quot;parent_type&quot;   : &quot;&quot;,
+        &quot;type&quot;      : &quot;subnet&quot;
+      ],
+      $[
+        &quot;children&quot;      : [
+        $[
+            &quot;id&quot;    : sformat (&quot;%1 netmask %2&quot;, subnet_ip, netmask),
+            &quot;type&quot;  : &quot;subnet&quot;
+        ]
+        ],
+        &quot;directives&quot;    : [
+        $[
+            &quot;key&quot;   : &quot;max-lease-time&quot;,
+            &quot;type&quot;  : &quot;directive&quot;,
+            &quot;value&quot; : &quot;7200&quot;
+        ],
+        $[
+            &quot;key&quot;   : &quot;ddns-updates&quot;,
+            &quot;type&quot;  : &quot;directive&quot;,
+            &quot;value&quot; : &quot;off&quot;
+        ],
+        $[
+            &quot;key&quot;   : &quot;ddns-update-style&quot;,
+            &quot;type&quot;  : &quot;directive&quot;,
+            &quot;value&quot; : &quot;none&quot;
+        ],
+        $[
+            &quot;key&quot;   : &quot;log-facility&quot;,
+            &quot;type&quot;  : &quot;directive&quot;,
+            &quot;value&quot; : &quot;local7&quot;
+        ],
+        $[
+            &quot;key&quot;   : &quot;default-lease-time&quot;,
+            &quot;type&quot;  : &quot;directive&quot;,
+            &quot;value&quot; : &quot;600&quot;
+        ],
+        ],
+        &quot;options&quot;   : [
+        $[
+            &quot;key&quot;   : &quot;suse-nebula&quot;,
+            &quot;type&quot;  : &quot;option&quot;,
+            &quot;value&quot; : &quot;code 239 = ip-address&quot;
+        ],
+        $[
+            &quot;key&quot;   : &quot;suse-nebula&quot;,
+            &quot;type&quot;  : &quot;option&quot;,
+            &quot;value&quot; : ip
+        ],
+        $[
+            &quot;key&quot;   : &quot;domain-name&quot;,
+            &quot;type&quot;  : &quot;option&quot;,
+            &quot;value&quot; : sformat (&quot;\&quot;%1\&quot;&quot;, domain),
+        ],
+        ],
+        &quot;id&quot;    :&quot;&quot;,
+        &quot;parent_id&quot;     : &quot;&quot;,
+        &quot;parent_type&quot;   : &quot;&quot;,
+        &quot;type&quot;      : &quot;&quot;
+      ]
+    ];
+    /*
+    y2internal (&quot;importing dhcp settings: %1&quot;, dhcp);
+    DhcpServer::Import (dhcp);
+    DhcpServer::Write ();
+    */
+ 
+    string dhcpd_conf   = sformat (
+&quot;option rfc3442-classless-static-routes code 121 = array of unsigned integer 8;
+option domain-name \&quot;%1\&quot;;
+max-lease-time 7200;
+# Custom option to identify this DHCP server as the cloud DHCP server
+# Define the new option
+option suse-nebula code 239 = ip-address;
+# Set the value
+option suse-nebula %2;
+# Set the address range to be handed out.
+subnet %3 netmask %4 {
+    range %5 %6;
+    default-lease-time 86400000;
+    max-lease-time 1728000000000;
+}&quot;, domain, ip, subnet_ip, netmask, ip_min, ip_max);
+ 
+    SCR::Write (.target.string, &quot;/etc/dhcpd.conf&quot;, dhcpd_conf);
+ 
+    SCR::Write (.sysconfig.dhcpd.DHCPD_INTERFACE, &quot;eth0&quot;);
+    SCR::Write (.sysconfig.dhcpd, nil);
+ 
+    Service::Enable (&quot;dhcpd&quot;);
+    Service::Start (&quot;dhcpd&quot;);
+
+    // 3. Write onedamin authentication file
+    string oneauth = sformat (&quot;oneadmin:%1&quot;, cadminp);
+    SCR::Write (.target.string, &quot;/var/lib/one/.one/one_auth&quot;, oneauth);
+ 
+	return true;
+    }
+ 
+    // initialize network data
+    boolean ReadNetworkSettings () {
+    network = YaPI::NETWORK::Read ();
+    y2internal (&quot;network: %1&quot;, network);
+    nameservers = network[&quot;dns&quot;,&quot;nameservers&quot;]:[];
+    searchdomains   = network[&quot;dns&quot;,&quot;searches&quot;]:[];
+    return true;
+    }
+ 
+    ReadNetworkSettings ();
+ 
+    term contents = `HBox (`HSpacing (1), `VBox (
+    `Frame (_(&quot;Network Configuration&quot;), `VBox (
+        // text entry label
+        `InputField (`id (&quot;clustername&quot;), `opt (`hstretch), _(&quot;C&amp;luster Name&quot;), clustername),
+        `HBox (
+        // text entry label
+        `InputField (`id (&quot;hostname&quot;), `opt (`hstretch), _(&quot;&amp;Hostname&quot;), hostname),
+        // text entry label
+        `InputField (`id (&quot;domain&quot;), `opt (`hstretch), _(&quot;&amp;Domain Name&quot;), domain)
+        ),
+        `HBox (
+        // text entry label
+        `InputField (`id (&quot;ip&quot;), `opt (`hstretch), _(&quot;&amp;IP Address&quot;), ip),
+        // text entry label
+        `InputField (`id (&quot;netmask&quot;), `opt (`hstretch), _(&quot;&amp;Netmask&quot;), netmask)
+        ),
+        // text entry label
+        `InputField (`id (&quot;route&quot;), `opt (`hstretch), _(&quot;Default Route&quot;), route),
+        `HBox (
+        // text entry label
+        `InputField (`id (&quot;nameservers&quot;), `opt (`hstretch), _(&quot;Name Servers&quot;), mergestring (nameservers, &quot; &quot;)),
+        // text entry label
+        `InputField (`id (&quot;searches&quot;), `opt (`hstretch), _(&quot;Search Domains&quot;), mergestring (searchdomains, &quot; &quot;))
+        )
+    )),
+    `VSpacing (2),
+    // frame label
+    `Frame (_(&quot;IP Address Range for Cloud Nodes&quot;), `HBox (
+        // text entry label
+        `InputField (`id (&quot;ip_min&quot;), `opt (`hstretch), _(&quot;Min IP Address&quot;), ip_min),
+        // text entry label
+        `InputField (`id (&quot;ip_max&quot;), `opt (`hstretch), _(&quot;Max IP Address&quot;), ip_max)
+    )),
+    `VSpacing (2),
+    // frame label
+    `Frame (_(&quot;Cloud Administrator&quot;), `VBox (
+        // text entry label
+        `InputField (`id (&quot;cadminp&quot;), `opt (`hstretch), _(&quot;Password for Cloud Administration&quot;), cadminp),
+        `VSpacing (1),
+        `Label (&quot;The password is stored in plain text in the file /var/lib/one/.one/one_auth and is used for cloud administration only.
+This is not the password for the cloud administrator (oneadmin) user account. The oneadmin account has no password.&quot;)
+    ))
+    ), `HSpacing (1));
+ 
+    if (Mode::normal ())
+    Wizard::OpenOKDialog ();
+ 
+    string help_text    = &quot;&quot;;
+ 
+    // dialog caption
+    Wizard::SetContents (_(&quot;SUSENebula&quot;), contents, help_text, true, true);
+ 
+    UI::ChangeWidget (`id (&quot;hostname&quot;), `ValidChars, Hostname::ValidChars);
+    foreach (string key, [&quot;ip&quot;, &quot;ip_min&quot;, &quot;ip_max&quot;], {
+    UI::ChangeWidget (`id (key), `ValidChars, IP::ValidChars4);
+    });
+    any ret = `back;
+    while (true)
+    {
+    ret = UI::UserInput ();
+    if (ret == `ok || ret == `next)
+    {
+        cadminp = (string) UI::QueryWidget (`id (&quot;cadminp&quot;), `Value);
+        clustername = (string) UI::QueryWidget (`id (&quot;clustername&quot;), `Value);
+        hostname    = (string) UI::QueryWidget (`id (&quot;hostname&quot;), `Value);
+        domain  = (string) UI::QueryWidget (`id (&quot;domain&quot;), `Value);
+        ip      = (string) UI::QueryWidget (`id (&quot;ip&quot;), `Value);
+        ip_min  = (string) UI::QueryWidget (`id (&quot;ip_min&quot;), `Value);
+        ip_max  = (string) UI::QueryWidget (`id (&quot;ip_max&quot;), `Value);
+        netmask = (string) UI::QueryWidget (`id (&quot;netmask&quot;), `Value);
+        route   = (string) UI::QueryWidget (`id (&quot;route&quot;), `Value);
+        string dns  = (string) UI::QueryWidget (`id (&quot;nameservers&quot;), `Value);
+        nameservers = splitstring (dns, &quot;, &quot;);
+        string searches = (string) UI::QueryWidget (`id (&quot;searches&quot;), `Value);
+        searchdomains = splitstring (searches, &quot;, &quot;);
+ 
+        if (!Hostname::Check (hostname))
+        {
+        Report::Error (Hostname::ValidHost ());
+        UI::SetFocus (`id (&quot;hostname&quot;));
+        continue;
+        }
+        if (!Hostname::CheckDomain (domain))
+        {
+        Report::Error (Hostname::ValidDomain ());
+        UI::SetFocus (`id (&quot;domain&quot;));
+        continue;
+        }
+        if (!IP::Check (ip))
+        {
+        Report::Error (IP::Valid4 ());
+        UI::SetFocus (`id (&quot;ip&quot;));
+        continue;
+        }
+        if (!IP::Check (ip_min))
+        {
+        Report::Error (IP::Valid4 ());
+        UI::SetFocus (`id (&quot;ip_min&quot;));
+        continue;
+        }
+        if (!IP::Check (ip_max))
+        {
+        Report::Error (IP::Valid4 ());
+        UI::SetFocus (`id (&quot;ip_max&quot;));
+        continue;
+        }
+ 
+        if (IP::ToInteger (ip_min) &lt;= IP::ToInteger (ip) &amp;&amp;
+        IP::ToInteger (ip) &lt;= IP::ToInteger (ip_max))
+        {
+        // error message
+        Report::Error (_(&quot;IP Address is within the IP range that should be offered by DHCP server.&quot;));
+        UI::SetFocus (`id (&quot;ip_min&quot;));
+        continue;
+        }
+ 
+        if (IP::ToInteger (ip_min) &gt; IP::ToInteger (ip_max))
+        {
+        // error message
+        Popup::Message(_(&quot;The lowest address must be lower than the highest one.&quot;));
+        UI::SetFocus (`id (&quot;ip_min&quot;));
+        continue;
+        }
+ 
+ 
+        WriteSettings ();
+        break;
+    }
+    if (ret == `cancel || ret == `abort)
+    {
+        break;
+    }
+    if (ret == `back)
+    {
+        break;
+    }
+    }
+    if (Mode::normal ())
+    Wizard::CloseDialog ();
+    return ret;
+}
diff --git a/doc/examples/extras/suse-11.3/suse-nebula-cloud/cloud_head/root/usr/share/firstboot/scripts/finalizeSetup b/doc/examples/extras/suse-11.3/suse-nebula-cloud/cloud_head/root/usr/share/firstboot/scripts/finalizeSetup
new file mode 100755
index 0000000..20a45bb
--- /dev/null
+++ b/doc/examples/extras/suse-11.3/suse-nebula-cloud/cloud_head/root/usr/share/firstboot/scripts/finalizeSetup
@@ -0,0 +1,92 @@
+#!/usr/bin/python
+
+# Author: Robert Schweikert
+# License: GPL v2
+# Copyright: SUSE
+
+import glob
+import os
+import sys
+import syslog
+
+# Only one interface should be configured at this point
+# check that this is indeed the case
+confFiles = glob.glob('/etc/sysconfig/network/ifcfg-eth*')
+numConfInterf = len(confFiles)
+if numConfInterf &gt; 1:
+    syslog.openlog('BR_SETUP]', syslog.LOG_PID, syslog.LOG_DAEMON)
+    syslog.syslog(syslog.LOG_INFO, 'Bridge setup\n')
+    msg = 'Multiple configured eth devices found, cannot resolve ambiguity\n'
+    syslog.syslog(syslog.LOG_ERR, msg)
+    syslog.closelog()
+    sys.exit(1)
+
+if numConfInterf &lt; 1:
+    syslog.openlog('BR_SETUP]', syslog.LOG_PID, syslog.LOG_DAEMON)
+    syslog.syslog(syslog.LOG_INFO, 'Bridge setup\n')
+    msg = 'No eth interface configured, cannot setup bridge\n'
+    syslog.syslog(syslog.LOG_ERR, msg)
+    syslog.closelog()
+    sys.exit(1)
+
+# Get the configured IP address (includes the subnet mask)
+interfConf = confFiles[0]
+interfaceName = interfConf.split('-')[-1]
+lines = open(interfConf, 'r').readlines()
+ipAddr = None
+for ln in lines:
+    if ln.find('IPADDR') != -1:
+        ipAddr = ln.strip().split('=')[-1]
+        break
+
+# Stop the running network services
+os.system('/etc/init.d/dhcpd stop &gt;&amp; /dev/null')
+os.system('/etc/init.d/nfsserver stop &gt;&amp; /dev/null')
+os.system('/sbin/ifdown %s &gt;&amp; /dev/null' %interfaceName)
+
+# Write the bridge configuration
+brCfg = open('/etc/sysconfig/network/ifcfg-br0', 'w')
+brCfg.write(&quot;BOOTPROTO='static'\n&quot;)
+brCfg.write(&quot;BRIDGE='yes'\n&quot;)
+brCfg.write(&quot;BRIDGE_PORTS='%s'\n&quot; %interfaceName)
+brCfg.write(&quot;BRIDGE_STP='off'\n&quot;)
+brCfg.write(&quot;BROADCAST=''\n&quot;)
+brCfg.write(&quot;ETHTOOL_OPTIONS=''\n&quot;)
+brCfg.write(&quot;IPADDR=%s\n&quot; %ipAddr)
+brCfg.write(&quot;MTU=''\n&quot;)
+brCfg.write(&quot;NAME=''\n&quot;)
+brCfg.write(&quot;NETWORK=''\n&quot;)
+brCfg.write(&quot;REMOTE_IPADDR=''\n&quot;)
+brCfg.write(&quot;STARTMODE='auto'\n&quot;)
+brCfg.write(&quot;USERCONTROL='no'\n&quot;)
+brCfg.write(&quot;IPADDR_0='169.254.1.1/24'\n&quot;)
+brCfg.write(&quot;LABEL_0='serviceport'\n&quot;)
+brCfg.close()
+
+# Server interface update
+lines = open('/etc/sysconfig/dhcpd', 'r').readlines()
+conf = open('/etc/sysconfig/dhcpd', 'w')
+for ln in lines:
+    if ln.find('DHCPD_INTERFACE') != -1:
+        conf.write('DHCPD_INTERFACE=&quot;br0&quot;\n')
+        continue
+    conf.write(ln)
+conf.close()
+                   
+# Run the configuration setup
+os.system('/sbin/SuSEconfig &gt;&amp; /dev/null')
+
+# Remove the old network configuration file
+os.remove(interfConf)
+
+# Insert the cloud information service and start it
+os.system('/sbin/insserv cloudinfo')
+# Insert the registration service and start it
+os.system('/sbin/insserv noderegistrar')
+# Proper permissions for the authentication file
+os.system('chown oneadmin:cloud /var/lib/one/.one/one_auth')
+# Start the cloud service
+# oned must be started with special environment setting the first time
+os.system('env ONE_AUTH=/var/lib/one/.one/one_auth /etc/init.d/one start &gt;&amp; /dev/null')
+os.system('/sbin/insserv one')
+os.system('/etc/init.d/one stop &gt;&amp; /dev/null')
diff --git a/doc/examples/extras/suse-11.3/suse-nebula-cloud/cloud_head/root/usr/share/susenebula/welcome.txt b/doc/examples/extras/suse-11.3/suse-nebula-cloud/cloud_head/root/usr/share/susenebula/welcome.txt
new file mode 100644
index 0000000..8af95e0
--- /dev/null
+++ b/doc/examples/extras/suse-11.3/suse-nebula-cloud/cloud_head/root/usr/share/susenebula/welcome.txt
@@ -0,0 +1,15 @@
+Welcome to SUSENebula
+
+The next few setup steps will guide you through the final configuration of the 
+Cloud Head node. After this is complete, your head node is ready for business.
+
+One note on security, this image contains pre-configured ssh keys that are
+available (including the private key) to the rest of the world. Therefore it
+is recommended that you generate new ssh keys for the oneadmin user. After the
+setup steps are complete, login as root (the oneadmin user has no password)
+and execute the following command:
+
+ssh-keygen -f /var/lib/one/.ssh/id_rsa
+
+Answer 'y' to over write the existing key. Do NOT enter a passphrase.
+
diff --git a/tools/burner/INSTALL b/doc/examples/extras/suse-11.3/suse-nebula-cloud/cloud_head/root/var/lib/YaST2/reconfig_system
similarity index 100%
copy from tools/burner/INSTALL
copy to doc/examples/extras/suse-11.3/suse-nebula-cloud/cloud_head/root/var/lib/YaST2/reconfig_system
diff --git a/doc/examples/extras/suse-11.3/suse-nebula-cloud/cloud_head/root/var/lib/one/.ssh/authorized_keys b/doc/examples/extras/suse-11.3/suse-nebula-cloud/cloud_head/root/var/lib/one/.ssh/authorized_keys
new file mode 100644
index 0000000..b00dfcd
--- /dev/null
+++ b/doc/examples/extras/suse-11.3/suse-nebula-cloud/cloud_head/root/var/lib/one/.ssh/authorized_keys
@@ -0,0 +1 @@
+ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDR2r8Y4l2dLfb4DFFD2UK0YxGOXdMJWm3XubVVnxuWKD7OTDpp7GVv0q7oaOlrRPb8q5cukSl5CSKn0YIseWiU9PMwcBOR7o7GXTl+r2NU16M47R/ys94Uy+OqS4172Z6m3uAJHb1MvU8BbIemcn9vWLteZBHViozQfMiifc3oE1StT8bUrJuj/AaoaPKS7OnmagJwIuyi+Ffk6LxjHWbEUfpou4Wa2xBFHP4IEclq5qYvKSDxhg4MCPW9rUw61W4hnA+JCkw6uWsoiu+jkOaQ4zgKvBkDUmf7FL4wTYeVTSClGXxny6gX/rjIfbCV+RggKDbNbLYltbB8HDp+ErGn <A HREF="https://lists.berlios.de/mailman/listinfo/kiwi-devel">oneadmin at linux</A>
diff --git a/doc/examples/extras/suse-11.3/suse-nebula-cloud/cloud_head/root/var/lib/one/.ssh/config b/doc/examples/extras/suse-11.3/suse-nebula-cloud/cloud_head/root/var/lib/one/.ssh/config
new file mode 100644
index 0000000..bc7cd5f
--- /dev/null
+++ b/doc/examples/extras/suse-11.3/suse-nebula-cloud/cloud_head/root/var/lib/one/.ssh/config
@@ -0,0 +1,3 @@
+Host *
+    StrictHostKeyChecking no
+
diff --git a/doc/examples/extras/suse-11.3/suse-nebula-cloud/cloud_head/root/var/lib/one/.ssh/id_rsa b/doc/examples/extras/suse-11.3/suse-nebula-cloud/cloud_head/root/var/lib/one/.ssh/id_rsa
new file mode 100644
index 0000000..973d568
--- /dev/null
+++ b/doc/examples/extras/suse-11.3/suse-nebula-cloud/cloud_head/root/var/lib/one/.ssh/id_rsa
@@ -0,0 +1,27 @@
+-----BEGIN RSA PRIVATE KEY-----
+MIIEpAIBAAKCAQEA0dq/GOJdnS32+AxRQ9lCtGMRjl3TCVpt17m1VZ8blig+zkw6
+aexlb9Ku6Gjpa0T2/KuXLpEpeQkip9GCLHlolPTzMHATke6Oxl05fq9jVNejOO0f
+8rPeFMvjqkuNe9mept7gCR29TL1PAWyHpnJ/b1i7XmQR1YqM0HzIon3N6BNUrU/G
+1Kybo/wGqGjykuzp5moCcCLsovhX5Oi8Yx1mxFH6aLuFmtsQRRz+CBHJauamLykg
+8YYODAj1va1MOtVuIZwPiQpMOrlrKIrvo5DmkOM4CrwZA1Jn+xS+ME2HlU0gpRl8
+Z8uoF/64yH2wlfkYICg2zWy2JbWwfBw6fhKxpwIDAQABAoIBABKQzbM/45RSSrUr
+Mc1U3UfkM9tqhY8gRvN85IQMrX4dVWEe8VQJq/e2pe69yVjKIye7boaaJRcmLcC3
+ElMo8o2rFhDE+ZZBirQV70476gfJhBE3OUpZi14/o4afZIb+e8C7mwpzbRnq7aBs
+n5ukKY4KRZlWNRW1Sjvvrjhh9OOBGUrmj9Yp10LEcKpstMSA/AENvVE81J7s7V7i
++CvZov41H7uO0a8J3aWO1TIjnnLE848nEoGZOvXVVyuLUbMZAYzdRjo0DzbXuSa4
+C/1AzQzD3a91xrF6lHYE4uphRY7tX1EDVfXQTNX+fH5PKp1uxJaU8nW22DbVL/us
+X/les1ECgYEA6rDHMvcqY+vWUzLXIHeOqlL3ORMq1+mQHVEuL+oZtz1uL0uTODZT
+jOaASXQGXRWpcGnmaTq7i3/S+zvjagqvkjtpJNmdeEVV3oQ0CtLtIIywRHiWJ/L1
+bP6YJr7o7+T3TfV2AYS1Ckuf0WwtDSfeAr+g9NyUg5d/TBKGQNImJTMCgYEA5Oir
+x34QU/NTYWJvVCDxQYRb/Lbbvao9CLE1P270uYMtAIJVBM+qL/IQAAmLWmO/coVM
+iOHOz/IDxrhtuaMXb7rN2JsDgRZfwKKFOS2uAO+VTga8f0UdOdV77qI30u792/D0
+2wB7nDIhJ/c4IwGaxgS11lrBJxcGfoNbAJIb2b0CgYEAjBCvAfrDQNk6k3LvM0BH
+U92qEFUhJ7UMPoL5prz3VgYCoZVgKpc5rAjRHYVyWtGXyzBYxAq6bVn/R9OJOPth
+p0tvx/9cXLA8vE14ZdFWliuA84xoSTVWRhN4KP+dM7cZ5VwObn+OMLPLkQgXpxdZ
+B5jobdrLg/HBllwj5cHF5EMCgYAsTYvRlGh8lv9wPajmU2neEEvtYUauMqCVahaw
+LD1ZGjY/fvoNcFOz69mE6FP8LooDFCF37JwmSuTINTGnWBVVHoZwga/v7/CgS9QU
++O5QaA4xh8Q7rZi2dMcDrIm5XV/sjXoWWMWTuXAJWCOZQto9sPOwhOgVNLOhELMw
+LRcO0QKBgQDQpLlzO7Lss+KMsrvtjWfW53nlUfDtYCS7zCer+segocrdoIhlw8uS
+TiWTIjQ1dxvhIbkL6d2tfr717AwYtf9FKJKAKYyyjW2IixLypN1SOSjjCf3mO860
+4vMHfod3dzySGf9a1M4NsKF33uZ5KbcseM3oPsLwncfaicy+G+Xwhg==
+-----END RSA PRIVATE KEY-----
diff --git a/doc/examples/extras/suse-11.3/suse-nebula-cloud/cloud_head/root/var/lib/one/.ssh/id_rsa.pub b/doc/examples/extras/suse-11.3/suse-nebula-cloud/cloud_head/root/var/lib/one/.ssh/id_rsa.pub
new file mode 100644
index 0000000..b00dfcd
--- /dev/null
+++ b/doc/examples/extras/suse-11.3/suse-nebula-cloud/cloud_head/root/var/lib/one/.ssh/id_rsa.pub
@@ -0,0 +1 @@
+ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDR2r8Y4l2dLfb4DFFD2UK0YxGOXdMJWm3XubVVnxuWKD7OTDpp7GVv0q7oaOlrRPb8q5cukSl5CSKn0YIseWiU9PMwcBOR7o7GXTl+r2NU16M47R/ys94Uy+OqS4172Z6m3uAJHb1MvU8BbIemcn9vWLteZBHViozQfMiifc3oE1StT8bUrJuj/AaoaPKS7OnmagJwIuyi+Ffk6LxjHWbEUfpou4Wa2xBFHP4IEclq5qYvKSDxhg4MCPW9rUw61W4hnA+JCkw6uWsoiu+jkOaQ4zgKvBkDUmf7FL4wTYeVTSClGXxny6gX/rjIfbCV+RggKDbNbLYltbB8HDp+ErGn <A HREF="https://lists.berlios.de/mailman/listinfo/kiwi-devel">oneadmin at linux</A>
diff --git a/doc/examples/extras/suse-11.4/suse-nebula-cloud.readme b/doc/examples/extras/suse-11.4/suse-nebula-cloud.readme
new file mode 100644
index 0000000..5626571
--- /dev/null
+++ b/doc/examples/extras/suse-11.4/suse-nebula-cloud.readme
@@ -0,0 +1,68 @@
+KIWI Image Description Example
+==============================
+* This example provides the configuration for a cloud setup based on the
+  OpenNebula project. The example contains three configuration trees, one
+  for the cloud head node, one for a cloud node, and one for a guest that
+  can be setup to run on the cloud.
+
+  The guest configuration example is slightly specialized to also function
+  as a basic test image for coud setup verification. The name of the resulting
+  image is incoded in the file /home/ctester/testVM.one. Also the config.sh
+  script modifies the dhcp client configuration file such that a DHCP lease
+  is only accepted from a server that can provide the &quot;suse-nebula&quot; feature.
+  The &quot;suse-nebula&quot; feature is the default setting in the YaST setup module
+  executed on firstboot after the head node installation.
+
+  Both the head node and cloud node images are oem images targeted to be
+  deployed from a USB stick. Both images will shutdown the machine after the
+  deployment is complete, a sign that the USB stick can be removed.
+
+  A keyboard and monitor need to be connected to the head node on firstboot
+  to complete the configuration. After the head node is configured cloud nodes 
+  can be deployed, or if deployed already be turned on. Cloud nodes will self
+  configure on first boot and register themselves with the cloud infrastructure
+  running on the head node.
+
+  The head node contains a /home/ctester directory that is setup to deploy the
+  guest image built with the cloud_guest tree. See the testVM.README file for
+  additional details.
+
+  For administration of the cloud infrastrusture see the documentation provided
+  by the OpenNebula project.
+
+  <A HREF="http://opennebula.org/documentation">http://opennebula.org/documentation</A>
+
+How to build this Example
+==============================
+
+* Head Node
+    kiwi -p /usr/share/doc/packages/kiwi/examples/extras/suse-11.4/suse-nebula-cloud/cloud_head --root /tmp/neb_head_unpacked
+
+    kiwi --create /tmp/neb_head_unpacked -d /tmp/neb_head_image
+
+* Cloud Node
+    kiwi -p /usr/share/doc/packages/kiwi/examples/extras/suse-11.4/suse-nebula-cloud/cloud_cloud --root /tmp/neb_cloud_unpacked
+
+    kiwi --create /tmp/neb_cloud_unpacked -d /tmp/neb_cloud_img
+
+* Guest
+    kiwi -p /usr/share/doc/packages/kiwi/examples/extras/suse-11.4/suse-nebula-cloud/cloud_guest --root /tmp/neb_guest_unpacked
+
+    kiwi --create /tmp/neb_guest_unpacked -d /tmp/neb_guest_img
+  
+How to test this Example
+==============================
+* The OEM images for the head node and cloud node can be dumped onto a USB
+  stick. Then appropriate machines can be booted from the stick. The head
+  node can run inside a VM. Cloud node machines for this example must have
+  processor(s) that support virtualization instructions as the example uses
+  KVM. You can modify the example to use Xen, if this is your preferred
+  hypervisor solution.
+
+Login Details Head and Cloud
+==============================
+* As configured during firstboot of the head node
+
+Login Details Guest
+==============================
+* User root pwd: linux
diff --git a/doc/examples/suse-11.3/suse-xen-guest/config.sh b/doc/examples/extras/suse-11.4/suse-nebula-cloud/cloud_cloud/config.sh
similarity index 67%
copy from doc/examples/suse-11.3/suse-xen-guest/config.sh
copy to doc/examples/extras/suse-11.4/suse-nebula-cloud/cloud_cloud/config.sh
index 098002e..b069be0 100755
--- a/doc/examples/suse-11.3/suse-xen-guest/config.sh
+++ b/doc/examples/extras/suse-11.4/suse-nebula-cloud/cloud_cloud/config.sh
@@ -5,12 +5,12 @@
 # PROJECT       : OpenSuSE KIWI Image System
 # COPYRIGHT     : (c) 2006 SUSE LINUX Products GmbH. All rights reserved
 #               :
-# AUTHOR        : Marcus Schaefer &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/kiwi-devel">ms at suse.de</A>&gt;
+# AUTHOR        : Robert Scwheikert &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/kiwi-devel">rschweikert at novell.com</A>&gt;
 #               :
 # BELONGS TO    : Operating System images
 #               :
 # DESCRIPTION   : configuration script for SUSE based
-#               : operating systems
+#               : OpenNebula cloud node
 #               :
 #               :
 # STATUS        : BETA
@@ -37,16 +37,26 @@ suseSetupProduct
 suseActivateDefaultServices
 suseInsertService boot.device-mapper
 suseInsertService sshd
+suseInsertService libvirtd
 
 #======================================
 # SuSEconfig
 #--------------------------------------
+baseUpdateSysConfig /etc/sysconfig/network/dhcp DHCLIENT_BIN dhclient
+# Disable IPv6
+baseUpdateSysConfig /etc/sysconfig/network/dhcp DHCLIENT6_BIN /bin/false
+echo &#226;&#128;&#156;alias net-pf-10 off&#226;&#128;&#157; &gt;&gt; /etc/modprobe.conf.local
+echo &#226;&#128;&#156;alias ipv6 off&#226;&#128;&#157; &gt;&gt; /etc/modprobe.conf.local
+sed -i &quot;s/#net.ipv6.conf.all.disable_ipv6 = 1/net.ipv6.conf.all.disable_ipv6 = 1&quot; /etc/sysctl.conf
+# Configure libvirt settings
+sed -i &quot;s/#listen_tcp = 1/listen_tcp = 1/&quot; /etc/libvirt/libvirtd.conf
+
 suseConfig
 
 #======================================
-# clone runlevel 3 to 4
+# Misc
 #--------------------------------------
-suseCloneRunlevel 4
+ln -s /usr/bin/qemu-kvm /usr/bin/kvm
 
 #======================================
 # Umount kernel filesystems
diff --git a/doc/examples/extras/suse-11.4/suse-nebula-cloud/cloud_cloud/config.xml b/doc/examples/extras/suse-11.4/suse-nebula-cloud/cloud_cloud/config.xml
new file mode 100644
index 0000000..ccb157d
--- /dev/null
+++ b/doc/examples/extras/suse-11.4/suse-nebula-cloud/cloud_cloud/config.xml
@@ -0,0 +1,65 @@
+&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
+&lt;image schemaversion=&quot;5.2&quot; name=&quot;suse-11.4-OpenNebula-Cloud-Node&quot;&gt;
+	&lt;description type=&quot;system&quot;&gt;
+		&lt;author&gt;Robert Schweikert&lt;/author&gt;
+		&lt;contact&gt;<A HREF="https://lists.berlios.de/mailman/listinfo/kiwi-devel">rschweikert at novell.com</A>&lt;/contact&gt;
+		&lt;specification&gt;OpenNebula Cloud Node configuration&lt;/specification&gt;
+    &lt;/description&gt;
+    &lt;preferences&gt;
+        &lt;type image=&quot;oem&quot; filesystem=&quot;ext3&quot; boot=&quot;oemboot/suse-11.4&quot; installstick=&quot;true&quot; installboot=&quot;install&quot; boottimeout=&quot;2&quot;&gt;
+			&lt;oemconfig&gt;
+				&lt;oem-boot-title&gt;OpenNebula Cloud Node&lt;/oem-boot-title&gt;
+				&lt;oem-shutdown&gt;true&lt;/oem-shutdown&gt;
+				&lt;oem-swap&gt;true&lt;/oem-swap&gt;
+				&lt;oem-swapsize&gt;2048&lt;/oem-swapsize&gt;
+                &lt;oem-unattended&gt;true&lt;/oem-unattended&gt;
+			&lt;/oemconfig&gt;
+		&lt;/type&gt;
+		&lt;version&gt;1.1.0&lt;/version&gt;
+		&lt;packagemanager&gt;zypper&lt;/packagemanager&gt;
+		&lt;rpm-check-signatures&gt;false&lt;/rpm-check-signatures&gt;
+		&lt;rpm-force&gt;true&lt;/rpm-force&gt;
+		&lt;locale&gt;en_US&lt;/locale&gt;
+		&lt;keytable&gt;us.map.gz&lt;/keytable&gt;
+	&lt;/preferences&gt;
+	&lt;users group=&quot;root&quot;&gt;
+		&lt;user pwd=&quot;cloudDemo&quot; pwdformat=&quot;plain&quot; home=&quot;/root&quot; name=&quot;root&quot;/&gt;
+	&lt;/users&gt;
+	&lt;repository type=&quot;yast2&quot;&gt;
+		&lt;source path=&quot;<A HREF="opensuse://11.4/repo/oss/">opensuse://11.4/repo/oss/</A>&quot;/&gt;
+	&lt;/repository&gt;
+    &lt;repository type=&quot;rpm-md&quot;&gt;
+        &lt;source path=&quot;<A HREF="http://download.opensuse.org/repositories/Virtualization:/Cloud:/OpenNebula/openSUSE_11.4">http://download.opensuse.org/repositories/Virtualization:/Cloud:/OpenNebula/openSUSE_11.4</A>&quot;/&gt;
+    &lt;/repository&gt;
+	&lt;packages type=&quot;image&quot; patternType=&quot;plusRecommended&quot;&gt;
+		&lt;opensusePattern name=&quot;base&quot;/&gt;
+		&lt;package name=&quot;bootsplash&quot;/&gt;
+        &lt;package name=&quot;bootsplash-branding-openSUSE&quot; bootinclude=&quot;true&quot; bootdelete=&quot;true&quot;/&gt;
+		&lt;package name=&quot;bridge-utils&quot;/&gt;
+		&lt;package name=&quot;dhcp-client&quot;/&gt;
+        &lt;package name=&quot;gfxboot-branding-openSUSE&quot; bootinclude=&quot;true&quot; bootdelete=&quot;true&quot;/&gt;
+		&lt;package name=&quot;ifplugd&quot;/&gt;
+		&lt;package name=&quot;iptables&quot;/&gt;
+		&lt;package name=&quot;iputils&quot;/&gt;
+		&lt;package name=&quot;kernel-default&quot;/&gt;
+        &lt;package name=&quot;kvm&quot;/&gt;
+        &lt;package name=&quot;libvirt&quot;/&gt;
+        &lt;package name=&quot;nfs-client&quot;/&gt;
+        &lt;package name=&quot;openssh&quot;/&gt;
+        &lt;package name=&quot;openssl&quot;/&gt;
+        &lt;package name=&quot;qemu&quot;/&gt;
+		&lt;package name=&quot;rsyslog&quot;/&gt;
+        &lt;package name=&quot;ruby&quot;/&gt;
+        &lt;package name=&quot;rubygems&quot;/&gt;
+        &lt;package name=&quot;rubygem-libxml-ruby&quot;/&gt;
+        &lt;package name=&quot;rubygem-nokogiri&quot;/&gt;
+        &lt;package name=&quot;terminfo&quot;/&gt;
+		&lt;package name=&quot;vi&quot;/&gt;
+        &lt;package name=&quot;xmlrpc-c&quot;/&gt;
+        &lt;package name=&quot;yast2-nfs-client&quot;/&gt;
+	&lt;/packages&gt;
+	&lt;packages type=&quot;bootstrap&quot;&gt;
+		&lt;package name=&quot;filesystem&quot;/&gt;
+		&lt;package name=&quot;glibc-locale&quot;/&gt;
+	&lt;/packages&gt;
+&lt;/image&gt;
diff --git a/doc/examples/extras/suse-11.4/suse-nebula-cloud/cloud_cloud/root/etc/HOSTNAME b/doc/examples/extras/suse-11.4/suse-nebula-cloud/cloud_cloud/root/etc/HOSTNAME
new file mode 100644
index 0000000..6cfc2eb
--- /dev/null
+++ b/doc/examples/extras/suse-11.4/suse-nebula-cloud/cloud_cloud/root/etc/HOSTNAME
@@ -0,0 +1 @@
+node1.SUSENebula
diff --git a/doc/examples/extras/suse-11.4/suse-nebula-cloud/cloud_cloud/root/etc/init.d/boot.local b/doc/examples/extras/suse-11.4/suse-nebula-cloud/cloud_cloud/root/etc/init.d/boot.local
new file mode 100755
index 0000000..45c6d97
--- /dev/null
+++ b/doc/examples/extras/suse-11.4/suse-nebula-cloud/cloud_cloud/root/etc/init.d/boot.local
@@ -0,0 +1,6 @@
+#!/bin/sh
+
+if [ -f /var/lib/firstboot ]; then
+    /usr/share/firstboot/scripts/cloudNodeConfig
+    rm /var/lib/firstboot
+fi
diff --git a/doc/examples/extras/suse-11.4/suse-nebula-cloud/cloud_cloud/root/etc/polkit-1/localauthority/50-local.d/60-suseNebula-access.pkla b/doc/examples/extras/suse-11.4/suse-nebula-cloud/cloud_cloud/root/etc/polkit-1/localauthority/50-local.d/60-suseNebula-access.pkla
new file mode 100644
index 0000000..b5a2ef4
--- /dev/null
+++ b/doc/examples/extras/suse-11.4/suse-nebula-cloud/cloud_cloud/root/etc/polkit-1/localauthority/50-local.d/60-suseNebula-access.pkla
@@ -0,0 +1,6 @@
+[Remote libvirt SSH access]
+ Identity=unix-user:oneadmin
+ Action=org.libvirt.unix.manage
+ ResultAny=yes
+ ResultInactive=yes
+ ResultActive=yes
diff --git a/doc/examples/extras/suse-11.4/suse-nebula-cloud/cloud_cloud/root/usr/share/firstboot/scripts/cloudNodeConfig b/doc/examples/extras/suse-11.4/suse-nebula-cloud/cloud_cloud/root/usr/share/firstboot/scripts/cloudNodeConfig
new file mode 100755
index 0000000..bc1da61
--- /dev/null
+++ b/doc/examples/extras/suse-11.4/suse-nebula-cloud/cloud_cloud/root/usr/share/firstboot/scripts/cloudNodeConfig
@@ -0,0 +1,372 @@
+#!/usr/bin/python
+
+&quot;&quot;&quot;SUSENebula cloud node configurator.&quot;&quot;&quot;
+
+import glob
+import os
+import re
+import socket
+import sys
+import syslog
+import time
+
+#------------------------------------------------------------------------
+def configureNode(confSettings):
+    &quot;&quot;&quot;Configure this node.&quot;&quot;&quot;
+    # Setup keyboard layout
+    layout = confSettings['keyLayout']
+    msg = 'Setting keyboard layout to: %s\n' %layout
+    syslog.syslog(syslog.LOG_INFO, msg)
+    os.system('/sbin/yast2 keyboard set layout=%s' %layout)
+    # Setup the timezone
+    zone = confSettings['timezone']
+    hwc = confSettings['hwclock'].lower()
+    msg = 'Setting timezone and hwclock to: %s, %s' %(zone, hwc)
+    syslog.syslog(syslog.LOG_INFO, msg)
+    os.system('/sbin/yast2 timezone set timezone=%s hwclock=%s' %(zone, hwc))
+        # Setup hostname
+    domain = confSettings['domainname']
+    name = confSettings['hostname']
+    host = '%s.%s' %(name, domain)
+    msg = 'Setting hostname to: %s\n' %host
+    hf = open('/etc/HOSTNAME', 'w')
+    hf.write(host)
+    hf.close()
+    # Add the hostname to the dhcp configuration info
+    lines = open('/etc/sysconfig/network/dhcp', 'r').readlines()
+    dhf = open('/etc/sysconfig/network/dhcp', 'w')
+    for ln in lines:
+        if ln.find('DHCLIENT_HOSTNAME_OPTION') != -1:
+            dhf.write('DHCLIENT_HOSTNAME_OPTION=&quot;%s&quot;' %name)
+            continue
+        dhf.write(ln)
+    dhf.close()
+    # Add the dhcp feature to avoid dhcp acceptance from servers other than
+    # the head node
+    feature = confSettings['dhcpFeature']
+    msg = 'Setting dhclient required feature to: %s\n' %feature
+    syslog.syslog(syslog.LOG_INFO, msg)
+    dhcf = open('/etc/dhclient.conf','a')
+    dhcf.write('option %s code 239 = ip-address;\n' %feature)
+    dhcf.write('request %s;\n' %feature)
+    dhcf.write('require %s;\n' %feature)
+    dhcf.close()
+    # Setup the name resolution
+    syslog.syslog(syslog.LOG_INFO, 'Setting up resolve.conf\n')
+    res = open('/etc/resolv.conf', 'w')
+    res.write(confSettings['resolve'])
+    res.close()
+    # Setup the routes
+    syslog.syslog(syslog.LOG_INFO, 'Setting up routes\n')
+    routes = open('/etc/sysconfig/network/routes', 'w')
+    routes.write(confSettings['routes'])
+    routes.close()
+    # Setup the root password
+    syslog.syslog(syslog.LOG_INFO, 'Setting root password\n')
+    lines = open('/etc/shadow', 'r').readlines()
+    shadow = open('/etc/shadow','w')
+    for ln in lines:
+        if ln[:4] == 'root':
+            shadow.write('root:')
+            shadow.write(confSettings['rootpass'])
+            shadow.write(':')
+            shadow.write(ln.split(':')[2])
+            shadow.write('::::::\n')
+            continue
+        shadow.write(ln)
+    shadow.close()
+    # Setup the cloud administartor acount
+    # Use eval; convert strings to tuple
+    gname, gid = eval(confSettings['groupID'])
+    uname, uid, pwd = eval(confSettings['userID'])
+    msg = 'Setting up %s with uid, gid: %s, %s\n' %(uname,uid,gid)
+    syslog.syslog(syslog.LOG_INFO, msg)
+    res = os.system('/usr/sbin/groupadd -g %s %s' %(gid, gname))
+    if res:
+        msg = 'Could not add %s group. ' %gname
+        msg += 'Incomplete configuration\n'
+        syslog.syslog(syslog.LOG_INFO, msg)
+        return -1
+    res = os.system(
+        '/usr/sbin/useradd -c &quot;%s&quot; -d %s -g %s -G %s -u %s -p %s -m %s'
+        %('Cloud admin', '/var/lib/one', gid, 'kvm,root', uid, pwd, uname))
+    if res:
+        msg = 'Could not add %s user. ' %uname
+        msg += 'Incomplete configuration\n'
+        syslog.syslog(syslog.LOG_INFO, msg)
+        return -1
+    # Setup nfs mount in fstab
+    syslog.syslog(syslog.LOG_INFO, 'Setting up NFS mount in fstab\n')
+    fst = open('/etc/fstab', 'a')
+    fst.write(confSettings['serverIP'])
+    fst.write(':/var/lib/one')
+    fst.write('\t/var/lib/one\tnfs\tdefaults\t1 1\n')
+    fst.close()
+            
+    return 1
+
+#----------------------------------------------------------------------------
+def getConfigFromServer():
+    &quot;&quot;&quot;Get the configuration from the service running on the head node.&quot;&quot;&quot;
+    syslog.syslog(syslog.LOG_INFO, 'Obtain node configuration from head\n')
+    s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
+    try:
+        s.connect(('169.254.1.1',  8445))
+    except:
+        msg = 'Could not connect to head node at 169.254.1.1 port  8445\n'
+        syslog.syslog(syslog.LOG_INFO, msg)
+        return -1
+    # Request the configuration info from the head node
+    s.send('PROVIDE_CONFIG')
+    confSettings = {}
+    confData = ''
+    # Read the configuration data from the socket
+    while 1:
+        data = s.recv(4096)
+        confData += data
+        if confData.find('COMPLETE') != -1:
+            break
+    s.close()
+    # Populate the configuration data dict
+    for confItem in confData.split(';'):
+        key, value = confItem.split('=', 1)
+        if key != 'COMPLETE':
+            confSettings[key] = value
+    return confSettings
+
+#----------------------------------------------------------------------------
+def getFirstConnectedInterface():
+    &quot;&quot;&quot;Find the interface that has a cable connected.&quot;&quot;&quot;
+    iFaceInfo = os.popen('/usr/sbin/hwinfo').readlines()
+    iFaceName = None
+    processBlock = None
+    for ln in iFaceInfo:
+        if ln.strip() == '':
+            processBlock = None
+            continue
+        if processBlock:
+            if ln.find('SysFS ID') != -1:
+                iFaceName = ln.split(':')[-1].split('/')[-1].strip()
+                continue
+            if ln.find('Link detected') != -1:
+                carrier = ln.split(':')[-1].strip()
+                if carrier == 'yes':
+                    if iFaceName:
+                        return iFaceName
+                else:
+                    continue
+        if re.match(r'^\d+:.*Ethernet$',ln):
+            processBlock = 1
+            continue
+
+    return -1 # No network interface is connected 
+
+#----------------------------------------------------------------------------
+def registerNode():
+    &quot;&quot;&quot;Register this node with the head node.&quot;&quot;&quot;
+    syslog.syslog(syslog.LOG_INFO, 'Register the node with the head node.\n')
+    # Get the IP and MAC Address of this node
+    ipInfo = os.popen('/sbin/ifconfig').readlines()
+    processBlk = None
+    ipAddr = None
+    macAddr = None
+    for ln in ipInfo:
+        if ipAddr and macAddr:
+            break
+        if processBlk:
+            if ln.find('inet addr') != -1:
+                ipAddr = ln.split(':')[1].split()[0].strip()
+                continue
+        # We always setup br0, see setupCloudNetwork()
+        if ln.find('br0') != -1:
+            processBlk = 1
+            macAddr = ln.split()[-1].strip()
+    if not ipAddr:
+        msg = 'Could not determine IP of this node. '
+        msg += 'Unable to gergister node.\n'
+        syslog.syslog(syslog.LOG_INFO, msg)
+        return -1
+    if not macAddr:
+        msg = 'Could not determine MAC of this node. '
+        msg += 'Unable to gergister node.\n'
+        syslog.syslog(syslog.LOG_INFO, msg)
+        return -1
+    # Get the server IP from fstab, see configureNode()
+    fst = open('/etc/fstab','r').readlines()
+    servIP = None
+    for ln in fst:
+        if ln.find('/var/lib/one') != -1:
+            servIP = ln.split(':')[0].strip()
+    if not servIP:
+        msg = 'Could not determine head node IP from /etc/fstab. '
+        msg += 'Unable to gergister node.\n'
+        syslog.syslog(syslog.LOG_INFO, msg)
+        return -1
+    # Hostname
+    myName = open('/etc/HOSTNAME', 'r').read().split('.')[0].strip()
+    # Connect to server and register
+    s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
+    try:
+        s.connect((servIP,  8445))
+    except:
+        msg = 'Could not connect to head node at %s port  8445\n' %servIP
+        syslog.syslog(syslog.LOG_INFO, msg)
+        return -1
+    regInfo = '%s;%s;%s' %(macAddr, ipAddr, myName)
+    s.send(regInfo)
+    s.close()
+
+    return 1
+    
+#----------------------------------------------------------------------------
+def removeConfNetworkSetting(iFace):
+    &quot;&quot;&quot;Shutdown the configuration network and remove the configuration.&quot;&quot;&quot;
+    syslog.syslog(syslog.LOG_INFO, 'Shutdown configuartion network\n')
+    os.system('/sbin/ifdown %s' %iFace)
+    msg = 'Remove configuration network interface config\n'
+    syslog.syslog(syslog.LOG_INFO, msg)
+    os.remove('/etc/sysconfig/network/ifcfg-%s' %iFace)
+
+#----------------------------------------------------------------------------
+def setupCloudNetwork(iFace):
+    &quot;&quot;&quot;Setup the configuration for the cloud network and fire it up.&quot;&quot;&quot;
+    msg = 'Setup cloud network configuration as br0\n'
+    syslog.syslog(syslog.LOG_INFO, msg)
+    cfgF = open('/etc/sysconfig/network/ifcfg-br0', 'w')
+    cfgF.write(&quot;BOOTPROTO='dhcp'\n&quot;)
+    cfgF.write(&quot;BRIDGE='yes'\n&quot;)
+    cfgF.write(&quot;BRIDGE_FORWARDDELAY='0'\n&quot;)
+    cfgF.write(&quot;BRIDGE_PORTS='%s'\n&quot; %iFace)
+    cfgF.write(&quot;BRIDGE_STP='off'\n&quot;)
+    cfgF.write(&quot;BROADCAST=''\n&quot;)
+    cfgF.write(&quot;ETHTOOL_OPTIONS=''\n&quot;)
+    cfgF.write(&quot;MTU=''\n&quot;)
+    cfgF.write(&quot;NAME=''\n&quot;)
+    cfgF.write(&quot;NETWORK=''\n&quot;)
+    cfgF.write(&quot;REMOTE_IPADDR=''\n&quot;)
+    cfgF.write(&quot;STARTMODE='auto'\n&quot;)
+    cfgF.write(&quot;USERCONTROL='no'&quot;)
+    cfgF.close()
+    
+#----------------------------------------------------------------------------
+def setupConfNetwork(iFace):
+    &quot;&quot;&quot;Setup the interface provided as the configuration network with a
+       static IP.&quot;&quot;&quot;
+    syslog.syslog(syslog.LOG_INFO, 'Setup configuration network 169.254.1.2\n')
+    cfgF = open('/etc/sysconfig/network/ifcfg-%s' %iFace, 'w')
+    cfgF.write(&quot;BOOTPROTO='static'\n&quot;)
+    cfgF.write(&quot;BROADCAST=''\n&quot;)
+    cfgF.write(&quot;ETHTOOL_OPTIONS=''\n&quot;)
+    cfgF.write(&quot;IPADDR='169.254.1.2/24'\n&quot;)
+    cfgF.write(&quot;MTU=''\n&quot;)
+    cfgF.write(&quot;NAME='Cloud configuration network'\n&quot;)
+    cfgF.write(&quot;NETWORK=''\n&quot;)
+    cfgF.write(&quot;REMOTE_IPADDR=''\n&quot;)
+    cfgF.write(&quot;STARTMODE='auto'\n&quot;)
+    cfgF.write(&quot;USERCONTROL='no'&quot;)
+    cfgF.close()
+
+#----------------------------------------------------------------------------
+def startCloudNetwork():
+    &quot;&quot;&quot;Start the cloud network.&quot;&quot;&quot;
+    syslog.syslog(syslog.LOG_INFO, 'Starting cloud network\n')
+    os.system('/sbin/ifup br0')
+    cnt = 0
+    # Cannot depend on the ifup exit status as we need to play a trick to
+    # disable IPv6 which always leads to a non zero exit status
+    # Therefore we probe whether or not we get an IP address assigned
+    while cnt &lt; 10:
+        time.sleep(15) # give dhcp a chance to get an address
+        processBlock = None
+        ifaceInfo = os.popen('/sbin/ifconfig').readlines()
+        for ln in ifaceInfo:
+            if ln.find('br0') != -1:
+                processBlock = 1
+                continue
+            if processBlock and ln.find('inet addr') != -1:
+                addr = ln.split(':')[1].split()[0].strip()
+                if addr.find('.') != -1:
+                    cnt = 99
+                    break
+        cnt += 1
+    if cnt != 100:
+        return -1
+
+    return 1
+
+#----------------------------------------------------------------------------
+def startNetwork(iFace, type):
+    &quot;&quot;&quot;Start the specified network interface.&quot;&quot;&quot;
+    msg = 'Start %s network interface on %s\n' %(type, iFace)
+    syslog.syslog(syslog.LOG_INFO, msg)
+    res = os.system('/sbin/ifup %s' %iFace)
+    if res:
+        return -1
+
+    return 1
+
+#----------------------------------------------------------------------------
+if __name__ == &quot;__main__&quot;:
+    # Triggered from boot.local, thus this runs prior to services being started
+    # Start the syslog service to make sure our messages are recorded
+    os.system('/etc/init.d/syslog start &gt;&amp; /dev/null')
+    syslog.openlog('[CLOUD_NODE_SETUP]', syslog.LOG_PID, syslog.LOG_DAEMON)
+    syslog.syslog(syslog.LOG_INFO, 'Start node registration and setup\n')
+    iFace = getFirstConnectedInterface()
+    if iFace == -1:
+        msg = 'Could not determine connected network interface aborting'
+        msg += ' node configuration\n'
+        syslog.syslog(syslog.LOG_INFO, msg)
+        syslog.closelog()
+        sys.exit(1)
+    setupConfNetwork(iFace)
+    res = startNetwork(iFace, 'configuration')
+    if res == -1:
+        msg = 'Could not start the network interface to configure the '
+        msg += 'cloud node, manual configuration required.\n'
+        syslog.syslog(syslog.LOG_INFO, msg)
+        syslog.closelog()
+        sys.exit(1)
+    confDict = getConfigFromServer()
+    if confDict == -1:
+        msg = 'Could not connect to configuration server at 169.254.1.1 '
+        msg += 'cloud node, manual configuration required.\n'
+        msg += 'This IP:  169.254.1.2\n'
+        syslog.syslog(syslog.LOG_INFO, msg)
+        syslog.closelog()
+        sys.exit(1)
+    removeConfNetworkSetting(iFace)
+    setupCloudNetwork(iFace)
+    res = configureNode(confDict)
+    if res == -1:
+        msg = 'Configuration failure. Manual configuration requires.\n'
+        syslog.syslog(syslog.LOG_INFO, msg)
+        syslog.closelog()
+        sys.exit(1)
+    # Setup cloud network
+    res = startCloudNetwork()
+    if res == -1:
+        msg = 'Cloud network setup and start up failed. Manual configuration '
+        msg += 'required\n'
+        syslog.syslog(syslog.LOG_INFO, msg)
+        syslog.closelog()
+        sys.exit(1)
+    # NFS setup
+    syslog.syslog(syslog.LOG_INFO, 'Insert nfs and start service\n')
+    os.system('/sbin/insserv nfs')
+    # Register the node with the head node
+    res = registerNode()
+    if res == -1:
+        msg = 'Could not register the node. Manual registration on head node '
+        msg += 'required. (dhcp and one)\n'
+        syslog.syslog(syslog.LOG_INFO, msg)
+        syslog.closelog()
+        sys.exit(1)
+    # Stop the network interface, will be started during service startup
+    os.system('/sbin/ifdown br0')
+    msg = 'Cloud node configuration completed with success.\n'
+    syslog.syslog(syslog.LOG_INFO, msg)
+    syslog.closelog()
+    # Stop the syslog service, will be started again during service startup
+    os.system('/etc/init.d/syslog stop &gt;&amp; /dev/null')
+
diff --git a/tools/burner/INSTALL b/doc/examples/extras/suse-11.4/suse-nebula-cloud/cloud_cloud/root/var/lib/firstboot
similarity index 100%
copy from tools/burner/INSTALL
copy to doc/examples/extras/suse-11.4/suse-nebula-cloud/cloud_cloud/root/var/lib/firstboot
diff --git a/doc/examples/suse-11.3/suse-xen-guest/config.sh b/doc/examples/extras/suse-11.4/suse-nebula-cloud/cloud_guest/config.sh
similarity index 63%
copy from doc/examples/suse-11.3/suse-xen-guest/config.sh
copy to doc/examples/extras/suse-11.4/suse-nebula-cloud/cloud_guest/config.sh
index 098002e..6dc8de5 100755
--- a/doc/examples/suse-11.3/suse-xen-guest/config.sh
+++ b/doc/examples/extras/suse-11.4/suse-nebula-cloud/cloud_guest/config.sh
@@ -3,9 +3,9 @@
 # FILE          : config.sh
 #----------------
 # PROJECT       : OpenSuSE KIWI Image System
-# COPYRIGHT     : (c) 2006 SUSE LINUX Products GmbH. All rights reserved
+# COPYRIGHT     : (c) 2011 SUSE LINUX Products GmbH. All rights reserved
 #               :
-# AUTHOR        : Marcus Schaefer &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/kiwi-devel">ms at suse.de</A>&gt;
+# AUTHOR        : Robert Schweikert
 #               :
 # BELONGS TO    : Operating System images
 #               :
@@ -41,12 +41,19 @@ suseInsertService sshd
 #======================================
 # SuSEconfig
 #--------------------------------------
-suseConfig
+baseUpdateSysConfig /etc/sysconfig/bootloader LOADER_LOCATION mbr
+baseUpdateSysConfig /etc/sysconfig/network/dhcp DHCLIENT_BIN dhclient
+# Disable IPv6
+baseUpdateSysConfig /etc/sysconfig/network/dhcp DHCLIENT6_BIN /bin/false
+echo &#226;&#128;&#156;alias net-pf-10 off&#226;&#128;&#157; &gt;&gt; /etc/modprobe.conf.local
+echo &#226;&#128;&#156;alias ipv6 off&#226;&#128;&#157; &gt;&gt; /etc/modprobe.conf.local
+sed -i &quot;s/#net.ipv6.conf.all.disable_ipv6 = 1/net.ipv6.conf.all.disable_ipv6 = 1&quot; /etc/sysctl.conf
 
-#======================================
-# clone runlevel 3 to 4
-#--------------------------------------
-suseCloneRunlevel 4
+echo &quot;option suse-nebula code 239 = ip-address;&quot; &gt;&gt; /etc/dhclient.conf
+echo &quot;require suse-nebula;&quot; &gt;&gt; /etc/dhclient.conf
+echo &quot;request suse-nebula;&quot; &gt;&gt; /etc/dhclient.conf
+
+suseConfig
 
 #======================================
 # Umount kernel filesystems
diff --git a/doc/examples/suse-11.4/suse-vm-guest/config.xml b/doc/examples/extras/suse-11.4/suse-nebula-cloud/cloud_guest/config.xml
similarity index 78%
copy from doc/examples/suse-11.4/suse-vm-guest/config.xml
copy to doc/examples/extras/suse-11.4/suse-nebula-cloud/cloud_guest/config.xml
index b42cf39..f2e6699 100644
--- a/doc/examples/suse-11.4/suse-vm-guest/config.xml
+++ b/doc/examples/extras/suse-11.4/suse-nebula-cloud/cloud_guest/config.xml
@@ -1,18 +1,13 @@
 &lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
-
-&lt;image schemaversion=&quot;5.2&quot; name=&quot;suse-11.4-vm-guest&quot;&gt;
+&lt;image schemaversion=&quot;5.2&quot; name=&quot;suse-11.4-SUSENebula-guest&quot;&gt;
 	&lt;description type=&quot;system&quot;&gt;
-		&lt;author&gt;Marcus Sch&#195;&#164;fer&lt;/author&gt;
-		&lt;contact&gt;<A HREF="https://lists.berlios.de/mailman/listinfo/kiwi-devel">ms at novell.com</A>&lt;/contact&gt;
+		&lt;author&gt;Robert Schweikert&lt;/author&gt;
+		&lt;contact&gt;<A HREF="https://lists.berlios.de/mailman/listinfo/kiwi-devel">rschweikert at novell.com</A>&lt;/contact&gt;
 		&lt;specification&gt;openSUSE 11.4 virtual disk system&lt;/specification&gt;
 	&lt;/description&gt;
 	&lt;preferences&gt;
-		&lt;type image=&quot;vmx&quot; primary=&quot;true&quot; filesystem=&quot;ext4&quot; boot=&quot;vmxboot/suse-11.4&quot; format=&quot;vmdk&quot;&gt;
-			&lt;machine memory=&quot;512&quot;&gt;
-				&lt;vmdisk controller=&quot;ide&quot; id=&quot;0&quot;/&gt;
-			&lt;/machine&gt;
-		&lt;/type&gt;
-		&lt;version&gt;1.1.2&lt;/version&gt;
+		&lt;type image=&quot;vmx&quot; primary=&quot;true&quot; filesystem=&quot;ext4&quot; boot=&quot;vmxboot/suse-11.4&quot; format=&quot;qcow2&quot;/&gt;
+		&lt;version&gt;1.0.0&lt;/version&gt;
 		&lt;packagemanager&gt;zypper&lt;/packagemanager&gt;
 		&lt;rpm-check-signatures&gt;false&lt;/rpm-check-signatures&gt;
 		&lt;rpm-force&gt;true&lt;/rpm-force&gt;
@@ -30,10 +25,10 @@
 		&lt;package name=&quot;gfxboot-branding-openSUSE&quot; bootinclude=&quot;true&quot; bootdelete=&quot;true&quot;/&gt;
 		&lt;package name=&quot;kernel-default&quot;/&gt;
 		&lt;package name=&quot;ifplugd&quot;/&gt;
+        &lt;package name=&quot;iputils&quot;/&gt;
 		&lt;package name=&quot;vim&quot;/&gt;
 		&lt;opensusePattern name=&quot;base&quot;/&gt;
 	&lt;/packages&gt;
-	&lt;packages type=&quot;vmx&quot;/&gt;
 	&lt;packages type=&quot;bootstrap&quot;&gt;
 		&lt;package name=&quot;filesystem&quot;/&gt;
 		&lt;package name=&quot;glibc-locale&quot;/&gt;
diff --git a/doc/examples/suse-11.3/suse-vm-guest/root/etc/init.d/boot b/doc/examples/extras/suse-11.4/suse-nebula-cloud/cloud_guest/root/etc/init.d/boot
similarity index 99%
copy from doc/examples/suse-11.3/suse-vm-guest/root/etc/init.d/boot
copy to doc/examples/extras/suse-11.4/suse-nebula-cloud/cloud_guest/root/etc/init.d/boot
index 37c97f5..40f3352 100755
--- a/doc/examples/suse-11.3/suse-vm-guest/root/etc/init.d/boot
+++ b/doc/examples/extras/suse-11.4/suse-nebula-cloud/cloud_guest/root/etc/init.d/boot
@@ -308,7 +308,6 @@ if test -f /var/lib/YaST2/runme_at_boot ; then
 	rm -f /var/lib/YaST2/runme_at_boot
     fi
 fi
-# trigger firstboot mechanism if configured
 if test -f /var/lib/YaST2/reconfig_system ; then
     HOSTTYPE=$(uname -m)
     splashtrigger &quot;YaST&quot;
diff --git a/doc/examples/suse-11.3/suse-ec2-guest/root/etc/sysconfig/network/ifcfg-eth0 b/doc/examples/extras/suse-11.4/suse-nebula-cloud/cloud_guest/root/etc/sysconfig/network/ifcfg-eth0
similarity index 100%
copy from doc/examples/suse-11.3/suse-ec2-guest/root/etc/sysconfig/network/ifcfg-eth0
copy to doc/examples/extras/suse-11.4/suse-nebula-cloud/cloud_guest/root/etc/sysconfig/network/ifcfg-eth0
diff --git a/doc/examples/suse-11.3/suse-xen-guest/config.sh b/doc/examples/extras/suse-11.4/suse-nebula-cloud/cloud_head/config.sh
similarity index 66%
copy from doc/examples/suse-11.3/suse-xen-guest/config.sh
copy to doc/examples/extras/suse-11.4/suse-nebula-cloud/cloud_head/config.sh
index 098002e..6202091 100755
--- a/doc/examples/suse-11.3/suse-xen-guest/config.sh
+++ b/doc/examples/extras/suse-11.4/suse-nebula-cloud/cloud_head/config.sh
@@ -5,12 +5,12 @@
 # PROJECT       : OpenSuSE KIWI Image System
 # COPYRIGHT     : (c) 2006 SUSE LINUX Products GmbH. All rights reserved
 #               :
-# AUTHOR        : Marcus Schaefer &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/kiwi-devel">ms at suse.de</A>&gt;
+# AUTHOR        : Robert Scwheikert &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/kiwi-devel">rschweikert at novell.com</A>&gt;
 #               :
 # BELONGS TO    : Operating System images
 #               :
 # DESCRIPTION   : configuration script for SUSE based
-#               : operating systems
+#               : OpenNebula cloud head node
 #               :
 #               :
 # STATUS        : BETA
@@ -36,17 +36,29 @@ suseSetupProduct
 #--------------------------------------
 suseActivateDefaultServices
 suseInsertService boot.device-mapper
+suseInsertService nfsserver
 suseInsertService sshd
 
 #======================================
 # SuSEconfig
 #--------------------------------------
+baseUpdateSysConfig /etc/sysconfig/firstboot FIRSTBOOT_WELCOME_DIR /usr/share/susenebula
+# Disable IPv6
+echo &#226;&#128;&#156;alias net-pf-10 off&#226;&#128;&#157; &gt;&gt; /etc/modprobe.conf.local
+echo &#226;&#128;&#156;alias ipv6 off&#226;&#128;&#157; &gt;&gt; /etc/modprobe.conf.local
 suseConfig
 
 #======================================
-# clone runlevel 3 to 4
+# Cloud specific settings
 #--------------------------------------
-suseCloneRunlevel 4
+# Directory for authentication file must exist such that YaST module can
+# write the file
+mkdir /var/lib/one/.one
+# Set he desired permissions
+chown oneadmin:cloud /var/lib/one
+chown -R oneadmin:cloud /var/lib/one
+# The permissions for the testcase
+chown -R oneadmin:cloud /home/ctester
 
 #======================================
 # Umount kernel filesystems
diff --git a/doc/examples/extras/suse-11.4/suse-nebula-cloud/cloud_head/config.xml b/doc/examples/extras/suse-11.4/suse-nebula-cloud/cloud_head/config.xml
new file mode 100644
index 0000000..a0c86e6
--- /dev/null
+++ b/doc/examples/extras/suse-11.4/suse-nebula-cloud/cloud_head/config.xml
@@ -0,0 +1,72 @@
+&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
+&lt;image schemaversion=&quot;5.2&quot; name=&quot;suse-11.4-OpenNebula-Head-Node&quot;&gt;
+	&lt;description type=&quot;system&quot;&gt;
+		&lt;author&gt;Robert Schweikert&lt;/author&gt;
+		&lt;contact&gt;<A HREF="https://lists.berlios.de/mailman/listinfo/kiwi-devel">rschweikert at novell.com</A>&lt;/contact&gt;
+		&lt;specification&gt;OpenNebula Head Node&lt;/specification&gt;
+    &lt;/description&gt;
+    &lt;preferences&gt;
+        &lt;type image=&quot;oem&quot; filesystem=&quot;ext3&quot; boot=&quot;oemboot/suse-11.4&quot; installstick=&quot;true&quot; installboot=&quot;install&quot; boottimeout=&quot;2&quot;&gt;
+			&lt;oemconfig&gt;
+				&lt;oem-boot-title&gt;OpenNebula Head Node&lt;/oem-boot-title&gt;
+				&lt;oem-shutdown&gt;true&lt;/oem-shutdown&gt;
+				&lt;oem-swap&gt;true&lt;/oem-swap&gt;
+				&lt;oem-swapsize&gt;2048&lt;/oem-swapsize&gt;
+                &lt;oem-unattended&gt;true&lt;/oem-unattended&gt;
+			&lt;/oemconfig&gt;
+		&lt;/type&gt;
+		&lt;version&gt;1.1.0&lt;/version&gt;
+		&lt;packagemanager&gt;zypper&lt;/packagemanager&gt;
+		&lt;rpm-check-signatures&gt;false&lt;/rpm-check-signatures&gt;
+		&lt;rpm-force&gt;true&lt;/rpm-force&gt;
+		&lt;locale&gt;en_US&lt;/locale&gt;
+		&lt;keytable&gt;us.map.gz&lt;/keytable&gt;
+	&lt;/preferences&gt;
+	&lt;users group=&quot;root&quot;&gt;
+		&lt;user pwd=&quot;cloudDemo&quot; pwdformat=&quot;plain&quot; home=&quot;/root&quot; name=&quot;root&quot;/&gt;
+	&lt;/users&gt;
+	&lt;repository type=&quot;yast2&quot;&gt;
+		&lt;source path=&quot;<A HREF="opensuse://11.4/repo/oss/">opensuse://11.4/repo/oss/</A>&quot;/&gt;
+	&lt;/repository&gt;
+    &lt;repository type=&quot;rpm-md&quot;&gt;
+        &lt;source path=&quot;<A HREF="http://download.opensuse.org/repositories/Virtualization:/Cloud:/OpenNebula/openSUSE_11.4">http://download.opensuse.org/repositories/Virtualization:/Cloud:/OpenNebula/openSUSE_11.4</A>&quot;/&gt;
+    &lt;/repository&gt;
+    &lt;repository type=&quot;rpm-md&quot;&gt;
+        &lt;source path=&quot;<A HREF="opensuse://11.4/repo/oss/suse/">opensuse://11.4/repo/oss/suse/</A>&quot;/&gt;
+    &lt;/repository&gt;
+	&lt;packages type=&quot;image&quot; patternType=&quot;plusRecommended&quot;&gt;
+		&lt;opensusePattern name=&quot;base&quot;/&gt;
+		&lt;package name=&quot;bootsplash&quot;/&gt;
+        &lt;package name=&quot;bootsplash-branding-openSUSE&quot; bootinclude=&quot;true&quot; bootdelete=&quot;true&quot;/&gt;
+		&lt;package name=&quot;bridge-utils&quot;/&gt;
+		&lt;package name=&quot;dhcp-server&quot;/&gt;
+        &lt;package name=&quot;gfxboot-branding-openSUSE&quot; bootinclude=&quot;true&quot; bootdelete=&quot;true&quot;/&gt;
+		&lt;package name=&quot;ifplugd&quot;/&gt;
+		&lt;package name=&quot;iptables&quot;/&gt;
+		&lt;package name=&quot;iputils&quot;/&gt;
+		&lt;package name=&quot;kernel-default&quot;/&gt;
+        &lt;package name=&quot;nfs-kernel-server&quot;/&gt;
+        &lt;package name=&quot;opennebula&quot;/&gt;
+        &lt;package name=&quot;openssh&quot;/&gt;
+        &lt;package name=&quot;openssl&quot;/&gt;
+        &lt;package name=&quot;python&quot;/&gt;
+		&lt;package name=&quot;rsyslog&quot;/&gt;
+        &lt;package name=&quot;ruby&quot;/&gt;
+        &lt;package name=&quot;rubygems&quot;/&gt;
+        &lt;package name=&quot;rubygem-libxml-ruby&quot;/&gt;
+        &lt;package name=&quot;rubygem-nokogiri&quot;/&gt;
+        &lt;package name=&quot;sqlite3&quot;/&gt;
+        &lt;package name=&quot;sudo&quot;/&gt;
+        &lt;package name=&quot;terminfo&quot;/&gt;
+		&lt;package name=&quot;vi&quot;/&gt;
+        &lt;package name=&quot;xmlrpc-c&quot;/&gt;
+        &lt;package name=&quot;yast2-dhcp-server&quot;/&gt;
+        &lt;package name=&quot;yast2-firstboot&quot;/&gt;
+        &lt;package name=&quot;yast2-network&quot;/&gt;
+        &lt;package name=&quot;yast2-nfs-server&quot;/&gt;
+	&lt;/packages&gt;
+	&lt;packages type=&quot;bootstrap&quot;&gt;
+		&lt;package name=&quot;filesystem&quot;/&gt;
+		&lt;package name=&quot;glibc-locale&quot;/&gt;
+	&lt;/packages&gt;
+&lt;/image&gt;
diff --git a/doc/examples/extras/suse-11.4/suse-nebula-cloud/cloud_head/root/etc/YaST2/firstboot.xml b/doc/examples/extras/suse-11.4/suse-nebula-cloud/cloud_head/root/etc/YaST2/firstboot.xml
new file mode 100644
index 0000000..4d3a60b
--- /dev/null
+++ b/doc/examples/extras/suse-11.4/suse-nebula-cloud/cloud_head/root/etc/YaST2/firstboot.xml
@@ -0,0 +1,65 @@
+&lt;?xml version=&quot;1.0&quot;?&gt;
+&lt;productDefines  xmlns=&quot;<A HREF="http://www.suse.com/1.0/yast2ns">http://www.suse.com/1.0/yast2ns</A>&quot;
+    xmlns:config=&quot;<A HREF="http://www.suse.com/1.0/configns">http://www.suse.com/1.0/configns</A>&quot;&gt;
+
+    &lt;textdomain&gt;firstboot&lt;/textdomain&gt;
+
+    &lt;workflows  config:type=&quot;list&quot;&gt;
+        &lt;workflow&gt;
+            &lt;defaults&gt;
+                &lt;enable_back&gt;yes&lt;/enable_back&gt;
+                &lt;enable_next&gt;yes&lt;/enable_next&gt;
+                &lt;archs&gt;all&lt;/archs&gt;
+            &lt;/defaults&gt;
+            &lt;stage&gt;firstboot&lt;/stage&gt;
+            &lt;label&gt;Configuration&lt;/label&gt;
+            &lt;mode&gt;installation&lt;/mode&gt;
+            &lt;modules  config:type=&quot;list&quot;&gt;
+
+                &lt;module&gt;
+                    &lt;label&gt;Welcome&lt;/label&gt;
+                    &lt;name&gt;firstboot_welcome&lt;/name&gt;
+                &lt;/module&gt;
+                &lt;module&gt;
+                    &lt;label&gt;License Agreements&lt;/label&gt;
+                    &lt;enabled config:type=&quot;boolean&quot;&gt;true&lt;/enabled&gt;
+                    &lt;name&gt;firstboot_licenses&lt;/name&gt;
+                &lt;/module&gt;
+                &lt;module&gt;
+                    &lt;label&gt;Keyboard Layout&lt;/label&gt;
+                    &lt;enabled config:type=&quot;boolean&quot;&gt;true&lt;/enabled&gt;
+                    &lt;name&gt;firstboot_keyboard&lt;/name&gt;
+                &lt;/module&gt;
+                &lt;module&gt;
+                    &lt;label&gt;Time and Date&lt;/label&gt;
+                    &lt;enabled config:type=&quot;boolean&quot;&gt;true&lt;/enabled&gt;
+                    &lt;name&gt;firstboot_timezone&lt;/name&gt;
+                &lt;/module&gt;
+                &lt;module&gt;
+                    &lt;label&gt;Root Password&lt;/label&gt;
+                    &lt;enabled config:type=&quot;boolean&quot;&gt;true&lt;/enabled&gt;
+                    &lt;name&gt;inst_root&lt;/name&gt;
+                &lt;/module&gt;
+                &lt;module&gt;
+                    &lt;label&gt;Cloud Configuration&lt;/label&gt;
+                    &lt;enabled config:type=&quot;boolean&quot;&gt;true&lt;/enabled&gt;
+                    &lt;name&gt;opennebula&lt;/name&gt;
+                &lt;/module&gt;
+                &lt;module&gt;
+                    &lt;label&gt;Finish Setup&lt;/label&gt;
+                    &lt;name&gt;firstboot_write&lt;/name&gt;
+                    &lt;enable_back&gt;no&lt;/enable_back&gt;
+                    &lt;enable_next&gt;no&lt;/enable_next&gt;
+                &lt;/module&gt;
+                &lt;module&gt;
+                    &lt;label&gt;Finish Setup&lt;/label&gt;
+                    &lt;name&gt;inst_suseconfig&lt;/name&gt;
+                    &lt;enable_back&gt;no&lt;/enable_back&gt;
+                    &lt;enable_next&gt;no&lt;/enable_next&gt;
+                &lt;/module&gt;
+
+            &lt;/modules&gt;
+        &lt;/workflow&gt;
+    &lt;/workflows&gt;
+&lt;/productDefines&gt;
+
diff --git a/doc/examples/extras/suse-11.4/suse-nebula-cloud/cloud_head/root/etc/exports b/doc/examples/extras/suse-11.4/suse-nebula-cloud/cloud_head/root/etc/exports
new file mode 100644
index 0000000..8fec075
--- /dev/null
+++ b/doc/examples/extras/suse-11.4/suse-nebula-cloud/cloud_head/root/etc/exports
@@ -0,0 +1 @@
+/var/lib/one *(no_subtree_check,rw,root_squash,sync)
diff --git a/doc/examples/extras/suse-11.4/suse-nebula-cloud/cloud_head/root/etc/init.d/cloudinfo b/doc/examples/extras/suse-11.4/suse-nebula-cloud/cloud_head/root/etc/init.d/cloudinfo
new file mode 100755
index 0000000..c43dc01
--- /dev/null
+++ b/doc/examples/extras/suse-11.4/suse-nebula-cloud/cloud_head/root/etc/init.d/cloudinfo
@@ -0,0 +1,64 @@
+#! /bin/sh
+# Copyright (c) 2011 SUSE
+# All rights reserved.
+#
+# Author: Robert Schweikert
+#
+# /etc/init.d/cloudinfo
+#
+### BEGIN INIT INFO
+# Provides:       cloudinfo
+# Required-Start: $remote_fs $syslog network
+# Required-Stop:  $remote_fs $syslog
+# Default-Start:  3 5
+# Default-Stop:   0 1 2 6
+# Short-Description: Information service for cloud nodes
+# Description: Information service to allow cloud nodes to configure themselves
+### END INIT INFO
+
+# First reset status of this service
+. /etc/rc.status
+rc_reset
+
+# Return values acc. to LSB for all commands but status:
+# 0 - success
+# 1 - generic or unspecified error
+# 2 - invalid or excess argument(s)
+# 3 - unimplemented feature (e.g. &quot;reload&quot;)
+# 4 - insufficient privilege
+# 5 - program is not installed
+# 6 - program is not configured
+# 7 - program is not running
+
+SERVICE_BIN=&quot;/sbin/suseNebulaConfSrv&quot;
+SERVICE_PID=&quot;${CHROOT_PREFIX}/var/run/suseNebula/infoSrv.pid&quot;
+
+case &quot;$1&quot; in
+  start)
+    echo -n &quot;Starting cloud info service: &quot;
+    $SERVICE_BIN &amp;
+    rc_status -v
+  ;;
+  stop)
+    echo -n &quot;Stopping cloud info service: &quot;
+    pid=`cat ${SERVICE_PID}`
+    kill -TERM $pid
+    #killproc does not work, it insists that $SERVICE_BIN does not exist
+    # Suspect this has something to do with it being python
+    #killproc -p ${SERVICE_PID} -TERM $SERVICE_BIN
+    # Remember status and be quiet
+    rc_status -v
+  ;;
+  restart)
+    $0 stop
+    $0 start $2
+    rc_status
+  ;;
+  *)
+    echo &quot;Usage: $0 {start|stop|restart}&quot;
+    exit 1
+  ;;
+esac
+rc_exit
+
+
diff --git a/doc/examples/extras/suse-11.4/suse-nebula-cloud/cloud_head/root/etc/init.d/noderegistrar b/doc/examples/extras/suse-11.4/suse-nebula-cloud/cloud_head/root/etc/init.d/noderegistrar
new file mode 100755
index 0000000..b2ecaca
--- /dev/null
+++ b/doc/examples/extras/suse-11.4/suse-nebula-cloud/cloud_head/root/etc/init.d/noderegistrar
@@ -0,0 +1,66 @@
+#! /bin/sh
+# Copyright (c) 2011 SUSE
+# All rights reserved.
+#
+# Author: Robert Schweikert
+#
+# /etc/init.d/noderegistrar
+#
+### BEGIN INIT INFO
+# Provides:       noderegistrar
+# Required-Start: $remote_fs $syslog network
+# Required-Stop:  $remote_fs $syslog
+# Should-Start:   cloudinfo
+# Default-Start:  3 5
+# Default-Stop:   0 1 2 6
+# Short-Description: Registration service for cloud nodes
+# Description: Registration service to allow cloud nodes to 
+#              register themselves with the head node
+### END INIT INFO
+
+# First reset status of this service
+. /etc/rc.status
+rc_reset
+
+# Return values acc. to LSB for all commands but status:
+# 0 - success
+# 1 - generic or unspecified error
+# 2 - invalid or excess argument(s)
+# 3 - unimplemented feature (e.g. &quot;reload&quot;)
+# 4 - insufficient privilege
+# 5 - program is not installed
+# 6 - program is not configured
+# 7 - program is not running
+
+SERVICE_BIN=&quot;/sbin/suseNebulaRegSrv&quot;
+SERVICE_PID=&quot;${CHROOT_PREFIX}/var/run/suseNebula/regSrv.pid&quot;
+
+case &quot;$1&quot; in
+  start)
+    echo -n &quot;Starting cloud info service: &quot;
+    $SERVICE_BIN &amp;
+    rc_status -v
+  ;;
+  stop)
+    echo -n &quot;Stopping cloud info service: &quot;
+    pid=`cat ${SERVICE_PID}`
+    kill -TERM $pid
+    #killproc does not work, it insists that $SERVICE_BIN does not exist
+    # Suspect this has something to do with it being python
+    #killproc -p ${SERVICE_PID} -TERM $SERVICE_BIN
+    # Remember status and be quiet
+    rc_status -v
+  ;;
+  restart)
+    $0 stop
+    $0 start $2
+    rc_status
+  ;;
+  *)
+    echo &quot;Usage: $0 {start|stop|restart}&quot;
+    exit 1
+  ;;
+esac
+rc_exit
+
+
diff --git a/doc/examples/extras/suse-11.4/suse-nebula-cloud/cloud_head/root/home/ctester/startTestVM b/doc/examples/extras/suse-11.4/suse-nebula-cloud/cloud_head/root/home/ctester/startTestVM
new file mode 100755
index 0000000..7551d9c
--- /dev/null
+++ b/doc/examples/extras/suse-11.4/suse-nebula-cloud/cloud_head/root/home/ctester/startTestVM
@@ -0,0 +1,9 @@
+#!/bin/bash
+
+# Author   : Robert Schweikert
+# License  : GPLv2
+# Copyright: 2011 SUSE
+
+export ONE_AUTH=/var/lib/one/.one/one_auth
+/usr/bin/oneimage register testVM.one
+/usr/bin/onevm create testVM.vmd
diff --git a/doc/examples/extras/suse-11.4/suse-nebula-cloud/cloud_head/root/home/ctester/testVM.README b/doc/examples/extras/suse-11.4/suse-nebula-cloud/cloud_head/root/home/ctester/testVM.README
new file mode 100644
index 0000000..d36dece
--- /dev/null
+++ b/doc/examples/extras/suse-11.4/suse-nebula-cloud/cloud_head/root/home/ctester/testVM.README
@@ -0,0 +1,31 @@
+The startTestVM script is expected to be executed only once. It's sole purpose
+is to facilitate easy and quick verification that the images built using the
+OBS OpenNebula packages work as intended. The working condition is defined as:
+    - generated guest image can be registered
+    - registered image can be started
+   - it is possible to log into the running image (manual action)
+The script should only be run on initial setup of the cloud after the head
+node and at least one cloud node have been set up.
+
+Prior to executing the startTestVM script:
+- verify there is a registered host
+  # sudo -u oneadmin env ONE_AUTH=/var/lib/one/.one/one_auth onehost list
+- make sure you have an image that matches the output of 
+  # grep PATH testVM.one
+
+Then run the script as the oneadmin user
+
+# sudo -u oneadmin ./startTestVM
+
+Once the VM is up and running you can verify it's functionality by using
+vncviewer on a machine running X as follows:
+
+-&gt; vncviewer IP_ADDRESS_OF_CLOUD_NODE:5905
+
+The IP_ADDRESS_OF_CLOUD_NODE is shown by the `onevm list` command executed on
+the head node
+
+# sudo -u oneadmin env ONE_AUTH=/var/lib/one/.one/one_auth onevm list
+
+
+
diff --git a/doc/examples/extras/suse-11.4/suse-nebula-cloud/cloud_head/root/home/ctester/testVM.one b/doc/examples/extras/suse-11.4/suse-nebula-cloud/cloud_head/root/home/ctester/testVM.one
new file mode 100644
index 0000000..bb47522
--- /dev/null
+++ b/doc/examples/extras/suse-11.4/suse-nebula-cloud/cloud_head/root/home/ctester/testVM.one
@@ -0,0 +1,5 @@
+NAME = &quot;openSUSE test image&quot;
+PATH = &quot;/home/ctester/suse-11.4-SUSENebula-guest.x86_64-1.0.0.qcow2&quot;
+PUBLIC = YES
+DESCRIPTION = &quot;A test image to test the basic functionality of the openSUSE based OpenNebula setup&quot;
+
diff --git a/doc/examples/extras/suse-11.4/suse-nebula-cloud/cloud_head/root/home/ctester/testVM.vmd b/doc/examples/extras/suse-11.4/suse-nebula-cloud/cloud_head/root/home/ctester/testVM.vmd
new file mode 100644
index 0000000..b8b3d0c
--- /dev/null
+++ b/doc/examples/extras/suse-11.4/suse-nebula-cloud/cloud_head/root/home/ctester/testVM.vmd
@@ -0,0 +1,17 @@
+NAME   = suse-test
+MEMORY = 512
+CPU    = 1
+
+OS     = [ ARCH = x86_64,
+           BOOT = hd,
+           ROOT = sda1 ]
+
+DISK   = [ IMAGE_ID  = 0,
+           DRIVER    = qcow2 ]
+
+NIC    = [ MAC = &quot;00:16:3e:7e:18:26&quot;,
+           BRIDGE = br0 ]
+
+GRAPHICS = [ TYPE   = &quot;vnc&quot;,
+             LISTEN = &quot;0.0.0.0&quot;,
+             PORT   = &quot;5905&quot; ]
diff --git a/doc/examples/extras/suse-11.4/suse-nebula-cloud/cloud_head/root/sbin/suseNebulaConfSrv b/doc/examples/extras/suse-11.4/suse-nebula-cloud/cloud_head/root/sbin/suseNebulaConfSrv
new file mode 100755
index 0000000..dc19017
--- /dev/null
+++ b/doc/examples/extras/suse-11.4/suse-nebula-cloud/cloud_head/root/sbin/suseNebulaConfSrv
@@ -0,0 +1,185 @@
+#!/usr/bin/python
+
+&quot;&quot;&quot;SUSENebula configuration service.&quot;&quot;&quot;
+
+# Author: Robert Schweikert
+# License: GPL v2
+# Copyright: SUSE
+
+import SocketServer
+import os
+import re
+import signal
+import sys
+import syslog
+
+ipPattern = r'\d{1,3}?\.\d{1,3}?\.\d{1,3}?\.\d{1,3}?'
+ipPat = re.compile(ipPattern)
+
+base = r'\d{0,2}?[A-F]{0,2}?:'
+macPattern = 5*base + r'\d{0,2}?[A-F]{0,2}?'
+macPat = re.compile(macPattern)
+
+#---------------------------------------------------------------------------
+class CloudConfigService(SocketServer.StreamRequestHandler):
+    &quot;&quot;&quot;Cloud head node information provider.&quot;&quot;&quot;
+    def __init__(self, request, client_address, server):
+        self.srvInfo = {}
+        # Collect the information we want to make propagate to the cloud node
+        # Keyboard layout
+        os.system('/sbin/yast2 keyboard summary &gt;&amp; /tmp/.kdb.info')
+        info = open('/tmp/.kdb.info', 'r').read()
+        os.remove('/tmp/.kdb.info')
+        self.srvInfo['keyLayout'] = info.split(':')[-1].strip()
+        # Timezone and HW clock setting (assume HW clock on nodes is set the
+        # same by default
+        os.system('/sbin/yast2 timezone summary &gt;&amp; /tmp/.tz.info')
+        info = open('/tmp/.tz.info', 'r').readlines()
+        os.remove('/tmp/.tz.info')
+        timezone = None
+        hwClockSet = None
+        for ln in info:
+            if ln.find('Current Time Zone') != -1:
+                timezone = ln.split(':')[-1].strip()
+            if ln.find('Hardware Clock') != -1:
+                hwClockSet = ln.split(':')[-1].strip()
+        self.srvInfo['timezone'] = timezone
+        self.srvInfo['hwclock'] = hwClockSet 
+        # Root passwd
+        lines = open('/etc/shadow', 'r').readlines()
+        passWd = None
+        for ln in lines:
+            if ln[0:4] == 'root':
+                passWd = ln.split(':')[1]
+        self.srvInfo['rootpass'] = passWd
+        # IP address
+        lines = open('/etc/sysconfig/network/ifcfg-br0', 'r').readlines()
+        ipAddr = None
+        for ln in lines:
+            if ln[0:7] == 'IPADDR=':
+                # [1:] at end removes leading quote
+                ipAddr = ln.split('=')[-1].split('/')[0].strip()[1:]
+        self.srvInfo['serverIP'] = ipAddr
+        # DHCP feature identifier
+        lines = open('/etc/dhcpd.conf','r').readlines()
+        dhcpFeature = None
+        domainname = None
+        for ln in lines:
+            if ln.find('domain-name') != -1:
+                # [1:-2] remove leading and trailing quotes and ; 
+                domainname = ln.split()[-1].strip()[1:-2]
+            # 239 is the assigned ID for the feature, hard coded in the YaST
+            # configuration module
+            if ln.find('code 239') != -1:
+                dhcpFeature = ln.split()[1].strip()
+        self.srvInfo['dhcpFeature'] = dhcpFeature
+        self.srvInfo['domainname'] = domainname
+        # Name resolution
+        self.srvInfo['resolve'] = open('/etc/resolv.conf', 'r').read()
+        # The configured routes
+        routes = open('/etc/sysconfig/network/routes', 'r').read()
+        self.srvInfo['routes'] = routes
+        # The one use ID
+        lines = open('/etc/passwd', 'r').readlines()
+        for ln in lines:
+            if ln.find('oneadmin') != -1:
+                self.srvInfo['userID'] = ('oneadmin', ln.split(':')[2],
+                                          ln.split(':')[1])
+                break
+        # The cloud group ID
+        lines = open('/etc/group', 'r').readlines()
+        for ln in lines:
+            if ln.find('cloud') != -1:
+                self.srvInfo['groupID'] = ('cloud', ln.split(':')[2])
+                break
+        SocketServer.StreamRequestHandler.__init__(self, request,
+                                                   client_address, server)
+        
+    #----------------------------------------------------------------------
+    def generateHostName(self):
+        &quot;&quot;&quot;Generate a new host name&quot;&quot;&quot;
+        # Create a host name for the host requesting the information
+        while (os.path.exists('/var/lock/nebula-hostname.lock')):
+            # We have to wait another cloud node is being configured
+            pass
+        os.system('touch /var/lock/nebula-hostname.lock')
+        cntr = None
+        if not os.path.exists('/var/lib/one/.nodecnt'):
+            cntr = 1
+            cntFl = open('/var/lib/one/.nodecnt', 'w')
+            cntFl.write('%d' %cntr)
+            cntFl.close()
+        if not cntr:
+            cntr = open('/var/lib/one/.nodecnt', 'r').read()
+            cntr = eval(cntr)
+            cntr += 1
+            cntFl = open('/var/lib/one/.nodecnt', 'w')
+            cntFl.write('%d' %cntr)
+            cntFl.close()
+        hostname = self.srvInfo['dhcpFeature'] + '-%d' %cntr
+        os.remove('/var/lock/nebula-hostname.lock')
+        return hostname
+
+    #----------------------------------------------------------------------
+    def handle(self):
+        &quot;&quot;&quot;Handle the information request&quot;&quot;&quot;
+        requestType = self.request.recv(512).strip()
+        if requestType == 'PROVIDE_CONFIG':
+            syslog.openlog('[CLOUD_INFO_SRV]',syslog.LOG_PID,syslog.LOG_DAEMON)
+            syslog.syslog(syslog.LOG_INFO, 'Provide cloud config info\n')
+            self.srvInfo['hostname'] = self.generateHostName()
+            for key in self.srvInfo.keys():
+                # Send a key value pair for each entry
+                self.request.send('%s=%s;' %(key,self.srvInfo[key]))
+            self.request.send('COMPLETE=finished')
+        syslog.closelog()
+
+#---------------------------------------------------------------------------
+def sigHandler(signum, frame):
+    &quot;&quot;&quot;Signal handler for termination&quot;&quot;&quot;
+    syslog.openlog('[CLOUD_INFO_SRV]',syslog.LOG_PID,syslog.LOG_DAEMON)
+    syslog.syslog(syslog.LOG_INFO, 'Terminating server on signal: %d' %signum)
+    syslog.closelog()
+    if os.path.exists('/var/lock/nebula-hostname.lock'):
+        os.remove('/var/lock/nebula-hostname.lock')
+    os.remove('/var/run/suseNebula/infoSrv.pid')
+    sys.exit(0)
+
+#---------------------------------------------------------------------------
+if __name__ == &quot;__main__&quot;:
+    syslog.openlog('[CLOUD_INFO_SRV]', syslog.LOG_PID, syslog.LOG_DAEMON)
+    syslog.syslog(syslog.LOG_INFO, 'Cloud Info Server start\n')
+
+    # Consistency check for pid file
+    if not os.path.exists('/var/run/suseNebula'):
+        os.system('mkdir -p /var/run/suseNebula')
+    if os.path.exists('/var/run/suseNebula/infoSrv.pid'):
+        msg = 'Found pid file, another server is running, not starting a '
+        msg += 'new one.'
+        syslog.syslog(syslog.LOG_ERR, msg)
+        syslog.closelog()
+        sys.exit(1)
+   
+    server = SocketServer.TCPServer(('169.254.1.1',  8445), CloudConfigService)
+
+    if not server:
+        syslog.syslog(syslog.LOG_ERR, 'Could not create server, exiting\n')
+        syslog.closelog()
+        sys.exit(1)
+
+    # Write pid to a file
+    pid = os.getpid()
+    pidFl = open('/var/run/suseNebula/infoSrv.pid', 'w');
+    pidFl.write('%d\n' %pid)
+    pidFl.close()
+
+    # Register signal handler
+    signal.signal(signal.SIGHUP, sigHandler)
+    signal.signal(signal.SIGTERM, sigHandler)
+    signal.signal(signal.SIGINT, sigHandler)
+
+    # No additional message will be printed, close the log
+    syslog.syslog(syslog.LOG_INFO, 'Cloud Info Server running\n')
+    syslog.closelog()
+    server.serve_forever()
+    
diff --git a/doc/examples/extras/suse-11.4/suse-nebula-cloud/cloud_head/root/sbin/suseNebulaRegSrv b/doc/examples/extras/suse-11.4/suse-nebula-cloud/cloud_head/root/sbin/suseNebulaRegSrv
new file mode 100755
index 0000000..748afdb
--- /dev/null
+++ b/doc/examples/extras/suse-11.4/suse-nebula-cloud/cloud_head/root/sbin/suseNebulaRegSrv
@@ -0,0 +1,145 @@
+#!/usr/bin/python
+
+&quot;&quot;&quot;SUSENebula Node Registration Service.&quot;&quot;&quot;
+
+# Author: Robert Schweikert
+# License: GPL v2
+# Copyright: SUSE
+
+import SocketServer
+import os
+import re
+import signal
+import sys
+import syslog
+
+ipPattern = r'\d{1,3}?\.\d{1,3}?\.\d{1,3}?\.\d{1,3}?'
+ipPat = re.compile(ipPattern)
+
+base = r'\d{0,2}?[A-F]{0,2}?:'
+macPattern = 5*base + r'\d{0,2}?[A-F]{0,2}?'
+macPat = re.compile(macPattern)
+
+#------------------------------------------------------------------------------
+class RegistrationHandler(SocketServer.BaseRequestHandler):
+    &quot;&quot;&quot;Cloud head node registration request handler.&quot;&quot;&quot;
+    def handle(self):
+        syslog.openlog('[NOD_REG]',syslog.LOG_PID, syslog.LOG_DAEMON)
+        syslog.syslog(syslog.LOG_INFO, 'Cloud node registration\n')
+        # self.request is the TCP socket connected to the client
+        macAddr, ipAddr, name = self.request.recv(1024).strip().split(';')
+        # Verify proper MAC Address format
+        if not macPat.match(macAddr):
+            msg = 'Received improper data for MAC Address '
+            msg += macAddr
+            msg += ' -&gt; skip registration\n'
+            syslog.syslog(syslog.LOG_ERR, msg)
+            syslog.closelog()
+            return
+        # Verify the IP address format
+        if not ipPat.match(ipAddr):
+             msg = 'Received improper data for IP Adress '
+             msg += ipAddr
+             msg += ' -&gt; skip registration\n'
+             syslog.syslog(syslog.LOG_ERR, msg)
+             syslog.closelog()
+             return
+        syslog.syslog(syslog.LOG_INFO, 'MAC Address: %s\n' %macAddr)
+        syslog.syslog(syslog.LOG_INFO, 'IP Address: %s\n' %ipAddr)
+        syslog.syslog(syslog.LOG_INFO, 'Node name: %s\n' %name)
+        # Setup the dhcp server to make sure the node being registered
+        # always gets the same IP address
+        lines = open('/etc/dhcpd.conf', 'r').readlines()
+        processBlock = None
+        for ln in lines:
+            if ln.find(name) != -1:
+                processBlock = 1
+                continue
+            if processBlock and ln.find('fixed-address') != -1:
+                setIP = ln.split()[-1].strip()[:-1]
+                if setIP != ipAddr:
+                    msg = 'Host with name &quot;%s&quot; already registered with ' %name
+                    msg += 'IP &quot;%s&quot;. Cannot register node.\n' %ipAddr
+                    syslog.syslog(syslog.LOG_INFO, msg)
+                    syslog.closelog()
+                    return
+        dhconf = open('/etc/dhcpd.conf', 'a')
+        dhconf.write('\n')
+        dhconf.write('host %s {\n' %name)
+        dhconf.write('    hardware ethernet %s;\n' %macAddr)
+        dhconf.write('    fixed-address %s;\n' %ipAddr)
+        dhconf.write('}\n')
+        dhconf.close()
+        # Restart the dhcp server as we just change the config
+        os.system('/etc/init.d/dhcpd restart  &gt;&amp; /dev/null')
+        # Create hosts entry
+        hosts = open('/etc/hosts', 'a')
+        hosts.write('%s    %s\n' %(ipAddr, name))
+        hosts.close()
+        # Register node with Nebula infrastructure
+        cmd = '/usr/bin/sudo env ONE_AUTH=/var/lib/one/.one/one_auth '
+        cmd += '/usr/bin/onehost create %s im_kvm vmm_kvm tm_nfs' %ipAddr
+        res = os.system(cmd)
+        if res:
+            msg = 'Registration failed, onehost command with non zero status\n'
+            syslog.syslog(syslog.LOG_ERR, msg)
+            syslog.closelog()
+            return
+        syslog.syslog(syslog.LOG_ERR, 'Node registration succesful.\n')
+        syslog.closelog()
+
+#------------------------------------------------------------------------------
+def sigHandler(signum, frame):
+    &quot;&quot;&quot;Signal handler for termination&quot;&quot;&quot;
+    syslog.openlog('[NOD_REG]',syslog.LOG_PID,syslog.LOG_DAEMON)
+    syslog.syslog(syslog.LOG_INFO, 'Terminating server on signal: %d' %signum)
+    syslog.closelog()
+    os.remove('/var/run/suseNebula/regSrv.pid')
+    sys.exit(0)
+
+#------------------------------------------------------------------------------
+if __name__ == &quot;__main__&quot;:
+    syslog.openlog('[NOD_REG]', syslog.LOG_PID, syslog.LOG_DAEMON)
+    syslog.syslog(syslog.LOG_INFO, 'Start node registration service\n')
+    # Determine the IP address of this host
+    inetInfo = os.popen('/sbin/ifconfig').readlines()
+    ipAddr = None
+    # Use the first IPv4 address found
+    for item in inetInfo:
+        if item.find('inet addr') != -1:
+            # Extract the IP address from line expected in following format
+            # inet addr:192.168.1.6  Bcast:192.168.1.255  Mask:255.255.255.0
+            ipAddr = item.strip().split()[1].split(':')[-1]
+            if ipPat.match(ipAddr):
+                break
+
+    if not ipAddr:
+        # No IP address found. Print a message to syslog and exit
+        syslog.syslog(syslog.LOG_ERR,
+                      'Could not determine IP address, exiting\n')
+        syslog.closelog()
+        sys.exit(1)
+        
+    server = SocketServer.TCPServer((ipAddr, 8445), RegistrationHandler)
+
+    if not server:
+        syslog.syslog(syslog.LOG_ERR, 'Could not create server, exiting\n')
+        syslog.closelog()
+        sys.exit(1)
+
+    # Write pid to a file
+    pid = os.getpid()
+    pidFl = open('/var/run/suseNebula/regSrv.pid', 'w');
+    pidFl.write('%d\n' %pid)
+    pidFl.close()
+
+    # Register signal handler
+    signal.signal(signal.SIGHUP, sigHandler)
+    signal.signal(signal.SIGTERM, sigHandler)
+    signal.signal(signal.SIGINT, sigHandler)
+
+    # No additional message will be printed, close the log
+    syslog.syslog(syslog.LOG_INFO, 'Cloud registration service  running\n')
+    syslog.closelog()
+    server.serve_forever()
+        
diff --git a/doc/examples/extras/suse-11.4/suse-nebula-cloud/cloud_head/root/usr/share/YaST2/clients/opennebula.ycp b/doc/examples/extras/suse-11.4/suse-nebula-cloud/cloud_head/root/usr/share/YaST2/clients/opennebula.ycp
new file mode 100644
index 0000000..6d82817
--- /dev/null
+++ b/doc/examples/extras/suse-11.4/suse-nebula-cloud/cloud_head/root/usr/share/YaST2/clients/opennebula.ycp
@@ -0,0 +1,365 @@
+/**
+ * File:        clients/opennebula.ycp
+ * Package:     Configuration of OpenNebula CLoud head node
+ * Authors:     Jiri Suchomel &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/kiwi-devel">jsuchome at suse.cz</A>&gt;
+ *              Robert Scwheikert &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/kiwi-devel">rschweikert at novell.com</A>&gt;
+ *
+ * License:     GPL v2
+ *
+ */
+
+{
+    textdomain &quot;susenebula&quot;;
+ 
+    import &quot;FileUtils&quot;;
+    import &quot;Hostname&quot;;
+    import &quot;IP&quot;;
+    import &quot;Label&quot;;
+    import &quot;Mode&quot;;
+    import &quot;Netmask&quot;;
+    import &quot;Popup&quot;;
+    import &quot;Report&quot;;
+    import &quot;Service&quot;;
+    import &quot;Wizard&quot;;
+ 
+    import &quot;YaPI::NETWORK&quot;;
+ 
+    string hostname = &quot;SUSENebula-Head&quot;;
+    string domain   = &quot;&quot;;
+    string ip       = &quot;192.168.1.2&quot;;
+    string netmask  = &quot;255.255.255.0&quot;;
+    string ip_min   = &quot;&quot;;
+    string ip_max   = &quot;&quot;;
+    string clustername  = &quot;SUSENebula&quot;;
+    string route    = &quot;&quot;;
+    string cadminp  = &quot;susenebula&quot;;
+    list&lt;string&gt; nameservers  = [];
+    list&lt;string&gt; searchdomains    = [];
+ 
+    // network export map
+    map network     = $[];
+    // dhcp server export map
+    map dhcp        = $[];
+ 
+    // write entered settings to the system
+    boolean WriteSettings () {
+ 
+    // 1. Write Network
+    map&lt;string,any&gt; write_network = $[
+        &quot;hostname&quot;  : network[&quot;hostname&quot;]:$[],
+        &quot;dns&quot;   : network[&quot;dns&quot;]:$[],
+    ];
+ 
+    write_network[&quot;hostname&quot;,&quot;domain&quot;]  = domain;
+    write_network[&quot;hostname&quot;,&quot;name&quot;]    = hostname;
+ 
+    write_network[&quot;dns&quot;,&quot;nameservers&quot;]  = nameservers;
+    write_network[&quot;dns&quot;,&quot;searches&quot;]     = searchdomains;
+ 
+    write_network[&quot;route&quot;]  = $[
+        &quot;default&quot;   : $[
+        &quot;via&quot;   : route
+        ]
+    ];
+ 
+    map interface   = network[&quot;interfaces&quot;]:$[];
+ 
+    // ip r|grep default|cut -d' ' -f5
+    if (haskey (interface, &quot;eth0&quot;))
+    {
+        interface[&quot;eth0&quot;,&quot;bootproto&quot;]   = &quot;static&quot;;
+        interface[&quot;eth0&quot;,&quot;ipaddr&quot;]  = sformat (&quot;%1/%2&quot;, ip, Netmask::ToBits (netmask));
+        write_network[&quot;interface&quot;]  = interface;
+    }
+    y2internal (&quot;network to write: %1&quot;, write_network);
+    map network_written = YaPI::NETWORK::Write (write_network);
+ 
+    Service::Restart (&quot;network&quot;);
+ 
+    // 2. Write DHCP server DhcpServer: settings/directives/range
+    // Min/Max IP -&gt; set the IP address range for dhcp server.
+ 
+    // Read DhcpServer after network is configured
+    /*
+    DhcpServer::Read ();
+    dhcp    = DhcpServer::Export ();
+    y2internal (&quot;dhcp: %1&quot;, dhcp);
+    */
+ 
+    string subnet_ip    = IP::ComputeNetwork (ip, netmask);
+ 
+    dhcp[&quot;allowed_interfaces&quot;]  = [&quot;eth0&quot;];
+    dhcp[&quot;start_service&quot;]       = true;
+    dhcp[&quot;use_ldap&quot;]        = false;
+    dhcp[&quot;settings&quot;]        = [
+      $[
+        &quot;children&quot;      : [],
+        &quot;directives&quot;    : [
+        $[
+            &quot;key&quot;       : &quot;default-lease-time&quot;,
+            &quot;type&quot;      : &quot;directive&quot;,
+            &quot;value&quot;     : &quot;14400&quot;
+        ],
+        $[
+            &quot;key&quot;       : &quot;max-lease-time&quot;,
+            &quot;type&quot;      : &quot;directive&quot;,
+            &quot;value&quot;     : &quot;172800&quot;
+        ],
+        $[
+             &quot;key&quot;      : &quot;range&quot;,
+            &quot;type&quot;      : &quot;directive&quot;,
+            &quot;value&quot;     : sformat (&quot;%1 %2&quot;, ip_min, ip_max)
+        ]
+        ],
+        &quot;id&quot;        : sformat (&quot;%1 netmask %2&quot;, subnet_ip, netmask),
+        &quot;options&quot;       : [],
+        &quot;parent_id&quot;     : &quot;&quot;,
+        &quot;parent_type&quot;   : &quot;&quot;,
+        &quot;type&quot;      : &quot;subnet&quot;
+      ],
+      $[
+        &quot;children&quot;      : [
+        $[
+            &quot;id&quot;    : sformat (&quot;%1 netmask %2&quot;, subnet_ip, netmask),
+            &quot;type&quot;  : &quot;subnet&quot;
+        ]
+        ],
+        &quot;directives&quot;    : [
+        $[
+            &quot;key&quot;   : &quot;max-lease-time&quot;,
+            &quot;type&quot;  : &quot;directive&quot;,
+            &quot;value&quot; : &quot;7200&quot;
+        ],
+        $[
+            &quot;key&quot;   : &quot;ddns-updates&quot;,
+            &quot;type&quot;  : &quot;directive&quot;,
+            &quot;value&quot; : &quot;off&quot;
+        ],
+        $[
+            &quot;key&quot;   : &quot;ddns-update-style&quot;,
+            &quot;type&quot;  : &quot;directive&quot;,
+            &quot;value&quot; : &quot;none&quot;
+        ],
+        $[
+            &quot;key&quot;   : &quot;log-facility&quot;,
+            &quot;type&quot;  : &quot;directive&quot;,
+            &quot;value&quot; : &quot;local7&quot;
+        ],
+        $[
+            &quot;key&quot;   : &quot;default-lease-time&quot;,
+            &quot;type&quot;  : &quot;directive&quot;,
+            &quot;value&quot; : &quot;600&quot;
+        ],
+        ],
+        &quot;options&quot;   : [
+        $[
+            &quot;key&quot;   : &quot;suse-nebula&quot;,
+            &quot;type&quot;  : &quot;option&quot;,
+            &quot;value&quot; : &quot;code 239 = ip-address&quot;
+        ],
+        $[
+            &quot;key&quot;   : &quot;suse-nebula&quot;,
+            &quot;type&quot;  : &quot;option&quot;,
+            &quot;value&quot; : ip
+        ],
+        $[
+            &quot;key&quot;   : &quot;domain-name&quot;,
+            &quot;type&quot;  : &quot;option&quot;,
+            &quot;value&quot; : sformat (&quot;\&quot;%1\&quot;&quot;, domain),
+        ],
+        ],
+        &quot;id&quot;    :&quot;&quot;,
+        &quot;parent_id&quot;     : &quot;&quot;,
+        &quot;parent_type&quot;   : &quot;&quot;,
+        &quot;type&quot;      : &quot;&quot;
+      ]
+    ];
+    /*
+    y2internal (&quot;importing dhcp settings: %1&quot;, dhcp);
+    DhcpServer::Import (dhcp);
+    DhcpServer::Write ();
+    */
+ 
+    string dhcpd_conf   = sformat (
+&quot;option rfc3442-classless-static-routes code 121 = array of unsigned integer 8;
+option domain-name \&quot;%1\&quot;;
+max-lease-time 7200;
+# Custom option to identify this DHCP server as the cloud DHCP server
+# Define the new option
+option suse-nebula code 239 = ip-address;
+# Set the value
+option suse-nebula %2;
+# Set the address range to be handed out.
+subnet %3 netmask %4 {
+    range %5 %6;
+    default-lease-time 86400000;
+    max-lease-time 1728000000000;
+}&quot;, domain, ip, subnet_ip, netmask, ip_min, ip_max);
+ 
+    SCR::Write (.target.string, &quot;/etc/dhcpd.conf&quot;, dhcpd_conf);
+ 
+    SCR::Write (.sysconfig.dhcpd.DHCPD_INTERFACE, &quot;eth0&quot;);
+    SCR::Write (.sysconfig.dhcpd, nil);
+ 
+    Service::Enable (&quot;dhcpd&quot;);
+    Service::Start (&quot;dhcpd&quot;);
+
+    // 3. Write onedamin authentication file
+    string oneauth = sformat (&quot;oneadmin:%1&quot;, cadminp);
+    SCR::Write (.target.string, &quot;/var/lib/one/.one/one_auth&quot;, oneauth);
+ 
+	return true;
+    }
+ 
+    // initialize network data
+    boolean ReadNetworkSettings () {
+    network = YaPI::NETWORK::Read ();
+    y2internal (&quot;network: %1&quot;, network);
+    nameservers = network[&quot;dns&quot;,&quot;nameservers&quot;]:[];
+    searchdomains   = network[&quot;dns&quot;,&quot;searches&quot;]:[];
+    return true;
+    }
+ 
+    ReadNetworkSettings ();
+ 
+    term contents = `HBox (`HSpacing (1), `VBox (
+    `Frame (_(&quot;Network Configuration&quot;), `VBox (
+        // text entry label
+        `InputField (`id (&quot;clustername&quot;), `opt (`hstretch), _(&quot;C&amp;luster Name&quot;), clustername),
+        `HBox (
+        // text entry label
+        `InputField (`id (&quot;hostname&quot;), `opt (`hstretch), _(&quot;&amp;Hostname&quot;), hostname),
+        // text entry label
+        `InputField (`id (&quot;domain&quot;), `opt (`hstretch), _(&quot;&amp;Domain Name&quot;), domain)
+        ),
+        `HBox (
+        // text entry label
+        `InputField (`id (&quot;ip&quot;), `opt (`hstretch), _(&quot;&amp;IP Address&quot;), ip),
+        // text entry label
+        `InputField (`id (&quot;netmask&quot;), `opt (`hstretch), _(&quot;&amp;Netmask&quot;), netmask)
+        ),
+        // text entry label
+        `InputField (`id (&quot;route&quot;), `opt (`hstretch), _(&quot;Default Route&quot;), route),
+        `HBox (
+        // text entry label
+        `InputField (`id (&quot;nameservers&quot;), `opt (`hstretch), _(&quot;Name Servers&quot;), mergestring (nameservers, &quot; &quot;)),
+        // text entry label
+        `InputField (`id (&quot;searches&quot;), `opt (`hstretch), _(&quot;Search Domains&quot;), mergestring (searchdomains, &quot; &quot;))
+        )
+    )),
+    `VSpacing (2),
+    // frame label
+    `Frame (_(&quot;IP Address Range for Cloud Nodes&quot;), `HBox (
+        // text entry label
+        `InputField (`id (&quot;ip_min&quot;), `opt (`hstretch), _(&quot;Min IP Address&quot;), ip_min),
+        // text entry label
+        `InputField (`id (&quot;ip_max&quot;), `opt (`hstretch), _(&quot;Max IP Address&quot;), ip_max)
+    )),
+    `VSpacing (2),
+    // frame label
+    `Frame (_(&quot;Cloud Administrator&quot;), `VBox (
+        // text entry label
+        `InputField (`id (&quot;cadminp&quot;), `opt (`hstretch), _(&quot;Password for Cloud Administration&quot;), cadminp),
+        `VSpacing (1),
+        `Label (&quot;The password is stored in plain text in the file /var/lib/one/.one/one_auth and is used for cloud administration only.
+This is not the password for the cloud administrator (oneadmin) user account. The oneadmin account has no password.&quot;)
+    ))
+    ), `HSpacing (1));
+ 
+    if (Mode::normal ())
+    Wizard::OpenOKDialog ();
+ 
+    string help_text    = &quot;&quot;;
+ 
+    // dialog caption
+    Wizard::SetContents (_(&quot;SUSENebula&quot;), contents, help_text, true, true);
+ 
+    UI::ChangeWidget (`id (&quot;hostname&quot;), `ValidChars, Hostname::ValidChars);
+    foreach (string key, [&quot;ip&quot;, &quot;ip_min&quot;, &quot;ip_max&quot;], {
+    UI::ChangeWidget (`id (key), `ValidChars, IP::ValidChars4);
+    });
+    any ret = `back;
+    while (true)
+    {
+    ret = UI::UserInput ();
+    if (ret == `ok || ret == `next)
+    {
+        cadminp = (string) UI::QueryWidget (`id (&quot;cadminp&quot;), `Value);
+        clustername = (string) UI::QueryWidget (`id (&quot;clustername&quot;), `Value);
+        hostname    = (string) UI::QueryWidget (`id (&quot;hostname&quot;), `Value);
+        domain  = (string) UI::QueryWidget (`id (&quot;domain&quot;), `Value);
+        ip      = (string) UI::QueryWidget (`id (&quot;ip&quot;), `Value);
+        ip_min  = (string) UI::QueryWidget (`id (&quot;ip_min&quot;), `Value);
+        ip_max  = (string) UI::QueryWidget (`id (&quot;ip_max&quot;), `Value);
+        netmask = (string) UI::QueryWidget (`id (&quot;netmask&quot;), `Value);
+        route   = (string) UI::QueryWidget (`id (&quot;route&quot;), `Value);
+        string dns  = (string) UI::QueryWidget (`id (&quot;nameservers&quot;), `Value);
+        nameservers = splitstring (dns, &quot;, &quot;);
+        string searches = (string) UI::QueryWidget (`id (&quot;searches&quot;), `Value);
+        searchdomains = splitstring (searches, &quot;, &quot;);
+ 
+        if (!Hostname::Check (hostname))
+        {
+        Report::Error (Hostname::ValidHost ());
+        UI::SetFocus (`id (&quot;hostname&quot;));
+        continue;
+        }
+        if (!Hostname::CheckDomain (domain))
+        {
+        Report::Error (Hostname::ValidDomain ());
+        UI::SetFocus (`id (&quot;domain&quot;));
+        continue;
+        }
+        if (!IP::Check (ip))
+        {
+        Report::Error (IP::Valid4 ());
+        UI::SetFocus (`id (&quot;ip&quot;));
+        continue;
+        }
+        if (!IP::Check (ip_min))
+        {
+        Report::Error (IP::Valid4 ());
+        UI::SetFocus (`id (&quot;ip_min&quot;));
+        continue;
+        }
+        if (!IP::Check (ip_max))
+        {
+        Report::Error (IP::Valid4 ());
+        UI::SetFocus (`id (&quot;ip_max&quot;));
+        continue;
+        }
+ 
+        if (IP::ToInteger (ip_min) &lt;= IP::ToInteger (ip) &amp;&amp;
+        IP::ToInteger (ip) &lt;= IP::ToInteger (ip_max))
+        {
+        // error message
+        Report::Error (_(&quot;IP Address is within the IP range that should be offered by DHCP server.&quot;));
+        UI::SetFocus (`id (&quot;ip_min&quot;));
+        continue;
+        }
+ 
+        if (IP::ToInteger (ip_min) &gt; IP::ToInteger (ip_max))
+        {
+        // error message
+        Popup::Message(_(&quot;The lowest address must be lower than the highest one.&quot;));
+        UI::SetFocus (`id (&quot;ip_min&quot;));
+        continue;
+        }
+ 
+ 
+        WriteSettings ();
+        break;
+    }
+    if (ret == `cancel || ret == `abort)
+    {
+        break;
+    }
+    if (ret == `back)
+    {
+        break;
+    }
+    }
+    if (Mode::normal ())
+    Wizard::CloseDialog ();
+    return ret;
+}
diff --git a/doc/examples/extras/suse-11.4/suse-nebula-cloud/cloud_head/root/usr/share/firstboot/scripts/finalizeSetup b/doc/examples/extras/suse-11.4/suse-nebula-cloud/cloud_head/root/usr/share/firstboot/scripts/finalizeSetup
new file mode 100755
index 0000000..20a45bb
--- /dev/null
+++ b/doc/examples/extras/suse-11.4/suse-nebula-cloud/cloud_head/root/usr/share/firstboot/scripts/finalizeSetup
@@ -0,0 +1,92 @@
+#!/usr/bin/python
+
+# Author: Robert Schweikert
+# License: GPL v2
+# Copyright: SUSE
+
+import glob
+import os
+import sys
+import syslog
+
+# Only one interface should be configured at this point
+# check that this is indeed the case
+confFiles = glob.glob('/etc/sysconfig/network/ifcfg-eth*')
+numConfInterf = len(confFiles)
+if numConfInterf &gt; 1:
+    syslog.openlog('BR_SETUP]', syslog.LOG_PID, syslog.LOG_DAEMON)
+    syslog.syslog(syslog.LOG_INFO, 'Bridge setup\n')
+    msg = 'Multiple configured eth devices found, cannot resolve ambiguity\n'
+    syslog.syslog(syslog.LOG_ERR, msg)
+    syslog.closelog()
+    sys.exit(1)
+
+if numConfInterf &lt; 1:
+    syslog.openlog('BR_SETUP]', syslog.LOG_PID, syslog.LOG_DAEMON)
+    syslog.syslog(syslog.LOG_INFO, 'Bridge setup\n')
+    msg = 'No eth interface configured, cannot setup bridge\n'
+    syslog.syslog(syslog.LOG_ERR, msg)
+    syslog.closelog()
+    sys.exit(1)
+
+# Get the configured IP address (includes the subnet mask)
+interfConf = confFiles[0]
+interfaceName = interfConf.split('-')[-1]
+lines = open(interfConf, 'r').readlines()
+ipAddr = None
+for ln in lines:
+    if ln.find('IPADDR') != -1:
+        ipAddr = ln.strip().split('=')[-1]
+        break
+
+# Stop the running network services
+os.system('/etc/init.d/dhcpd stop &gt;&amp; /dev/null')
+os.system('/etc/init.d/nfsserver stop &gt;&amp; /dev/null')
+os.system('/sbin/ifdown %s &gt;&amp; /dev/null' %interfaceName)
+
+# Write the bridge configuration
+brCfg = open('/etc/sysconfig/network/ifcfg-br0', 'w')
+brCfg.write(&quot;BOOTPROTO='static'\n&quot;)
+brCfg.write(&quot;BRIDGE='yes'\n&quot;)
+brCfg.write(&quot;BRIDGE_PORTS='%s'\n&quot; %interfaceName)
+brCfg.write(&quot;BRIDGE_STP='off'\n&quot;)
+brCfg.write(&quot;BROADCAST=''\n&quot;)
+brCfg.write(&quot;ETHTOOL_OPTIONS=''\n&quot;)
+brCfg.write(&quot;IPADDR=%s\n&quot; %ipAddr)
+brCfg.write(&quot;MTU=''\n&quot;)
+brCfg.write(&quot;NAME=''\n&quot;)
+brCfg.write(&quot;NETWORK=''\n&quot;)
+brCfg.write(&quot;REMOTE_IPADDR=''\n&quot;)
+brCfg.write(&quot;STARTMODE='auto'\n&quot;)
+brCfg.write(&quot;USERCONTROL='no'\n&quot;)
+brCfg.write(&quot;IPADDR_0='169.254.1.1/24'\n&quot;)
+brCfg.write(&quot;LABEL_0='serviceport'\n&quot;)
+brCfg.close()
+
+# Server interface update
+lines = open('/etc/sysconfig/dhcpd', 'r').readlines()
+conf = open('/etc/sysconfig/dhcpd', 'w')
+for ln in lines:
+    if ln.find('DHCPD_INTERFACE') != -1:
+        conf.write('DHCPD_INTERFACE=&quot;br0&quot;\n')
+        continue
+    conf.write(ln)
+conf.close()
+                   
+# Run the configuration setup
+os.system('/sbin/SuSEconfig &gt;&amp; /dev/null')
+
+# Remove the old network configuration file
+os.remove(interfConf)
+
+# Insert the cloud information service and start it
+os.system('/sbin/insserv cloudinfo')
+# Insert the registration service and start it
+os.system('/sbin/insserv noderegistrar')
+# Proper permissions for the authentication file
+os.system('chown oneadmin:cloud /var/lib/one/.one/one_auth')
+# Start the cloud service
+# oned must be started with special environment setting the first time
+os.system('env ONE_AUTH=/var/lib/one/.one/one_auth /etc/init.d/one start &gt;&amp; /dev/null')
+os.system('/sbin/insserv one')
+os.system('/etc/init.d/one stop &gt;&amp; /dev/null')
diff --git a/doc/examples/extras/suse-11.4/suse-nebula-cloud/cloud_head/root/usr/share/susenebula/welcome.txt b/doc/examples/extras/suse-11.4/suse-nebula-cloud/cloud_head/root/usr/share/susenebula/welcome.txt
new file mode 100644
index 0000000..8af95e0
--- /dev/null
+++ b/doc/examples/extras/suse-11.4/suse-nebula-cloud/cloud_head/root/usr/share/susenebula/welcome.txt
@@ -0,0 +1,15 @@
+Welcome to SUSENebula
+
+The next few setup steps will guide you through the final configuration of the 
+Cloud Head node. After this is complete, your head node is ready for business.
+
+One note on security, this image contains pre-configured ssh keys that are
+available (including the private key) to the rest of the world. Therefore it
+is recommended that you generate new ssh keys for the oneadmin user. After the
+setup steps are complete, login as root (the oneadmin user has no password)
+and execute the following command:
+
+ssh-keygen -f /var/lib/one/.ssh/id_rsa
+
+Answer 'y' to over write the existing key. Do NOT enter a passphrase.
+
diff --git a/tools/burner/INSTALL b/doc/examples/extras/suse-11.4/suse-nebula-cloud/cloud_head/root/var/lib/YaST2/reconfig_system
similarity index 100%
copy from tools/burner/INSTALL
copy to doc/examples/extras/suse-11.4/suse-nebula-cloud/cloud_head/root/var/lib/YaST2/reconfig_system
diff --git a/doc/examples/extras/suse-11.4/suse-nebula-cloud/cloud_head/root/var/lib/one/.ssh/authorized_keys b/doc/examples/extras/suse-11.4/suse-nebula-cloud/cloud_head/root/var/lib/one/.ssh/authorized_keys
new file mode 100644
index 0000000..b00dfcd
--- /dev/null
+++ b/doc/examples/extras/suse-11.4/suse-nebula-cloud/cloud_head/root/var/lib/one/.ssh/authorized_keys
@@ -0,0 +1 @@
+ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDR2r8Y4l2dLfb4DFFD2UK0YxGOXdMJWm3XubVVnxuWKD7OTDpp7GVv0q7oaOlrRPb8q5cukSl5CSKn0YIseWiU9PMwcBOR7o7GXTl+r2NU16M47R/ys94Uy+OqS4172Z6m3uAJHb1MvU8BbIemcn9vWLteZBHViozQfMiifc3oE1StT8bUrJuj/AaoaPKS7OnmagJwIuyi+Ffk6LxjHWbEUfpou4Wa2xBFHP4IEclq5qYvKSDxhg4MCPW9rUw61W4hnA+JCkw6uWsoiu+jkOaQ4zgKvBkDUmf7FL4wTYeVTSClGXxny6gX/rjIfbCV+RggKDbNbLYltbB8HDp+ErGn <A HREF="https://lists.berlios.de/mailman/listinfo/kiwi-devel">oneadmin at linux</A>
diff --git a/doc/examples/extras/suse-11.4/suse-nebula-cloud/cloud_head/root/var/lib/one/.ssh/config b/doc/examples/extras/suse-11.4/suse-nebula-cloud/cloud_head/root/var/lib/one/.ssh/config
new file mode 100644
index 0000000..bc7cd5f
--- /dev/null
+++ b/doc/examples/extras/suse-11.4/suse-nebula-cloud/cloud_head/root/var/lib/one/.ssh/config
@@ -0,0 +1,3 @@
+Host *
+    StrictHostKeyChecking no
+
diff --git a/doc/examples/extras/suse-11.4/suse-nebula-cloud/cloud_head/root/var/lib/one/.ssh/id_rsa b/doc/examples/extras/suse-11.4/suse-nebula-cloud/cloud_head/root/var/lib/one/.ssh/id_rsa
new file mode 100644
index 0000000..973d568
--- /dev/null
+++ b/doc/examples/extras/suse-11.4/suse-nebula-cloud/cloud_head/root/var/lib/one/.ssh/id_rsa
@@ -0,0 +1,27 @@
+-----BEGIN RSA PRIVATE KEY-----
+MIIEpAIBAAKCAQEA0dq/GOJdnS32+AxRQ9lCtGMRjl3TCVpt17m1VZ8blig+zkw6
+aexlb9Ku6Gjpa0T2/KuXLpEpeQkip9GCLHlolPTzMHATke6Oxl05fq9jVNejOO0f
+8rPeFMvjqkuNe9mept7gCR29TL1PAWyHpnJ/b1i7XmQR1YqM0HzIon3N6BNUrU/G
+1Kybo/wGqGjykuzp5moCcCLsovhX5Oi8Yx1mxFH6aLuFmtsQRRz+CBHJauamLykg
+8YYODAj1va1MOtVuIZwPiQpMOrlrKIrvo5DmkOM4CrwZA1Jn+xS+ME2HlU0gpRl8
+Z8uoF/64yH2wlfkYICg2zWy2JbWwfBw6fhKxpwIDAQABAoIBABKQzbM/45RSSrUr
+Mc1U3UfkM9tqhY8gRvN85IQMrX4dVWEe8VQJq/e2pe69yVjKIye7boaaJRcmLcC3
+ElMo8o2rFhDE+ZZBirQV70476gfJhBE3OUpZi14/o4afZIb+e8C7mwpzbRnq7aBs
+n5ukKY4KRZlWNRW1Sjvvrjhh9OOBGUrmj9Yp10LEcKpstMSA/AENvVE81J7s7V7i
++CvZov41H7uO0a8J3aWO1TIjnnLE848nEoGZOvXVVyuLUbMZAYzdRjo0DzbXuSa4
+C/1AzQzD3a91xrF6lHYE4uphRY7tX1EDVfXQTNX+fH5PKp1uxJaU8nW22DbVL/us
+X/les1ECgYEA6rDHMvcqY+vWUzLXIHeOqlL3ORMq1+mQHVEuL+oZtz1uL0uTODZT
+jOaASXQGXRWpcGnmaTq7i3/S+zvjagqvkjtpJNmdeEVV3oQ0CtLtIIywRHiWJ/L1
+bP6YJr7o7+T3TfV2AYS1Ckuf0WwtDSfeAr+g9NyUg5d/TBKGQNImJTMCgYEA5Oir
+x34QU/NTYWJvVCDxQYRb/Lbbvao9CLE1P270uYMtAIJVBM+qL/IQAAmLWmO/coVM
+iOHOz/IDxrhtuaMXb7rN2JsDgRZfwKKFOS2uAO+VTga8f0UdOdV77qI30u792/D0
+2wB7nDIhJ/c4IwGaxgS11lrBJxcGfoNbAJIb2b0CgYEAjBCvAfrDQNk6k3LvM0BH
+U92qEFUhJ7UMPoL5prz3VgYCoZVgKpc5rAjRHYVyWtGXyzBYxAq6bVn/R9OJOPth
+p0tvx/9cXLA8vE14ZdFWliuA84xoSTVWRhN4KP+dM7cZ5VwObn+OMLPLkQgXpxdZ
+B5jobdrLg/HBllwj5cHF5EMCgYAsTYvRlGh8lv9wPajmU2neEEvtYUauMqCVahaw
+LD1ZGjY/fvoNcFOz69mE6FP8LooDFCF37JwmSuTINTGnWBVVHoZwga/v7/CgS9QU
++O5QaA4xh8Q7rZi2dMcDrIm5XV/sjXoWWMWTuXAJWCOZQto9sPOwhOgVNLOhELMw
+LRcO0QKBgQDQpLlzO7Lss+KMsrvtjWfW53nlUfDtYCS7zCer+segocrdoIhlw8uS
+TiWTIjQ1dxvhIbkL6d2tfr717AwYtf9FKJKAKYyyjW2IixLypN1SOSjjCf3mO860
+4vMHfod3dzySGf9a1M4NsKF33uZ5KbcseM3oPsLwncfaicy+G+Xwhg==
+-----END RSA PRIVATE KEY-----
diff --git a/doc/examples/extras/suse-11.4/suse-nebula-cloud/cloud_head/root/var/lib/one/.ssh/id_rsa.pub b/doc/examples/extras/suse-11.4/suse-nebula-cloud/cloud_head/root/var/lib/one/.ssh/id_rsa.pub
new file mode 100644
index 0000000..b00dfcd
--- /dev/null
+++ b/doc/examples/extras/suse-11.4/suse-nebula-cloud/cloud_head/root/var/lib/one/.ssh/id_rsa.pub
@@ -0,0 +1 @@
+ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDR2r8Y4l2dLfb4DFFD2UK0YxGOXdMJWm3XubVVnxuWKD7OTDpp7GVv0q7oaOlrRPb8q5cukSl5CSKn0YIseWiU9PMwcBOR7o7GXTl+r2NU16M47R/ys94Uy+OqS4172Z6m3uAJHb1MvU8BbIemcn9vWLteZBHViozQfMiifc3oE1StT8bUrJuj/AaoaPKS7OnmagJwIuyi+Ffk6LxjHWbEUfpou4Wa2xBFHP4IEclq5qYvKSDxhg4MCPW9rUw61W4hnA+JCkw6uWsoiu+jkOaQ4zgKvBkDUmf7FL4wTYeVTSClGXxny6gX/rjIfbCV+RggKDbNbLYltbB8HDp+ErGn <A HREF="https://lists.berlios.de/mailman/listinfo/kiwi-devel">oneadmin at linux</A>
diff --git a/doc/examples/extras/suse-12.1/suse-nebula-cloud.readme b/doc/examples/extras/suse-12.1/suse-nebula-cloud.readme
new file mode 100644
index 0000000..21b85e9
--- /dev/null
+++ b/doc/examples/extras/suse-12.1/suse-nebula-cloud.readme
@@ -0,0 +1,68 @@
+KIWI Image Description Example
+==============================
+* This example provides the configuration for a cloud setup based on the
+  OpenNebula project. The example contains three configuration trees, one
+  for the cloud head node, one for a cloud node, and one for a guest that
+  can be setup to run on the cloud.
+
+  The guest configuration example is slightly specialized to also function
+  as a basic test image for coud setup verification. The name of the resulting
+  image is incoded in the file /home/ctester/testVM.one. Also the config.sh
+  script modifies the dhcp client configuration file such that a DHCP lease
+  is only accepted from a server that can provide the &quot;suse-nebula&quot; feature.
+  The &quot;suse-nebula&quot; feature is the default setting in the YaST setup module
+  executed on firstboot after the head node installation.
+
+  Both the head node and cloud node images are oem images targeted to be
+  deployed from a USB stick. Both images will shutdown the machine after the
+  deployment is complete, a sign that the USB stick can be removed.
+
+  A keyboard and monitor need to be connected to the head node on firstboot
+  to complete the configuration. After the head node is configured cloud nodes 
+  can be deployed, or if deployed already be turned on. Cloud nodes will self
+  configure on first boot and register themselves with the cloud infrastructure
+  running on the head node.
+
+  The head node contains a /home/ctester directory that is setup to deploy the
+  guest image built with the cloud_guest tree. See the testVM.README file for
+  additional details.
+
+  For administration of the cloud infrastrusture see the documentation provided
+  by the OpenNebula project.
+
+  <A HREF="http://opennebula.org/documentation">http://opennebula.org/documentation</A>
+
+How to build this Example
+==============================
+
+* Head Node
+    kiwi -p /usr/share/doc/packages/kiwi/examples/extras/suse-12.1/suse-nebula-cloud/cloud_head --root /tmp/neb_head_unpacked
+
+    kiwi --create /tmp/neb_head_unpacked -d /tmp/neb_head_image
+
+* Cloud Node
+    kiwi -p /usr/share/doc/packages/kiwi/examples/extras/suse-12.1/suse-nebula-cloud/cloud_cloud --root /tmp/neb_cloud_unpacked
+
+    kiwi --create /tmp/neb_cloud_unpacked -d /tmp/neb_cloud_img
+
+* Guest
+    kiwi -p /usr/share/doc/packages/kiwi/examples/extras/suse-12.1/suse-nebula-cloud/cloud_guest --root /tmp/neb_guest_unpacked
+
+    kiwi --create /tmp/neb_guest_unpacked -d /tmp/neb_guest_img
+  
+How to test this Example
+==============================
+* The OEM images for the head node and cloud node can be dumped onto a USB
+  stick. Then appropriate machines can be booted from the stick. The head
+  node can run inside a VM. Cloud node machines for this example must have
+  processor(s) that support virtualization instructions as the example uses
+  KVM. You can modify the example to use Xen, if this is your preferred
+  hypervisor solution.
+
+Login Details Head and Cloud
+==============================
+* As configured during firstboot of the head node
+
+Login Details Guest
+==============================
+* User root pwd: linux
diff --git a/doc/examples/suse-11.3/suse-xen-guest/config.sh b/doc/examples/extras/suse-12.1/suse-nebula-cloud/cloud_cloud/config.sh
similarity index 67%
copy from doc/examples/suse-11.3/suse-xen-guest/config.sh
copy to doc/examples/extras/suse-12.1/suse-nebula-cloud/cloud_cloud/config.sh
index 098002e..b069be0 100755
--- a/doc/examples/suse-11.3/suse-xen-guest/config.sh
+++ b/doc/examples/extras/suse-12.1/suse-nebula-cloud/cloud_cloud/config.sh
@@ -5,12 +5,12 @@
 # PROJECT       : OpenSuSE KIWI Image System
 # COPYRIGHT     : (c) 2006 SUSE LINUX Products GmbH. All rights reserved
 #               :
-# AUTHOR        : Marcus Schaefer &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/kiwi-devel">ms at suse.de</A>&gt;
+# AUTHOR        : Robert Scwheikert &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/kiwi-devel">rschweikert at novell.com</A>&gt;
 #               :
 # BELONGS TO    : Operating System images
 #               :
 # DESCRIPTION   : configuration script for SUSE based
-#               : operating systems
+#               : OpenNebula cloud node
 #               :
 #               :
 # STATUS        : BETA
@@ -37,16 +37,26 @@ suseSetupProduct
 suseActivateDefaultServices
 suseInsertService boot.device-mapper
 suseInsertService sshd
+suseInsertService libvirtd
 
 #======================================
 # SuSEconfig
 #--------------------------------------
+baseUpdateSysConfig /etc/sysconfig/network/dhcp DHCLIENT_BIN dhclient
+# Disable IPv6
+baseUpdateSysConfig /etc/sysconfig/network/dhcp DHCLIENT6_BIN /bin/false
+echo &#226;&#128;&#156;alias net-pf-10 off&#226;&#128;&#157; &gt;&gt; /etc/modprobe.conf.local
+echo &#226;&#128;&#156;alias ipv6 off&#226;&#128;&#157; &gt;&gt; /etc/modprobe.conf.local
+sed -i &quot;s/#net.ipv6.conf.all.disable_ipv6 = 1/net.ipv6.conf.all.disable_ipv6 = 1&quot; /etc/sysctl.conf
+# Configure libvirt settings
+sed -i &quot;s/#listen_tcp = 1/listen_tcp = 1/&quot; /etc/libvirt/libvirtd.conf
+
 suseConfig
 
 #======================================
-# clone runlevel 3 to 4
+# Misc
 #--------------------------------------
-suseCloneRunlevel 4
+ln -s /usr/bin/qemu-kvm /usr/bin/kvm
 
 #======================================
 # Umount kernel filesystems
diff --git a/doc/examples/extras/suse-12.1/suse-nebula-cloud/cloud_cloud/config.xml b/doc/examples/extras/suse-12.1/suse-nebula-cloud/cloud_cloud/config.xml
new file mode 100644
index 0000000..53776cf
--- /dev/null
+++ b/doc/examples/extras/suse-12.1/suse-nebula-cloud/cloud_cloud/config.xml
@@ -0,0 +1,65 @@
+&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
+&lt;image schemaversion=&quot;5.2&quot; name=&quot;suse-12.1-OpenNebula-Cloud-Node&quot;&gt;
+	&lt;description type=&quot;system&quot;&gt;
+		&lt;author&gt;Robert Schweikert&lt;/author&gt;
+		&lt;contact&gt;<A HREF="https://lists.berlios.de/mailman/listinfo/kiwi-devel">rschweikert at novell.com</A>&lt;/contact&gt;
+		&lt;specification&gt;OpenNebula Cloud Node configuration&lt;/specification&gt;
+    &lt;/description&gt;
+    &lt;preferences&gt;
+        &lt;type image=&quot;oem&quot; filesystem=&quot;ext3&quot; boot=&quot;oemboot/suse-12.1&quot; installstick=&quot;true&quot; installboot=&quot;install&quot; boottimeout=&quot;2&quot;&gt;
+			&lt;oemconfig&gt;
+				&lt;oem-boot-title&gt;OpenNebula Cloud Node&lt;/oem-boot-title&gt;
+				&lt;oem-shutdown&gt;true&lt;/oem-shutdown&gt;
+				&lt;oem-swap&gt;true&lt;/oem-swap&gt;
+				&lt;oem-swapsize&gt;2048&lt;/oem-swapsize&gt;
+                &lt;oem-unattended&gt;true&lt;/oem-unattended&gt;
+			&lt;/oemconfig&gt;
+		&lt;/type&gt;
+		&lt;version&gt;1.1.0&lt;/version&gt;
+		&lt;packagemanager&gt;zypper&lt;/packagemanager&gt;
+		&lt;rpm-check-signatures&gt;false&lt;/rpm-check-signatures&gt;
+		&lt;rpm-force&gt;true&lt;/rpm-force&gt;
+		&lt;locale&gt;en_US&lt;/locale&gt;
+		&lt;keytable&gt;us.map.gz&lt;/keytable&gt;
+	&lt;/preferences&gt;
+	&lt;users group=&quot;root&quot;&gt;
+		&lt;user pwd=&quot;cloudDemo&quot; pwdformat=&quot;plain&quot; home=&quot;/root&quot; name=&quot;root&quot;/&gt;
+	&lt;/users&gt;
+	&lt;repository type=&quot;yast2&quot;&gt;
+		&lt;source path=&quot;<A HREF="opensuse://12.1/repo/oss/">opensuse://12.1/repo/oss/</A>&quot;/&gt;
+	&lt;/repository&gt;
+    &lt;repository type=&quot;rpm-md&quot;&gt;
+        &lt;source path=&quot;<A HREF="http://download.opensuse.org/repositories/Virtualization:/Cloud:/OpenNebula/openSUSE_12.1">http://download.opensuse.org/repositories/Virtualization:/Cloud:/OpenNebula/openSUSE_12.1</A>&quot;/&gt;
+    &lt;/repository&gt;
+	&lt;packages type=&quot;image&quot; patternType=&quot;plusRecommended&quot;&gt;
+		&lt;opensusePattern name=&quot;base&quot;/&gt;
+		&lt;package name=&quot;bootsplash&quot;/&gt;
+        &lt;package name=&quot;bootsplash-branding-openSUSE&quot; bootinclude=&quot;true&quot; bootdelete=&quot;true&quot;/&gt;
+		&lt;package name=&quot;bridge-utils&quot;/&gt;
+		&lt;package name=&quot;dhcp-client&quot;/&gt;
+        &lt;package name=&quot;gfxboot-branding-openSUSE&quot; bootinclude=&quot;true&quot; bootdelete=&quot;true&quot;/&gt;
+		&lt;package name=&quot;ifplugd&quot;/&gt;
+		&lt;package name=&quot;iptables&quot;/&gt;
+		&lt;package name=&quot;iputils&quot;/&gt;
+		&lt;package name=&quot;kernel-default&quot;/&gt;
+        &lt;package name=&quot;kvm&quot;/&gt;
+        &lt;package name=&quot;libvirt&quot;/&gt;
+        &lt;package name=&quot;nfs-client&quot;/&gt;
+        &lt;package name=&quot;openssh&quot;/&gt;
+        &lt;package name=&quot;openssl&quot;/&gt;
+        &lt;package name=&quot;qemu&quot;/&gt;
+		&lt;package name=&quot;rsyslog&quot;/&gt;
+        &lt;package name=&quot;ruby&quot;/&gt;
+        &lt;package name=&quot;rubygems&quot;/&gt;
+        &lt;package name=&quot;rubygem-libxml-ruby&quot;/&gt;
+        &lt;package name=&quot;rubygem-nokogiri&quot;/&gt;
+        &lt;package name=&quot;terminfo&quot;/&gt;
+		&lt;package name=&quot;vi&quot;/&gt;
+        &lt;package name=&quot;xmlrpc-c&quot;/&gt;
+        &lt;package name=&quot;yast2-nfs-client&quot;/&gt;
+	&lt;/packages&gt;
+	&lt;packages type=&quot;bootstrap&quot;&gt;
+		&lt;package name=&quot;filesystem&quot;/&gt;
+		&lt;package name=&quot;glibc-locale&quot;/&gt;
+	&lt;/packages&gt;
+&lt;/image&gt;
diff --git a/doc/examples/extras/suse-12.1/suse-nebula-cloud/cloud_cloud/root/etc/HOSTNAME b/doc/examples/extras/suse-12.1/suse-nebula-cloud/cloud_cloud/root/etc/HOSTNAME
new file mode 100644
index 0000000..6cfc2eb
--- /dev/null
+++ b/doc/examples/extras/suse-12.1/suse-nebula-cloud/cloud_cloud/root/etc/HOSTNAME
@@ -0,0 +1 @@
+node1.SUSENebula
diff --git a/doc/examples/extras/suse-12.1/suse-nebula-cloud/cloud_cloud/root/etc/init.d/boot.local b/doc/examples/extras/suse-12.1/suse-nebula-cloud/cloud_cloud/root/etc/init.d/boot.local
new file mode 100755
index 0000000..45c6d97
--- /dev/null
+++ b/doc/examples/extras/suse-12.1/suse-nebula-cloud/cloud_cloud/root/etc/init.d/boot.local
@@ -0,0 +1,6 @@
+#!/bin/sh
+
+if [ -f /var/lib/firstboot ]; then
+    /usr/share/firstboot/scripts/cloudNodeConfig
+    rm /var/lib/firstboot
+fi
diff --git a/doc/examples/extras/suse-12.1/suse-nebula-cloud/cloud_cloud/root/etc/polkit-1/localauthority/50-local.d/60-suseNebula-access.pkla b/doc/examples/extras/suse-12.1/suse-nebula-cloud/cloud_cloud/root/etc/polkit-1/localauthority/50-local.d/60-suseNebula-access.pkla
new file mode 100644
index 0000000..b5a2ef4
--- /dev/null
+++ b/doc/examples/extras/suse-12.1/suse-nebula-cloud/cloud_cloud/root/etc/polkit-1/localauthority/50-local.d/60-suseNebula-access.pkla
@@ -0,0 +1,6 @@
+[Remote libvirt SSH access]
+ Identity=unix-user:oneadmin
+ Action=org.libvirt.unix.manage
+ ResultAny=yes
+ ResultInactive=yes
+ ResultActive=yes
diff --git a/doc/examples/extras/suse-12.1/suse-nebula-cloud/cloud_cloud/root/usr/share/firstboot/scripts/cloudNodeConfig b/doc/examples/extras/suse-12.1/suse-nebula-cloud/cloud_cloud/root/usr/share/firstboot/scripts/cloudNodeConfig
new file mode 100755
index 0000000..bc1da61
--- /dev/null
+++ b/doc/examples/extras/suse-12.1/suse-nebula-cloud/cloud_cloud/root/usr/share/firstboot/scripts/cloudNodeConfig
@@ -0,0 +1,372 @@
+#!/usr/bin/python
+
+&quot;&quot;&quot;SUSENebula cloud node configurator.&quot;&quot;&quot;
+
+import glob
+import os
+import re
+import socket
+import sys
+import syslog
+import time
+
+#------------------------------------------------------------------------
+def configureNode(confSettings):
+    &quot;&quot;&quot;Configure this node.&quot;&quot;&quot;
+    # Setup keyboard layout
+    layout = confSettings['keyLayout']
+    msg = 'Setting keyboard layout to: %s\n' %layout
+    syslog.syslog(syslog.LOG_INFO, msg)
+    os.system('/sbin/yast2 keyboard set layout=%s' %layout)
+    # Setup the timezone
+    zone = confSettings['timezone']
+    hwc = confSettings['hwclock'].lower()
+    msg = 'Setting timezone and hwclock to: %s, %s' %(zone, hwc)
+    syslog.syslog(syslog.LOG_INFO, msg)
+    os.system('/sbin/yast2 timezone set timezone=%s hwclock=%s' %(zone, hwc))
+        # Setup hostname
+    domain = confSettings['domainname']
+    name = confSettings['hostname']
+    host = '%s.%s' %(name, domain)
+    msg = 'Setting hostname to: %s\n' %host
+    hf = open('/etc/HOSTNAME', 'w')
+    hf.write(host)
+    hf.close()
+    # Add the hostname to the dhcp configuration info
+    lines = open('/etc/sysconfig/network/dhcp', 'r').readlines()
+    dhf = open('/etc/sysconfig/network/dhcp', 'w')
+    for ln in lines:
+        if ln.find('DHCLIENT_HOSTNAME_OPTION') != -1:
+            dhf.write('DHCLIENT_HOSTNAME_OPTION=&quot;%s&quot;' %name)
+            continue
+        dhf.write(ln)
+    dhf.close()
+    # Add the dhcp feature to avoid dhcp acceptance from servers other than
+    # the head node
+    feature = confSettings['dhcpFeature']
+    msg = 'Setting dhclient required feature to: %s\n' %feature
+    syslog.syslog(syslog.LOG_INFO, msg)
+    dhcf = open('/etc/dhclient.conf','a')
+    dhcf.write('option %s code 239 = ip-address;\n' %feature)
+    dhcf.write('request %s;\n' %feature)
+    dhcf.write('require %s;\n' %feature)
+    dhcf.close()
+    # Setup the name resolution
+    syslog.syslog(syslog.LOG_INFO, 'Setting up resolve.conf\n')
+    res = open('/etc/resolv.conf', 'w')
+    res.write(confSettings['resolve'])
+    res.close()
+    # Setup the routes
+    syslog.syslog(syslog.LOG_INFO, 'Setting up routes\n')
+    routes = open('/etc/sysconfig/network/routes', 'w')
+    routes.write(confSettings['routes'])
+    routes.close()
+    # Setup the root password
+    syslog.syslog(syslog.LOG_INFO, 'Setting root password\n')
+    lines = open('/etc/shadow', 'r').readlines()
+    shadow = open('/etc/shadow','w')
+    for ln in lines:
+        if ln[:4] == 'root':
+            shadow.write('root:')
+            shadow.write(confSettings['rootpass'])
+            shadow.write(':')
+            shadow.write(ln.split(':')[2])
+            shadow.write('::::::\n')
+            continue
+        shadow.write(ln)
+    shadow.close()
+    # Setup the cloud administartor acount
+    # Use eval; convert strings to tuple
+    gname, gid = eval(confSettings['groupID'])
+    uname, uid, pwd = eval(confSettings['userID'])
+    msg = 'Setting up %s with uid, gid: %s, %s\n' %(uname,uid,gid)
+    syslog.syslog(syslog.LOG_INFO, msg)
+    res = os.system('/usr/sbin/groupadd -g %s %s' %(gid, gname))
+    if res:
+        msg = 'Could not add %s group. ' %gname
+        msg += 'Incomplete configuration\n'
+        syslog.syslog(syslog.LOG_INFO, msg)
+        return -1
+    res = os.system(
+        '/usr/sbin/useradd -c &quot;%s&quot; -d %s -g %s -G %s -u %s -p %s -m %s'
+        %('Cloud admin', '/var/lib/one', gid, 'kvm,root', uid, pwd, uname))
+    if res:
+        msg = 'Could not add %s user. ' %uname
+        msg += 'Incomplete configuration\n'
+        syslog.syslog(syslog.LOG_INFO, msg)
+        return -1
+    # Setup nfs mount in fstab
+    syslog.syslog(syslog.LOG_INFO, 'Setting up NFS mount in fstab\n')
+    fst = open('/etc/fstab', 'a')
+    fst.write(confSettings['serverIP'])
+    fst.write(':/var/lib/one')
+    fst.write('\t/var/lib/one\tnfs\tdefaults\t1 1\n')
+    fst.close()
+            
+    return 1
+
+#----------------------------------------------------------------------------
+def getConfigFromServer():
+    &quot;&quot;&quot;Get the configuration from the service running on the head node.&quot;&quot;&quot;
+    syslog.syslog(syslog.LOG_INFO, 'Obtain node configuration from head\n')
+    s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
+    try:
+        s.connect(('169.254.1.1',  8445))
+    except:
+        msg = 'Could not connect to head node at 169.254.1.1 port  8445\n'
+        syslog.syslog(syslog.LOG_INFO, msg)
+        return -1
+    # Request the configuration info from the head node
+    s.send('PROVIDE_CONFIG')
+    confSettings = {}
+    confData = ''
+    # Read the configuration data from the socket
+    while 1:
+        data = s.recv(4096)
+        confData += data
+        if confData.find('COMPLETE') != -1:
+            break
+    s.close()
+    # Populate the configuration data dict
+    for confItem in confData.split(';'):
+        key, value = confItem.split('=', 1)
+        if key != 'COMPLETE':
+            confSettings[key] = value
+    return confSettings
+
+#----------------------------------------------------------------------------
+def getFirstConnectedInterface():
+    &quot;&quot;&quot;Find the interface that has a cable connected.&quot;&quot;&quot;
+    iFaceInfo = os.popen('/usr/sbin/hwinfo').readlines()
+    iFaceName = None
+    processBlock = None
+    for ln in iFaceInfo:
+        if ln.strip() == '':
+            processBlock = None
+            continue
+        if processBlock:
+            if ln.find('SysFS ID') != -1:
+                iFaceName = ln.split(':')[-1].split('/')[-1].strip()
+                continue
+            if ln.find('Link detected') != -1:
+                carrier = ln.split(':')[-1].strip()
+                if carrier == 'yes':
+                    if iFaceName:
+                        return iFaceName
+                else:
+                    continue
+        if re.match(r'^\d+:.*Ethernet$',ln):
+            processBlock = 1
+            continue
+
+    return -1 # No network interface is connected 
+
+#----------------------------------------------------------------------------
+def registerNode():
+    &quot;&quot;&quot;Register this node with the head node.&quot;&quot;&quot;
+    syslog.syslog(syslog.LOG_INFO, 'Register the node with the head node.\n')
+    # Get the IP and MAC Address of this node
+    ipInfo = os.popen('/sbin/ifconfig').readlines()
+    processBlk = None
+    ipAddr = None
+    macAddr = None
+    for ln in ipInfo:
+        if ipAddr and macAddr:
+            break
+        if processBlk:
+            if ln.find('inet addr') != -1:
+                ipAddr = ln.split(':')[1].split()[0].strip()
+                continue
+        # We always setup br0, see setupCloudNetwork()
+        if ln.find('br0') != -1:
+            processBlk = 1
+            macAddr = ln.split()[-1].strip()
+    if not ipAddr:
+        msg = 'Could not determine IP of this node. '
+        msg += 'Unable to gergister node.\n'
+        syslog.syslog(syslog.LOG_INFO, msg)
+        return -1
+    if not macAddr:
+        msg = 'Could not determine MAC of this node. '
+        msg += 'Unable to gergister node.\n'
+        syslog.syslog(syslog.LOG_INFO, msg)
+        return -1
+    # Get the server IP from fstab, see configureNode()
+    fst = open('/etc/fstab','r').readlines()
+    servIP = None
+    for ln in fst:
+        if ln.find('/var/lib/one') != -1:
+            servIP = ln.split(':')[0].strip()
+    if not servIP:
+        msg = 'Could not determine head node IP from /etc/fstab. '
+        msg += 'Unable to gergister node.\n'
+        syslog.syslog(syslog.LOG_INFO, msg)
+        return -1
+    # Hostname
+    myName = open('/etc/HOSTNAME', 'r').read().split('.')[0].strip()
+    # Connect to server and register
+    s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
+    try:
+        s.connect((servIP,  8445))
+    except:
+        msg = 'Could not connect to head node at %s port  8445\n' %servIP
+        syslog.syslog(syslog.LOG_INFO, msg)
+        return -1
+    regInfo = '%s;%s;%s' %(macAddr, ipAddr, myName)
+    s.send(regInfo)
+    s.close()
+
+    return 1
+    
+#----------------------------------------------------------------------------
+def removeConfNetworkSetting(iFace):
+    &quot;&quot;&quot;Shutdown the configuration network and remove the configuration.&quot;&quot;&quot;
+    syslog.syslog(syslog.LOG_INFO, 'Shutdown configuartion network\n')
+    os.system('/sbin/ifdown %s' %iFace)
+    msg = 'Remove configuration network interface config\n'
+    syslog.syslog(syslog.LOG_INFO, msg)
+    os.remove('/etc/sysconfig/network/ifcfg-%s' %iFace)
+
+#----------------------------------------------------------------------------
+def setupCloudNetwork(iFace):
+    &quot;&quot;&quot;Setup the configuration for the cloud network and fire it up.&quot;&quot;&quot;
+    msg = 'Setup cloud network configuration as br0\n'
+    syslog.syslog(syslog.LOG_INFO, msg)
+    cfgF = open('/etc/sysconfig/network/ifcfg-br0', 'w')
+    cfgF.write(&quot;BOOTPROTO='dhcp'\n&quot;)
+    cfgF.write(&quot;BRIDGE='yes'\n&quot;)
+    cfgF.write(&quot;BRIDGE_FORWARDDELAY='0'\n&quot;)
+    cfgF.write(&quot;BRIDGE_PORTS='%s'\n&quot; %iFace)
+    cfgF.write(&quot;BRIDGE_STP='off'\n&quot;)
+    cfgF.write(&quot;BROADCAST=''\n&quot;)
+    cfgF.write(&quot;ETHTOOL_OPTIONS=''\n&quot;)
+    cfgF.write(&quot;MTU=''\n&quot;)
+    cfgF.write(&quot;NAME=''\n&quot;)
+    cfgF.write(&quot;NETWORK=''\n&quot;)
+    cfgF.write(&quot;REMOTE_IPADDR=''\n&quot;)
+    cfgF.write(&quot;STARTMODE='auto'\n&quot;)
+    cfgF.write(&quot;USERCONTROL='no'&quot;)
+    cfgF.close()
+    
+#----------------------------------------------------------------------------
+def setupConfNetwork(iFace):
+    &quot;&quot;&quot;Setup the interface provided as the configuration network with a
+       static IP.&quot;&quot;&quot;
+    syslog.syslog(syslog.LOG_INFO, 'Setup configuration network 169.254.1.2\n')
+    cfgF = open('/etc/sysconfig/network/ifcfg-%s' %iFace, 'w')
+    cfgF.write(&quot;BOOTPROTO='static'\n&quot;)
+    cfgF.write(&quot;BROADCAST=''\n&quot;)
+    cfgF.write(&quot;ETHTOOL_OPTIONS=''\n&quot;)
+    cfgF.write(&quot;IPADDR='169.254.1.2/24'\n&quot;)
+    cfgF.write(&quot;MTU=''\n&quot;)
+    cfgF.write(&quot;NAME='Cloud configuration network'\n&quot;)
+    cfgF.write(&quot;NETWORK=''\n&quot;)
+    cfgF.write(&quot;REMOTE_IPADDR=''\n&quot;)
+    cfgF.write(&quot;STARTMODE='auto'\n&quot;)
+    cfgF.write(&quot;USERCONTROL='no'&quot;)
+    cfgF.close()
+
+#----------------------------------------------------------------------------
+def startCloudNetwork():
+    &quot;&quot;&quot;Start the cloud network.&quot;&quot;&quot;
+    syslog.syslog(syslog.LOG_INFO, 'Starting cloud network\n')
+    os.system('/sbin/ifup br0')
+    cnt = 0
+    # Cannot depend on the ifup exit status as we need to play a trick to
+    # disable IPv6 which always leads to a non zero exit status
+    # Therefore we probe whether or not we get an IP address assigned
+    while cnt &lt; 10:
+        time.sleep(15) # give dhcp a chance to get an address
+        processBlock = None
+        ifaceInfo = os.popen('/sbin/ifconfig').readlines()
+        for ln in ifaceInfo:
+            if ln.find('br0') != -1:
+                processBlock = 1
+                continue
+            if processBlock and ln.find('inet addr') != -1:
+                addr = ln.split(':')[1].split()[0].strip()
+                if addr.find('.') != -1:
+                    cnt = 99
+                    break
+        cnt += 1
+    if cnt != 100:
+        return -1
+
+    return 1
+
+#----------------------------------------------------------------------------
+def startNetwork(iFace, type):
+    &quot;&quot;&quot;Start the specified network interface.&quot;&quot;&quot;
+    msg = 'Start %s network interface on %s\n' %(type, iFace)
+    syslog.syslog(syslog.LOG_INFO, msg)
+    res = os.system('/sbin/ifup %s' %iFace)
+    if res:
+        return -1
+
+    return 1
+
+#----------------------------------------------------------------------------
+if __name__ == &quot;__main__&quot;:
+    # Triggered from boot.local, thus this runs prior to services being started
+    # Start the syslog service to make sure our messages are recorded
+    os.system('/etc/init.d/syslog start &gt;&amp; /dev/null')
+    syslog.openlog('[CLOUD_NODE_SETUP]', syslog.LOG_PID, syslog.LOG_DAEMON)
+    syslog.syslog(syslog.LOG_INFO, 'Start node registration and setup\n')
+    iFace = getFirstConnectedInterface()
+    if iFace == -1:
+        msg = 'Could not determine connected network interface aborting'
+        msg += ' node configuration\n'
+        syslog.syslog(syslog.LOG_INFO, msg)
+        syslog.closelog()
+        sys.exit(1)
+    setupConfNetwork(iFace)
+    res = startNetwork(iFace, 'configuration')
+    if res == -1:
+        msg = 'Could not start the network interface to configure the '
+        msg += 'cloud node, manual configuration required.\n'
+        syslog.syslog(syslog.LOG_INFO, msg)
+        syslog.closelog()
+        sys.exit(1)
+    confDict = getConfigFromServer()
+    if confDict == -1:
+        msg = 'Could not connect to configuration server at 169.254.1.1 '
+        msg += 'cloud node, manual configuration required.\n'
+        msg += 'This IP:  169.254.1.2\n'
+        syslog.syslog(syslog.LOG_INFO, msg)
+        syslog.closelog()
+        sys.exit(1)
+    removeConfNetworkSetting(iFace)
+    setupCloudNetwork(iFace)
+    res = configureNode(confDict)
+    if res == -1:
+        msg = 'Configuration failure. Manual configuration requires.\n'
+        syslog.syslog(syslog.LOG_INFO, msg)
+        syslog.closelog()
+        sys.exit(1)
+    # Setup cloud network
+    res = startCloudNetwork()
+    if res == -1:
+        msg = 'Cloud network setup and start up failed. Manual configuration '
+        msg += 'required\n'
+        syslog.syslog(syslog.LOG_INFO, msg)
+        syslog.closelog()
+        sys.exit(1)
+    # NFS setup
+    syslog.syslog(syslog.LOG_INFO, 'Insert nfs and start service\n')
+    os.system('/sbin/insserv nfs')
+    # Register the node with the head node
+    res = registerNode()
+    if res == -1:
+        msg = 'Could not register the node. Manual registration on head node '
+        msg += 'required. (dhcp and one)\n'
+        syslog.syslog(syslog.LOG_INFO, msg)
+        syslog.closelog()
+        sys.exit(1)
+    # Stop the network interface, will be started during service startup
+    os.system('/sbin/ifdown br0')
+    msg = 'Cloud node configuration completed with success.\n'
+    syslog.syslog(syslog.LOG_INFO, msg)
+    syslog.closelog()
+    # Stop the syslog service, will be started again during service startup
+    os.system('/etc/init.d/syslog stop &gt;&amp; /dev/null')
+
diff --git a/tools/burner/INSTALL b/doc/examples/extras/suse-12.1/suse-nebula-cloud/cloud_cloud/root/var/lib/firstboot
similarity index 100%
copy from tools/burner/INSTALL
copy to doc/examples/extras/suse-12.1/suse-nebula-cloud/cloud_cloud/root/var/lib/firstboot
diff --git a/doc/examples/suse-11.3/suse-xen-guest/config.sh b/doc/examples/extras/suse-12.1/suse-nebula-cloud/cloud_guest/config.sh
similarity index 63%
copy from doc/examples/suse-11.3/suse-xen-guest/config.sh
copy to doc/examples/extras/suse-12.1/suse-nebula-cloud/cloud_guest/config.sh
index 098002e..6dc8de5 100755
--- a/doc/examples/suse-11.3/suse-xen-guest/config.sh
+++ b/doc/examples/extras/suse-12.1/suse-nebula-cloud/cloud_guest/config.sh
@@ -3,9 +3,9 @@
 # FILE          : config.sh
 #----------------
 # PROJECT       : OpenSuSE KIWI Image System
-# COPYRIGHT     : (c) 2006 SUSE LINUX Products GmbH. All rights reserved
+# COPYRIGHT     : (c) 2011 SUSE LINUX Products GmbH. All rights reserved
 #               :
-# AUTHOR        : Marcus Schaefer &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/kiwi-devel">ms at suse.de</A>&gt;
+# AUTHOR        : Robert Schweikert
 #               :
 # BELONGS TO    : Operating System images
 #               :
@@ -41,12 +41,19 @@ suseInsertService sshd
 #======================================
 # SuSEconfig
 #--------------------------------------
-suseConfig
+baseUpdateSysConfig /etc/sysconfig/bootloader LOADER_LOCATION mbr
+baseUpdateSysConfig /etc/sysconfig/network/dhcp DHCLIENT_BIN dhclient
+# Disable IPv6
+baseUpdateSysConfig /etc/sysconfig/network/dhcp DHCLIENT6_BIN /bin/false
+echo &#226;&#128;&#156;alias net-pf-10 off&#226;&#128;&#157; &gt;&gt; /etc/modprobe.conf.local
+echo &#226;&#128;&#156;alias ipv6 off&#226;&#128;&#157; &gt;&gt; /etc/modprobe.conf.local
+sed -i &quot;s/#net.ipv6.conf.all.disable_ipv6 = 1/net.ipv6.conf.all.disable_ipv6 = 1&quot; /etc/sysctl.conf
 
-#======================================
-# clone runlevel 3 to 4
-#--------------------------------------
-suseCloneRunlevel 4
+echo &quot;option suse-nebula code 239 = ip-address;&quot; &gt;&gt; /etc/dhclient.conf
+echo &quot;require suse-nebula;&quot; &gt;&gt; /etc/dhclient.conf
+echo &quot;request suse-nebula;&quot; &gt;&gt; /etc/dhclient.conf
+
+suseConfig
 
 #======================================
 # Umount kernel filesystems
diff --git a/doc/examples/suse-12.1/suse-vm-guest/config.xml b/doc/examples/extras/suse-12.1/suse-nebula-cloud/cloud_guest/config.xml
similarity index 78%
copy from doc/examples/suse-12.1/suse-vm-guest/config.xml
copy to doc/examples/extras/suse-12.1/suse-nebula-cloud/cloud_guest/config.xml
index f0ffdf2..a9b88b3 100644
--- a/doc/examples/suse-12.1/suse-vm-guest/config.xml
+++ b/doc/examples/extras/suse-12.1/suse-nebula-cloud/cloud_guest/config.xml
@@ -1,18 +1,13 @@
 &lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
-
-&lt;image schemaversion=&quot;5.2&quot; name=&quot;suse-12.1-vm-guest&quot;&gt;
+&lt;image schemaversion=&quot;5.2&quot; name=&quot;suse-12.1-SUSENebula-guest&quot;&gt;
 	&lt;description type=&quot;system&quot;&gt;
-		&lt;author&gt;Marcus Sch&#195;&#164;fer&lt;/author&gt;
-		&lt;contact&gt;<A HREF="https://lists.berlios.de/mailman/listinfo/kiwi-devel">ms at novell.com</A>&lt;/contact&gt;
+		&lt;author&gt;Robert Schweikert&lt;/author&gt;
+		&lt;contact&gt;<A HREF="https://lists.berlios.de/mailman/listinfo/kiwi-devel">rschweikert at novell.com</A>&lt;/contact&gt;
 		&lt;specification&gt;openSUSE 12.1 virtual disk system&lt;/specification&gt;
 	&lt;/description&gt;
 	&lt;preferences&gt;
-		&lt;type image=&quot;vmx&quot; primary=&quot;true&quot; filesystem=&quot;ext4&quot; boot=&quot;vmxboot/suse-12.1&quot; format=&quot;vmdk&quot;&gt;
-			&lt;machine memory=&quot;512&quot;&gt;
-				&lt;vmdisk controller=&quot;ide&quot; id=&quot;0&quot;/&gt;
-			&lt;/machine&gt;
-		&lt;/type&gt;
-		&lt;version&gt;1.1.2&lt;/version&gt;
+		&lt;type image=&quot;vmx&quot; primary=&quot;true&quot; filesystem=&quot;ext4&quot; boot=&quot;vmxboot/suse-12.1&quot; format=&quot;qcow2&quot;/&gt;
+		&lt;version&gt;1.0.0&lt;/version&gt;
 		&lt;packagemanager&gt;zypper&lt;/packagemanager&gt;
 		&lt;rpm-check-signatures&gt;false&lt;/rpm-check-signatures&gt;
 		&lt;rpm-force&gt;true&lt;/rpm-force&gt;
@@ -30,10 +25,10 @@
 		&lt;package name=&quot;gfxboot-branding-openSUSE&quot; bootinclude=&quot;true&quot; bootdelete=&quot;true&quot;/&gt;
 		&lt;package name=&quot;kernel-default&quot;/&gt;
 		&lt;package name=&quot;ifplugd&quot;/&gt;
+        &lt;package name=&quot;iputils&quot;/&gt;
 		&lt;package name=&quot;vim&quot;/&gt;
 		&lt;opensusePattern name=&quot;base&quot;/&gt;
 	&lt;/packages&gt;
-	&lt;packages type=&quot;vmx&quot;/&gt;
 	&lt;packages type=&quot;bootstrap&quot;&gt;
 		&lt;package name=&quot;filesystem&quot;/&gt;
 		&lt;package name=&quot;glibc-locale&quot;/&gt;
diff --git a/doc/examples/suse-11.3/suse-vm-guest/root/etc/init.d/boot b/doc/examples/extras/suse-12.1/suse-nebula-cloud/cloud_guest/root/etc/init.d/boot
similarity index 99%
copy from doc/examples/suse-11.3/suse-vm-guest/root/etc/init.d/boot
copy to doc/examples/extras/suse-12.1/suse-nebula-cloud/cloud_guest/root/etc/init.d/boot
index 37c97f5..40f3352 100755
--- a/doc/examples/suse-11.3/suse-vm-guest/root/etc/init.d/boot
+++ b/doc/examples/extras/suse-12.1/suse-nebula-cloud/cloud_guest/root/etc/init.d/boot
@@ -308,7 +308,6 @@ if test -f /var/lib/YaST2/runme_at_boot ; then
 	rm -f /var/lib/YaST2/runme_at_boot
     fi
 fi
-# trigger firstboot mechanism if configured
 if test -f /var/lib/YaST2/reconfig_system ; then
     HOSTTYPE=$(uname -m)
     splashtrigger &quot;YaST&quot;
diff --git a/doc/examples/suse-11.3/suse-ec2-guest/root/etc/sysconfig/network/ifcfg-eth0 b/doc/examples/extras/suse-12.1/suse-nebula-cloud/cloud_guest/root/etc/sysconfig/network/ifcfg-eth0
similarity index 100%
copy from doc/examples/suse-11.3/suse-ec2-guest/root/etc/sysconfig/network/ifcfg-eth0
copy to doc/examples/extras/suse-12.1/suse-nebula-cloud/cloud_guest/root/etc/sysconfig/network/ifcfg-eth0
diff --git a/doc/examples/suse-11.3/suse-xen-guest/config.sh b/doc/examples/extras/suse-12.1/suse-nebula-cloud/cloud_head/config.sh
similarity index 66%
copy from doc/examples/suse-11.3/suse-xen-guest/config.sh
copy to doc/examples/extras/suse-12.1/suse-nebula-cloud/cloud_head/config.sh
index 098002e..6202091 100755
--- a/doc/examples/suse-11.3/suse-xen-guest/config.sh
+++ b/doc/examples/extras/suse-12.1/suse-nebula-cloud/cloud_head/config.sh
@@ -5,12 +5,12 @@
 # PROJECT       : OpenSuSE KIWI Image System
 # COPYRIGHT     : (c) 2006 SUSE LINUX Products GmbH. All rights reserved
 #               :
-# AUTHOR        : Marcus Schaefer &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/kiwi-devel">ms at suse.de</A>&gt;
+# AUTHOR        : Robert Scwheikert &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/kiwi-devel">rschweikert at novell.com</A>&gt;
 #               :
 # BELONGS TO    : Operating System images
 #               :
 # DESCRIPTION   : configuration script for SUSE based
-#               : operating systems
+#               : OpenNebula cloud head node
 #               :
 #               :
 # STATUS        : BETA
@@ -36,17 +36,29 @@ suseSetupProduct
 #--------------------------------------
 suseActivateDefaultServices
 suseInsertService boot.device-mapper
+suseInsertService nfsserver
 suseInsertService sshd
 
 #======================================
 # SuSEconfig
 #--------------------------------------
+baseUpdateSysConfig /etc/sysconfig/firstboot FIRSTBOOT_WELCOME_DIR /usr/share/susenebula
+# Disable IPv6
+echo &#226;&#128;&#156;alias net-pf-10 off&#226;&#128;&#157; &gt;&gt; /etc/modprobe.conf.local
+echo &#226;&#128;&#156;alias ipv6 off&#226;&#128;&#157; &gt;&gt; /etc/modprobe.conf.local
 suseConfig
 
 #======================================
-# clone runlevel 3 to 4
+# Cloud specific settings
 #--------------------------------------
-suseCloneRunlevel 4
+# Directory for authentication file must exist such that YaST module can
+# write the file
+mkdir /var/lib/one/.one
+# Set he desired permissions
+chown oneadmin:cloud /var/lib/one
+chown -R oneadmin:cloud /var/lib/one
+# The permissions for the testcase
+chown -R oneadmin:cloud /home/ctester
 
 #======================================
 # Umount kernel filesystems
diff --git a/doc/examples/extras/suse-12.1/suse-nebula-cloud/cloud_head/config.xml b/doc/examples/extras/suse-12.1/suse-nebula-cloud/cloud_head/config.xml
new file mode 100644
index 0000000..51b3f2f
--- /dev/null
+++ b/doc/examples/extras/suse-12.1/suse-nebula-cloud/cloud_head/config.xml
@@ -0,0 +1,72 @@
+&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
+&lt;image schemaversion=&quot;5.2&quot; name=&quot;suse-12.1-OpenNebula-Head-Node&quot;&gt;
+	&lt;description type=&quot;system&quot;&gt;
+		&lt;author&gt;Robert Schweikert&lt;/author&gt;
+		&lt;contact&gt;<A HREF="https://lists.berlios.de/mailman/listinfo/kiwi-devel">rschweikert at novell.com</A>&lt;/contact&gt;
+		&lt;specification&gt;OpenNebula Head Node&lt;/specification&gt;
+    &lt;/description&gt;
+    &lt;preferences&gt;
+        &lt;type image=&quot;oem&quot; filesystem=&quot;ext3&quot; boot=&quot;oemboot/suse-12.1&quot; installstick=&quot;true&quot; installboot=&quot;install&quot; boottimeout=&quot;2&quot;&gt;
+			&lt;oemconfig&gt;
+				&lt;oem-boot-title&gt;OpenNebula Head Node&lt;/oem-boot-title&gt;
+				&lt;oem-shutdown&gt;true&lt;/oem-shutdown&gt;
+				&lt;oem-swap&gt;true&lt;/oem-swap&gt;
+				&lt;oem-swapsize&gt;2048&lt;/oem-swapsize&gt;
+                &lt;oem-unattended&gt;true&lt;/oem-unattended&gt;
+			&lt;/oemconfig&gt;
+		&lt;/type&gt;
+		&lt;version&gt;1.1.0&lt;/version&gt;
+		&lt;packagemanager&gt;zypper&lt;/packagemanager&gt;
+		&lt;rpm-check-signatures&gt;false&lt;/rpm-check-signatures&gt;
+		&lt;rpm-force&gt;true&lt;/rpm-force&gt;
+		&lt;locale&gt;en_US&lt;/locale&gt;
+		&lt;keytable&gt;us.map.gz&lt;/keytable&gt;
+	&lt;/preferences&gt;
+	&lt;users group=&quot;root&quot;&gt;
+		&lt;user pwd=&quot;cloudDemo&quot; pwdformat=&quot;plain&quot; home=&quot;/root&quot; name=&quot;root&quot;/&gt;
+	&lt;/users&gt;
+	&lt;repository type=&quot;yast2&quot;&gt;
+		&lt;source path=&quot;<A HREF="opensuse://12.1/repo/oss/">opensuse://12.1/repo/oss/</A>&quot;/&gt;
+	&lt;/repository&gt;
+    &lt;repository type=&quot;rpm-md&quot;&gt;
+        &lt;source path=&quot;<A HREF="http://download.opensuse.org/repositories/Virtualization:/Cloud:/OpenNebula/openSUSE_12.1">http://download.opensuse.org/repositories/Virtualization:/Cloud:/OpenNebula/openSUSE_12.1</A>&quot;/&gt;
+    &lt;/repository&gt;
+    &lt;repository type=&quot;rpm-md&quot;&gt;
+        &lt;source path=&quot;<A HREF="opensuse://12.1/repo/oss/suse/">opensuse://12.1/repo/oss/suse/</A>&quot;/&gt;
+    &lt;/repository&gt;
+	&lt;packages type=&quot;image&quot; patternType=&quot;plusRecommended&quot;&gt;
+		&lt;opensusePattern name=&quot;base&quot;/&gt;
+		&lt;package name=&quot;bootsplash&quot;/&gt;
+        &lt;package name=&quot;bootsplash-branding-openSUSE&quot; bootinclude=&quot;true&quot; bootdelete=&quot;true&quot;/&gt;
+		&lt;package name=&quot;bridge-utils&quot;/&gt;
+		&lt;package name=&quot;dhcp-server&quot;/&gt;
+        &lt;package name=&quot;gfxboot-branding-openSUSE&quot; bootinclude=&quot;true&quot; bootdelete=&quot;true&quot;/&gt;
+		&lt;package name=&quot;ifplugd&quot;/&gt;
+		&lt;package name=&quot;iptables&quot;/&gt;
+		&lt;package name=&quot;iputils&quot;/&gt;
+		&lt;package name=&quot;kernel-default&quot;/&gt;
+        &lt;package name=&quot;nfs-kernel-server&quot;/&gt;
+        &lt;package name=&quot;opennebula&quot;/&gt;
+        &lt;package name=&quot;openssh&quot;/&gt;
+        &lt;package name=&quot;openssl&quot;/&gt;
+        &lt;package name=&quot;python&quot;/&gt;
+		&lt;package name=&quot;rsyslog&quot;/&gt;
+        &lt;package name=&quot;ruby&quot;/&gt;
+        &lt;package name=&quot;rubygems&quot;/&gt;
+        &lt;package name=&quot;rubygem-libxml-ruby&quot;/&gt;
+        &lt;package name=&quot;rubygem-nokogiri&quot;/&gt;
+        &lt;package name=&quot;sqlite3&quot;/&gt;
+        &lt;package name=&quot;sudo&quot;/&gt;
+        &lt;package name=&quot;terminfo&quot;/&gt;
+		&lt;package name=&quot;vi&quot;/&gt;
+        &lt;package name=&quot;xmlrpc-c&quot;/&gt;
+        &lt;package name=&quot;yast2-dhcp-server&quot;/&gt;
+        &lt;package name=&quot;yast2-firstboot&quot;/&gt;
+        &lt;package name=&quot;yast2-network&quot;/&gt;
+        &lt;package name=&quot;yast2-nfs-server&quot;/&gt;
+	&lt;/packages&gt;
+	&lt;packages type=&quot;bootstrap&quot;&gt;
+		&lt;package name=&quot;filesystem&quot;/&gt;
+		&lt;package name=&quot;glibc-locale&quot;/&gt;
+	&lt;/packages&gt;
+&lt;/image&gt;
diff --git a/doc/examples/extras/suse-12.1/suse-nebula-cloud/cloud_head/root/etc/YaST2/firstboot.xml b/doc/examples/extras/suse-12.1/suse-nebula-cloud/cloud_head/root/etc/YaST2/firstboot.xml
new file mode 100644
index 0000000..4d3a60b
--- /dev/null
+++ b/doc/examples/extras/suse-12.1/suse-nebula-cloud/cloud_head/root/etc/YaST2/firstboot.xml
@@ -0,0 +1,65 @@
+&lt;?xml version=&quot;1.0&quot;?&gt;
+&lt;productDefines  xmlns=&quot;<A HREF="http://www.suse.com/1.0/yast2ns">http://www.suse.com/1.0/yast2ns</A>&quot;
+    xmlns:config=&quot;<A HREF="http://www.suse.com/1.0/configns">http://www.suse.com/1.0/configns</A>&quot;&gt;
+
+    &lt;textdomain&gt;firstboot&lt;/textdomain&gt;
+
+    &lt;workflows  config:type=&quot;list&quot;&gt;
+        &lt;workflow&gt;
+            &lt;defaults&gt;
+                &lt;enable_back&gt;yes&lt;/enable_back&gt;
+                &lt;enable_next&gt;yes&lt;/enable_next&gt;
+                &lt;archs&gt;all&lt;/archs&gt;
+            &lt;/defaults&gt;
+            &lt;stage&gt;firstboot&lt;/stage&gt;
+            &lt;label&gt;Configuration&lt;/label&gt;
+            &lt;mode&gt;installation&lt;/mode&gt;
+            &lt;modules  config:type=&quot;list&quot;&gt;
+
+                &lt;module&gt;
+                    &lt;label&gt;Welcome&lt;/label&gt;
+                    &lt;name&gt;firstboot_welcome&lt;/name&gt;
+                &lt;/module&gt;
+                &lt;module&gt;
+                    &lt;label&gt;License Agreements&lt;/label&gt;
+                    &lt;enabled config:type=&quot;boolean&quot;&gt;true&lt;/enabled&gt;
+                    &lt;name&gt;firstboot_licenses&lt;/name&gt;
+                &lt;/module&gt;
+                &lt;module&gt;
+                    &lt;label&gt;Keyboard Layout&lt;/label&gt;
+                    &lt;enabled config:type=&quot;boolean&quot;&gt;true&lt;/enabled&gt;
+                    &lt;name&gt;firstboot_keyboard&lt;/name&gt;
+                &lt;/module&gt;
+                &lt;module&gt;
+                    &lt;label&gt;Time and Date&lt;/label&gt;
+                    &lt;enabled config:type=&quot;boolean&quot;&gt;true&lt;/enabled&gt;
+                    &lt;name&gt;firstboot_timezone&lt;/name&gt;
+                &lt;/module&gt;
+                &lt;module&gt;
+                    &lt;label&gt;Root Password&lt;/label&gt;
+                    &lt;enabled config:type=&quot;boolean&quot;&gt;true&lt;/enabled&gt;
+                    &lt;name&gt;inst_root&lt;/name&gt;
+                &lt;/module&gt;
+                &lt;module&gt;
+                    &lt;label&gt;Cloud Configuration&lt;/label&gt;
+                    &lt;enabled config:type=&quot;boolean&quot;&gt;true&lt;/enabled&gt;
+                    &lt;name&gt;opennebula&lt;/name&gt;
+                &lt;/module&gt;
+                &lt;module&gt;
+                    &lt;label&gt;Finish Setup&lt;/label&gt;
+                    &lt;name&gt;firstboot_write&lt;/name&gt;
+                    &lt;enable_back&gt;no&lt;/enable_back&gt;
+                    &lt;enable_next&gt;no&lt;/enable_next&gt;
+                &lt;/module&gt;
+                &lt;module&gt;
+                    &lt;label&gt;Finish Setup&lt;/label&gt;
+                    &lt;name&gt;inst_suseconfig&lt;/name&gt;
+                    &lt;enable_back&gt;no&lt;/enable_back&gt;
+                    &lt;enable_next&gt;no&lt;/enable_next&gt;
+                &lt;/module&gt;
+
+            &lt;/modules&gt;
+        &lt;/workflow&gt;
+    &lt;/workflows&gt;
+&lt;/productDefines&gt;
+
diff --git a/doc/examples/extras/suse-12.1/suse-nebula-cloud/cloud_head/root/etc/exports b/doc/examples/extras/suse-12.1/suse-nebula-cloud/cloud_head/root/etc/exports
new file mode 100644
index 0000000..8fec075
--- /dev/null
+++ b/doc/examples/extras/suse-12.1/suse-nebula-cloud/cloud_head/root/etc/exports
@@ -0,0 +1 @@
+/var/lib/one *(no_subtree_check,rw,root_squash,sync)
diff --git a/doc/examples/extras/suse-12.1/suse-nebula-cloud/cloud_head/root/etc/init.d/cloudinfo b/doc/examples/extras/suse-12.1/suse-nebula-cloud/cloud_head/root/etc/init.d/cloudinfo
new file mode 100755
index 0000000..c43dc01
--- /dev/null
+++ b/doc/examples/extras/suse-12.1/suse-nebula-cloud/cloud_head/root/etc/init.d/cloudinfo
@@ -0,0 +1,64 @@
+#! /bin/sh
+# Copyright (c) 2011 SUSE
+# All rights reserved.
+#
+# Author: Robert Schweikert
+#
+# /etc/init.d/cloudinfo
+#
+### BEGIN INIT INFO
+# Provides:       cloudinfo
+# Required-Start: $remote_fs $syslog network
+# Required-Stop:  $remote_fs $syslog
+# Default-Start:  3 5
+# Default-Stop:   0 1 2 6
+# Short-Description: Information service for cloud nodes
+# Description: Information service to allow cloud nodes to configure themselves
+### END INIT INFO
+
+# First reset status of this service
+. /etc/rc.status
+rc_reset
+
+# Return values acc. to LSB for all commands but status:
+# 0 - success
+# 1 - generic or unspecified error
+# 2 - invalid or excess argument(s)
+# 3 - unimplemented feature (e.g. &quot;reload&quot;)
+# 4 - insufficient privilege
+# 5 - program is not installed
+# 6 - program is not configured
+# 7 - program is not running
+
+SERVICE_BIN=&quot;/sbin/suseNebulaConfSrv&quot;
+SERVICE_PID=&quot;${CHROOT_PREFIX}/var/run/suseNebula/infoSrv.pid&quot;
+
+case &quot;$1&quot; in
+  start)
+    echo -n &quot;Starting cloud info service: &quot;
+    $SERVICE_BIN &amp;
+    rc_status -v
+  ;;
+  stop)
+    echo -n &quot;Stopping cloud info service: &quot;
+    pid=`cat ${SERVICE_PID}`
+    kill -TERM $pid
+    #killproc does not work, it insists that $SERVICE_BIN does not exist
+    # Suspect this has something to do with it being python
+    #killproc -p ${SERVICE_PID} -TERM $SERVICE_BIN
+    # Remember status and be quiet
+    rc_status -v
+  ;;
+  restart)
+    $0 stop
+    $0 start $2
+    rc_status
+  ;;
+  *)
+    echo &quot;Usage: $0 {start|stop|restart}&quot;
+    exit 1
+  ;;
+esac
+rc_exit
+
+
diff --git a/doc/examples/extras/suse-12.1/suse-nebula-cloud/cloud_head/root/etc/init.d/noderegistrar b/doc/examples/extras/suse-12.1/suse-nebula-cloud/cloud_head/root/etc/init.d/noderegistrar
new file mode 100755
index 0000000..b2ecaca
--- /dev/null
+++ b/doc/examples/extras/suse-12.1/suse-nebula-cloud/cloud_head/root/etc/init.d/noderegistrar
@@ -0,0 +1,66 @@
+#! /bin/sh
+# Copyright (c) 2011 SUSE
+# All rights reserved.
+#
+# Author: Robert Schweikert
+#
+# /etc/init.d/noderegistrar
+#
+### BEGIN INIT INFO
+# Provides:       noderegistrar
+# Required-Start: $remote_fs $syslog network
+# Required-Stop:  $remote_fs $syslog
+# Should-Start:   cloudinfo
+# Default-Start:  3 5
+# Default-Stop:   0 1 2 6
+# Short-Description: Registration service for cloud nodes
+# Description: Registration service to allow cloud nodes to 
+#              register themselves with the head node
+### END INIT INFO
+
+# First reset status of this service
+. /etc/rc.status
+rc_reset
+
+# Return values acc. to LSB for all commands but status:
+# 0 - success
+# 1 - generic or unspecified error
+# 2 - invalid or excess argument(s)
+# 3 - unimplemented feature (e.g. &quot;reload&quot;)
+# 4 - insufficient privilege
+# 5 - program is not installed
+# 6 - program is not configured
+# 7 - program is not running
+
+SERVICE_BIN=&quot;/sbin/suseNebulaRegSrv&quot;
+SERVICE_PID=&quot;${CHROOT_PREFIX}/var/run/suseNebula/regSrv.pid&quot;
+
+case &quot;$1&quot; in
+  start)
+    echo -n &quot;Starting cloud info service: &quot;
+    $SERVICE_BIN &amp;
+    rc_status -v
+  ;;
+  stop)
+    echo -n &quot;Stopping cloud info service: &quot;
+    pid=`cat ${SERVICE_PID}`
+    kill -TERM $pid
+    #killproc does not work, it insists that $SERVICE_BIN does not exist
+    # Suspect this has something to do with it being python
+    #killproc -p ${SERVICE_PID} -TERM $SERVICE_BIN
+    # Remember status and be quiet
+    rc_status -v
+  ;;
+  restart)
+    $0 stop
+    $0 start $2
+    rc_status
+  ;;
+  *)
+    echo &quot;Usage: $0 {start|stop|restart}&quot;
+    exit 1
+  ;;
+esac
+rc_exit
+
+
diff --git a/doc/examples/extras/suse-12.1/suse-nebula-cloud/cloud_head/root/home/ctester/startTestVM b/doc/examples/extras/suse-12.1/suse-nebula-cloud/cloud_head/root/home/ctester/startTestVM
new file mode 100755
index 0000000..7551d9c
--- /dev/null
+++ b/doc/examples/extras/suse-12.1/suse-nebula-cloud/cloud_head/root/home/ctester/startTestVM
@@ -0,0 +1,9 @@
+#!/bin/bash
+
+# Author   : Robert Schweikert
+# License  : GPLv2
+# Copyright: 2011 SUSE
+
+export ONE_AUTH=/var/lib/one/.one/one_auth
+/usr/bin/oneimage register testVM.one
+/usr/bin/onevm create testVM.vmd
diff --git a/doc/examples/extras/suse-12.1/suse-nebula-cloud/cloud_head/root/home/ctester/testVM.README b/doc/examples/extras/suse-12.1/suse-nebula-cloud/cloud_head/root/home/ctester/testVM.README
new file mode 100644
index 0000000..d36dece
--- /dev/null
+++ b/doc/examples/extras/suse-12.1/suse-nebula-cloud/cloud_head/root/home/ctester/testVM.README
@@ -0,0 +1,31 @@
+The startTestVM script is expected to be executed only once. It's sole purpose
+is to facilitate easy and quick verification that the images built using the
+OBS OpenNebula packages work as intended. The working condition is defined as:
+    - generated guest image can be registered
+    - registered image can be started
+   - it is possible to log into the running image (manual action)
+The script should only be run on initial setup of the cloud after the head
+node and at least one cloud node have been set up.
+
+Prior to executing the startTestVM script:
+- verify there is a registered host
+  # sudo -u oneadmin env ONE_AUTH=/var/lib/one/.one/one_auth onehost list
+- make sure you have an image that matches the output of 
+  # grep PATH testVM.one
+
+Then run the script as the oneadmin user
+
+# sudo -u oneadmin ./startTestVM
+
+Once the VM is up and running you can verify it's functionality by using
+vncviewer on a machine running X as follows:
+
+-&gt; vncviewer IP_ADDRESS_OF_CLOUD_NODE:5905
+
+The IP_ADDRESS_OF_CLOUD_NODE is shown by the `onevm list` command executed on
+the head node
+
+# sudo -u oneadmin env ONE_AUTH=/var/lib/one/.one/one_auth onevm list
+
+
+
diff --git a/doc/examples/extras/suse-12.1/suse-nebula-cloud/cloud_head/root/home/ctester/testVM.one b/doc/examples/extras/suse-12.1/suse-nebula-cloud/cloud_head/root/home/ctester/testVM.one
new file mode 100644
index 0000000..854ca69
--- /dev/null
+++ b/doc/examples/extras/suse-12.1/suse-nebula-cloud/cloud_head/root/home/ctester/testVM.one
@@ -0,0 +1,5 @@
+NAME = &quot;openSUSE test image&quot;
+PATH = &quot;/home/ctester/suse-12.1-SUSENebula-guest.x86_64-1.0.0.qcow2&quot;
+PUBLIC = YES
+DESCRIPTION = &quot;A test image to test the basic functionality of the openSUSE based OpenNebula setup&quot;
+
diff --git a/doc/examples/extras/suse-12.1/suse-nebula-cloud/cloud_head/root/home/ctester/testVM.vmd b/doc/examples/extras/suse-12.1/suse-nebula-cloud/cloud_head/root/home/ctester/testVM.vmd
new file mode 100644
index 0000000..b8b3d0c
--- /dev/null
+++ b/doc/examples/extras/suse-12.1/suse-nebula-cloud/cloud_head/root/home/ctester/testVM.vmd
@@ -0,0 +1,17 @@
+NAME   = suse-test
+MEMORY = 512
+CPU    = 1
+
+OS     = [ ARCH = x86_64,
+           BOOT = hd,
+           ROOT = sda1 ]
+
+DISK   = [ IMAGE_ID  = 0,
+           DRIVER    = qcow2 ]
+
+NIC    = [ MAC = &quot;00:16:3e:7e:18:26&quot;,
+           BRIDGE = br0 ]
+
+GRAPHICS = [ TYPE   = &quot;vnc&quot;,
+             LISTEN = &quot;0.0.0.0&quot;,
+             PORT   = &quot;5905&quot; ]
diff --git a/doc/examples/extras/suse-12.1/suse-nebula-cloud/cloud_head/root/sbin/suseNebulaConfSrv b/doc/examples/extras/suse-12.1/suse-nebula-cloud/cloud_head/root/sbin/suseNebulaConfSrv
new file mode 100755
index 0000000..dc19017
--- /dev/null
+++ b/doc/examples/extras/suse-12.1/suse-nebula-cloud/cloud_head/root/sbin/suseNebulaConfSrv
@@ -0,0 +1,185 @@
+#!/usr/bin/python
+
+&quot;&quot;&quot;SUSENebula configuration service.&quot;&quot;&quot;
+
+# Author: Robert Schweikert
+# License: GPL v2
+# Copyright: SUSE
+
+import SocketServer
+import os
+import re
+import signal
+import sys
+import syslog
+
+ipPattern = r'\d{1,3}?\.\d{1,3}?\.\d{1,3}?\.\d{1,3}?'
+ipPat = re.compile(ipPattern)
+
+base = r'\d{0,2}?[A-F]{0,2}?:'
+macPattern = 5*base + r'\d{0,2}?[A-F]{0,2}?'
+macPat = re.compile(macPattern)
+
+#---------------------------------------------------------------------------
+class CloudConfigService(SocketServer.StreamRequestHandler):
+    &quot;&quot;&quot;Cloud head node information provider.&quot;&quot;&quot;
+    def __init__(self, request, client_address, server):
+        self.srvInfo = {}
+        # Collect the information we want to make propagate to the cloud node
+        # Keyboard layout
+        os.system('/sbin/yast2 keyboard summary &gt;&amp; /tmp/.kdb.info')
+        info = open('/tmp/.kdb.info', 'r').read()
+        os.remove('/tmp/.kdb.info')
+        self.srvInfo['keyLayout'] = info.split(':')[-1].strip()
+        # Timezone and HW clock setting (assume HW clock on nodes is set the
+        # same by default
+        os.system('/sbin/yast2 timezone summary &gt;&amp; /tmp/.tz.info')
+        info = open('/tmp/.tz.info', 'r').readlines()
+        os.remove('/tmp/.tz.info')
+        timezone = None
+        hwClockSet = None
+        for ln in info:
+            if ln.find('Current Time Zone') != -1:
+                timezone = ln.split(':')[-1].strip()
+            if ln.find('Hardware Clock') != -1:
+                hwClockSet = ln.split(':')[-1].strip()
+        self.srvInfo['timezone'] = timezone
+        self.srvInfo['hwclock'] = hwClockSet 
+        # Root passwd
+        lines = open('/etc/shadow', 'r').readlines()
+        passWd = None
+        for ln in lines:
+            if ln[0:4] == 'root':
+                passWd = ln.split(':')[1]
+        self.srvInfo['rootpass'] = passWd
+        # IP address
+        lines = open('/etc/sysconfig/network/ifcfg-br0', 'r').readlines()
+        ipAddr = None
+        for ln in lines:
+            if ln[0:7] == 'IPADDR=':
+                # [1:] at end removes leading quote
+                ipAddr = ln.split('=')[-1].split('/')[0].strip()[1:]
+        self.srvInfo['serverIP'] = ipAddr
+        # DHCP feature identifier
+        lines = open('/etc/dhcpd.conf','r').readlines()
+        dhcpFeature = None
+        domainname = None
+        for ln in lines:
+            if ln.find('domain-name') != -1:
+                # [1:-2] remove leading and trailing quotes and ; 
+                domainname = ln.split()[-1].strip()[1:-2]
+            # 239 is the assigned ID for the feature, hard coded in the YaST
+            # configuration module
+            if ln.find('code 239') != -1:
+                dhcpFeature = ln.split()[1].strip()
+        self.srvInfo['dhcpFeature'] = dhcpFeature
+        self.srvInfo['domainname'] = domainname
+        # Name resolution
+        self.srvInfo['resolve'] = open('/etc/resolv.conf', 'r').read()
+        # The configured routes
+        routes = open('/etc/sysconfig/network/routes', 'r').read()
+        self.srvInfo['routes'] = routes
+        # The one use ID
+        lines = open('/etc/passwd', 'r').readlines()
+        for ln in lines:
+            if ln.find('oneadmin') != -1:
+                self.srvInfo['userID'] = ('oneadmin', ln.split(':')[2],
+                                          ln.split(':')[1])
+                break
+        # The cloud group ID
+        lines = open('/etc/group', 'r').readlines()
+        for ln in lines:
+            if ln.find('cloud') != -1:
+                self.srvInfo['groupID'] = ('cloud', ln.split(':')[2])
+                break
+        SocketServer.StreamRequestHandler.__init__(self, request,
+                                                   client_address, server)
+        
+    #----------------------------------------------------------------------
+    def generateHostName(self):
+        &quot;&quot;&quot;Generate a new host name&quot;&quot;&quot;
+        # Create a host name for the host requesting the information
+        while (os.path.exists('/var/lock/nebula-hostname.lock')):
+            # We have to wait another cloud node is being configured
+            pass
+        os.system('touch /var/lock/nebula-hostname.lock')
+        cntr = None
+        if not os.path.exists('/var/lib/one/.nodecnt'):
+            cntr = 1
+            cntFl = open('/var/lib/one/.nodecnt', 'w')
+            cntFl.write('%d' %cntr)
+            cntFl.close()
+        if not cntr:
+            cntr = open('/var/lib/one/.nodecnt', 'r').read()
+            cntr = eval(cntr)
+            cntr += 1
+            cntFl = open('/var/lib/one/.nodecnt', 'w')
+            cntFl.write('%d' %cntr)
+            cntFl.close()
+        hostname = self.srvInfo['dhcpFeature'] + '-%d' %cntr
+        os.remove('/var/lock/nebula-hostname.lock')
+        return hostname
+
+    #----------------------------------------------------------------------
+    def handle(self):
+        &quot;&quot;&quot;Handle the information request&quot;&quot;&quot;
+        requestType = self.request.recv(512).strip()
+        if requestType == 'PROVIDE_CONFIG':
+            syslog.openlog('[CLOUD_INFO_SRV]',syslog.LOG_PID,syslog.LOG_DAEMON)
+            syslog.syslog(syslog.LOG_INFO, 'Provide cloud config info\n')
+            self.srvInfo['hostname'] = self.generateHostName()
+            for key in self.srvInfo.keys():
+                # Send a key value pair for each entry
+                self.request.send('%s=%s;' %(key,self.srvInfo[key]))
+            self.request.send('COMPLETE=finished')
+        syslog.closelog()
+
+#---------------------------------------------------------------------------
+def sigHandler(signum, frame):
+    &quot;&quot;&quot;Signal handler for termination&quot;&quot;&quot;
+    syslog.openlog('[CLOUD_INFO_SRV]',syslog.LOG_PID,syslog.LOG_DAEMON)
+    syslog.syslog(syslog.LOG_INFO, 'Terminating server on signal: %d' %signum)
+    syslog.closelog()
+    if os.path.exists('/var/lock/nebula-hostname.lock'):
+        os.remove('/var/lock/nebula-hostname.lock')
+    os.remove('/var/run/suseNebula/infoSrv.pid')
+    sys.exit(0)
+
+#---------------------------------------------------------------------------
+if __name__ == &quot;__main__&quot;:
+    syslog.openlog('[CLOUD_INFO_SRV]', syslog.LOG_PID, syslog.LOG_DAEMON)
+    syslog.syslog(syslog.LOG_INFO, 'Cloud Info Server start\n')
+
+    # Consistency check for pid file
+    if not os.path.exists('/var/run/suseNebula'):
+        os.system('mkdir -p /var/run/suseNebula')
+    if os.path.exists('/var/run/suseNebula/infoSrv.pid'):
+        msg = 'Found pid file, another server is running, not starting a '
+        msg += 'new one.'
+        syslog.syslog(syslog.LOG_ERR, msg)
+        syslog.closelog()
+        sys.exit(1)
+   
+    server = SocketServer.TCPServer(('169.254.1.1',  8445), CloudConfigService)
+
+    if not server:
+        syslog.syslog(syslog.LOG_ERR, 'Could not create server, exiting\n')
+        syslog.closelog()
+        sys.exit(1)
+
+    # Write pid to a file
+    pid = os.getpid()
+    pidFl = open('/var/run/suseNebula/infoSrv.pid', 'w');
+    pidFl.write('%d\n' %pid)
+    pidFl.close()
+
+    # Register signal handler
+    signal.signal(signal.SIGHUP, sigHandler)
+    signal.signal(signal.SIGTERM, sigHandler)
+    signal.signal(signal.SIGINT, sigHandler)
+
+    # No additional message will be printed, close the log
+    syslog.syslog(syslog.LOG_INFO, 'Cloud Info Server running\n')
+    syslog.closelog()
+    server.serve_forever()
+    
diff --git a/doc/examples/extras/suse-12.1/suse-nebula-cloud/cloud_head/root/sbin/suseNebulaRegSrv b/doc/examples/extras/suse-12.1/suse-nebula-cloud/cloud_head/root/sbin/suseNebulaRegSrv
new file mode 100755
index 0000000..748afdb
--- /dev/null
+++ b/doc/examples/extras/suse-12.1/suse-nebula-cloud/cloud_head/root/sbin/suseNebulaRegSrv
@@ -0,0 +1,145 @@
+#!/usr/bin/python
+
+&quot;&quot;&quot;SUSENebula Node Registration Service.&quot;&quot;&quot;
+
+# Author: Robert Schweikert
+# License: GPL v2
+# Copyright: SUSE
+
+import SocketServer
+import os
+import re
+import signal
+import sys
+import syslog
+
+ipPattern = r'\d{1,3}?\.\d{1,3}?\.\d{1,3}?\.\d{1,3}?'
+ipPat = re.compile(ipPattern)
+
+base = r'\d{0,2}?[A-F]{0,2}?:'
+macPattern = 5*base + r'\d{0,2}?[A-F]{0,2}?'
+macPat = re.compile(macPattern)
+
+#------------------------------------------------------------------------------
+class RegistrationHandler(SocketServer.BaseRequestHandler):
+    &quot;&quot;&quot;Cloud head node registration request handler.&quot;&quot;&quot;
+    def handle(self):
+        syslog.openlog('[NOD_REG]',syslog.LOG_PID, syslog.LOG_DAEMON)
+        syslog.syslog(syslog.LOG_INFO, 'Cloud node registration\n')
+        # self.request is the TCP socket connected to the client
+        macAddr, ipAddr, name = self.request.recv(1024).strip().split(';')
+        # Verify proper MAC Address format
+        if not macPat.match(macAddr):
+            msg = 'Received improper data for MAC Address '
+            msg += macAddr
+            msg += ' -&gt; skip registration\n'
+            syslog.syslog(syslog.LOG_ERR, msg)
+            syslog.closelog()
+            return
+        # Verify the IP address format
+        if not ipPat.match(ipAddr):
+             msg = 'Received improper data for IP Adress '
+             msg += ipAddr
+             msg += ' -&gt; skip registration\n'
+             syslog.syslog(syslog.LOG_ERR, msg)
+             syslog.closelog()
+             return
+        syslog.syslog(syslog.LOG_INFO, 'MAC Address: %s\n' %macAddr)
+        syslog.syslog(syslog.LOG_INFO, 'IP Address: %s\n' %ipAddr)
+        syslog.syslog(syslog.LOG_INFO, 'Node name: %s\n' %name)
+        # Setup the dhcp server to make sure the node being registered
+        # always gets the same IP address
+        lines = open('/etc/dhcpd.conf', 'r').readlines()
+        processBlock = None
+        for ln in lines:
+            if ln.find(name) != -1:
+                processBlock = 1
+                continue
+            if processBlock and ln.find('fixed-address') != -1:
+                setIP = ln.split()[-1].strip()[:-1]
+                if setIP != ipAddr:
+                    msg = 'Host with name &quot;%s&quot; already registered with ' %name
+                    msg += 'IP &quot;%s&quot;. Cannot register node.\n' %ipAddr
+                    syslog.syslog(syslog.LOG_INFO, msg)
+                    syslog.closelog()
+                    return
+        dhconf = open('/etc/dhcpd.conf', 'a')
+        dhconf.write('\n')
+        dhconf.write('host %s {\n' %name)
+        dhconf.write('    hardware ethernet %s;\n' %macAddr)
+        dhconf.write('    fixed-address %s;\n' %ipAddr)
+        dhconf.write('}\n')
+        dhconf.close()
+        # Restart the dhcp server as we just change the config
+        os.system('/etc/init.d/dhcpd restart  &gt;&amp; /dev/null')
+        # Create hosts entry
+        hosts = open('/etc/hosts', 'a')
+        hosts.write('%s    %s\n' %(ipAddr, name))
+        hosts.close()
+        # Register node with Nebula infrastructure
+        cmd = '/usr/bin/sudo env ONE_AUTH=/var/lib/one/.one/one_auth '
+        cmd += '/usr/bin/onehost create %s im_kvm vmm_kvm tm_nfs' %ipAddr
+        res = os.system(cmd)
+        if res:
+            msg = 'Registration failed, onehost command with non zero status\n'
+            syslog.syslog(syslog.LOG_ERR, msg)
+            syslog.closelog()
+            return
+        syslog.syslog(syslog.LOG_ERR, 'Node registration succesful.\n')
+        syslog.closelog()
+
+#------------------------------------------------------------------------------
+def sigHandler(signum, frame):
+    &quot;&quot;&quot;Signal handler for termination&quot;&quot;&quot;
+    syslog.openlog('[NOD_REG]',syslog.LOG_PID,syslog.LOG_DAEMON)
+    syslog.syslog(syslog.LOG_INFO, 'Terminating server on signal: %d' %signum)
+    syslog.closelog()
+    os.remove('/var/run/suseNebula/regSrv.pid')
+    sys.exit(0)
+
+#------------------------------------------------------------------------------
+if __name__ == &quot;__main__&quot;:
+    syslog.openlog('[NOD_REG]', syslog.LOG_PID, syslog.LOG_DAEMON)
+    syslog.syslog(syslog.LOG_INFO, 'Start node registration service\n')
+    # Determine the IP address of this host
+    inetInfo = os.popen('/sbin/ifconfig').readlines()
+    ipAddr = None
+    # Use the first IPv4 address found
+    for item in inetInfo:
+        if item.find('inet addr') != -1:
+            # Extract the IP address from line expected in following format
+            # inet addr:192.168.1.6  Bcast:192.168.1.255  Mask:255.255.255.0
+            ipAddr = item.strip().split()[1].split(':')[-1]
+            if ipPat.match(ipAddr):
+                break
+
+    if not ipAddr:
+        # No IP address found. Print a message to syslog and exit
+        syslog.syslog(syslog.LOG_ERR,
+                      'Could not determine IP address, exiting\n')
+        syslog.closelog()
+        sys.exit(1)
+        
+    server = SocketServer.TCPServer((ipAddr, 8445), RegistrationHandler)
+
+    if not server:
+        syslog.syslog(syslog.LOG_ERR, 'Could not create server, exiting\n')
+        syslog.closelog()
+        sys.exit(1)
+
+    # Write pid to a file
+    pid = os.getpid()
+    pidFl = open('/var/run/suseNebula/regSrv.pid', 'w');
+    pidFl.write('%d\n' %pid)
+    pidFl.close()
+
+    # Register signal handler
+    signal.signal(signal.SIGHUP, sigHandler)
+    signal.signal(signal.SIGTERM, sigHandler)
+    signal.signal(signal.SIGINT, sigHandler)
+
+    # No additional message will be printed, close the log
+    syslog.syslog(syslog.LOG_INFO, 'Cloud registration service  running\n')
+    syslog.closelog()
+    server.serve_forever()
+        
diff --git a/doc/examples/extras/suse-12.1/suse-nebula-cloud/cloud_head/root/usr/share/YaST2/clients/opennebula.ycp b/doc/examples/extras/suse-12.1/suse-nebula-cloud/cloud_head/root/usr/share/YaST2/clients/opennebula.ycp
new file mode 100644
index 0000000..6d82817
--- /dev/null
+++ b/doc/examples/extras/suse-12.1/suse-nebula-cloud/cloud_head/root/usr/share/YaST2/clients/opennebula.ycp
@@ -0,0 +1,365 @@
+/**
+ * File:        clients/opennebula.ycp
+ * Package:     Configuration of OpenNebula CLoud head node
+ * Authors:     Jiri Suchomel &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/kiwi-devel">jsuchome at suse.cz</A>&gt;
+ *              Robert Scwheikert &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/kiwi-devel">rschweikert at novell.com</A>&gt;
+ *
+ * License:     GPL v2
+ *
+ */
+
+{
+    textdomain &quot;susenebula&quot;;
+ 
+    import &quot;FileUtils&quot;;
+    import &quot;Hostname&quot;;
+    import &quot;IP&quot;;
+    import &quot;Label&quot;;
+    import &quot;Mode&quot;;
+    import &quot;Netmask&quot;;
+    import &quot;Popup&quot;;
+    import &quot;Report&quot;;
+    import &quot;Service&quot;;
+    import &quot;Wizard&quot;;
+ 
+    import &quot;YaPI::NETWORK&quot;;
+ 
+    string hostname = &quot;SUSENebula-Head&quot;;
+    string domain   = &quot;&quot;;
+    string ip       = &quot;192.168.1.2&quot;;
+    string netmask  = &quot;255.255.255.0&quot;;
+    string ip_min   = &quot;&quot;;
+    string ip_max   = &quot;&quot;;
+    string clustername  = &quot;SUSENebula&quot;;
+    string route    = &quot;&quot;;
+    string cadminp  = &quot;susenebula&quot;;
+    list&lt;string&gt; nameservers  = [];
+    list&lt;string&gt; searchdomains    = [];
+ 
+    // network export map
+    map network     = $[];
+    // dhcp server export map
+    map dhcp        = $[];
+ 
+    // write entered settings to the system
+    boolean WriteSettings () {
+ 
+    // 1. Write Network
+    map&lt;string,any&gt; write_network = $[
+        &quot;hostname&quot;  : network[&quot;hostname&quot;]:$[],
+        &quot;dns&quot;   : network[&quot;dns&quot;]:$[],
+    ];
+ 
+    write_network[&quot;hostname&quot;,&quot;domain&quot;]  = domain;
+    write_network[&quot;hostname&quot;,&quot;name&quot;]    = hostname;
+ 
+    write_network[&quot;dns&quot;,&quot;nameservers&quot;]  = nameservers;
+    write_network[&quot;dns&quot;,&quot;searches&quot;]     = searchdomains;
+ 
+    write_network[&quot;route&quot;]  = $[
+        &quot;default&quot;   : $[
+        &quot;via&quot;   : route
+        ]
+    ];
+ 
+    map interface   = network[&quot;interfaces&quot;]:$[];
+ 
+    // ip r|grep default|cut -d' ' -f5
+    if (haskey (interface, &quot;eth0&quot;))
+    {
+        interface[&quot;eth0&quot;,&quot;bootproto&quot;]   = &quot;static&quot;;
+        interface[&quot;eth0&quot;,&quot;ipaddr&quot;]  = sformat (&quot;%1/%2&quot;, ip, Netmask::ToBits (netmask));
+        write_network[&quot;interface&quot;]  = interface;
+    }
+    y2internal (&quot;network to write: %1&quot;, write_network);
+    map network_written = YaPI::NETWORK::Write (write_network);
+ 
+    Service::Restart (&quot;network&quot;);
+ 
+    // 2. Write DHCP server DhcpServer: settings/directives/range
+    // Min/Max IP -&gt; set the IP address range for dhcp server.
+ 
+    // Read DhcpServer after network is configured
+    /*
+    DhcpServer::Read ();
+    dhcp    = DhcpServer::Export ();
+    y2internal (&quot;dhcp: %1&quot;, dhcp);
+    */
+ 
+    string subnet_ip    = IP::ComputeNetwork (ip, netmask);
+ 
+    dhcp[&quot;allowed_interfaces&quot;]  = [&quot;eth0&quot;];
+    dhcp[&quot;start_service&quot;]       = true;
+    dhcp[&quot;use_ldap&quot;]        = false;
+    dhcp[&quot;settings&quot;]        = [
+      $[
+        &quot;children&quot;      : [],
+        &quot;directives&quot;    : [
+        $[
+            &quot;key&quot;       : &quot;default-lease-time&quot;,
+            &quot;type&quot;      : &quot;directive&quot;,
+            &quot;value&quot;     : &quot;14400&quot;
+        ],
+        $[
+            &quot;key&quot;       : &quot;max-lease-time&quot;,
+            &quot;type&quot;      : &quot;directive&quot;,
+            &quot;value&quot;     : &quot;172800&quot;
+        ],
+        $[
+             &quot;key&quot;      : &quot;range&quot;,
+            &quot;type&quot;      : &quot;directive&quot;,
+            &quot;value&quot;     : sformat (&quot;%1 %2&quot;, ip_min, ip_max)
+        ]
+        ],
+        &quot;id&quot;        : sformat (&quot;%1 netmask %2&quot;, subnet_ip, netmask),
+        &quot;options&quot;       : [],
+        &quot;parent_id&quot;     : &quot;&quot;,
+        &quot;parent_type&quot;   : &quot;&quot;,
+        &quot;type&quot;      : &quot;subnet&quot;
+      ],
+      $[
+        &quot;children&quot;      : [
+        $[
+            &quot;id&quot;    : sformat (&quot;%1 netmask %2&quot;, subnet_ip, netmask),
+            &quot;type&quot;  : &quot;subnet&quot;
+        ]
+        ],
+        &quot;directives&quot;    : [
+        $[
+            &quot;key&quot;   : &quot;max-lease-time&quot;,
+            &quot;type&quot;  : &quot;directive&quot;,
+            &quot;value&quot; : &quot;7200&quot;
+        ],
+        $[
+            &quot;key&quot;   : &quot;ddns-updates&quot;,
+            &quot;type&quot;  : &quot;directive&quot;,
+            &quot;value&quot; : &quot;off&quot;
+        ],
+        $[
+            &quot;key&quot;   : &quot;ddns-update-style&quot;,
+            &quot;type&quot;  : &quot;directive&quot;,
+            &quot;value&quot; : &quot;none&quot;
+        ],
+        $[
+            &quot;key&quot;   : &quot;log-facility&quot;,
+            &quot;type&quot;  : &quot;directive&quot;,
+            &quot;value&quot; : &quot;local7&quot;
+        ],
+        $[
+            &quot;key&quot;   : &quot;default-lease-time&quot;,
+            &quot;type&quot;  : &quot;directive&quot;,
+            &quot;value&quot; : &quot;600&quot;
+        ],
+        ],
+        &quot;options&quot;   : [
+        $[
+            &quot;key&quot;   : &quot;suse-nebula&quot;,
+            &quot;type&quot;  : &quot;option&quot;,
+            &quot;value&quot; : &quot;code 239 = ip-address&quot;
+        ],
+        $[
+            &quot;key&quot;   : &quot;suse-nebula&quot;,
+            &quot;type&quot;  : &quot;option&quot;,
+            &quot;value&quot; : ip
+        ],
+        $[
+            &quot;key&quot;   : &quot;domain-name&quot;,
+            &quot;type&quot;  : &quot;option&quot;,
+            &quot;value&quot; : sformat (&quot;\&quot;%1\&quot;&quot;, domain),
+        ],
+        ],
+        &quot;id&quot;    :&quot;&quot;,
+        &quot;parent_id&quot;     : &quot;&quot;,
+        &quot;parent_type&quot;   : &quot;&quot;,
+        &quot;type&quot;      : &quot;&quot;
+      ]
+    ];
+    /*
+    y2internal (&quot;importing dhcp settings: %1&quot;, dhcp);
+    DhcpServer::Import (dhcp);
+    DhcpServer::Write ();
+    */
+ 
+    string dhcpd_conf   = sformat (
+&quot;option rfc3442-classless-static-routes code 121 = array of unsigned integer 8;
+option domain-name \&quot;%1\&quot;;
+max-lease-time 7200;
+# Custom option to identify this DHCP server as the cloud DHCP server
+# Define the new option
+option suse-nebula code 239 = ip-address;
+# Set the value
+option suse-nebula %2;
+# Set the address range to be handed out.
+subnet %3 netmask %4 {
+    range %5 %6;
+    default-lease-time 86400000;
+    max-lease-time 1728000000000;
+}&quot;, domain, ip, subnet_ip, netmask, ip_min, ip_max);
+ 
+    SCR::Write (.target.string, &quot;/etc/dhcpd.conf&quot;, dhcpd_conf);
+ 
+    SCR::Write (.sysconfig.dhcpd.DHCPD_INTERFACE, &quot;eth0&quot;);
+    SCR::Write (.sysconfig.dhcpd, nil);
+ 
+    Service::Enable (&quot;dhcpd&quot;);
+    Service::Start (&quot;dhcpd&quot;);
+
+    // 3. Write onedamin authentication file
+    string oneauth = sformat (&quot;oneadmin:%1&quot;, cadminp);
+    SCR::Write (.target.string, &quot;/var/lib/one/.one/one_auth&quot;, oneauth);
+ 
+	return true;
+    }
+ 
+    // initialize network data
+    boolean ReadNetworkSettings () {
+    network = YaPI::NETWORK::Read ();
+    y2internal (&quot;network: %1&quot;, network);
+    nameservers = network[&quot;dns&quot;,&quot;nameservers&quot;]:[];
+    searchdomains   = network[&quot;dns&quot;,&quot;searches&quot;]:[];
+    return true;
+    }
+ 
+    ReadNetworkSettings ();
+ 
+    term contents = `HBox (`HSpacing (1), `VBox (
+    `Frame (_(&quot;Network Configuration&quot;), `VBox (
+        // text entry label
+        `InputField (`id (&quot;clustername&quot;), `opt (`hstretch), _(&quot;C&amp;luster Name&quot;), clustername),
+        `HBox (
+        // text entry label
+        `InputField (`id (&quot;hostname&quot;), `opt (`hstretch), _(&quot;&amp;Hostname&quot;), hostname),
+        // text entry label
+        `InputField (`id (&quot;domain&quot;), `opt (`hstretch), _(&quot;&amp;Domain Name&quot;), domain)
+        ),
+        `HBox (
+        // text entry label
+        `InputField (`id (&quot;ip&quot;), `opt (`hstretch), _(&quot;&amp;IP Address&quot;), ip),
+        // text entry label
+        `InputField (`id (&quot;netmask&quot;), `opt (`hstretch), _(&quot;&amp;Netmask&quot;), netmask)
+        ),
+        // text entry label
+        `InputField (`id (&quot;route&quot;), `opt (`hstretch), _(&quot;Default Route&quot;), route),
+        `HBox (
+        // text entry label
+        `InputField (`id (&quot;nameservers&quot;), `opt (`hstretch), _(&quot;Name Servers&quot;), mergestring (nameservers, &quot; &quot;)),
+        // text entry label
+        `InputField (`id (&quot;searches&quot;), `opt (`hstretch), _(&quot;Search Domains&quot;), mergestring (searchdomains, &quot; &quot;))
+        )
+    )),
+    `VSpacing (2),
+    // frame label
+    `Frame (_(&quot;IP Address Range for Cloud Nodes&quot;), `HBox (
+        // text entry label
+        `InputField (`id (&quot;ip_min&quot;), `opt (`hstretch), _(&quot;Min IP Address&quot;), ip_min),
+        // text entry label
+        `InputField (`id (&quot;ip_max&quot;), `opt (`hstretch), _(&quot;Max IP Address&quot;), ip_max)
+    )),
+    `VSpacing (2),
+    // frame label
+    `Frame (_(&quot;Cloud Administrator&quot;), `VBox (
+        // text entry label
+        `InputField (`id (&quot;cadminp&quot;), `opt (`hstretch), _(&quot;Password for Cloud Administration&quot;), cadminp),
+        `VSpacing (1),
+        `Label (&quot;The password is stored in plain text in the file /var/lib/one/.one/one_auth and is used for cloud administration only.
+This is not the password for the cloud administrator (oneadmin) user account. The oneadmin account has no password.&quot;)
+    ))
+    ), `HSpacing (1));
+ 
+    if (Mode::normal ())
+    Wizard::OpenOKDialog ();
+ 
+    string help_text    = &quot;&quot;;
+ 
+    // dialog caption
+    Wizard::SetContents (_(&quot;SUSENebula&quot;), contents, help_text, true, true);
+ 
+    UI::ChangeWidget (`id (&quot;hostname&quot;), `ValidChars, Hostname::ValidChars);
+    foreach (string key, [&quot;ip&quot;, &quot;ip_min&quot;, &quot;ip_max&quot;], {
+    UI::ChangeWidget (`id (key), `ValidChars, IP::ValidChars4);
+    });
+    any ret = `back;
+    while (true)
+    {
+    ret = UI::UserInput ();
+    if (ret == `ok || ret == `next)
+    {
+        cadminp = (string) UI::QueryWidget (`id (&quot;cadminp&quot;), `Value);
+        clustername = (string) UI::QueryWidget (`id (&quot;clustername&quot;), `Value);
+        hostname    = (string) UI::QueryWidget (`id (&quot;hostname&quot;), `Value);
+        domain  = (string) UI::QueryWidget (`id (&quot;domain&quot;), `Value);
+        ip      = (string) UI::QueryWidget (`id (&quot;ip&quot;), `Value);
+        ip_min  = (string) UI::QueryWidget (`id (&quot;ip_min&quot;), `Value);
+        ip_max  = (string) UI::QueryWidget (`id (&quot;ip_max&quot;), `Value);
+        netmask = (string) UI::QueryWidget (`id (&quot;netmask&quot;), `Value);
+        route   = (string) UI::QueryWidget (`id (&quot;route&quot;), `Value);
+        string dns  = (string) UI::QueryWidget (`id (&quot;nameservers&quot;), `Value);
+        nameservers = splitstring (dns, &quot;, &quot;);
+        string searches = (string) UI::QueryWidget (`id (&quot;searches&quot;), `Value);
+        searchdomains = splitstring (searches, &quot;, &quot;);
+ 
+        if (!Hostname::Check (hostname))
+        {
+        Report::Error (Hostname::ValidHost ());
+        UI::SetFocus (`id (&quot;hostname&quot;));
+        continue;
+        }
+        if (!Hostname::CheckDomain (domain))
+        {
+        Report::Error (Hostname::ValidDomain ());
+        UI::SetFocus (`id (&quot;domain&quot;));
+        continue;
+        }
+        if (!IP::Check (ip))
+        {
+        Report::Error (IP::Valid4 ());
+        UI::SetFocus (`id (&quot;ip&quot;));
+        continue;
+        }
+        if (!IP::Check (ip_min))
+        {
+        Report::Error (IP::Valid4 ());
+        UI::SetFocus (`id (&quot;ip_min&quot;));
+        continue;
+        }
+        if (!IP::Check (ip_max))
+        {
+        Report::Error (IP::Valid4 ());
+        UI::SetFocus (`id (&quot;ip_max&quot;));
+        continue;
+        }
+ 
+        if (IP::ToInteger (ip_min) &lt;= IP::ToInteger (ip) &amp;&amp;
+        IP::ToInteger (ip) &lt;= IP::ToInteger (ip_max))
+        {
+        // error message
+        Report::Error (_(&quot;IP Address is within the IP range that should be offered by DHCP server.&quot;));
+        UI::SetFocus (`id (&quot;ip_min&quot;));
+        continue;
+        }
+ 
+        if (IP::ToInteger (ip_min) &gt; IP::ToInteger (ip_max))
+        {
+        // error message
+        Popup::Message(_(&quot;The lowest address must be lower than the highest one.&quot;));
+        UI::SetFocus (`id (&quot;ip_min&quot;));
+        continue;
+        }
+ 
+ 
+        WriteSettings ();
+        break;
+    }
+    if (ret == `cancel || ret == `abort)
+    {
+        break;
+    }
+    if (ret == `back)
+    {
+        break;
+    }
+    }
+    if (Mode::normal ())
+    Wizard::CloseDialog ();
+    return ret;
+}
diff --git a/doc/examples/extras/suse-12.1/suse-nebula-cloud/cloud_head/root/usr/share/firstboot/scripts/finalizeSetup b/doc/examples/extras/suse-12.1/suse-nebula-cloud/cloud_head/root/usr/share/firstboot/scripts/finalizeSetup
new file mode 100755
index 0000000..20a45bb
--- /dev/null
+++ b/doc/examples/extras/suse-12.1/suse-nebula-cloud/cloud_head/root/usr/share/firstboot/scripts/finalizeSetup
@@ -0,0 +1,92 @@
+#!/usr/bin/python
+
+# Author: Robert Schweikert
+# License: GPL v2
+# Copyright: SUSE
+
+import glob
+import os
+import sys
+import syslog
+
+# Only one interface should be configured at this point
+# check that this is indeed the case
+confFiles = glob.glob('/etc/sysconfig/network/ifcfg-eth*')
+numConfInterf = len(confFiles)
+if numConfInterf &gt; 1:
+    syslog.openlog('BR_SETUP]', syslog.LOG_PID, syslog.LOG_DAEMON)
+    syslog.syslog(syslog.LOG_INFO, 'Bridge setup\n')
+    msg = 'Multiple configured eth devices found, cannot resolve ambiguity\n'
+    syslog.syslog(syslog.LOG_ERR, msg)
+    syslog.closelog()
+    sys.exit(1)
+
+if numConfInterf &lt; 1:
+    syslog.openlog('BR_SETUP]', syslog.LOG_PID, syslog.LOG_DAEMON)
+    syslog.syslog(syslog.LOG_INFO, 'Bridge setup\n')
+    msg = 'No eth interface configured, cannot setup bridge\n'
+    syslog.syslog(syslog.LOG_ERR, msg)
+    syslog.closelog()
+    sys.exit(1)
+
+# Get the configured IP address (includes the subnet mask)
+interfConf = confFiles[0]
+interfaceName = interfConf.split('-')[-1]
+lines = open(interfConf, 'r').readlines()
+ipAddr = None
+for ln in lines:
+    if ln.find('IPADDR') != -1:
+        ipAddr = ln.strip().split('=')[-1]
+        break
+
+# Stop the running network services
+os.system('/etc/init.d/dhcpd stop &gt;&amp; /dev/null')
+os.system('/etc/init.d/nfsserver stop &gt;&amp; /dev/null')
+os.system('/sbin/ifdown %s &gt;&amp; /dev/null' %interfaceName)
+
+# Write the bridge configuration
+brCfg = open('/etc/sysconfig/network/ifcfg-br0', 'w')
+brCfg.write(&quot;BOOTPROTO='static'\n&quot;)
+brCfg.write(&quot;BRIDGE='yes'\n&quot;)
+brCfg.write(&quot;BRIDGE_PORTS='%s'\n&quot; %interfaceName)
+brCfg.write(&quot;BRIDGE_STP='off'\n&quot;)
+brCfg.write(&quot;BROADCAST=''\n&quot;)
+brCfg.write(&quot;ETHTOOL_OPTIONS=''\n&quot;)
+brCfg.write(&quot;IPADDR=%s\n&quot; %ipAddr)
+brCfg.write(&quot;MTU=''\n&quot;)
+brCfg.write(&quot;NAME=''\n&quot;)
+brCfg.write(&quot;NETWORK=''\n&quot;)
+brCfg.write(&quot;REMOTE_IPADDR=''\n&quot;)
+brCfg.write(&quot;STARTMODE='auto'\n&quot;)
+brCfg.write(&quot;USERCONTROL='no'\n&quot;)
+brCfg.write(&quot;IPADDR_0='169.254.1.1/24'\n&quot;)
+brCfg.write(&quot;LABEL_0='serviceport'\n&quot;)
+brCfg.close()
+
+# Server interface update
+lines = open('/etc/sysconfig/dhcpd', 'r').readlines()
+conf = open('/etc/sysconfig/dhcpd', 'w')
+for ln in lines:
+    if ln.find('DHCPD_INTERFACE') != -1:
+        conf.write('DHCPD_INTERFACE=&quot;br0&quot;\n')
+        continue
+    conf.write(ln)
+conf.close()
+                   
+# Run the configuration setup
+os.system('/sbin/SuSEconfig &gt;&amp; /dev/null')
+
+# Remove the old network configuration file
+os.remove(interfConf)
+
+# Insert the cloud information service and start it
+os.system('/sbin/insserv cloudinfo')
+# Insert the registration service and start it
+os.system('/sbin/insserv noderegistrar')
+# Proper permissions for the authentication file
+os.system('chown oneadmin:cloud /var/lib/one/.one/one_auth')
+# Start the cloud service
+# oned must be started with special environment setting the first time
+os.system('env ONE_AUTH=/var/lib/one/.one/one_auth /etc/init.d/one start &gt;&amp; /dev/null')
+os.system('/sbin/insserv one')
+os.system('/etc/init.d/one stop &gt;&amp; /dev/null')
diff --git a/doc/examples/extras/suse-12.1/suse-nebula-cloud/cloud_head/root/usr/share/susenebula/welcome.txt b/doc/examples/extras/suse-12.1/suse-nebula-cloud/cloud_head/root/usr/share/susenebula/welcome.txt
new file mode 100644
index 0000000..8af95e0
--- /dev/null
+++ b/doc/examples/extras/suse-12.1/suse-nebula-cloud/cloud_head/root/usr/share/susenebula/welcome.txt
@@ -0,0 +1,15 @@
+Welcome to SUSENebula
+
+The next few setup steps will guide you through the final configuration of the 
+Cloud Head node. After this is complete, your head node is ready for business.
+
+One note on security, this image contains pre-configured ssh keys that are
+available (including the private key) to the rest of the world. Therefore it
+is recommended that you generate new ssh keys for the oneadmin user. After the
+setup steps are complete, login as root (the oneadmin user has no password)
+and execute the following command:
+
+ssh-keygen -f /var/lib/one/.ssh/id_rsa
+
+Answer 'y' to over write the existing key. Do NOT enter a passphrase.
+
diff --git a/tools/burner/INSTALL b/doc/examples/extras/suse-12.1/suse-nebula-cloud/cloud_head/root/var/lib/YaST2/reconfig_system
similarity index 100%
copy from tools/burner/INSTALL
copy to doc/examples/extras/suse-12.1/suse-nebula-cloud/cloud_head/root/var/lib/YaST2/reconfig_system
diff --git a/doc/examples/extras/suse-12.1/suse-nebula-cloud/cloud_head/root/var/lib/one/.ssh/authorized_keys b/doc/examples/extras/suse-12.1/suse-nebula-cloud/cloud_head/root/var/lib/one/.ssh/authorized_keys
new file mode 100644
index 0000000..b00dfcd
--- /dev/null
+++ b/doc/examples/extras/suse-12.1/suse-nebula-cloud/cloud_head/root/var/lib/one/.ssh/authorized_keys
@@ -0,0 +1 @@
+ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDR2r8Y4l2dLfb4DFFD2UK0YxGOXdMJWm3XubVVnxuWKD7OTDpp7GVv0q7oaOlrRPb8q5cukSl5CSKn0YIseWiU9PMwcBOR7o7GXTl+r2NU16M47R/ys94Uy+OqS4172Z6m3uAJHb1MvU8BbIemcn9vWLteZBHViozQfMiifc3oE1StT8bUrJuj/AaoaPKS7OnmagJwIuyi+Ffk6LxjHWbEUfpou4Wa2xBFHP4IEclq5qYvKSDxhg4MCPW9rUw61W4hnA+JCkw6uWsoiu+jkOaQ4zgKvBkDUmf7FL4wTYeVTSClGXxny6gX/rjIfbCV+RggKDbNbLYltbB8HDp+ErGn <A HREF="https://lists.berlios.de/mailman/listinfo/kiwi-devel">oneadmin at linux</A>
diff --git a/doc/examples/extras/suse-12.1/suse-nebula-cloud/cloud_head/root/var/lib/one/.ssh/config b/doc/examples/extras/suse-12.1/suse-nebula-cloud/cloud_head/root/var/lib/one/.ssh/config
new file mode 100644
index 0000000..bc7cd5f
--- /dev/null
+++ b/doc/examples/extras/suse-12.1/suse-nebula-cloud/cloud_head/root/var/lib/one/.ssh/config
@@ -0,0 +1,3 @@
+Host *
+    StrictHostKeyChecking no
+
diff --git a/doc/examples/extras/suse-12.1/suse-nebula-cloud/cloud_head/root/var/lib/one/.ssh/id_rsa b/doc/examples/extras/suse-12.1/suse-nebula-cloud/cloud_head/root/var/lib/one/.ssh/id_rsa
new file mode 100644
index 0000000..973d568
--- /dev/null
+++ b/doc/examples/extras/suse-12.1/suse-nebula-cloud/cloud_head/root/var/lib/one/.ssh/id_rsa
@@ -0,0 +1,27 @@
+-----BEGIN RSA PRIVATE KEY-----
+MIIEpAIBAAKCAQEA0dq/GOJdnS32+AxRQ9lCtGMRjl3TCVpt17m1VZ8blig+zkw6
+aexlb9Ku6Gjpa0T2/KuXLpEpeQkip9GCLHlolPTzMHATke6Oxl05fq9jVNejOO0f
+8rPeFMvjqkuNe9mept7gCR29TL1PAWyHpnJ/b1i7XmQR1YqM0HzIon3N6BNUrU/G
+1Kybo/wGqGjykuzp5moCcCLsovhX5Oi8Yx1mxFH6aLuFmtsQRRz+CBHJauamLykg
+8YYODAj1va1MOtVuIZwPiQpMOrlrKIrvo5DmkOM4CrwZA1Jn+xS+ME2HlU0gpRl8
+Z8uoF/64yH2wlfkYICg2zWy2JbWwfBw6fhKxpwIDAQABAoIBABKQzbM/45RSSrUr
+Mc1U3UfkM9tqhY8gRvN85IQMrX4dVWEe8VQJq/e2pe69yVjKIye7boaaJRcmLcC3
+ElMo8o2rFhDE+ZZBirQV70476gfJhBE3OUpZi14/o4afZIb+e8C7mwpzbRnq7aBs
+n5ukKY4KRZlWNRW1Sjvvrjhh9OOBGUrmj9Yp10LEcKpstMSA/AENvVE81J7s7V7i
++CvZov41H7uO0a8J3aWO1TIjnnLE848nEoGZOvXVVyuLUbMZAYzdRjo0DzbXuSa4
+C/1AzQzD3a91xrF6lHYE4uphRY7tX1EDVfXQTNX+fH5PKp1uxJaU8nW22DbVL/us
+X/les1ECgYEA6rDHMvcqY+vWUzLXIHeOqlL3ORMq1+mQHVEuL+oZtz1uL0uTODZT
+jOaASXQGXRWpcGnmaTq7i3/S+zvjagqvkjtpJNmdeEVV3oQ0CtLtIIywRHiWJ/L1
+bP6YJr7o7+T3TfV2AYS1Ckuf0WwtDSfeAr+g9NyUg5d/TBKGQNImJTMCgYEA5Oir
+x34QU/NTYWJvVCDxQYRb/Lbbvao9CLE1P270uYMtAIJVBM+qL/IQAAmLWmO/coVM
+iOHOz/IDxrhtuaMXb7rN2JsDgRZfwKKFOS2uAO+VTga8f0UdOdV77qI30u792/D0
+2wB7nDIhJ/c4IwGaxgS11lrBJxcGfoNbAJIb2b0CgYEAjBCvAfrDQNk6k3LvM0BH
+U92qEFUhJ7UMPoL5prz3VgYCoZVgKpc5rAjRHYVyWtGXyzBYxAq6bVn/R9OJOPth
+p0tvx/9cXLA8vE14ZdFWliuA84xoSTVWRhN4KP+dM7cZ5VwObn+OMLPLkQgXpxdZ
+B5jobdrLg/HBllwj5cHF5EMCgYAsTYvRlGh8lv9wPajmU2neEEvtYUauMqCVahaw
+LD1ZGjY/fvoNcFOz69mE6FP8LooDFCF37JwmSuTINTGnWBVVHoZwga/v7/CgS9QU
++O5QaA4xh8Q7rZi2dMcDrIm5XV/sjXoWWMWTuXAJWCOZQto9sPOwhOgVNLOhELMw
+LRcO0QKBgQDQpLlzO7Lss+KMsrvtjWfW53nlUfDtYCS7zCer+segocrdoIhlw8uS
+TiWTIjQ1dxvhIbkL6d2tfr717AwYtf9FKJKAKYyyjW2IixLypN1SOSjjCf3mO860
+4vMHfod3dzySGf9a1M4NsKF33uZ5KbcseM3oPsLwncfaicy+G+Xwhg==
+-----END RSA PRIVATE KEY-----
diff --git a/doc/examples/extras/suse-12.1/suse-nebula-cloud/cloud_head/root/var/lib/one/.ssh/id_rsa.pub b/doc/examples/extras/suse-12.1/suse-nebula-cloud/cloud_head/root/var/lib/one/.ssh/id_rsa.pub
new file mode 100644
index 0000000..b00dfcd
--- /dev/null
+++ b/doc/examples/extras/suse-12.1/suse-nebula-cloud/cloud_head/root/var/lib/one/.ssh/id_rsa.pub
@@ -0,0 +1 @@
+ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDR2r8Y4l2dLfb4DFFD2UK0YxGOXdMJWm3XubVVnxuWKD7OTDpp7GVv0q7oaOlrRPb8q5cukSl5CSKn0YIseWiU9PMwcBOR7o7GXTl+r2NU16M47R/ys94Uy+OqS4172Z6m3uAJHb1MvU8BbIemcn9vWLteZBHViozQfMiifc3oE1StT8bUrJuj/AaoaPKS7OnmagJwIuyi+Ffk6LxjHWbEUfpou4Wa2xBFHP4IEclq5qYvKSDxhg4MCPW9rUw61W4hnA+JCkw6uWsoiu+jkOaQ4zgKvBkDUmf7FL4wTYeVTSClGXxny6gX/rjIfbCV+RggKDbNbLYltbB8HDp+ErGn <A HREF="https://lists.berlios.de/mailman/listinfo/kiwi-devel">oneadmin at linux</A>
diff --git a/modules/KIWIXMLValidator.pm b/modules/KIWIXMLValidator.pm
index 025741b..854ee6f 100644
--- a/modules/KIWIXMLValidator.pm
+++ b/modules/KIWIXMLValidator.pm
@@ -462,6 +462,9 @@ sub __checkPatternTypeAttrConsistent {
 	# multiple times, the value of patternType must be the same for each use
 	my %profPatternUseMap = ();
 	for my $pkgs (@pkgsNodes) {
+		if ( $pkgs -&gt; getAttribute( 'type' ) eq 'delete') {
+			next;
+		}
 		my $profiles = $pkgs -&gt; getAttribute( 'profiles' );
 		if ($profiles) {
 			my @profNames = split /,/, $profiles;
diff --git a/rpm/kiwi.spec b/rpm/kiwi.spec
index 0d57b8f..2027cb0 100644
--- a/rpm/kiwi.spec
+++ b/rpm/kiwi.spec
@@ -77,8 +77,10 @@ Source1:        %{name}-rpmlintrc
 Source2:        %{name}-docu.tar.bz2
 Source3:        %{name}-repo.tar.bz2
 BuildRoot:      %{_tmppath}/%{name}-%{version}-build
+%if 0%{?suse_version}
 Recommends:     jing
 Recommends:     zypper
+%endif
 Obsoletes:      kiwi-desc-usbboot &lt;= 4.81
 
 
@@ -336,7 +338,9 @@ test -f $RPM_BUILD_ROOT/srv/tftpboot/pxelinux.0 &amp;&amp; \
 	echo /srv/tftpboot/pxelinux.0 &gt; kiwi.loader
 test -f $RPM_BUILD_ROOT/srv/tftpboot/mboot.c32 &amp;&amp; \
 	echo /srv/tftpboot/mboot.c32 &gt;&gt; kiwi.loader
+%if 0%{?suse_version}
 %perl_process_packlist
+%endif
 rm -f $RPM_BUILD_ROOT/%{perl_vendorarch}/KIWI/example.pl
 ./.links
 %if %{suse_version} &gt; 1020
@@ -393,7 +397,7 @@ rm -rf $RPM_BUILD_ROOT
 %exclude %{_datadir}/kiwi/modules/KIWIUtil.pm
 %{_datadir}/kiwi/xsl
 %{_sbindir}/kiwi
-%if 0%{?suse_version} &lt; 1140
+%if 0%{?suse_version} &lt; 1140 &amp;&amp; %{suse_version} &gt;0
 %{perl_vendorarch}/KIWI
 %{perl_vendorarch}/auto/KIWI
 /var/adm/perl-modules/kiwi
diff --git a/tests/unit/data/kiwiXMLValidator/patternTattrUseValid_8.xml b/tests/unit/data/kiwiXMLValidator/patternTattrUseValid_10.xml
similarity index 76%
copy from tests/unit/data/kiwiXMLValidator/patternTattrUseValid_8.xml
copy to tests/unit/data/kiwiXMLValidator/patternTattrUseValid_10.xml
index 78323de..fc2f242 100644
--- a/tests/unit/data/kiwiXMLValidator/patternTattrUseValid_8.xml
+++ b/tests/unit/data/kiwiXMLValidator/patternTattrUseValid_10.xml
@@ -1,11 +1,13 @@
 &lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
-
-&lt;image schemaversion=&quot;5.2&quot; name=&quot;suse-11.3-oem-preload&quot;&gt;
+&lt;image schemaversion=&quot;4.9&quot; name=&quot;suse-11.3-oem-preload&quot;&gt;
 	&lt;description type=&quot;system&quot;&gt;
 		&lt;author&gt;Robert Schweikert&lt;/author&gt;
 		&lt;contact&gt;<A HREF="https://lists.berlios.de/mailman/listinfo/kiwi-devel">rschweikert at novell.com</A>&lt;/contact&gt;
-		&lt;specification&gt;test use of patternType attribute&lt;/specification&gt;
+		&lt;specification&gt;test use of patternType attribute use&lt;/specification&gt;
 	&lt;/description&gt;
+	&lt;profiles&gt;
+		&lt;profile description=&quot;test delete packages&quot; name=&quot;tdel&quot;/&gt;
+	&lt;/profiles&gt;
 	&lt;preferences&gt;
 		&lt;type image=&quot;oem&quot; filesystem=&quot;ext4&quot; boot=&quot;oemboot/suse-11.3&quot; installiso=&quot;true&quot; installboot=&quot;install&quot;&gt;
 			&lt;oemconfig&gt;
@@ -39,4 +41,11 @@
 		&lt;package name=&quot;filesystem&quot;/&gt;
 		&lt;package name=&quot;glibc-locale&quot;/&gt;
 	&lt;/packages&gt;
+	&lt;packages type=&quot;delete&quot; profiles=&quot;tdel&quot;&gt;
+		&lt;package name=&quot;evolution&quot;/&gt;
+		&lt;package name=&quot;firefox&quot;/&gt;
+	&lt;/packages&gt;
+	&lt;packages type=&quot;image&quot; profiles=&quot;tdel&quot; patternType=&quot;plusRecommended&quot;&gt;
+		&lt;package name=&quot;iputils&quot;/&gt;
+	&lt;/packages&gt;
 &lt;/image&gt;


hooks/post-receive
-- 
Project kiwi at BerliOS

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="003538.html">[Kiwi-devel] [Git]Project kiwi at BerliOS branch,	KIWI-374-SuSE-11-1-SLE-SP-Devel,	updated. a2dfb53b39cbe9439375ce2116ffb622f9118b16
</A></li>
	<LI>Next message: <A HREF="003545.html">[Kiwi-devel] obs links issue and proposed patch
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3544">[ date ]</a>
              <a href="thread.html#3544">[ thread ]</a>
              <a href="subject.html#3544">[ subject ]</a>
              <a href="author.html#3544">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/kiwi-devel">More information about the Kiwi-devel
mailing list</a><br>
</body></html>

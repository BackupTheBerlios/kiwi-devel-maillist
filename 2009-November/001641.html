<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Kiwi-devel] [Git]Project kiwi at BerliOS branch,	KIWI-374-SuSE-11-1-SLE-SP-Devel,	updated. 6405857077e49d8d1f78eaac1ea490ac54430ced
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/kiwi-devel/2009-November/index.html" >
   <LINK REL="made" HREF="mailto:kiwi-devel%40lists.berlios.de?Subject=Re%3A%20%5BKiwi-devel%5D%20%5BGit%5DProject%20kiwi%20at%20BerliOS%20branch%2C%0A%09KIWI-374-SuSE-11-1-SLE-SP-Devel%2C%0A%09updated.%206405857077e49d8d1f78eaac1ea490ac54430ced&In-Reply-To=%3C200911301646.nAUGkXcW030081%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001642.html">
   
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Kiwi-devel] [Git]Project kiwi at BerliOS branch,	KIWI-374-SuSE-11-1-SLE-SP-Devel,	updated. 6405857077e49d8d1f78eaac1ea490ac54430ced</H1>
    <B>marcus_schaefer at BerliOS</B> 
    <A HREF="mailto:kiwi-devel%40lists.berlios.de?Subject=Re%3A%20%5BKiwi-devel%5D%20%5BGit%5DProject%20kiwi%20at%20BerliOS%20branch%2C%0A%09KIWI-374-SuSE-11-1-SLE-SP-Devel%2C%0A%09updated.%206405857077e49d8d1f78eaac1ea490ac54430ced&In-Reply-To=%3C200911301646.nAUGkXcW030081%40sheep.berlios.de%3E"
       TITLE="[Kiwi-devel] [Git]Project kiwi at BerliOS branch,	KIWI-374-SuSE-11-1-SLE-SP-Devel,	updated. 6405857077e49d8d1f78eaac1ea490ac54430ced">marcus_schaefer at mail.berlios.de
       </A><BR>
    <I>Mon Nov 30 17:46:33 CET 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="001642.html">[Kiwi-devel] [Git]Project kiwi at BerliOS branch, master,	updated. 7cb0ea07b977d7120da62641c72575532ef37737
</A></li>
        
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1641">[ date ]</a>
              <a href="thread.html#1641">[ thread ]</a>
              <a href="subject.html#1641">[ subject ]</a>
              <a href="author.html#1641">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>This is an automated email from the git hooks/post-receive script. It was
generated because a ref change was pushed to the repository containing
the project &quot;Project kiwi at BerliOS&quot;.

The branch, KIWI-374-SuSE-11-1-SLE-SP-Devel has been updated
       via  6405857077e49d8d1f78eaac1ea490ac54430ced (commit)
      from  0de30955b3d411dbd4d35bb91fa8547ace32925c (commit)

Those revisions listed above that are new to this repository have
not appeared on any other notification email; so we list those
revisions in full, below.

- Log -----------------------------------------------------------------
commit 6405857077e49d8d1f78eaac1ea490ac54430ced
Author: Marcus Sch&#195;&#164;fer &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/kiwi-devel">ms at novell.com</A>&gt;
Date:   Mon Nov 30 17:46:18 2009 +0100

    - added options --fs-max-mount-count and --fs-check-interval
      as well as the XML type attribute fsnocheck which deactivates
      the filesystem check at all.

-----------------------------------------------------------------------

Summary of changes:
diff --git a/doc/kiwi-man/KIWI::config.sh.1 b/doc/kiwi-man/KIWI::config.sh.1
index 8174383..4f7521b 100644
--- a/doc/kiwi-man/KIWI::config.sh.1
+++ b/doc/kiwi-man/KIWI::config.sh.1
@@ -1,12 +1,12 @@
 .\&quot;     Title: kiwi::config.sh
 .\&quot;    Author: Marcus Sch&#195;&#164;fer &lt;ms (AT) suse.de&gt;
 .\&quot; Generator: DocBook XSL Stylesheets v1.74.0 &lt;<A HREF="http://docbook.sf.net/">http://docbook.sf.net/</A>&gt;
-.\&quot;      Date: Created: 11/17/2009
+.\&quot;      Date: Created: 11/30/2009
 .\&quot;    Manual: KIWI Manualpage
 .\&quot;    Source: KIWI v3.65
 .\&quot;  Language: English
 .\&quot;
-.TH &quot;KIWI::CONFIG\&amp;.SH&quot; &quot;1&quot; &quot;Created: 11/17/2009&quot; &quot;KIWI v3\&amp;.65&quot; &quot;KIWI Manualpage&quot;
+.TH &quot;KIWI::CONFIG\&amp;.SH&quot; &quot;1&quot; &quot;Created: 11/30/2009&quot; &quot;KIWI v3\&amp;.65&quot; &quot;KIWI Manualpage&quot;
 .\&quot; -----------------------------------------------------------------
 .\&quot; * (re)Define some macros
 .\&quot; -----------------------------------------------------------------
diff --git a/doc/kiwi-man/KIWI::images.sh.1 b/doc/kiwi-man/KIWI::images.sh.1
index 5fda53e..d91598a 100644
--- a/doc/kiwi-man/KIWI::images.sh.1
+++ b/doc/kiwi-man/KIWI::images.sh.1
@@ -1,12 +1,12 @@
 .\&quot;     Title: kiwi::images.sh
 .\&quot;    Author: Marcus Sch&#195;&#164;fer &lt;ms (AT) suse.de&gt;
 .\&quot; Generator: DocBook XSL Stylesheets v1.74.0 &lt;<A HREF="http://docbook.sf.net/">http://docbook.sf.net/</A>&gt;
-.\&quot;      Date: Created: 11/17/2009
+.\&quot;      Date: Created: 11/30/2009
 .\&quot;    Manual: KIWI Manualpage
 .\&quot;    Source: KIWI v3.65
 .\&quot;  Language: English
 .\&quot;
-.TH &quot;KIWI::IMAGES\&amp;.SH&quot; &quot;1&quot; &quot;Created: 11/17/2009&quot; &quot;KIWI v3\&amp;.65&quot; &quot;KIWI Manualpage&quot;
+.TH &quot;KIWI::IMAGES\&amp;.SH&quot; &quot;1&quot; &quot;Created: 11/30/2009&quot; &quot;KIWI v3\&amp;.65&quot; &quot;KIWI Manualpage&quot;
 .\&quot; -----------------------------------------------------------------
 .\&quot; * (re)Define some macros
 .\&quot; -----------------------------------------------------------------
diff --git a/doc/kiwi-man/kiwi-man.xml b/doc/kiwi-man/kiwi-man.xml
index 118b586..4a8d1af 100644
--- a/doc/kiwi-man/kiwi-man.xml
+++ b/doc/kiwi-man/kiwi-man.xml
@@ -695,6 +695,29 @@
         &lt;/listitem&gt;
     &lt;/varlistentry&gt;
 	&lt;varlistentry&gt;
+		&lt;term&gt;&lt;optional&gt;&lt;option&gt;--fs-max-mount-count &lt;replaceable&gt;number&lt;/replaceable&gt;&lt;/option&gt;
+		&lt;/optional&gt;&lt;/term&gt;
+		&lt;listitem&gt;
+		&lt;para&gt;
+			When calling kiwi in creation mode this option will set the number
+			of mounts after which the filesystem will be checked. Set to 0 to
+			disable checks.
+			This option applies only to ext[234] filesystems.
+		&lt;/para&gt;
+		&lt;/listitem&gt;
+	&lt;/varlistentry&gt;
+	&lt;varlistentry&gt;
+		&lt;term&gt;&lt;optional&gt;&lt;option&gt;--fs-check-interval &lt;replaceable&gt;number&lt;/replaceable&gt;&lt;/option&gt;
+		&lt;/optional&gt;&lt;/term&gt;
+		&lt;listitem&gt;
+		&lt;para&gt;
+			When calling kiwi in creation mode this option will set the maximal time
+			between two filesystem checks. Set to 0 to disable time-dependent checks.
+			This option applies only to ext[234] filesystems.
+		&lt;/para&gt;
+		&lt;/listitem&gt;
+	&lt;/varlistentry&gt;
+	&lt;varlistentry&gt;
         &lt;term&gt;&lt;optional&gt;&lt;option&gt;--partitioner &lt;replaceable&gt;fdisk|parted&lt;/replaceable&gt;&lt;/option&gt;
         &lt;/optional&gt;&lt;/term&gt;
         &lt;listitem&gt;
diff --git a/doc/kiwi-man/kiwi.1 b/doc/kiwi-man/kiwi.1
index 043a580..58d6870 100644
--- a/doc/kiwi-man/kiwi.1
+++ b/doc/kiwi-man/kiwi.1
@@ -1,12 +1,12 @@
 .\&quot;     Title: kiwi
 .\&quot;    Author: Marcus Schaefer &lt;ms (AT) suse.de&gt;
 .\&quot; Generator: DocBook XSL Stylesheets v1.74.0 &lt;<A HREF="http://docbook.sf.net/">http://docbook.sf.net/</A>&gt;
-.\&quot;      Date: Created: 11/17/2009
+.\&quot;      Date: Created: 11/30/2009
 .\&quot;    Manual: KIWI Manualpage
 .\&quot;    Source: KIWI v3.65
 .\&quot;  Language: English
 .\&quot;
-.TH &quot;KIWI&quot; &quot;1&quot; &quot;Created: 11/17/2009&quot; &quot;KIWI v3\&amp;.65&quot; &quot;KIWI Manualpage&quot;
+.TH &quot;KIWI&quot; &quot;1&quot; &quot;Created: 11/30/2009&quot; &quot;KIWI v3\&amp;.65&quot; &quot;KIWI Manualpage&quot;
 .\&quot; -----------------------------------------------------------------
 .\&quot; * (re)Define some macros
 .\&quot; -----------------------------------------------------------------
@@ -495,6 +495,16 @@ When calling kiwi in creation mode this option will set the inode size in bytes\
 Set the bytes/inode ratio\&amp;. This option has no effect if the reiser filesystem is used
 .RE
 .PP
+[\fB\-\-fs\-max\-mount\-count \fR\fB\fInumber\fR\fR ]
+.RS 4
+When calling kiwi in creation mode this option will set the number of mounts after which the filesystem will be checked\&amp;. Set to 0 to disable checks\&amp;. This option applies only to ext[234] filesystems\&amp;.
+.RE
+.PP
+[\fB\-\-fs\-check\-interval \fR\fB\fInumber\fR\fR ]
+.RS 4
+When calling kiwi in creation mode this option will set the maximal time between two filesystem checks\&amp;. Set to 0 to disable time\-dependent checks\&amp;. This option applies only to ext[234] filesystems\&amp;.
+.RE
+.PP
 [\fB\-\-partitioner \fR\fB\fIfdisk|parted\fR\fR ]
 .RS 4
 Select the tool to create partition tables\&amp;. Supported are fdisk (sfdisk) and parted\&amp;. By default fdisk is used
diff --git a/doc/kiwi.pdf b/doc/kiwi.pdf
index ed34ff1..930d51b 100644
Binary files a/doc/kiwi.pdf and b/doc/kiwi.pdf differ
diff --git a/kiwi.pl b/kiwi.pl
index c37ee6b..730b07a 100755
--- a/kiwi.pl
+++ b/kiwi.pl
@@ -196,6 +196,8 @@ our $PackageManager;        # package manager to use for this image
 our $FSBlockSize;           # filesystem block size
 our $FSInodeSize;           # filesystem inode size
 our $FSJournalSize;         # filesystem journal size
+our $FSMaxMountCount;       # filesystem (ext2-4) max mount count between fs checks
+our $FSCheckInterval;       # filesystem (ext2-4) max interval between fs checks
 our $FSInodeRatio;          # filesystem bytes/inode ratio
 our $Verbosity = 0;         # control the verbosity level
 our $TargetArch;            # target architecture -&gt; writes zypp.conf
@@ -1321,6 +1323,8 @@ sub init {
 		&quot;fs-journalsize=i&quot;      =&gt; \$FSJournalSize,
 		&quot;fs-inodesize=i&quot;        =&gt; \$FSInodeSize,
 		&quot;fs-inoderatio=i&quot;       =&gt; \$FSInodeRatio,
+		&quot;fs-max-mount-count=i&quot;  =&gt; \$FSMaxMountCount,
+		&quot;fs-check-interval=i&quot;   =&gt; \$FSCheckInterval,
 		&quot;partitioner=s&quot;         =&gt; \$Partitioner,
 		&quot;target-arch=s&quot;         =&gt; \$TargetArch,
 		&quot;check-kernel&quot;          =&gt; \$CheckKernel,
@@ -1651,6 +1655,14 @@ sub usage {
 	print &quot;      Set the bytes/inode ratio. This option has no\n&quot;;
 	print &quot;      effect if the reiser filesystem is used\n&quot;;
 	print &quot;\n&quot;;
+	print &quot;    [ --fs-max-mount-count &lt;number&gt; ]\n&quot;;
+	print &quot;      Set the number of mounts after which the filesystem will\n&quot;;
+	print &quot;      be checked for ext[234]. Set to 0 to disable checks.\n&quot;;
+	print &quot;\n&quot;;
+	print &quot;    [ --fs-check-interval &lt;number&gt; ]\n&quot;;
+	print &quot;      Set the maximal time between two filesystem checks for ext[234].\n&quot;;
+	print &quot;      Set to 0 to disable time-dependent checks.\n&quot;;
+	print &quot;\n&quot;;
 	print &quot;    [ --partitioner &lt;fdisk|parted&gt; ]\n&quot;;
 	print &quot;      Select the tool to create partition tables. Supported are\n&quot;;
 	print &quot;      fdisk (sfdisk) and parted. By default fdisk is used\n&quot;;
@@ -2349,6 +2361,8 @@ sub checkFSOptions {
 	# string for the relevant filesystems
 	# ---
 	my %result = ();
+	my $fs_maxmountcount;
+	my $fs_checkinterval;
 	foreach my $fs (keys %KnownFS) {
 		my $blocksize;   # block size in bytes
 		my $journalsize; # journal size in MB (ext) or blocks (reiser)
@@ -2365,6 +2379,12 @@ sub checkFSOptions {
 				if ($FSInodeSize)   {$inodesize   = &quot;-I $FSInodeSize&quot;}
 				if ($FSInodeRatio)  {$inoderatio  = &quot;-i $FSInodeRatio&quot;}
 				if ($FSJournalSize) {$journalsize = &quot;-J size=$FSJournalSize&quot;}
+				if ($FSMaxMountCount) {
+					$fs_maxmountcount = &quot; -c $FSMaxMountCount&quot;;
+				}
+				if ($FSCheckInterval) {
+					$fs_checkinterval = &quot; -i $FSCheckInterval&quot;;
+				}
 				$fsfeature = &quot;-O resize_inode&quot;;
 				$fstype = &quot;-T $fs&quot;;
 				last SWITCH;
@@ -2398,6 +2418,9 @@ sub checkFSOptions {
 			$result{$fs} .= $fstype.&quot; &quot;;
 		}
 	}
+	if ($fs_maxmountcount || $fs_checkinterval) {
+		$result{extfstune} = &quot;$fs_maxmountcount$fs_checkinterval&quot;;
+	}
 	return %result;
 }
 
diff --git a/modules/KIWIBoot.pm b/modules/KIWIBoot.pm
index f20255f..23c2327 100644
--- a/modules/KIWIBoot.pm
+++ b/modules/KIWIBoot.pm
@@ -4798,41 +4798,27 @@ sub setupFilesystem {
 	my $device = shift;
 	my $name   = shift;
 	my $kiwi   = $this-&gt;{kiwi};
+	my $xml    = $this-&gt;{xml};
+	my %type   = %{$xml-&gt;getImageTypeAndAttributes()};
 	my %FSopts = main::checkFSOptions();
 	my $result;
 	my $status;
 	SWITCH: for ($fstype) {
-		/^ext2/     &amp;&amp; do {
-			$kiwi -&gt; info (&quot;Creating ext2 $name filesystem&quot;);
-			my $fsopts = $FSopts{ext2};
-			$fsopts.= &quot;-F&quot;;
+		/^ext[234]/     &amp;&amp; do {
+			$kiwi -&gt; info (&quot;Creating $_ $name filesystem&quot;);
+			my $fsopts = $FSopts{$_};
+			$fsopts .= /^ext2/ ? &quot;-F&quot; : &quot;-j -F&quot;;
 			if ($this-&gt;{inodes}) {
 				$fsopts.= &quot; -N $this-&gt;{inodes}&quot;;
 			}
+			my $tuneopts = $type{fsnocheck} eq &quot;true&quot; ? &quot;-c 0 -i 0&quot; : &quot;&quot;;
+			$tuneopts = $FSopts{extfstune} if $FSopts{extfstune};
 			$status = qxx (&quot;/sbin/mke2fs $fsopts $device 2&gt;&amp;1&quot;);
 			$result = $? &gt;&gt; 8;
-			last SWITCH;
-		};
-		/^ext3/     &amp;&amp; do {
-			$kiwi -&gt; info (&quot;Creating ext3 $name filesystem&quot;);
-			my $fsopts = $FSopts{ext3};
-			$fsopts.= &quot;-j -F&quot;;
-			if ($this-&gt;{inodes}) {
-				$fsopts.= &quot; -N $this-&gt;{inodes}&quot;;
-			}
-			$status = qxx (&quot;/sbin/mke2fs $fsopts $device 2&gt;&amp;1&quot;);
-			$result = $? &gt;&gt; 8;
-			last SWITCH;
-		};
-		/^ext4/     &amp;&amp; do {
-			$kiwi -&gt; info (&quot;Creating ext4 $name filesystem&quot;);
-			my $fsopts = $FSopts{ext4};
-			$fsopts.= &quot;-j -F&quot;;
-			if ($this-&gt;{inodes}) {
-				$fsopts.= &quot; -N $this-&gt;{inodes}&quot;;
+			if (!$result &amp;&amp; $tuneopts) {
+				$status .= qxx (&quot;/sbin/tune2fs $tuneopts $device 2&gt;&amp;1&quot;);
+				$result = $? &gt;&gt; 8;
 			}
-			$status = qxx (&quot;/sbin/mke2fs $fsopts $device 2&gt;&amp;1&quot;);
-			$result = $? &gt;&gt; 8;
 			last SWITCH;
 		};
 		/^reiserfs/ &amp;&amp; do {
diff --git a/modules/KIWIImage.pm b/modules/KIWIImage.pm
index f277f56..12becfc 100644
--- a/modules/KIWIImage.pm
+++ b/modules/KIWIImage.pm
@@ -3732,8 +3732,11 @@ sub setupEXT2 {
 	my $tree    = shift;
 	my $journal = shift;
 	my $kiwi    = $this-&gt;{kiwi};
+	my $xml  = $this-&gt;{xml};
+	my %type = %{$xml-&gt;getImageTypeAndAttributes()};
 	my $imageTree = $this-&gt;{imageTree};
 	my $fsopts;
+	my $tuneopts;
 	if (! defined $tree) {
 		$tree = $imageTree;
 	}
@@ -3751,8 +3754,14 @@ sub setupEXT2 {
 	if ($this-&gt;{inodes}) {
 		$fsopts.= &quot; -N $this-&gt;{inodes}&quot;;
 	}
+	$tuneopts = $type{fsnocheck} eq &quot;true&quot; ? &quot;-c 0 -i 0&quot; : &quot;&quot;;
+	$tuneopts = $FSopts{extfstune} if $FSopts{extfstune};
 	my $data = qxx (&quot;/sbin/mke2fs $fsopts $this-&gt;{imageDest}/$name 2&gt;&amp;1&quot;);
 	my $code = $? &gt;&gt; 8;
+	if (!$code &amp;&amp; $tuneopts) {
+		$data = qxx (&quot;/sbin/tune2fs $tuneopts $this-&gt;{imageDest}/$name 2&gt;&amp;1&quot;);
+		$code = $? &gt;&gt; 8;
+	}
 	if ($code != 0) {
 		$kiwi -&gt; error  (&quot;Couldn't create EXT2 filesystem&quot;);
 		$kiwi -&gt; failed ();
diff --git a/modules/KIWISchema.rnc b/modules/KIWISchema.rnc
index bd688b0..fc3d072 100644
--- a/modules/KIWISchema.rnc
+++ b/modules/KIWISchema.rnc
@@ -1166,6 +1166,9 @@ div {
 # common element &lt;type&gt;
 #
 div {
+	k.type.fsnocheck.attribute =
+		## Turn off periodic filesystem checks on ext2/3/4.
+		attribute fsnocheck { xsd:boolean }
 	k.type.lvm.attribute =
 		## Specify whether LVM should be used or not. This is effective
 		## for the types oem,usb and vmx
@@ -1271,6 +1274,7 @@ div {
 		## Specifies the primary type (choose KIWI option type)
 		attribute primary { xsd:boolean }
 	k.type.attlist =
+		k.type.fsnocheck.attribute? &amp;
 		k.type.lvm.attribute? &amp;
 		k.type.checkprebuilt.attribute? &amp;
 		k.type.bootprofile.attribute? &amp;
diff --git a/modules/KIWIXML.pm b/modules/KIWIXML.pm
index 9ce4c98..91a9afc 100644
--- a/modules/KIWIXML.pm
+++ b/modules/KIWIXML.pm
@@ -775,6 +775,7 @@ sub getImageTypeAndAttributes {
 		$record{bootprofile}   = $node -&gt; getAttribute(&quot;bootprofile&quot;);
 		$record{bootkernel}    = $node -&gt; getAttribute(&quot;bootkernel&quot;);
 		$record{filesystem}    = $node -&gt; getAttribute(&quot;filesystem&quot;);
+		$record{fsnocheck}     = $node -&gt; getAttribute(&quot;fsnocheck&quot;);
 		$record{AWSAccountNr}  = $node -&gt; getAttribute(&quot;ec2accountnr&quot;);
 		$record{EC2CertFile}   = $node -&gt; getAttribute(&quot;ec2certfile&quot;);
 		$record{EC2PrivateKeyFile} = $node -&gt; getAttribute(&quot;ec2privatekeyfile&quot;);
diff --git a/rpm/kiwi.changes b/rpm/kiwi.changes
index 192c7cb..9ab2f44 100644
--- a/rpm/kiwi.changes
+++ b/rpm/kiwi.changes
@@ -1,4 +1,11 @@
 -------------------------------------------------------------------
+Mon Nov 30 17:45:46 CET 2009 - <A HREF="https://lists.berlios.de/mailman/listinfo/kiwi-devel">ms at suse.de</A>
+
+- added options --fs-max-mount-count and --fs-check-interval
+  as well as the XML type attribute fsnocheck which deactivates
+  the filesystem check at all.
+
+-------------------------------------------------------------------
 Mon Nov 30 15:59:08 CET 2009 - <A HREF="https://lists.berlios.de/mailman/listinfo/kiwi-devel">ms at suse.de</A>
 
 - fixed root device setup for xenboot in EC2 (bnc #559143)


hooks/post-receive
-- 
Project kiwi at BerliOS

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001642.html">[Kiwi-devel] [Git]Project kiwi at BerliOS branch, master,	updated. 7cb0ea07b977d7120da62641c72575532ef37737
</A></li>
	
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1641">[ date ]</a>
              <a href="thread.html#1641">[ thread ]</a>
              <a href="subject.html#1641">[ subject ]</a>
              <a href="author.html#1641">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/kiwi-devel">More information about the Kiwi-devel
mailing list</a><br>
</body></html>

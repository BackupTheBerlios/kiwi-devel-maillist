<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Kiwi-devel] [Git]Project kiwi at BerliOS branch, master,	updated. 4f593b22118e24d1feb2feef363914b8f23ab1f7
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/kiwi-devel/2011-February/index.html" >
   <LINK REL="made" HREF="mailto:kiwi-devel%40lists.berlios.de?Subject=Re%3A%20%5BKiwi-devel%5D%20%5BGit%5DProject%20kiwi%20at%20BerliOS%20branch%2C%20master%2C%0A%09updated.%204f593b22118e24d1feb2feef363914b8f23ab1f7&In-Reply-To=%3C20110222163807.C48724812B7%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="003104.html">
   <LINK REL="Next"  HREF="003105.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Kiwi-devel] [Git]Project kiwi at BerliOS branch, master,	updated. 4f593b22118e24d1feb2feef363914b8f23ab1f7</H1>
    <B>marcus_schaefer at BerliOS</B> 
    <A HREF="mailto:kiwi-devel%40lists.berlios.de?Subject=Re%3A%20%5BKiwi-devel%5D%20%5BGit%5DProject%20kiwi%20at%20BerliOS%20branch%2C%20master%2C%0A%09updated.%204f593b22118e24d1feb2feef363914b8f23ab1f7&In-Reply-To=%3C20110222163807.C48724812B7%40sheep.berlios.de%3E"
       TITLE="[Kiwi-devel] [Git]Project kiwi at BerliOS branch, master,	updated. 4f593b22118e24d1feb2feef363914b8f23ab1f7">marcus_schaefer at mail.berlios.de
       </A><BR>
    <I>Tue Feb 22 17:38:07 CET 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="003104.html">[Kiwi-devel] no whitespace in profile name
</A></li>
        <LI>Next message: <A HREF="003105.html">[Kiwi-devel] [Git]Project kiwi at BerliOS branch, master,	updated. d32fb17debadd5fa678e69503183bf70ad1eeb51
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3103">[ date ]</a>
              <a href="thread.html#3103">[ thread ]</a>
              <a href="subject.html#3103">[ subject ]</a>
              <a href="author.html#3103">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>This is an automated email from the git hooks/post-receive script. It was
generated because a ref change was pushed to the repository containing
the project &quot;Project kiwi at BerliOS&quot;.

The branch, master has been updated
       via  4f593b22118e24d1feb2feef363914b8f23ab1f7 (commit)
       via  c1c3b15518bc521c68e28b3572ac487eb986ef43 (commit)
       via  4d10d513c012bd9885d59d08236c37c0fd53e4c5 (commit)
      from  704c00971b5b5972e0bfa67dc584db81b18195b9 (commit)

Those revisions listed above that are new to this repository have
not appeared on any other notification email; so we list those
revisions in full, below.

- Log -----------------------------------------------------------------
commit 4f593b22118e24d1feb2feef363914b8f23ab1f7
Author: Marcus Sch&#195;&#164;fer &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/kiwi-devel">ms at novell.com</A>&gt;
Date:   Tue Feb 22 17:35:41 2011 +0100

    - enhanced patternType check which now allows the use of the patternType
      attribute for all &lt;packages&gt; specifications that add packages to the
      image

commit c1c3b15518bc521c68e28b3572ac487eb986ef43
Author: Marcus Sch&#195;&#164;fer &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/kiwi-devel">ms at novell.com</A>&gt;
Date:   Tue Feb 22 17:32:29 2011 +0100

    - fixed suse-min-gnome example, empty vmx package section doesn't make sense

commit 4d10d513c012bd9885d59d08236c37c0fd53e4c5
Author: Marcus Sch&#195;&#164;fer &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/kiwi-devel">ms at novell.com</A>&gt;
Date:   Tue Feb 22 17:28:50 2011 +0100

    - fixed cleanup of shared memory segments and semaphores
      by a valid destructor in KIWISharedMem.pm

-----------------------------------------------------------------------

Summary of changes:
diff --git a/doc/examples/suse-11.2/suse-min-gnome/config.xml b/doc/examples/suse-11.2/suse-min-gnome/config.xml
index a5ef417..32384ac 100644
--- a/doc/examples/suse-11.2/suse-min-gnome/config.xml
+++ b/doc/examples/suse-11.2/suse-min-gnome/config.xml
@@ -47,7 +47,6 @@
 		&lt;package name=&quot;xorg-x11-server&quot;/&gt;
 		&lt;opensusePattern name=&quot;base&quot;/&gt;
 	&lt;/packages&gt;
-	&lt;packages type=&quot;vmx&quot;/&gt;
 	&lt;packages type=&quot;bootstrap&quot;&gt;
 		&lt;package name=&quot;filesystem&quot;/&gt;
 		&lt;package name=&quot;glibc-locale&quot;/&gt;
diff --git a/doc/examples/suse-11.3/suse-min-gnome/config.xml b/doc/examples/suse-11.3/suse-min-gnome/config.xml
index a361c33..ddf2d70 100644
--- a/doc/examples/suse-11.3/suse-min-gnome/config.xml
+++ b/doc/examples/suse-11.3/suse-min-gnome/config.xml
@@ -60,7 +60,6 @@
 		&lt;opensusePattern name=&quot;base&quot;/&gt;
 		&lt;opensusePattern name=&quot;x11&quot;/&gt;
 	&lt;/packages&gt;
-	&lt;packages type=&quot;vmx&quot;/&gt;
 	&lt;packages type=&quot;bootstrap&quot;&gt;
 		&lt;package name=&quot;filesystem&quot;/&gt;
 		&lt;package name=&quot;glibc-locale&quot;/&gt;
diff --git a/doc/examples/suse-11.4/suse-min-gnome/config.xml b/doc/examples/suse-11.4/suse-min-gnome/config.xml
index 7f8073e..13be545 100644
--- a/doc/examples/suse-11.4/suse-min-gnome/config.xml
+++ b/doc/examples/suse-11.4/suse-min-gnome/config.xml
@@ -60,7 +60,6 @@
 		&lt;opensusePattern name=&quot;base&quot;/&gt;
 		&lt;opensusePattern name=&quot;x11&quot;/&gt;
 	&lt;/packages&gt;
-	&lt;packages type=&quot;vmx&quot;/&gt;
 	&lt;packages type=&quot;bootstrap&quot;&gt;
 		&lt;package name=&quot;filesystem&quot;/&gt;
 		&lt;package name=&quot;glibc-locale&quot;/&gt;
diff --git a/modules/KIWISharedMem.pm b/modules/KIWISharedMem.pm
index 9780a71..2e7b1b8 100644
--- a/modules/KIWISharedMem.pm
+++ b/modules/KIWISharedMem.pm
@@ -185,4 +185,12 @@ sub closeSegment {
 	return $this;
 }
 
+#==========================================
+# DESTRUCTOR
+#------------------------------------------
+sub DESTROY {
+	my $this = shift;
+	$this -&gt; closeSegment();
+}
+
 1;
diff --git a/modules/KIWIXMLValidator.pm b/modules/KIWIXMLValidator.pm
index 53486c7..f11cc1a 100644
--- a/modules/KIWIXMLValidator.pm
+++ b/modules/KIWIXMLValidator.pm
@@ -335,7 +335,7 @@ sub __checkPatternTypeAttrConsistent {
 		}
 	}
 	# Set up a hash for specified profiles for packages, if a profile is used
-	# multiple times, the value of patternType must be the same for eac use
+	# multiple times, the value of patternType must be the same for each use
 	my %profPatternUseMap = ();
 	for my $pkgs (@pkgsNodes) {
 		my $profiles = $pkgs -&gt; getAttribute( &quot;profiles&quot; );
@@ -409,15 +409,14 @@ sub __checkPatternTypeAttrUse {
 	# ---
 	my $this = shift;
 	my @pkgsNodes = $this-&gt;{systemTree} -&gt; getElementsByTagName(&quot;packages&quot;);
-	my @allowedTypes = qw /bootstrap image/;
+	my @notAllowedTypes = qw /delete/;
 	for my $pkgs (@pkgsNodes) {
 		if ($pkgs -&gt; getAttribute( &quot;patternType&quot; )) {
 			my $type = $pkgs -&gt; getAttribute( &quot;type&quot;);
-			if (! grep /$type/, @allowedTypes) {
+			if (grep /$type/, @notAllowedTypes) {
 				my $kiwi = $this-&gt;{kiwi};
-				my $msg = 'The patternType atribute may only be used for '
-				. '&lt;packages&gt; specification of type &quot;bootstrap&quot; and '
-				. 'type &quot;image&quot;.';
+				my $msg = 'The patternType atribute is not allowed on a '
+				. &quot;&lt;packages&gt; specification of type $type.&quot;;
 				$kiwi -&gt; error ( $msg );
 				$kiwi -&gt; failed ();
 				return undef
@@ -543,7 +542,7 @@ sub __checkReferencedProfDefined {
 			}
 			if (! $foundit) {
 				my $msg = 'Found reference to profile &quot;'
-                  . $profile
+				. $profile
 				  . '&quot; but this profile is not defined.';
 				$kiwi -&gt; error ($msg);
 				$kiwi -&gt; failed ();
diff --git a/tests/unit/data/xmlValidator/patternTattrUseInvalid_2.xml b/tests/unit/data/xmlValidator/patternTattrUseValid_4.xml
similarity index 100%
rename from tests/unit/data/xmlValidator/patternTattrUseInvalid_2.xml
rename to tests/unit/data/xmlValidator/patternTattrUseValid_4.xml
diff --git a/tests/unit/data/xmlValidator/patternTattrUseInvalid_3.xml b/tests/unit/data/xmlValidator/patternTattrUseValid_5.xml
similarity index 100%
rename from tests/unit/data/xmlValidator/patternTattrUseInvalid_3.xml
rename to tests/unit/data/xmlValidator/patternTattrUseValid_5.xml
diff --git a/tests/unit/data/xmlValidator/patternTattrUseInvalid_4.xml b/tests/unit/data/xmlValidator/patternTattrUseValid_6.xml
similarity index 100%
rename from tests/unit/data/xmlValidator/patternTattrUseInvalid_4.xml
rename to tests/unit/data/xmlValidator/patternTattrUseValid_6.xml
diff --git a/tests/unit/data/xmlValidator/patternTattrUseInvalid_5.xml b/tests/unit/data/xmlValidator/patternTattrUseValid_7.xml
similarity index 100%
rename from tests/unit/data/xmlValidator/patternTattrUseInvalid_5.xml
rename to tests/unit/data/xmlValidator/patternTattrUseValid_7.xml
diff --git a/tests/unit/data/xmlValidator/patternTattrUseInvalid_6.xml b/tests/unit/data/xmlValidator/patternTattrUseValid_8.xml
similarity index 100%
rename from tests/unit/data/xmlValidator/patternTattrUseInvalid_6.xml
rename to tests/unit/data/xmlValidator/patternTattrUseValid_8.xml
diff --git a/tests/unit/data/xmlValidator/patternTattrUseInvalid_7.xml b/tests/unit/data/xmlValidator/patternTattrUseValid_9.xml
similarity index 100%
rename from tests/unit/data/xmlValidator/patternTattrUseInvalid_7.xml
rename to tests/unit/data/xmlValidator/patternTattrUseValid_9.xml
diff --git a/tests/unit/lib/Test/xmlValidator.pm b/tests/unit/lib/Test/xmlValidator.pm
index e59f1a5..c9cbedd 100644
--- a/tests/unit/lib/Test/xmlValidator.pm
+++ b/tests/unit/lib/Test/xmlValidator.pm
@@ -418,8 +418,8 @@ sub test_patternTattrUse {
 		$validator -&gt; validate();
 		my $kiwi = $this -&gt; {kiwi};
 		my $msg = $kiwi -&gt; getMessage();
-		my $expectedMsg = 'The patternType atribute may only be used for '
-		. '&lt;packages&gt; specification of type &quot;bootstrap&quot; and type &quot;image&quot;.';
+		my $expectedMsg = 'The patternType atribute is not allowed on a '
+		. '&lt;packages&gt; specification of type delete.';
 		$this -&gt; assert_str_equals($expectedMsg, $msg);
 		my $msgT = $kiwi -&gt; getMessageType();
 		$this -&gt; assert_str_equals('error', $msgT);


hooks/post-receive
-- 
Project kiwi at BerliOS

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="003104.html">[Kiwi-devel] no whitespace in profile name
</A></li>
	<LI>Next message: <A HREF="003105.html">[Kiwi-devel] [Git]Project kiwi at BerliOS branch, master,	updated. d32fb17debadd5fa678e69503183bf70ad1eeb51
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3103">[ date ]</a>
              <a href="thread.html#3103">[ thread ]</a>
              <a href="subject.html#3103">[ subject ]</a>
              <a href="author.html#3103">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/kiwi-devel">More information about the Kiwi-devel
mailing list</a><br>
</body></html>

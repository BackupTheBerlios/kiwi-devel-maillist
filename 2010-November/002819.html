<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Kiwi-devel] [Git]Project kiwi at BerliOS branch, master,	updated. 47cce9945c4057a9a644b8054781b16f42e02f81
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/kiwi-devel/2010-November/index.html" >
   <LINK REL="made" HREF="mailto:kiwi-devel%40lists.berlios.de?Subject=Re%3A%20%5BKiwi-devel%5D%20%5BGit%5DProject%20kiwi%20at%20BerliOS%20branch%2C%20master%2C%0A%09updated.%2047cce9945c4057a9a644b8054781b16f42e02f81&In-Reply-To=%3C20101117074913.6B5BC480F4E%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002818.html">
   <LINK REL="Next"  HREF="002820.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Kiwi-devel] [Git]Project kiwi at BerliOS branch, master,	updated. 47cce9945c4057a9a644b8054781b16f42e02f81</H1>
    <B>marcus_schaefer at BerliOS</B> 
    <A HREF="mailto:kiwi-devel%40lists.berlios.de?Subject=Re%3A%20%5BKiwi-devel%5D%20%5BGit%5DProject%20kiwi%20at%20BerliOS%20branch%2C%20master%2C%0A%09updated.%2047cce9945c4057a9a644b8054781b16f42e02f81&In-Reply-To=%3C20101117074913.6B5BC480F4E%40sheep.berlios.de%3E"
       TITLE="[Kiwi-devel] [Git]Project kiwi at BerliOS branch, master,	updated. 47cce9945c4057a9a644b8054781b16f42e02f81">marcus_schaefer at mail.berlios.de
       </A><BR>
    <I>Wed Nov 17 08:49:12 CET 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="002818.html">[Kiwi-devel] fix bug in format conversion for qcow2
</A></li>
        <LI>Next message: <A HREF="002820.html">[Kiwi-devel] [Git]Project kiwi at BerliOS branch, master,	updated. cdeeb70df478f601032e2a6e48a164e456090992
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2819">[ date ]</a>
              <a href="thread.html#2819">[ thread ]</a>
              <a href="subject.html#2819">[ subject ]</a>
              <a href="author.html#2819">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>This is an automated email from the git hooks/post-receive script. It was
generated because a ref change was pushed to the repository containing
the project &quot;Project kiwi at BerliOS&quot;.

The branch, master has been updated
       via  47cce9945c4057a9a644b8054781b16f42e02f81 (commit)
       via  f9eed56df8c9125dc946de5b640d5996dfa77738 (commit)
       via  e246e1e082a5b42bef5cbbf5757a9a3bb3e4a104 (commit)
       via  e6b9f01ab2dc625769f5d9c9d6cc640509d9011f (commit)
       via  51bd699fc83a749bd9b4631e9b26a7514a9322e8 (commit)
      from  cfab5ad6479ebe0cca09481b9b02dbb33e529934 (commit)

Those revisions listed above that are new to this repository have
not appeared on any other notification email; so we list those
revisions in full, below.

- Log -----------------------------------------------------------------
commit 47cce9945c4057a9a644b8054781b16f42e02f81
Author: Marcus Sch&#195;&#164;fer &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/kiwi-devel">ms at novell.com</A>&gt;
Date:   Wed Nov 17 08:47:01 2010 +0100

    - update documentation for oem-unattended mode

commit f9eed56df8c9125dc946de5b640d5996dfa77738
Author: Marcus Sch&#195;&#164;fer &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/kiwi-devel">ms at novell.com</A>&gt;
Date:   Wed Nov 17 08:45:40 2010 +0100

    - if in oem-unattended mode and we found more than one disk for
      installation, use the first disk found by hwinfo

commit e246e1e082a5b42bef5cbbf5757a9a3bb3e4a104
Author: Marcus Sch&#195;&#164;fer &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/kiwi-devel">ms at novell.com</A>&gt;
Date:   Wed Nov 17 08:33:28 2010 +0100

    - fix bug in the format conversion from raw to qcow2.
      The 'convert' command to qemu-mig was missing.

commit e6b9f01ab2dc625769f5d9c9d6cc640509d9011f
Author: Marcus Sch&#195;&#164;fer &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/kiwi-devel">ms at novell.com</A>&gt;
Date:   Wed Nov 17 08:29:33 2010 +0100

    - move the two consistency checks (kiwirevision and
      version format) out of the KIWIXML constructor and into
      their own methods
    
    - Implement a new consistency check, __checkFilesysSpec().
      This method assures that the 'filesystem' attribute is used
      for image types that require the attribute

commit 51bd699fc83a749bd9b4631e9b26a7514a9322e8
Author: Marcus Sch&#195;&#164;fer &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/kiwi-devel">ms at novell.com</A>&gt;
Date:   Tue Nov 16 19:03:39 2010 +0100

    - fixed creation and use of kiwi caches for boot images
      also make sure the same clicfs cache is mounted only once
      and is released in case of an exception

-----------------------------------------------------------------------

Summary of changes:
diff --git a/Makefile b/Makefile
index a89abf2..392b466 100644
--- a/Makefile
+++ b/Makefile
@@ -156,7 +156,7 @@ modules/KIWISchema.rng: modules/KIWISchema.rnc
 	#============================================
 	# Check RNG Schema...
 	#--------------------------------------------
-	for i in `find -name config.xml`;do \
+	for i in `find -name config.xml` modules/KIWICache.kiwi;do \
 		test -f xsl/master.xsl &amp;&amp; \
 			xsltproc -o $$i.new xsl/master.xsl $$i &amp;&amp; mv $$i.new $$i;\
 		echo $$i; j=`jing modules/KIWISchema.rng $$i`;if test ! -z &quot;$$j&quot;;then\
diff --git a/doc/docbook/kiwi-doc-description.xml b/doc/docbook/kiwi-doc-description.xml
index bfa5b0f..4f0eec6 100644
--- a/doc/docbook/kiwi-doc-description.xml
+++ b/doc/docbook/kiwi-doc-description.xml
@@ -793,7 +793,7 @@
               &lt;/varlistentry&gt;
               &lt;varlistentry&gt;
                 &lt;term&gt;&lt;sgmltag class=&quot;starttag&quot;
-                    &gt;oem-reboot&lt;/sgmltag&gt;true|false&lt;sgmltag
+                    &gt;oem-bootwait&lt;/sgmltag&gt;true|false&lt;sgmltag
                     class=&quot;endtag&quot;&gt;oem-bootwait&lt;/sgmltag&gt;&lt;/term&gt;
                 &lt;listitem&gt;
                   &lt;para&gt;Specify if the system should wait for user interaction
@@ -838,7 +838,7 @@
               &lt;/varlistentry&gt;
               &lt;varlistentry&gt;
                 &lt;term&gt;&lt;sgmltag class=&quot;starttag&quot;
-                    &gt;oem-reboot&lt;/sgmltag&gt;true|false&lt;sgmltag
+                    &gt;oem-reboot-interactive&lt;/sgmltag&gt;true|false&lt;sgmltag
                     class=&quot;endtag&quot;&gt;oem-reboot-interactive&lt;/sgmltag&gt;&lt;/term&gt;
                 &lt;listitem&gt;
                   &lt;para&gt;Specify if the system is to be rebooted after
@@ -888,7 +888,7 @@
               &lt;/varlistentry&gt;
               &lt;varlistentry&gt;
                 &lt;term&gt;&lt;sgmltag class=&quot;starttag&quot;
-                    &gt;oem-reboot&lt;/sgmltag&gt;true|false&lt;sgmltag
+                    &gt;oem-shutdown&lt;/sgmltag&gt;true|false&lt;sgmltag
                     class=&quot;endtag&quot;&gt;oem-shutdown&lt;/sgmltag&gt;&lt;/term&gt;
                 &lt;listitem&gt;
                   &lt;para&gt;Specify if the system is to be powered down after
@@ -901,7 +901,7 @@
               &lt;/varlistentry&gt;
               &lt;varlistentry&gt;
                 &lt;term&gt;&lt;sgmltag class=&quot;starttag&quot;
-                    &gt;oem-reboot&lt;/sgmltag&gt;true|false&lt;sgmltag
+                    &gt;oem-shutdown-interactive&lt;/sgmltag&gt;true|false&lt;sgmltag
                     class=&quot;endtag&quot;&gt;oem-shutdown-interactive&lt;/sgmltag&gt;&lt;/term&gt;
                 &lt;listitem&gt;
                   &lt;para&gt;Specify if the system is to be powered down after
@@ -953,6 +953,19 @@
                       &lt;filename&gt;config.oempartition&lt;/filename&gt;. &lt;/para&gt;
                 &lt;/listitem&gt;
               &lt;/varlistentry&gt;
+              &lt;varlistentry&gt;
+                &lt;term&gt;&lt;sgmltag class=&quot;starttag&quot;
+                  &gt;oem-unattended&lt;/sgmltag&gt;true|false&lt;sgmltag
+                    class=&quot;endtag&quot;&gt;oem-unattended&lt;/sgmltag&gt;&lt;/term&gt;
+                &lt;listitem&gt;
+                  &lt;para&gt;The installation of the image to the target system
+                      occurs automatically without requiering user
+                      interaction. If multiple possible target devices are
+                      discovered the image is deployed to the first device.
+                      &lt;varname&gt;OEM_UNATTENDED&lt;/varname&gt; in
+                      &lt;filename&gt;config.oempartition&lt;/filename&gt;. &lt;/para&gt;
+                &lt;/listitem&gt;
+              &lt;/varlistentry&gt;
             &lt;/variablelist&gt;
           &lt;/listitem&gt;
         &lt;/varlistentry&gt;
diff --git a/kiwi.pl b/kiwi.pl
index 9ac50c7..755f8be 100755
--- a/kiwi.pl
+++ b/kiwi.pl
@@ -389,18 +389,6 @@ sub main {
 		}
 		my %type = %{$xml-&gt;getImageTypeAndAttributes()};
 		#==========================================
-		# Setup image cache if requested
-		#------------------------------------------
-		if ($ImageCache) {
-			my $cacheInit = initializeCache($xml,\%type);
-			if (! selectCache ($xml,$cacheInit)) {
-				if (createCache ($xml,$cacheInit)) {
-					selectCache ($xml,$cacheInit);
-				}
-			}
-			undef $ImageCache;
-		}
-		#==========================================
 		# Check for bootprofile in xml descr.
 		#------------------------------------------
 		if (! @Profiles) {
@@ -528,6 +516,19 @@ sub main {
 			my $code = kiwiExit (1); return $code;
 		}
 		#==========================================
+		# Setup image cache if requested
+		#------------------------------------------
+		if ($ImageCache) {
+			my $cacheInit = initializeCache($xml,\%type);
+			if (! selectCache ($xml,$cacheInit)) {
+				if (createCache ($xml,$cacheInit)) {
+					selectCache ($xml,$cacheInit);
+				}
+				my $code = kiwiExit (1); return $code;
+			}
+			undef $ImageCache;
+		}
+		#==========================================
 		# Initialize root system
 		#------------------------------------------
 		$root = new KIWIRoot (
@@ -605,7 +606,7 @@ sub main {
 		#==========================================
 		# Check for overlay meta data...
 		#------------------------------------------
-		if (-f &quot;$Create/kiwi-root.cache&quot;) {
+		if ((! defined $BaseRoot) &amp;&amp; (-f &quot;$Create/kiwi-root.cache&quot;)) {
 			my $FD; if (! open ($FD,&quot;$Create/kiwi-root.cache&quot;)) {
 				$kiwi -&gt; error  (&quot;Can't open baseroot meta data&quot;);
 				$kiwi -&gt; failed ();
@@ -758,7 +759,7 @@ sub main {
 				$kiwi -&gt; failed ();
 				$kiwi -&gt; info   (&quot;No destination directory specified&quot;);
 				$kiwi -&gt; failed ();
-				if ((defined $BaseRoot) &amp;&amp; ($overlay)) {
+				if ((defined $BaseRootMode) &amp;&amp; ($overlay)) {
 					$overlay -&gt; resetOverlay();
 				}
 				my $code = kiwiExit (1); return $code;
@@ -794,7 +795,7 @@ sub main {
 		#------------------------------------------
 		my $dirCreated = createDirInteractive($kiwi, $Destination);
 		if (! defined $dirCreated) {
-			if (defined $BaseRoot) {
+			if ((defined $BaseRootMode) &amp;&amp; ($overlay)) {
 				$overlay -&gt; resetOverlay();
 			}
 			my $code = kiwiExit (1); return $code;
@@ -810,7 +811,7 @@ sub main {
 		#------------------------------------------
 		my $para = checkType ( \%attr );
 		if (! defined $para) {
-			if (defined $BaseRoot) {
+			if ((defined $BaseRootMode) &amp;&amp; ($overlay)) {
 				$overlay -&gt; resetOverlay();
 			}
 			my $code = kiwiExit (1); return $code;
@@ -823,7 +824,7 @@ sub main {
 			&quot;/base-system&quot;,$origroot
 		);
 		if (! defined $image) {
-			if (defined $BaseRoot) {
+			if ((defined $BaseRootMode) &amp;&amp; ($overlay)) {
 				$overlay -&gt; resetOverlay();
 			}
 			my $code = kiwiExit (1); return $code;
@@ -836,13 +837,13 @@ sub main {
 				$kiwi,$xml,$Create,$Create.&quot;/image&quot;,$Destination
 			);
 			if (! defined $configure) {
-				if (defined $BaseRoot) {
+				if ((defined $BaseRootMode) &amp;&amp; ($overlay)) {
 					$overlay -&gt; resetOverlay();
 				}
 				my $code = kiwiExit (1); return $code;
 			}
 			if (! $configure -&gt; setupRecoveryArchive($attr{filesystem})) {
-				if (defined $BaseRoot) {
+				if ((defined $BaseRootMode) &amp;&amp; ($overlay)) {
 					$overlay -&gt; resetOverlay();
 				}
 				my $code = kiwiExit (1); return $code;
@@ -915,12 +916,12 @@ sub main {
 			};
 			$kiwi -&gt; error  (&quot;Unsupported type: $attr{type}&quot;);
 			$kiwi -&gt; failed ();
-			if (defined $BaseRoot) {
+			if ((defined $BaseRootMode) &amp;&amp; ($overlay)) {
 				$overlay -&gt; resetOverlay();
 			}
 			my $code = kiwiExit (1); return $code;
 		}
-		if (defined $BaseRoot) {
+		if ((defined $BaseRootMode) &amp;&amp; ($overlay)) {
 			$overlay -&gt; resetOverlay();
 		}
 		if ($ok) {
@@ -1064,6 +1065,18 @@ sub main {
 			my $code = kiwiExit (1); return $code;
 		}
 		#==========================================
+		# Check for overlay meta data...
+		#------------------------------------------
+		if ((! defined $BaseRoot) &amp;&amp; (-f &quot;$Upgrade/kiwi-root.cache&quot;)) {
+			my $FD; if (! open ($FD,&quot;$Upgrade/kiwi-root.cache&quot;)) {
+				$kiwi -&gt; error  (&quot;Can't open baseroot meta data&quot;);
+				$kiwi -&gt; failed ();
+				my $code = kiwiExit (1); return $code;
+			}
+			$BaseRoot = &lt;$FD&gt;; close $FD; chomp $BaseRoot;
+			$BaseRootMode = &quot;union&quot;;
+		}
+		#==========================================
 		# Check for default base root in XML
 		#------------------------------------------
 		if (! defined $BaseRoot) {
@@ -3029,7 +3042,10 @@ sub initializeCache {
 	#==========================================
 	# Check boot type of the image
 	#------------------------------------------
-	if ($type{boot} =~ /.*\/(.*)/) {
+	my $name = $xml -&gt; getImageName();
+	if (($type{boot}) &amp;&amp; ($type{boot} =~ /.*\/(.*)/)) {
+		$CacheDistro = $1;
+	} elsif (($type{type} eq &quot;cpio&quot;) &amp;&amp; ($name =~ /initrd-.*boot-(.*)/)) {
 		$CacheDistro = $1;
 	} else {
 		$kiwi -&gt; warning (&quot;Can't setup cache without a boot type&quot;);
@@ -3211,6 +3227,7 @@ sub createCache {
 	# Variable setup and reset function
 	#------------------------------------------
 	sub reset_sub {
+		my @backupProfiles     = @main::Profiles;
 		my $backupPrepare      = $main::Prepare;
 		my $backupRootTree     = $main::RootTree;
 		my $backupForceNewRoot = $main::ForceNewRoot;
@@ -3218,6 +3235,7 @@ sub createCache {
 		my @backupPackages     = @main::AddPackage;
 		my $backupImageCache   = $main::ImageCache;
 		return sub {
+			@main::Profiles     = @backupProfiles;
 			$main::Prepare      = $backupPrepare;
 			$main::ForceNewRoot = $backupForceNewRoot;
 			@main::AddPattern   = @backupPatterns;
@@ -3255,18 +3273,22 @@ sub createCache {
 			push @CachePackages,$xml-&gt;getPackageManager();
 			undef @main::AddPattern;
 			@main::AddPackage = @CachePackages;
+			$kiwi -&gt; info (
+				&quot;--&gt; Building cache file for plain package list\n&quot;
+			);
 		} else {
 			@main::AddPackage = $xml-&gt;getPackageManager();
 			@main::AddPattern = $pattern;
+			$kiwi -&gt; info (
+				&quot;--&gt; Building cache file for pattern: $pattern\n&quot;
+			);
 		}
-		$kiwi -&gt; info (
-			&quot;--&gt; Building cache file for pattern: $pattern\n&quot;
-		);
 		$main::Prepare      = $BasePath.&quot;/modules&quot;;
 		$main::RootTree     = $imageCacheDir.&quot;/&quot;;
 		$main::RootTree    .= $CacheDistro.&quot;-&quot;.$pattern;
 		$main::Survive      = &quot;yes&quot;;
 		$main::ForceNewRoot = 1;
+		undef @main::Profiles;
 		#==========================================
 		# Prepare new cache tree
 		#------------------------------------------
@@ -3288,7 +3310,7 @@ sub createCache {
 		# Turn cache into clicfs file
 		#------------------------------------------
 		$kiwi -&gt; info (
-			&quot;--&gt; Building clicfs cache for pattern: $pattern\n&quot;
+			&quot;--&gt; Building clicfs cache...\n&quot;
 		);
 		my $image = new KIWIImage (
 			$kiwi,$xml,$root,$imageCacheDir,undef,&quot;/base-system&quot;
@@ -3302,6 +3324,7 @@ sub createCache {
 		my $name = $imageCacheDir.&quot;/&quot;.$image -&gt; buildImageName();
 		qxx (&quot;mv $name $main::RootTree.clicfs&quot;);
 		qxx (&quot;rm $name.clicfs $name.md5&quot;);
+		qxx (&quot;rm -f  $imageCacheDir/initrd-*&quot;);
 		qxx (&quot;rm -rf $main::RootTree&quot;);
 	}
 	&amp;{$resetVariables};
diff --git a/modules/KIWICache.kiwi b/modules/KIWICache.kiwi
index 7619a3c..c358090 100644
--- a/modules/KIWICache.kiwi
+++ b/modules/KIWICache.kiwi
@@ -1,6 +1,6 @@
 &lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
 
-&lt;image schemaversion=&quot;4.7&quot; name=&quot;cache-builder&quot;&gt;
+&lt;image schemaversion=&quot;5.0&quot; name=&quot;cache-builder&quot;&gt;
 	&lt;description type=&quot;system&quot;&gt;
 		&lt;author&gt;Marcus Sch&#195;&#164;fer&lt;/author&gt;
 		&lt;contact&gt;<A HREF="https://lists.berlios.de/mailman/listinfo/kiwi-devel">ms at novell.com</A>&lt;/contact&gt;
@@ -17,9 +17,7 @@
 	&lt;repository type=&quot;yast2&quot;&gt;
 		&lt;source path=&quot;some-repo-path&quot;/&gt;
 	&lt;/repository&gt;
-	&lt;packages type=&quot;image&quot;&gt;
-		&lt;!-- patterns for building the cache are added on the fly here --&gt;
-	&lt;/packages&gt;
+	&lt;packages type=&quot;image&quot;&gt;&lt;!-- patterns and packages for building the cache are added on the fly here --&gt;&lt;/packages&gt;
 	&lt;packages type=&quot;bootstrap&quot;&gt;
 		&lt;package name=&quot;filesystem&quot;/&gt;
 		&lt;package name=&quot;glibc-locale&quot;/&gt;
diff --git a/modules/KIWIImage.pm b/modules/KIWIImage.pm
index f7feb8f..f128e79 100644
--- a/modules/KIWIImage.pm
+++ b/modules/KIWIImage.pm
@@ -728,6 +728,7 @@ sub createImageUSB {
 	$main::Survive  = &quot;yes&quot;;
 	$main::RootTree = &quot;$tmpdir/kiwi-&quot;.$text.&quot;boot-$$&quot;;
 	$main::Prepare  = $boot;
+	undef $main::BaseRoot;
 	if (defined $type{baseroot}) {
 		$main::BaseRoot = $type{baseroot};
 	}
@@ -1356,6 +1357,7 @@ sub createImageLiveCD {
 	$main::Survive  = &quot;yes&quot;;
 	$main::RootTree = &quot;$tmpdir/kiwi-cdboot-$$&quot;;
 	$main::Prepare  = $boot;
+	undef $main::BaseRoot;
 	if (defined $type{baseroot}) {
 		$main::BaseRoot = $type{baseroot};
 	}
diff --git a/modules/KIWIImageFormat.pm b/modules/KIWIImageFormat.pm
index e8ad3da..04ccafa 100644
--- a/modules/KIWIImageFormat.pm
+++ b/modules/KIWIImageFormat.pm
@@ -325,7 +325,7 @@ sub createQCOW2 {
 	my $result;
 	$kiwi -&gt; info (&quot;Creating $format image...&quot;);
 	$target  =~ s/\.raw$/\.$format/;
-	$status = qxx (&quot;qemu-img -f raw $source -O $format $target 2&gt;&amp;1&quot;);
+	$status = qxx (&quot;qemu-img convert -f raw $source -O $format $target 2&gt;&amp;1&quot;);
 	$result = $? &gt;&gt; 8;
 	if ($result != 0) {
 		$kiwi -&gt; failed ();
diff --git a/modules/KIWIOverlay.pm b/modules/KIWIOverlay.pm
index 2f7d332..e756217 100644
--- a/modules/KIWIOverlay.pm
+++ b/modules/KIWIOverlay.pm
@@ -297,4 +297,13 @@ sub resetOverlay {
 	return $this;
 }
 
+#==========================================
+# Destructor
+#------------------------------------------
+sub DESTROY {
+	my $this = shift;
+	$this -&gt; resetOverlay();
+	return $this;
+}
+
 1;
diff --git a/modules/KIWISchema.rnc b/modules/KIWISchema.rnc
index c01b8bd..ac969de 100644
--- a/modules/KIWISchema.rnc
+++ b/modules/KIWISchema.rnc
@@ -1155,7 +1155,7 @@ div {
 	k.oem-shutdown.attlist = empty
 	k.oem-shutdown =
 		## For oemboot driven images: shutdown after first deployment 
-        ## true/false
+		## true/false
 		[
 		db:para [
 			&quot;For oemboot driven images: shutdown after first deployment &quot;~
@@ -1177,7 +1177,7 @@ div {
 	k.oem-shutdown-interactive.attlist = empty
 	k.oem-shutdown-interactive =
 		## For oemboot driven images: shutdown after first deployment 
-        ## true/false
+		## true/false
 		[
 		db:para [
 			&quot;For oemboot driven images: shutdown after first deployment &quot;~
@@ -1222,10 +1222,12 @@ div {
 	k.oem-unattended.content = xsd:boolean
 	k.oem-unattended.attlist = empty
 	k.oem-unattended =
-		## For oemboot driven images: don't ask questions if possible y/n
+		## For oemboot driven images: don't ask questions if possible
+		## true/false
 		[
 		db:para [
-			&quot;For oemboot driven images: don't ask questions if possible y/n&quot;
+			&quot;For oemboot driven images: don't ask questions if&quot;~
+            &quot;possible true/false&quot;
 		]
 		]
 		element oem-unattended {
diff --git a/modules/KIWISchema.rng b/modules/KIWISchema.rng
index 6f5c22e..8d4bf47 100644
--- a/modules/KIWISchema.rng
+++ b/modules/KIWISchema.rng
@@ -1660,8 +1660,9 @@ true/false&lt;/a:documentation&gt;
     &lt;/define&gt;
     &lt;define name=&quot;k.oem-unattended&quot;&gt;
       &lt;element name=&quot;oem-unattended&quot;&gt;
-        &lt;a:documentation&gt;For oemboot driven images: don't ask questions if possible y/n&lt;/a:documentation&gt;
-        &lt;db:para&gt;For oemboot driven images: don't ask questions if possible y/n&lt;/db:para&gt;
+        &lt;a:documentation&gt;For oemboot driven images: don't ask questions if possible
+true/false&lt;/a:documentation&gt;
+        &lt;db:para&gt;For oemboot driven images: don't ask questions ifpossible true/false&lt;/db:para&gt;
         &lt;ref name=&quot;k.oem-unattended.attlist&quot;/&gt;
         &lt;ref name=&quot;k.oem-unattended.content&quot;/&gt;
       &lt;/element&gt;
diff --git a/modules/KIWIXML.pm b/modules/KIWIXML.pm
index caac1c6..83569a1 100644
--- a/modules/KIWIXML.pm
+++ b/modules/KIWIXML.pm
@@ -170,33 +170,6 @@ sub new {
 	$this-&gt;{reqProfiles}     = $reqProfiles;
 	$this-&gt;{profilesNodeList}= $profilesNodeList;
 	#==========================================
-	# Check kiwirevision attribute
-	#------------------------------------------
-	if (open (my $FD,$main::Revision)) {
-		my $cur_rev = &lt;$FD&gt;; close $FD;
-		my $req_rev = $imgnameNodeList
-			-&gt; get_node(1) -&gt; getAttribute (&quot;kiwirevision&quot;);
-		if ((defined $req_rev) &amp;&amp; ($cur_rev &lt; $req_rev)) {
-			$kiwi -&gt; failed ();
-			$kiwi -&gt; error  (
-				&quot;KIWI revision too old, require r$req_rev got r$cur_rev&quot;
-			);
-			$kiwi -&gt; failed ();
-			return undef;
-		}
-	}
-	#==========================================
-	# Check image version format
-	#------------------------------------------
-	my $version = $this -&gt; getImageVersion();
-	if ($version !~ /^\d+\.\d+\.\d+$/) {
-		$kiwi -&gt; error  (&quot;Invalid version format: $version&quot;);
-		$kiwi -&gt; failed ();
-		$kiwi -&gt; error  (&quot;Expected 'Major.Minor.Release'&quot;);
-		$kiwi -&gt; failed ();
-		return undef;
-	}
-	#==========================================
 	# Apply default profiles from XML if set
 	#------------------------------------------
 	$this -&gt; setDefaultProfiles();
@@ -4517,6 +4490,39 @@ sub getVMConfigOpts {
 # Private helper methods
 #------------------------------------------
 #==========================================
+# __checkFilesysSpec
+#------------------------------------------
+sub __checkFilesysSpec {
+	# ...
+	# It is necessary to specify the filesystem attribute for certain
+	# image types. Make sure the attribute is specified when required.
+	# ---
+	my $this = shift;
+	my $isInvalid;
+	my $kiwi = $this-&gt;{kiwi};
+	my @typeNodes = $this-&gt;{systemTree} -&gt; getElementsByTagName(&quot;type&quot;);
+	my @typesReqFS = qw /oem usb vmx/;
+	for my $typeN (@typeNodes) {
+		my $imgType = $typeN -&gt; getAttribute( &quot;image&quot; );
+		if (grep /$imgType/, @typesReqFS) {
+			my $hasFSattr = $typeN -&gt; getAttribute( &quot;filesystem&quot; );
+			if (! $hasFSattr) {
+				my $msg = 'filesystem attribute must be set for image=&quot;'
+				. $imgType
+				. '&quot;';
+				$kiwi -&gt; error ( $msg );
+				$kiwi -&gt; failed ();
+				$isInvalid = 1;
+			}
+		}
+	}
+	if ($isInvalid) {
+		return undef;
+	}
+	return 1;
+}
+
+#==========================================
 # __checkPostDumpAction
 #------------------------------------------
 sub __checkPostDumpAction {
@@ -4557,6 +4563,53 @@ sub __checkPostDumpAction {
 }
 
 #==========================================
+# __checkRevision
+#------------------------------------------
+sub __checkRevision {
+	# ...
+	# Check that the current revision meets the minimum requirement
+	# ---
+	my $this = shift;
+	my $kiwi = $this-&gt;{kiwi};
+	if (open (my $FD,$main::Revision)) {
+		my $cur_rev = &lt;$FD&gt;; close $FD;
+		my $req_rev = $this-&gt;{imgnameNodeList}
+			-&gt; get_node(1) -&gt; getAttribute (&quot;kiwirevision&quot;);
+		if ((defined $req_rev) &amp;&amp; ($cur_rev &lt; $req_rev)) {
+			$kiwi -&gt; failed ();
+			$kiwi -&gt; error  (
+				&quot;KIWI revision too old, require r$req_rev got r$cur_rev&quot;
+			);
+			$kiwi -&gt; failed ();
+			return undef;
+		}
+	}
+	return 1;
+}
+
+#==========================================
+# __checkVersionFormat
+#------------------------------------------
+sub __checkVersionFormat {
+	# ...
+	# Check image version format
+	# This check should be implemented in the schema but there is a
+	# bug in libxml2 that prevents proper type validation for elements
+	# ---
+	my $this = shift;
+	my $kiwi = $this-&gt;{kiwi};
+	my $version = $this -&gt; getImageVersion();
+	if ($version !~ /^\d+\.\d+\.\d+$/) {
+		$kiwi -&gt; error  (&quot;Invalid version format: $version&quot;);
+		$kiwi -&gt; failed ();
+		$kiwi -&gt; error  (&quot;Expected 'Major.Minor.Release'&quot;);
+		$kiwi -&gt; failed ();
+		return undef;
+	}
+	return 1;
+}
+
+#==========================================
 # __getXMLDocTree
 #------------------------------------------
 sub __getXMLDocTree {
@@ -4620,9 +4673,18 @@ sub __validateConsistency {
 	# elements and attributes as well as certain values.
 	# ---
 	my $this = shift;
+	if (! $this -&gt; __checkRevision()) {
+		return undef;
+	}
+	if (! $this -&gt; __checkVersionFormat()) {
+		return undef;
+	}
 	if (! $this -&gt; __checkPostDumpAction()) {
 		return undef;
 	}
+	if (! $this -&gt; __checkFilesysSpec()) {
+		return undef;
+	}
 	return 1;
 }
 
diff --git a/system/boot/ix86/oemboot/suse-dump b/system/boot/ix86/oemboot/suse-dump
index b71ebb8..b614b42 100755
--- a/system/boot/ix86/oemboot/suse-dump
+++ b/system/boot/ix86/oemboot/suse-dump
@@ -207,6 +207,11 @@ function OEMInstall {
 		# Found one single disk... use it
 		#--------------------------------------
 		instDisk=${deviceArray[0]}
+	elif [ ! -z &quot;$kiwi_oemunattended&quot; ];then
+		#======================================
+		# Unattended mode... use first disk
+		#--------------------------------------
+		instDisk=${deviceArray[0]}
 	else
 		#======================================
 		# Found multiple disks...
diff --git a/system/boot/s390/oemboot/suse-dump b/system/boot/s390/oemboot/suse-dump
index b71ebb8..b614b42 100755
--- a/system/boot/s390/oemboot/suse-dump
+++ b/system/boot/s390/oemboot/suse-dump
@@ -207,6 +207,11 @@ function OEMInstall {
 		# Found one single disk... use it
 		#--------------------------------------
 		instDisk=${deviceArray[0]}
+	elif [ ! -z &quot;$kiwi_oemunattended&quot; ];then
+		#======================================
+		# Unattended mode... use first disk
+		#--------------------------------------
+		instDisk=${deviceArray[0]}
 	else
 		#======================================
 		# Found multiple disks...


hooks/post-receive
-- 
Project kiwi at BerliOS

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002818.html">[Kiwi-devel] fix bug in format conversion for qcow2
</A></li>
	<LI>Next message: <A HREF="002820.html">[Kiwi-devel] [Git]Project kiwi at BerliOS branch, master,	updated. cdeeb70df478f601032e2a6e48a164e456090992
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2819">[ date ]</a>
              <a href="thread.html#2819">[ thread ]</a>
              <a href="subject.html#2819">[ subject ]</a>
              <a href="author.html#2819">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/kiwi-devel">More information about the Kiwi-devel
mailing list</a><br>
</body></html>

<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Kiwi-devel] [Git]Project kiwi at BerliOS branch, master,	updated. 021e62dc8cb35ac46457541710efd0ac058514ba
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/kiwi-devel/2010-November/index.html" >
   <LINK REL="made" HREF="mailto:kiwi-devel%40lists.berlios.de?Subject=Re%3A%20%5BKiwi-devel%5D%20%5BGit%5DProject%20kiwi%20at%20BerliOS%20branch%2C%20master%2C%0A%09updated.%20021e62dc8cb35ac46457541710efd0ac058514ba&In-Reply-To=%3C20101116092115.2B9AB48027F%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002807.html">
   <LINK REL="Next"  HREF="002810.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Kiwi-devel] [Git]Project kiwi at BerliOS branch, master,	updated. 021e62dc8cb35ac46457541710efd0ac058514ba</H1>
    <B>marcus_schaefer at BerliOS</B> 
    <A HREF="mailto:kiwi-devel%40lists.berlios.de?Subject=Re%3A%20%5BKiwi-devel%5D%20%5BGit%5DProject%20kiwi%20at%20BerliOS%20branch%2C%20master%2C%0A%09updated.%20021e62dc8cb35ac46457541710efd0ac058514ba&In-Reply-To=%3C20101116092115.2B9AB48027F%40sheep.berlios.de%3E"
       TITLE="[Kiwi-devel] [Git]Project kiwi at BerliOS branch, master,	updated. 021e62dc8cb35ac46457541710efd0ac058514ba">marcus_schaefer at mail.berlios.de
       </A><BR>
    <I>Tue Nov 16 10:21:14 CET 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="002807.html">[Kiwi-devel] support sepc of VM config file options
</A></li>
        <LI>Next message: <A HREF="002810.html">[Kiwi-devel] [Git]Project kiwi at BerliOS branch, master,	updated. c7cffdeb20f0718e745eeb5c58ddfa30aac475a0
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2809">[ date ]</a>
              <a href="thread.html#2809">[ thread ]</a>
              <a href="subject.html#2809">[ subject ]</a>
              <a href="author.html#2809">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>This is an automated email from the git hooks/post-receive script. It was
generated because a ref change was pushed to the repository containing
the project &quot;Project kiwi at BerliOS&quot;.

The branch, master has been updated
       via  021e62dc8cb35ac46457541710efd0ac058514ba (commit)
      from  729fd7dcee7855a56ff1d38c2b9697e2cc1bce77 (commit)

Those revisions listed above that are new to this repository have
not appeared on any other notification email; so we list those
revisions in full, below.

- Log -----------------------------------------------------------------
commit 021e62dc8cb35ac46457541710efd0ac058514ba
Author: Marcus Sch&#195;&#164;fer &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/kiwi-devel">ms at novell.com</A>&gt;
Date:   Tue Nov 16 10:12:02 2010 +0100

    - added new element &lt;vmconfig-entry&gt;text&lt;/vmconfig-entry&gt; which
      allows the user to specify raw text that ends up in the .vmx
      or .xenconfig file. Certain default options currently written by
      Kiwi may be over written by these settings. Therefore the use
      of this option happens on your own risk. No validation of the
      raw text is performed.

-----------------------------------------------------------------------

Summary of changes:
diff --git a/doc/docbook/kiwi-doc-description.xml b/doc/docbook/kiwi-doc-description.xml
index 1e7c80c..bfa5b0f 100644
--- a/doc/docbook/kiwi-doc-description.xml
+++ b/doc/docbook/kiwi-doc-description.xml
@@ -793,6 +793,19 @@
               &lt;/varlistentry&gt;
               &lt;varlistentry&gt;
                 &lt;term&gt;&lt;sgmltag class=&quot;starttag&quot;
+                    &gt;oem-reboot&lt;/sgmltag&gt;true|false&lt;sgmltag
+                    class=&quot;endtag&quot;&gt;oem-bootwait&lt;/sgmltag&gt;&lt;/term&gt;
+                &lt;listitem&gt;
+                  &lt;para&gt;Specify if the system should wait for user interaction
+                    priot to  continuing the boot process after the oem image
+                    has been dumped to the designated storage device (default
+                    value is false). This value is represented by the
+                    &lt;varname&gt;OEM_BOOTWAIT&lt;/varname&gt; variable in
+                    &lt;filename&gt;config.oempartition&lt;/filename&gt;. &lt;/para&gt;
+                &lt;/listitem&gt;
+              &lt;/varlistentry&gt;
+              &lt;varlistentry&gt;
+                &lt;term&gt;&lt;sgmltag class=&quot;starttag&quot;
                     &gt;oem-kiwi-initrd&lt;/sgmltag&gt;true|false&lt;sgmltag
                     class=&quot;endtag&quot;&gt;oem-kiwi-initrd&lt;/sgmltag&gt;&lt;/term&gt;
                 &lt;listitem&gt;
@@ -825,6 +838,21 @@
               &lt;/varlistentry&gt;
               &lt;varlistentry&gt;
                 &lt;term&gt;&lt;sgmltag class=&quot;starttag&quot;
+                    &gt;oem-reboot&lt;/sgmltag&gt;true|false&lt;sgmltag
+                    class=&quot;endtag&quot;&gt;oem-reboot-interactive&lt;/sgmltag&gt;&lt;/term&gt;
+                &lt;listitem&gt;
+                  &lt;para&gt;Specify if the system is to be rebooted after
+                    the oem image has been deployed to the designated
+                    storage device (default value is false). Prior to
+                    reboot a message is posted and must be acknowledged
+                    by the user in order for the system to reboot. This value
+                    is represented by the
+                    &lt;varname&gt;OEM_REBOOT_INTERACTIVE&lt;/varname&gt; variable in
+                    &lt;filename&gt;config.oempartition&lt;/filename&gt;. &lt;/para&gt;
+                &lt;/listitem&gt;
+              &lt;/varlistentry&gt;
+              &lt;varlistentry&gt;
+                &lt;term&gt;&lt;sgmltag class=&quot;starttag&quot;
                     &gt;oem-recovery&lt;/sgmltag&gt;true|false&lt;sgmltag
                     class=&quot;endtag&quot;&gt;oem-recovery&lt;/sgmltag&gt;&lt;/term&gt;
                 &lt;listitem&gt;
@@ -860,6 +888,34 @@
               &lt;/varlistentry&gt;
               &lt;varlistentry&gt;
                 &lt;term&gt;&lt;sgmltag class=&quot;starttag&quot;
+                    &gt;oem-reboot&lt;/sgmltag&gt;true|false&lt;sgmltag
+                    class=&quot;endtag&quot;&gt;oem-shutdown&lt;/sgmltag&gt;&lt;/term&gt;
+                &lt;listitem&gt;
+                  &lt;para&gt;Specify if the system is to be powered down after
+                    the oem image has been deployed to the designated
+                    storage device (default value is false). This value
+                    is represented by the &lt;varname&gt;OEM_SHUTDOWN&lt;/varname&gt;
+                    variable in
+                    &lt;filename&gt;config.oempartition&lt;/filename&gt;. &lt;/para&gt;
+                &lt;/listitem&gt;
+              &lt;/varlistentry&gt;
+              &lt;varlistentry&gt;
+                &lt;term&gt;&lt;sgmltag class=&quot;starttag&quot;
+                    &gt;oem-reboot&lt;/sgmltag&gt;true|false&lt;sgmltag
+                    class=&quot;endtag&quot;&gt;oem-shutdown-interactive&lt;/sgmltag&gt;&lt;/term&gt;
+                &lt;listitem&gt;
+                  &lt;para&gt;Specify if the system is to be powered down after
+                    the oem image has been deployed to the designated
+                    storage device (default value is false). Prior to
+                    shutdown a message is posted and must be acknowledged
+                    by the user in order for the system to power off. This
+                    value is represented by the
+                    &lt;varname&gt;OEM_SHUTDOWN_INTERACTIVE&lt;/varname&gt; variable in
+                    &lt;filename&gt;config.oempartition&lt;/filename&gt;. &lt;/para&gt;
+                &lt;/listitem&gt;
+              &lt;/varlistentry&gt;
+              &lt;varlistentry&gt;
+                &lt;term&gt;&lt;sgmltag class=&quot;starttag&quot;
                     &gt;oem-swap&lt;/sgmltag&gt;true|false&lt;sgmltag class=&quot;endtag&quot;
                     &gt;oem-swap&lt;/sgmltag&gt;&lt;/term&gt;
                 &lt;listitem&gt;
@@ -1142,7 +1198,10 @@
             &lt;screen&gt;&lt;machine arch=&quot;arch&quot; memory=&quot;MB&quot;
   HWversion=&quot;number&quot; guestOS=&quot;suse|sles&quot;
   domain=&quot;dom0|domU&quot;/&gt; 
+   &lt;vmconfig-entry&gt;Entry_for_VM_config_file&lt;\vmconfig-entry&gt;
+   &lt;vmconfig-entry .../&gt;
    &lt;vmnic driver=&quot;name&quot; interface=&quot;number&quot; mode=&quot;mode&quot;/&gt; 
+   &lt;vmnic ...&gt;
    &lt;vmdisk controller=&quot;ide|scsi&quot; id=&quot;number&quot;/&gt; 
    &lt;vmdvd  controller=&quot;ide|scsi&quot; id=&quot;number&quot;/&gt; 
 &lt;/machine&gt; &lt;/screen&gt;
@@ -1198,8 +1257,17 @@
                 &lt;/listitem&gt;
               &lt;/varlistentry&gt;
             &lt;/variablelist&gt;
-            &lt;para&gt;The following information can be provided to setup the
-              virtual main storage device and CD/DVD drive connection: &lt;/para&gt;
+            &lt;para&gt;Use the &lt;sgmltag class=&quot;element&quot;&gt;vmconfig-entry&lt;/sgmltag&gt;
+              element to create entries in the virtual machine's configuration
+              file; .vmx for VMware images and .xenconfig for Xen images.
+              You may specify as many configuration options as desired. The
+              value of the &lt;sgmltag class=&quot;element&quot;&gt;vmconfig-entry&lt;/sgmltag&gt;
+              element is expected to be specified in the syntax required by
+              the VM configuration file to be written. The value is free
+              format text and is not validated by Kiwi in any way. The entry
+              is written to the VM configuration file verbatime.&lt;/para&gt;
+            &lt;para&gt;Use the &lt;sgmltag class=&quot;element&quot;&gt;vmdisk&lt;/sgmltag&gt; element
+              to setup the virtual main storage device.&lt;/para&gt;
             &lt;variablelist&gt;
               &lt;varlistentry&gt;
                 &lt;term&gt;&lt;sgmltag class=&quot;attribute&quot;
@@ -1229,8 +1297,33 @@
                 &lt;/listitem&gt;
               &lt;/varlistentry&gt;
             &lt;/variablelist&gt;
-            &lt;para&gt;The following information can be provided to setup the
-              virtual network interface: &lt;/para&gt;
+            &lt;para&gt;Use the &lt;sgmltag class=&quot;element&quot;&gt;vmdvd&lt;/sgmltag&gt; element
+              to setup a virtual optical drive (CD/DVD) connection&lt;/para&gt;
+            &lt;variablelist&gt;
+              &lt;varlistentry&gt;
+                &lt;term&gt;&lt;sgmltag class=&quot;attribute&quot;
+                  &gt;controller&lt;/sgmltag&gt;&lt;/term&gt;
+                &lt;listitem&gt;
+                  &lt;para&gt; Supported values for the mandatory &lt;sgmltag
+                      class=&quot;attribute&quot;&gt;controller&lt;/sgmltag&gt; attribute
+                    are &lt;sgmltag class=&quot;attvalue&quot;&gt;ide&lt;/sgmltag&gt; and
+                      &lt;sgmltag class=&quot;attvalue&quot;&gt;scsi&lt;/sgmltag&gt;. &lt;/para&gt;
+                &lt;/listitem&gt;
+              &lt;/varlistentry&gt;
+              &lt;varlistentry&gt;
+                &lt;term&gt;&lt;sgmltag class=&quot;attribute&quot;&gt;id&lt;/sgmltag&gt;&lt;/term&gt;
+                &lt;listitem&gt;
+                  &lt;para&gt;The mandatory &lt;sgmltag class=&quot;attribute&quot;
+                      &gt;id&lt;/sgmltag&gt; attribute specifies the disk id. If
+                    only one disk is set the id value should be set to
+                    0. &lt;/para&gt;
+                &lt;/listitem&gt;
+              &lt;/varlistentry&gt;
+            &lt;/variablelist&gt;
+            &lt;para&gt;Use the &lt;sgmltag class=&quot;element&quot;&gt;vmnic&lt;/sgmltag&gt; element
+              to setup the virtual network interface. Multiple
+              &lt;sgmltag class=&quot;element&quot;&gt;vmnic&lt;/sgmltag&gt; child elements may be
+              specified to setup multiple virtual network interfaces.&lt;/para&gt;
             &lt;variablelist&gt;
               &lt;varlistentry&gt;
                 &lt;term&gt;&lt;sgmltag class=&quot;attribute&quot;&gt;driver&lt;/sgmltag&gt;&lt;/term&gt;
diff --git a/modules/KIWIImageFormat.pm b/modules/KIWIImageFormat.pm
index 0cf894d..e8ad3da 100644
--- a/modules/KIWIImageFormat.pm
+++ b/modules/KIWIImageFormat.pm
@@ -553,15 +553,25 @@ sub createXENConfiguration {
 		print $FD &quot; ]&quot;.&quot;\n&quot;;
 	}
 	#==========================================
-	# xen console
+	# kernel boot parameters
 	#------------------------------------------
 	if ($type{type} eq &quot;xen&quot;) {
-		print $FD 'root=&quot;'.$part.' ro&quot;'.&quot;\n&quot;;
+		print $FD 'root=&quot;'.$part.' rw&quot;'.&quot;\n&quot;;
+	}
+	#==========================================
+	# Process raw config options
+	#------------------------------------------
+	my @userOptSettings;
+	for my $configOpt (@{$xenconfig{xen_config}}) {
+		print $FD $configOpt . &quot;\n&quot;;
+		push @userOptSettings, (split /=/, $configOpt)[0];
 	}
 	#==========================================
 	# xen virtual framebuffer
 	#------------------------------------------
-	print $FD 'vfb = [&quot;type=vnc,vncunused=1,vnclisten=0.0.0.0&quot;]'.&quot;\n&quot;;
+	if (! grep /vfb/, @userOptSettings) {
+		print $FD 'vfb = [&quot;type=vnc,vncunused=1,vnclisten=0.0.0.0&quot;]'.&quot;\n&quot;;
+	}
 	close $FD;
 	$kiwi -&gt; done();
 	return $file;
@@ -678,18 +688,34 @@ sub createVMwareConfiguration {
 		print $FD $device.':0.startConnected = &quot;true&quot;'.&quot;\n&quot;;
 	}
 	#==========================================
-	# USB setup
+	# Setup default options
+	#------------------------------------------
+	my %defaultOpts = (
+		'usb.present'        =&gt; 'true',
+		'priority.grabbed'   =&gt; 'normal',
+		'priority.ungrabbed' =&gt; 'normal',
+		'powerType.powerOff' =&gt; 'soft',
+		'powerType.powerOn'  =&gt; 'soft',
+		'powerType.suspend'  =&gt; 'soft',
+		'powerType.reset'    =&gt; 'soft'
+	);
+	#==========================================
+	# Process raw config options
 	#------------------------------------------
-	print $FD 'usb.present = &quot;true&quot;'.&quot;\n&quot;;
+	my @userOptSettings;
+	for my $configOpt (@{$vmwconfig{vmware_config}}) {
+		print $FD $configOpt . &quot;\n&quot;;
+		push @userOptSettings, (split /=/, $configOpt)[0];
+	}
 	#==========================================
-	# Power Management setup
+	# Process the default options
 	#------------------------------------------
-	print $FD 'priority.grabbed = &quot;normal&quot;'.&quot;\n&quot;;
-	print $FD 'priority.ungrabbed = &quot;normal&quot;'.&quot;\n&quot;;
-	print $FD 'powerType.powerOff = &quot;soft&quot;'.&quot;\n&quot;;
-	print $FD 'powerType.powerOn  = &quot;soft&quot;'.&quot;\n&quot;;
-	print $FD 'powerType.suspend  = &quot;soft&quot;'.&quot;\n&quot;;
-	print $FD 'powerType.reset    = &quot;soft&quot;'.&quot;\n&quot;;
+	for my $defOpt (keys %defaultOpts) {
+		if (grep /$defOpt/, @userOptSettings) {
+			next;
+		}
+		print $FD $defOpt . ' = ' . '&quot;' . $defaultOpts{$defOpt} . '&quot;' . &quot;\n&quot;;
+	}
 	close $FD;
 	chmod 0755,$file;
 	$kiwi -&gt; done();
diff --git a/modules/KIWISchema.rnc b/modules/KIWISchema.rnc
index 2e583e6..c01b8bd 100644
--- a/modules/KIWISchema.rnc
+++ b/modules/KIWISchema.rnc
@@ -1683,31 +1683,15 @@ div {
 }
 
 #==========================================
-# common element &lt;vmnic&gt;
+# common element &lt;vmconfig-entry&gt;
 #
 div {
-	k.vmnic.driver.attribute =
-		## The driver used for the VM network interface
-		attribute driver { text }
-	k.vmnic.interface.attribute =
-		## The interface ID for the VM network interface
-		attribute interface { text }
-	k.vmnic.mode.attribute =
-		## The VM network mode
-		attribute mode { text }
-	k.vmnic.mac.attribute =
-		## The VM mac address
-		attribute mac { mac-address-type }
-	k.vmnic.attlist =
-		k.vmnic.driver.attribute? &amp;
-		k.vmnic.interface.attribute &amp;
-		k.vmnic.mode.attribute? &amp;
-		k.vmnic.mac.attribute?
-	k.vmnic =
-		## The VM network interface definition
-		element vmnic {
-			k.vmnic.attlist &amp;
-			empty
+	k.vmconfig-entry.attlist = empty
+	k.vmconfig-entry =
+		## An entry for the VM configuration file
+		element vmconfig-entry {
+			k.vmconfig-entry.attlist &amp;
+			text
 		}
 }
 
@@ -1759,6 +1743,35 @@ div {
 }
 
 #==========================================
+# common element &lt;vmnic&gt;
+#
+div {
+	k.vmnic.driver.attribute =
+		## The driver used for the VM network interface
+		attribute driver { text }
+	k.vmnic.interface.attribute =
+		## The interface ID for the VM network interface
+		attribute interface { text }
+	k.vmnic.mode.attribute =
+		## The VM network mode
+		attribute mode { text }
+	k.vmnic.mac.attribute =
+		## The VM mac address
+		attribute mac { mac-address-type }
+	k.vmnic.attlist =
+		k.vmnic.driver.attribute? &amp;
+		k.vmnic.interface.attribute &amp;
+		k.vmnic.mode.attribute? &amp;
+		k.vmnic.mac.attribute?
+	k.vmnic =
+		## The VM network interface definition
+		element vmnic {
+			k.vmnic.attlist &amp;
+			empty
+		}
+}
+
+#==========================================
 # main block: &lt;pxedeploy&gt;
 #
 div {
@@ -2259,9 +2272,10 @@ div {
 		]
 		element machine {
 			k.machine.attlist &amp;
-			k.vmnic * &amp;
+			k.vmconfig-entry * &amp;
 			k.vmdisk ? &amp;
-			k.vmdvd ?
+			k.vmdvd ? &amp;
+			k.vmnic *
 		}
 }
 
diff --git a/modules/KIWIXML.pm b/modules/KIWIXML.pm
index 1a35aea..4b8db08 100644
--- a/modules/KIWIXML.pm
+++ b/modules/KIWIXML.pm
@@ -3034,9 +3034,16 @@ sub getVMwareConfig {
 		};
 	}
 	#==========================================
+	# configuration file settings
+	#------------------------------------------
+	my @vmConfigOpts = $this -&gt; getVMConfigOpts();
+	#==========================================
 	# save hash
 	#------------------------------------------
 	$result{vmware_arch}  = $arch;
+	if (@vmConfigOpts) {
+		$result{vmware_config} = \@vmConfigOpts;
+	}
 	$result{vmware_hwver} = $hwver;
 	$result{vmware_guest} = $guest;
 	$result{vmware_memory}= $memory;
@@ -3100,8 +3107,15 @@ sub getXenConfig {
 		}
 	}
 	#==========================================
+	# configuration file settings
+	#------------------------------------------
+	my @vmConfigOpts = $this -&gt; getVMConfigOpts();
+	#==========================================
 	# save hash
 	#------------------------------------------
+	if (@vmConfigOpts) {
+		$result{xen_config} = \@vmConfigOpts
+	}
 	$result{xen_memory}= $memory;
 	$result{xen_domain}= $domain;
 	if ($disk) {
@@ -4485,6 +4499,24 @@ sub addDefaultSplitNode {
 }
 
 #==========================================
+# getVMConfigOpts
+#------------------------------------------
+sub getVMConfigOpts {
+	# ...
+	# Extract the &lt;vmconfig-entry&gt; information from the
+	# XML and return all options in a list
+	# ---
+	my $this = shift;
+	my @configOpts = $this-&gt;{systemTree}
+		-&gt;getElementsByTagName (&quot;vmconfig-entry&quot;);
+	for my $node (@configNodes) {
+		my $value = $node-&gt;textContent();
+		push @configOpts, $node-&gt;textContent();
+	}
+	return @configOpts;
+}
+
+#==========================================
 # Private helper methods
 #------------------------------------------
 #==========================================


hooks/post-receive
-- 
Project kiwi at BerliOS

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002807.html">[Kiwi-devel] support sepc of VM config file options
</A></li>
	<LI>Next message: <A HREF="002810.html">[Kiwi-devel] [Git]Project kiwi at BerliOS branch, master,	updated. c7cffdeb20f0718e745eeb5c58ddfa30aac475a0
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2809">[ date ]</a>
              <a href="thread.html#2809">[ thread ]</a>
              <a href="subject.html#2809">[ subject ]</a>
              <a href="author.html#2809">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/kiwi-devel">More information about the Kiwi-devel
mailing list</a><br>
</body></html>

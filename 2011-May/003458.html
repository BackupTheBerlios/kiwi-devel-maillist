<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Kiwi-devel] [Git]Project kiwi at BerliOS branch, master,	updated. 9cbb2adca3ec0659bcbd7c0284d36be3c4824f73
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/kiwi-devel/2011-May/index.html" >
   <LINK REL="made" HREF="mailto:kiwi-devel%40lists.berlios.de?Subject=Re%3A%20%5BKiwi-devel%5D%20%5BGit%5DProject%20kiwi%20at%20BerliOS%20branch%2C%20master%2C%0A%09updated.%209cbb2adca3ec0659bcbd7c0284d36be3c4824f73&In-Reply-To=%3C20110524092656.699DF48137E%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="003457.html">
   <LINK REL="Next"  HREF="003459.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Kiwi-devel] [Git]Project kiwi at BerliOS branch, master,	updated. 9cbb2adca3ec0659bcbd7c0284d36be3c4824f73</H1>
    <B>marcus_schaefer at BerliOS</B> 
    <A HREF="mailto:kiwi-devel%40lists.berlios.de?Subject=Re%3A%20%5BKiwi-devel%5D%20%5BGit%5DProject%20kiwi%20at%20BerliOS%20branch%2C%20master%2C%0A%09updated.%209cbb2adca3ec0659bcbd7c0284d36be3c4824f73&In-Reply-To=%3C20110524092656.699DF48137E%40sheep.berlios.de%3E"
       TITLE="[Kiwi-devel] [Git]Project kiwi at BerliOS branch, master,	updated. 9cbb2adca3ec0659bcbd7c0284d36be3c4824f73">marcus_schaefer at mail.berlios.de
       </A><BR>
    <I>Tue May 24 11:26:55 CEST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="003457.html">[Kiwi-devel] [Git]Project kiwi at BerliOS branch, master,	updated. 006ed05164d19c55c097171940a07090c6823ec4
</A></li>
        <LI>Next message: <A HREF="003459.html">[Kiwi-devel] [Git]Project kiwi at BerliOS branch, master,	updated. 96ca08b1b03e3ed30c71e59d60f0d160f823910d
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3458">[ date ]</a>
              <a href="thread.html#3458">[ thread ]</a>
              <a href="subject.html#3458">[ subject ]</a>
              <a href="author.html#3458">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>This is an automated email from the git hooks/post-receive script. It was
generated because a ref change was pushed to the repository containing
the project &quot;Project kiwi at BerliOS&quot;.

The branch, master has been updated
       via  9cbb2adca3ec0659bcbd7c0284d36be3c4824f73 (commit)
      from  006ed05164d19c55c097171940a07090c6823ec4 (commit)

Those revisions listed above that are new to this repository have
not appeared on any other notification email; so we list those
revisions in full, below.

- Log -----------------------------------------------------------------
commit 9cbb2adca3ec0659bcbd7c0284d36be3c4824f73
Author: Marcus Sch&#195;&#164;fer &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/kiwi-devel">ms at novell.com</A>&gt;
Date:   Tue May 24 10:51:43 2011 +0200

    - eliminate global variables used by main()

-----------------------------------------------------------------------

Summary of changes:
diff --git a/kiwi.pl b/kiwi.pl
index 8621968..0269a58 100755
--- a/kiwi.pl
+++ b/kiwi.pl
@@ -63,86 +63,34 @@ our $global  = new KIWIGlobals();
 our $locator = new KIWILocator();
 
 #============================================
+# Variables (operation mode)
+#--------------------------------------------
+my $migrate;    # Migration
+my $kic;        # Image preparation / creation
+my $icache;     # Image Cache creation
+my $cmdL;       # Command line data container
+my $kiwi;       # logger object
+
+#============================================
 # Globals
 #--------------------------------------------
-our $Build;                 # run prepare and create in one step
-our $Prepare;               # control XML file for building chroot extend
-our $Create;                # image description for building image extend
-our $CheckConfig;           # Configuration file to check
-our $InitCache;             # create image cache(s) from given description
-our $CreateInstSource;      # create installation source from meta packages
-our $Upgrade;               # upgrade physical extend
 our $Destination;           # destination directory for logical extends
 our $LogFile;               # optional file name for logging
 our $RootTree;              # optional root tree destination
 our $BootVMSystem;          # system image to be copied on a VM disk
-our $BootVMDisk;            # deploy initrd booting from a VM 
 our $BootVMSize;            # size of virtual disk
-our $InstallCD;             # Installation initrd booting from CD
-our $InstallCDSystem;       # virtual disk system image to be installed on disk
-our $BootCD;                # Boot initrd booting from CD
-our $BootUSB;               # Boot initrd booting from Stick
-our $TestImage;             # call end-to-end testsuite if installed
-our $TestCase;              # path to image description including test/ case
-our $InstallStick;          # Installation initrd booting from USB stick
-our $InstallStickSystem;    # virtual disk system image to be installed on disk
 our $StripImage;            # strip shared objects and binaries
-our $CreateHash;            # create .checksum.md5 for given description
-our $SetupSplash;           # setup splash screen (bootsplash or splashy)
-our @AddRepository;         # add repository for building physical extend
-our @AddRepositoryType;     # add repository type
-our @AddRepositoryAlias;    # alias name for the repository
-our @AddRepositoryPriority; # priority for the repository
-our @AddPackage;            # add packages to the image package list
-our @AddPattern;            # add patterns to the image package list
 our $ImageCache;            # build an image cache for later re-use
-our @RemovePackage;         # remove package by adding them to the remove list
-our $IgnoreRepos;           # ignore repositories specified so far
-our $SetRepository;         # set first repository for building physical extend
-our $SetRepositoryType;     # set firt repository type
-our $SetRepositoryAlias;    # alias name for the repository
-our $SetRepositoryPriority; # priority for the repository
-our $Migrate;               # migrate running system to image description
-our @Exclude;               # exclude directories in migrate search
-our @Skip;                  # skip this package in migration mode
-our @Profiles;              # list of profiles to include in image
 our @ProfilesOrig;          # copy of original Profiles option value 
-our $ForceNewRoot;          # force creation of new root directory
-our $NoColor;               # do not used colored output (done/failed messages)
-our $LogPort;               # specify alternative log server port
-our $GzipCmd;               # command to run to gzip things
 our $PrebuiltBootImage;     # directory where a prepared boot image may be found
-our $CreatePassword;        # create crypted password
 our $ISOCheck;              # create checkmedia boot entry
-our $Verbosity = 0;         # control the verbosity level
-our $TargetArch;            # target architecture -&gt; writes zypp.conf
 our $CheckKernel;           # check for kernel matches in boot and system image
-our $Clone;                 # clone existing image description
 our $LVM;                   # use LVM partition setup for virtual disk
-our $Debug;                 # activates the internal stack trace output
 our $GrubChainload;         # install grub loader in first partition not MBR
-our $MigrateNoFiles;        # migrate: don't create overlay files
-our $MigrateNoTemplate;     # migrate: don't create image description template
-our $Convert;               # convert image into given format/configuration
-our $Format;                # format to convert to, vmdk, ovf, etc...
-our $defaultAnswer;         # default answer to any questions
-our $targetDevice;          # alternative device instead of a loop device
 our %XMLChangeSet;          # internal data set for update of XML objects
 our $ImageDescription;      # uniq path to image description due to caller opts
 our $RecycleRoot;           # use existing root directory incl. contents
 our $FatStorage;            # specify size of fat partition if syslinux is used
-our $cmdL;                  # command line storage object
-our $kiwi;                  # global logging handler object
-our $MBRID;                 # custom mbrid value
-our $ListXMLInfo;           # list XML information
-our $kic;                   # global Image Creator object
-our $icache;                # global Image Cache object
-our $Partitioner = &quot;parted&quot;;# default partitioner
-
-#============================================
-# Globals
-#--------------------------------------------
-my $migrate;    # KIWIMigrate object for system to image migration
 
 #==========================================
 # main
@@ -175,7 +123,7 @@ sub main {
 	#==========================================
 	# Check for nocolor option
 	#------------------------------------------
-	if (defined $NoColor) {
+	if ($cmdL -&gt; getNoColor()) {
 		$kiwi -&gt; info (&quot;Switching off colored output\n&quot;);
 		if (! $kiwi -&gt; setColorOff ()) {
 			kiwiExit (1);
@@ -193,12 +141,12 @@ sub main {
 	#========================================
 	# Prepare and Create in one step
 	#----------------------------------------
-	if (defined $Build) {
+	if ($cmdL-&gt;getOperationMode(&quot;build&quot;)) {
 		#==========================================
 		# Create destdir if needed
 		#------------------------------------------
 		my $dirCreated = $global -&gt; createDirInteractive(
-			$Destination, $defaultAnswer
+			$Destination, $cmdL-&gt;getDefaultAnswer()
 		);
 		if (! defined $dirCreated) {
 			kiwiExit (1);
@@ -232,13 +180,14 @@ sub main {
 	#========================================
 	# Create image cache(s)
 	#----------------------------------------
-	if (defined $InitCache) {
+	if ($cmdL-&gt;getOperationMode(&quot;initCache&quot;)) {
 		#==========================================
 		# Process system image description
 		#------------------------------------------
 		$kiwi -&gt; info (&quot;Reading image description [Cache]...\n&quot;);
 		my $xml = new KIWIXML (
-			$kiwi,$InitCache,undef,\@Profiles
+			$kiwi,$cmdL-&gt;getOperationMode(&quot;initCache&quot;),
+			undef,$cmdL-&gt;getBuildProfiles()
 		);
 		if (! defined $xml) {
 			kiwiExit (1);
@@ -255,7 +204,9 @@ sub main {
 			$cdir = $locator -&gt; getDefaultCacheDir();
 		}
 		$icache = new KIWICache (
-			$kiwi,$xml,$cdir,$gdata-&gt;{BasePath},\@Profiles,$InitCache
+			$kiwi,$xml,$cdir,$gdata-&gt;{BasePath},
+			$cmdL-&gt;getBuildProfiles(),
+			$cmdL-&gt;getOperationMode(&quot;initCache&quot;)
 		);
 		if (! $icache) {
 			kiwiExit (1);
@@ -273,7 +224,7 @@ sub main {
 	#========================================
 	# Prepare image and build chroot system
 	#----------------------------------------
-	if (defined $Prepare) {
+	if ($cmdL-&gt;getOperationMode(&quot;prepare&quot;)) {
 		$kic = new KIWIImageCreator ($kiwi, $cmdL);
 		if (! $kic) {
 			kiwiExit (1);
@@ -287,7 +238,7 @@ sub main {
 	#==========================================
 	# Create image from chroot system
 	#------------------------------------------
-	if (defined $Create) {
+	if ($cmdL-&gt;getOperationMode(&quot;create&quot;)) {
 		$kic = new KIWIImageCreator ($kiwi, $cmdL);
 		if (! $kic) {
 			kiwiExit (1);
@@ -301,7 +252,7 @@ sub main {
 	#==========================================
 	# Upgrade image in chroot system
 	#------------------------------------------
-	if (defined $Upgrade) {
+	if ($cmdL-&gt;getOperationMode(&quot;upgrade&quot;)) {
 		$kic = new KIWIImageCreator ($kiwi, $cmdL);
 		if (! $kic) {
 			kiwiExit (1);
@@ -315,13 +266,23 @@ sub main {
 	#==========================================
 	# Migrate system to image description
 	#------------------------------------------
-	if (defined $Migrate) {
+	if ($cmdL-&gt;getOperationMode(&quot;migrate&quot;)) {
 		$kiwi -&gt; info (&quot;Starting system to image migration&quot;);
-		$Destination = &quot;/tmp/$Migrate&quot;;
+		$Destination = $cmdL-&gt;getOperationMode(&quot;migrate&quot;);
+		$Destination = &quot;/tmp/&quot;.$Destination;
+		my $addlRepos = $cmdL -&gt; getAdditionalRepos();
+		my $migopts   = $cmdL -&gt; getMigrationOptions();
+		my $exclude   = $migopts-&gt;[0];
+		my $skip      = $migopts-&gt;[1];
+		my $nofiles   = $migopts-&gt;[2];
+		my $notempl   = $migopts-&gt;[3];
 		$migrate = new KIWIMigrate (
-			$kiwi,$Destination,$Migrate,\@Exclude,\@Skip,
-			\@AddRepository,\@AddRepositoryType,
-			\@AddRepositoryAlias,\@AddRepositoryPriority,
+			$kiwi,$Destination,
+			$cmdL-&gt;getOperationMode(&quot;migrate&quot;),$exclude,$skip,
+			$addlRepos-&gt;{repositories},
+			$addlRepos-&gt;{repositoryTypes},
+			$addlRepos-&gt;{repositoryAlia},
+			$addlRepos-&gt;{repositoryPriorities},
 			$cmdL-&gt;getForceNewRoot()
 		);
 		#==========================================
@@ -337,12 +298,12 @@ sub main {
 		#==========================================
 		# Create report HTML file, errors allowed
 		#------------------------------------------
-		if (! $MigrateNoFiles) {
+		if (! $nofiles) {
 			$migrate -&gt; setSystemOverlayFiles();
 		}
 		$migrate -&gt; getPackageList();
 		$migrate -&gt; createReport();
-		if (! $MigrateNoTemplate) {
+		if (! $notempl) {
 			if (! $migrate -&gt; setTemplate()) {
 				$migrate -&gt; cleanMount();
 				kiwiExit (1);
@@ -363,7 +324,7 @@ sub main {
 	#==========================================
 	# setup a splash initrd
 	#------------------------------------------
-	if (defined $SetupSplash) {
+	if ($cmdL-&gt;getOperationMode(&quot;setupSplash&quot;)) {
 		$kic = new KIWIImageCreator ($kiwi, $cmdL);
 		if (! $kic) {
 			kiwiExit (1);
@@ -377,7 +338,7 @@ sub main {
 	#==========================================
 	# Create a boot Stick (USB)
 	#------------------------------------------
-	if (defined $BootUSB) {
+	if ($cmdL-&gt;getOperationMode(&quot;bootUSB&quot;)) {
 		$kic = new KIWIImageCreator ($kiwi, $cmdL);
 		if (! $kic) {
 			kiwiExit (1);
@@ -391,7 +352,7 @@ sub main {
 	#==========================================
 	# Create a boot CD (ISO)
 	#------------------------------------------
-	if (defined $BootCD) {
+	if ($cmdL-&gt;getOperationMode(&quot;bootCD&quot;)) {
 		$kic = new KIWIImageCreator ($kiwi, $cmdL);
 		if (! $kic) {
 			kiwiExit (1);
@@ -405,7 +366,7 @@ sub main {
 	#==========================================
 	# Create an install CD (ISO)
 	#------------------------------------------
-	if (defined $InstallCD) {
+	if ($cmdL-&gt;getOperationMode(&quot;installCD&quot;)) {
 		$kic = new KIWIImageCreator ($kiwi, $cmdL);
 		if (! $kic) {
 			kiwiExit (1);
@@ -419,7 +380,7 @@ sub main {
 	#==========================================
 	# Create an install USB stick
 	#------------------------------------------
-	if (defined $InstallStick) {
+	if ($cmdL-&gt;getOperationMode(&quot;installStick&quot;)) {
 		$kic = new KIWIImageCreator ($kiwi, $cmdL);
 		if (! $kic) {
 			kiwiExit (1);
@@ -433,7 +394,7 @@ sub main {
 	#==========================================
 	# Create a virtual disk image
 	#------------------------------------------
-	if (defined $BootVMDisk) {
+	if ($cmdL-&gt;getOperationMode(&quot;bootVMDisk&quot;)) {
 		$kic = new KIWIImageCreator ($kiwi, $cmdL);
 		if (! $kic) {
 			kiwiExit (1);
@@ -447,7 +408,7 @@ sub main {
 	#==========================================
 	# Convert image into format/configuration
 	#------------------------------------------
-	if (defined $Convert) {
+	if ($cmdL-&gt;getOperationMode(&quot;convert&quot;)) {
 		$kic = new KIWIImageCreator ($kiwi, $cmdL);
 		if (! $kic) {
 			kiwiExit (1);
@@ -461,11 +422,13 @@ sub main {
 	#==========================================
 	# Test suite
 	#------------------------------------------
-	if (defined $TestImage) {
+	if ($cmdL-&gt;getOperationMode(&quot;testImage&quot;)) {
 		$kiwi -&gt; info (&quot;Starting image test run...&quot;);
 		my $suite  = &quot;/usr/lib/os-autoinst&quot;;
 		my $distri = &quot;kiwi-$$&quot;;
 		my $type   = $cmdL -&gt; getBuildType();
+		my $image  = $cmdL -&gt; getOperationMode(&quot;testImage&quot;);
+		my $tcase  = $cmdL -&gt; getTestCase();
 		#==========================================
 		# Check pre-conditions
 		#------------------------------------------
@@ -475,9 +438,9 @@ sub main {
 			$kiwi -&gt; failed ();
 			kiwiExit (1);
 		}
-		if (! -f $TestImage) {
+		if (! -f $image) {
 			$kiwi -&gt; failed ();
-			$kiwi -&gt; error (&quot;Test image $TestImage doesn't exist&quot;);
+			$kiwi -&gt; error (&quot;Test image $image doesn't exist&quot;);
 			$kiwi -&gt; failed ();
 			kiwiExit (1);
 		}
@@ -487,19 +450,19 @@ sub main {
 			$kiwi -&gt; failed ();
 			kiwiExit (1);
 		}
-		if (! defined $TestCase) {
+		if (! defined $tcase) {
 			$kiwi -&gt; failed ();
 			$kiwi -&gt; error (&quot;No test test case specified&quot;);
 			$kiwi -&gt; failed ();
 			kiwiExit (1);
 		}
-		if (! -d $TestCase.&quot;/&quot;.$type) {
+		if (! -d $tcase.&quot;/&quot;.$type) {
 			$kiwi -&gt; failed ();
 			$kiwi -&gt; error (&quot;Test case $type does not exist&quot;);
 			$kiwi -&gt; failed ();
 			kiwiExit (1);
 		}
-		if (! -f $TestCase.&quot;/env.sh&quot;) {
+		if (! -f $tcase.&quot;/env.sh&quot;) {
 			$kiwi -&gt; failed ();
 			$kiwi -&gt; error (&quot;Can't find environment for this test&quot;);
 			$kiwi -&gt; failed ();
@@ -508,12 +471,12 @@ sub main {
 		#==========================================
 		# Turn parameters into absolute pathes
 		#------------------------------------------
-		$TestImage = File::Spec-&gt;rel2abs ($TestImage);
-		$TestCase  = File::Spec-&gt;rel2abs ($TestCase);
+		$image = File::Spec-&gt;rel2abs ($image);
+		$tcase = File::Spec-&gt;rel2abs ($tcase);
 		#==========================================
 		# Create distri link for os-autoinst
 		#------------------------------------------
-		my $test = $TestCase.&quot;/&quot;.$type;
+		my $test = $tcase.&quot;/&quot;.$type;
 		my $data = qxx (&quot;ln -s $test $suite/distri/$distri 2&gt;&amp;1&quot;);
 		my $code = $? &gt;&gt; 8;
 		if ($code != 0) {
@@ -537,7 +500,7 @@ sub main {
 		#==========================================
 		# Copy environment to result directory
 		#------------------------------------------
-		$data = qxx (&quot;cp $TestCase/env.sh $out&quot;);
+		$data = qxx (&quot;cp $tcase/env.sh $out&quot;);
 		$code = $? &gt;&gt; 8;
 		if ($code != 0) {
 			$kiwi -&gt; failed ();
@@ -553,7 +516,7 @@ sub main {
 		if (open my $FD,&quot;&gt;$out/run.sh&quot;) {
 			print $FD &quot;cd $out\n&quot;;
 			print $FD &quot;export DISTRI=$distri&quot;.&quot;\n&quot;;
-			print $FD &quot;export ISO=$TestImage&quot;.&quot;\n&quot;;
+			print $FD &quot;export ISO=$image&quot;.&quot;\n&quot;;
 			print $FD 'isotovideo $ISO'.&quot;\n&quot;;
 			close $FD;
 		} else {
@@ -627,8 +590,60 @@ sub init {
 	my $FSCheckInterval;       # filesystem (ext) max interval between fs checks
 	my $FSInodeRatio;          # filesystem bytes/inode ratio
 	my $SetImageType;          # set image type to use, default is primary type
-	my $PackageManager;
-	my $Version;
+	my $Build;                 # run prepare and create in one step
+	my $Prepare;               # control XML file for building chroot extend
+	my $Create;                # image description for building image extend
+	my $InitCache;             # create image cache(s) from given description
+	my $Upgrade;               # upgrade physical extend
+	my $BootVMDisk;            # deploy initrd booting from a VM
+	my $InstallCD;             # Installation initrd booting from CD
+	my $BootCD;                # Boot initrd booting from CD
+	my $BootUSB;               # Boot initrd booting from Stick
+	my $TestImage;             # call end-to-end testsuite if installed
+	my $InstallStick;          # Installation initrd booting from USB stick
+	my $SetupSplash;           # setup splash screen (bootsplash or splashy)
+	my $Migrate;               # migrate running system to image description
+	my $Convert;               # convert image into given format/configuration
+	my $MBRID;                 # custom mbrid value
+	my @RemovePackage;         # remove pack by adding them to the remove list
+	my $IgnoreRepos;           # ignore repositories specified so far
+	my $SetRepository;         # set first repo for building physical extend
+	my $SetRepositoryType;     # set firt repository type
+	my $SetRepositoryAlias;    # alias name for the repository
+	my $SetRepositoryPriority; # priority for the repository
+	my @AddRepository;         # add repository for building physical extend
+	my @AddRepositoryType;     # add repository type
+	my @AddRepositoryAlias;    # alias name for the repository
+	my @AddRepositoryPriority; # priority for the repository
+	my @AddPackage;            # add packages to the image package list
+	my @AddPattern;            # add patterns to the image package list
+	my $Partitioner;           # default partitioner
+	my $ListXMLInfo;           # list XML information
+	my $CheckConfig;           # Configuration file to check
+	my $CreateInstSource;      # create installation source from meta packages
+	my $CreateHash;            # create .checksum.md5 for given description
+	my $CreatePassword;        # create crypted password
+	my $Clone;                 # clone existing image description
+	my $InstallCDSystem;       # disk system image to be installed on disk
+	my $TestCase;              # path to image description including test/ case
+	my $InstallStickSystem;    # disk system image to be installed on disk
+	my @Exclude;               # exclude directories in migrate search
+	my @Skip;                  # skip this package in migration mode
+	my @Profiles;              # list of profiles to include in image
+	my $ForceNewRoot;          # force creation of new root directory
+	my $NoColor;               # don't use colored output (done/failed messages)
+	my $LogPort;               # specify alternative log server port
+	my $GzipCmd;               # command to run to gzip things
+	my $Verbosity;             # control the verbosity level
+	my $TargetArch;            # target architecture -&gt; writes zypp.conf
+	my $Debug;                 # activates the internal stack trace output
+	my $MigrateNoFiles;        # migrate: don't create overlay files
+	my $MigrateNoTemplate;     # migrate: don't create image description
+	my $Format;                # format to convert to, vmdk, ovf, etc...
+	my $defaultAnswer;         # default answer to any questions
+	my $targetDevice;          # alternative device instead of a loop device
+	my $PackageManager;        # package manager to use
+	my $Version;               # version information
 	#==========================================
 	# create logger and cmdline object
 	#------------------------------------------
@@ -716,7 +731,7 @@ sub init {
 		&quot;upgrade|u=s&quot;           =&gt; \$Upgrade,
 		&quot;test-image=s&quot;          =&gt; \$TestImage,
 		&quot;test-case=s&quot;           =&gt; \$TestCase,
-		&quot;v|verbose+&quot;            =&gt; \$Verbosity,
+		&quot;v|verbose=i&quot;           =&gt; \$Verbosity,
 		&quot;version&quot;               =&gt; \$Version,
 		&quot;yes|y&quot;                 =&gt; \$defaultAnswer,
 	);
@@ -728,6 +743,30 @@ sub init {
 		$FSMaxMountCount,$FSCheckInterval
 	);
 	#========================================
+	# set list of migration options
+	#----------------------------------------
+	$cmdL -&gt; setMigrationOptions (
+		\@Exclude,\@Skip,$MigrateNoFiles,$MigrateNoTemplate
+	);
+	#========================================
+	# check if TestCase is specified
+	#----------------------------------------
+	if (defined $TestCase) {
+		$cmdL -&gt; setTestCase ($TestCase);
+	}
+	#========================================
+	# check if Debug is specified
+	#----------------------------------------
+	if (defined $Debug) {
+		$cmdL -&gt; setDebug ($Debug);
+	}
+	#========================================
+	# check if NoColor is specified
+	#----------------------------------------
+	if (defined $NoColor) {
+		$cmdL -&gt; setNoColor ($NoColor);
+	}
+	#========================================
 	# check if MBRID is specified
 	#----------------------------------------
 	if (defined $MBRID) {
@@ -796,25 +835,25 @@ sub init {
 	#========================================
 	# check if packages are to be added
 	#----------------------------------------
-	if (defined @AddPackage) {
+	if (@AddPackage) {
 		$cmdL -&gt; setAdditionalPackages (\@AddPackage);
 	}
 	#========================================
 	# check if patterns are to be added
 	#----------------------------------------
-	if (defined @AddPattern) {
+	if (@AddPattern) {
 		$cmdL -&gt; setAdditionalPatterns (\@AddPattern);
 	}
 	#========================================
 	# check if packs are marked for removal
 	#----------------------------------------
-	if (defined @RemovePackage) {
+	if (@RemovePackage) {
 		$cmdL -&gt; setPackagesToRemove (\@RemovePackage)
 	}
 	#========================================
 	# check if repositories are to be added
 	#----------------------------------------
-	if (defined @AddRepository) {
+	if (@AddRepository) {
 		my $res = $cmdL -&gt; setAdditionalRepos(
 			\@AddRepository,
 			\@AddRepositoryAlias,
@@ -906,10 +945,21 @@ sub init {
 		$cmdL -&gt; setImageArchitecture ($TargetArch);
 	}
 	#============================================
+	# check if a partitioner is used
+	#--------------------------------------------
+	if ($Partitioner) {
+		if (($Partitioner ne &quot;parted&quot;) &amp;&amp;($Partitioner ne &quot;fdasd&quot;)) {
+			$kiwi -&gt; error (&quot;Invalid partitioner, expected parted|fdasd&quot;);
+			$kiwi -&gt; failed ();
+			kiwiExit (1);
+		}
+		$cmdL -&gt; setPartitioner ($Partitioner);
+	}
+	#============================================
 	# check Partitioner according to device
 	#-----------------------------------------
 	if (($targetDevice) &amp;&amp; ($targetDevice =~ /\/dev\/dasd/)) {
-		$Partitioner = &quot;fdasd&quot;;
+		$cmdL -&gt; setPartitioner (&quot;fdasd&quot;);
 	}
 	#========================================
 	# turn destdir into absolute path
@@ -946,6 +996,51 @@ sub init {
 		$cmdL -&gt; setConfigDir ($ImageDescription);
 	}
 	#========================================
+	# store operation modes
+	#----------------------------------------
+	if (defined $Build) {
+		$cmdL -&gt; setOperationMode (&quot;build&quot;,$Build);
+	}
+	if (defined $Prepare) {
+		$cmdL -&gt; setOperationMode (&quot;prepare&quot;,$Prepare);
+	}
+	if (defined $Upgrade) {
+		$cmdL -&gt; setOperationMode (&quot;upgrade&quot;,$Upgrade);
+	}
+	if (defined $Create) {
+		$cmdL -&gt; setOperationMode (&quot;create&quot;,$Create);
+	}
+	if (defined $InitCache) {
+		$cmdL -&gt; setOperationMode (&quot;initCache&quot;,$InitCache);
+	}
+	if (defined $Migrate) {
+		$cmdL -&gt; setOperationMode (&quot;migrate&quot;,$Migrate);
+	}
+	if (defined $SetupSplash) {
+		$cmdL -&gt; setOperationMode (&quot;setupSplash&quot;,$SetupSplash);
+	}
+	if (defined $BootUSB) {
+		$cmdL -&gt; setOperationMode (&quot;bootUSB&quot;,$BootUSB);
+	}
+	if (defined $BootCD) {
+		$cmdL -&gt; setOperationMode (&quot;bootCD&quot;,$BootCD);
+	}
+	if (defined $InstallCD) {
+		$cmdL -&gt; setOperationMode (&quot;installCD&quot;,$InstallCD);
+	}
+	if (defined $InstallStick) {
+		$cmdL -&gt; setOperationMode (&quot;installStick&quot;,$InstallStick);
+	}
+	if (defined $BootVMDisk) {
+		$cmdL -&gt; setOperationMode (&quot;bootVMDisk&quot;,$BootVMDisk);
+	}
+	if (defined $Convert) {
+		$cmdL -&gt; setOperationMode (&quot;convert&quot;,$Convert);
+	}
+	if (defined $TestImage) {
+		$cmdL -&gt; setOperationMode (&quot;testImage&quot;,$TestImage);
+	}
+	#========================================
 	# store original value of Profiles
 	#----------------------------------------
 	@ProfilesOrig = @Profiles;
@@ -966,7 +1061,7 @@ sub init {
 	# non root task: Check XML configuration
 	#------------------------------------------
 	if (defined $CheckConfig) {
-		checkConfig();
+		checkConfig ($CheckConfig);
 	}
 	#==========================================
 	# non root task: Create crypted password
@@ -978,19 +1073,19 @@ sub init {
 	# non root task: create inst source
 	#----------------------------------------
 	if (defined $CreateInstSource) {
-		createInstSource();
+		createInstSource ($CreateInstSource,$Verbosity);
 	}
 	#==========================================
 	# non root task: create md5 hash
 	#------------------------------------------
 	if (defined $CreateHash) {
-		createHash();
+		createHash ($CreateHash);
 	}
 	#==========================================
 	# non root task: Clone image 
 	#------------------------------------------
 	if (defined $Clone) {
-		cloneImage();
+		cloneImage ($Clone);
 	}
 	#==========================================
 	# non root task: Help
@@ -1079,16 +1174,6 @@ sub init {
 		$kiwi -&gt; failed ();
 		kiwiExit (1);
 	}
-	if (defined $Partitioner) {
-		if (
-			($Partitioner ne &quot;parted&quot;) &amp;&amp;
-			($Partitioner ne &quot;fdasd&quot;)
-		) {
-			$kiwi -&gt; error (&quot;Invalid partitioner, expected parted|fdasd&quot;);
-			$kiwi -&gt; failed ();
-			kiwiExit (1);
-		}
-	}
 	if ((defined $Build) &amp;&amp; (! defined $Destination)) {
 		$kiwi -&gt; error  (&quot;No destination directory specified&quot;);
 		$kiwi -&gt; failed ();
@@ -1406,17 +1491,18 @@ sub checkConfig {
 	# ...
 	# Check the specified configuration file
 	# ---
-	my $kiwi  = new KIWILog(&quot;tiny&quot;);
-	my $gdata = $global -&gt; getGlobals();
-	if (! -f $CheckConfig) {
+	my $config = shift;
+	my $kiwi   = new KIWILog(&quot;tiny&quot;);
+	my $gdata  = $global -&gt; getGlobals();
+	if (! -f $config) {
 		$kiwi -&gt; error (
-			&quot;Could not access specified file to check: $CheckConfig&quot;
+			&quot;Could not access specified file to check: $config&quot;
 		);
 		$kiwi -&gt; failed ();
 		exit 1;
 	}
 	my $validator = new KIWIXMLValidator (
-		$kiwi,$CheckConfig,$gdata-&gt;{Revision},
+		$kiwi,$config,$gdata-&gt;{Revision},
 		$gdata-&gt;{Schema},$gdata-&gt;{SchemaCVT}
 	);
 	if (! $validator) {
@@ -1443,6 +1529,7 @@ sub cloneImage {
 	# existing checksum will be removed as we assume
 	# that the clone will be changed
 	# ----
+	my $clone      = shift;
 	my $answer     = &quot;unknown&quot;;
 	my $gdata      = $global -&gt; getGlobals();
 	my $configName = $gdata-&gt;{ConfigName};
@@ -1456,18 +1543,18 @@ sub cloneImage {
 		$kiwi -&gt; failed ();
 		kiwiExit (1);
 	} else {
-		$kiwi -&gt; info (&quot;Cloning image $Clone -&gt; $Destination...&quot;);
+		$kiwi -&gt; info (&quot;Cloning image $clone -&gt; $Destination...&quot;);
 	}
 	#==========================================
 	# Evaluate image path or name 
 	#------------------------------------------
-	if (($Clone !~ /^\//) &amp;&amp; (! -d $Clone)) {
-		$Clone = $system.&quot;/&quot;.$Clone;
+	if (($clone !~ /^\//) &amp;&amp; (! -d $clone)) {
+		$clone = $system.&quot;/&quot;.$clone;
 	}
-	my $cfg = $Clone.&quot;/&quot;.$configName;
+	my $cfg = $clone.&quot;/&quot;.$configName;
 	my $md5 = $Destination.&quot;/.checksum.md5&quot;;
 	if (! -f $cfg) {
-		my @globsearch = glob ($Clone.&quot;/*.kiwi&quot;);
+		my @globsearch = glob ($clone.&quot;/*.kiwi&quot;);
 		my $globitems  = @globsearch;
 		if ($globitems == 0) {
 			$kiwi -&gt; failed ();
@@ -1504,11 +1591,11 @@ sub cloneImage {
 	#==========================================
 	# Copy path to destination 
 	#------------------------------------------
-	my $data = qxx (&quot;cp -a $Clone/* $Destination 2&gt;&amp;1&quot;);
+	my $data = qxx (&quot;cp -a $clone/* $Destination 2&gt;&amp;1&quot;);
 	my $code = $? &gt;&gt; 8;
 	if ($code != 0) {
 		$kiwi -&gt; failed ();
-		$kiwi -&gt; error (&quot;Failed to copy $Clone: $data&quot;);
+		$kiwi -&gt; error (&quot;Failed to copy $clone: $data&quot;);
 		$kiwi -&gt; failed ();
 		kiwiExit (1);
 	}
@@ -1553,7 +1640,7 @@ sub kiwiExit {
 	# Check for backtrace and clean flag...
 	#------------------------------------------
 	if ($code != 0) {
-		if (defined $Debug) {
+		if ($cmdL -&gt; getDebug()) {
 			$kiwi -&gt; printBackTrace();
 		}
 		$kiwi -&gt; printLogExcerpt();
@@ -1694,17 +1781,16 @@ sub createHash {
 	# file .checksum.md5 is checked on runtime with the md5sum
 	# command
 	# ----
-	if (! defined $kiwi) {
-		$kiwi = new KIWILog(&quot;tiny&quot;);
-	}
-	$kiwi -&gt; info (&quot;Creating MD5 sum for $CreateHash...&quot;);
-	if (! -d $CreateHash) {
+	my $idesc = shift;
+	$kiwi  = new KIWILog(&quot;tiny&quot;);
+	$kiwi -&gt; info (&quot;Creating MD5 sum for $idesc...&quot;);
+	if (! -d $idesc) {
 		$kiwi -&gt; failed ();
-		$kiwi -&gt; error  (&quot;Not a directory: $CreateHash: $!&quot;);
+		$kiwi -&gt; error  (&quot;Not a directory: $idesc: $!&quot;);
 		$kiwi -&gt; failed ();
 		kiwiExit (1);
 	}
-	if (! $locator -&gt; getControlFile ($CreateHash)) {
+	if (! $locator -&gt; getControlFile ($idesc)) {
 		$kiwi -&gt; failed ();
 		$kiwi -&gt; error  (&quot;Not a kiwi description: no xml description found&quot;);
 		$kiwi -&gt; failed ();
@@ -1712,7 +1798,7 @@ sub createHash {
 	}
 	my $cmd  = &quot;find -L -type f | grep -v .svn | grep -v .checksum.md5&quot;;
 	my $status = qxx (
-		&quot;cd $CreateHash &amp;&amp; $cmd | xargs md5sum &gt; .checksum.md5&quot;
+		&quot;cd $idesc &amp;&amp; $cmd | xargs md5sum &gt; .checksum.md5&quot;
 	);
 	my $result = $? &gt;&gt; 8;
 	if ($result != 0) {
@@ -1732,6 +1818,8 @@ sub createInstSource {
 	# If it is not available, the option cannot be used.
 	# kiwi then issues a warning and exits.
 	# ----
+	my $idesc = shift;
+	my $vlevel= shift;
 	$kiwi = new KIWILog(&quot;tiny&quot;);
 	$kiwi -&gt; deactivateBackTrace();
 	my $mod = &quot;KIWICollect&quot;;
@@ -1746,7 +1834,7 @@ sub createInstSource {
 	}
 	$kiwi -&gt; info (&quot;Reading image description [InstSource]...\n&quot;);
 	my $xml = new KIWIXML (
-		$kiwi,$CreateInstSource,undef,undef
+		$kiwi,$idesc,undef,undef
 	);
 	if (! defined $xml) {
 		kiwiExit (1);
@@ -1766,8 +1854,8 @@ sub createInstSource {
 	}
 	#==========================================
 	# Create object...
-	#----------------------------------------
-	my $collect = new KIWICollect ( $kiwi, $xml, $root, $Verbosity );
+	#------------------------------------------
+	my $collect = new KIWICollect ( $kiwi, $xml, $root, $vlevel );
 	if (! defined( $collect) ) {
 		$kiwi -&gt; error( &quot;Unable to create KIWICollect module.&quot; );
 		$kiwi -&gt; failed ();
diff --git a/modules/KIWIBoot.pm b/modules/KIWIBoot.pm
index 347296b..20927b7 100644
--- a/modules/KIWIBoot.pm
+++ b/modules/KIWIBoot.pm
@@ -477,6 +477,13 @@ sub new {
 		}
 	}
 	#==========================================
+	# check partitioner
+	#------------------------------------------
+	my $ptool = $cmdL -&gt; getPartitioner();
+	if (! $ptool) {
+		$ptool = $this-&gt;{gdata}-&gt;{Partitioner};
+	}
+	#==========================================
 	# Store object data (2)
 	#------------------------------------------
 	$this-&gt;{initrd}    = $initrd;
@@ -490,7 +497,7 @@ sub new {
 	$this-&gt;{isxen}     = $isxen;
 	$this-&gt;{xengz}     = $xengz;
 	$this-&gt;{arch}      = $arch;
-	$this-&gt;{ptool}     = $main::Partitioner;
+	$this-&gt;{ptool}     = $ptool;
 	$this-&gt;{chainload} = $main::GrubChainload;
 	$this-&gt;{vga}       = $vga;
 	$this-&gt;{xml}       = $xml;
diff --git a/modules/KIWICommandLine.pm b/modules/KIWICommandLine.pm
index 54669d1..6d934db 100644
--- a/modules/KIWICommandLine.pm
+++ b/modules/KIWICommandLine.pm
@@ -65,6 +65,7 @@ sub new {
 	$this-&gt;{imageTgtDir}        = '';
 	$this-&gt;{kiwi}               = $kiwi;
 	$this-&gt;{supportedRepoTypes} = \@supportedRepos;
+	$this-&gt;{gdata}              = $main::global -&gt; getGlobals();
 	return $this;
 }
 
@@ -981,6 +982,12 @@ sub setFilesystemOptions {
 	my $FSMaxMountCount = shift;
 	my $FSCheckInterval = shift;
 	my @result;
+	if (! defined $FSInodeRatio) {
+		$FSInodeRatio = $this-&gt;{gdata}-&gt;{FSInodeRatio};
+	}
+	if (! defined $FSInodeSize) {
+		$FSInodeSize = $this-&gt;{gdata}-&gt;{FSInodeSize};
+	}
 	push @result,$FSBlockSize;
 	push @result,$FSInodeSize;
 	push @result,$FSInodeRatio;
@@ -1017,4 +1024,122 @@ sub getMBRID {
 	return $this-&gt;{mbrid};
 }
 
+#==========================================
+# setOperationMode
+#------------------------------------------
+sub setOperationMode {
+	my $this = shift;
+	my $mode = shift;
+	my $value= shift;
+	$this-&gt;{operation}{$mode} = $value;
+	return 1;
+}
+
+#==========================================
+# getOperationMode
+#------------------------------------------
+sub getOperationMode {
+	my $this = shift;
+	my $mode = shift;
+	return $this-&gt;{operation}{$mode}
+}
+
+#==========================================
+# setPartitioner
+#------------------------------------------
+sub setPartitioner {
+	my $this = shift;
+	my $tool = shift;
+	$this-&gt;{partitioner} = $tool;
+	return 1;
+}
+
+#==========================================
+# getPartitioner
+#------------------------------------------
+sub getPartitioner {
+	my $this = shift;
+	return $this-&gt;{partitioner};
+}
+
+#==========================================
+# setNoColor
+#------------------------------------------
+sub setNoColor {
+	my $this = shift;
+	my $value= shift;
+	$this-&gt;{nocolor} = $value;
+	return 1;
+}
+
+#==========================================
+# getNoColor
+#------------------------------------------
+sub getNoColor {
+	my $this = shift;
+	return $this-&gt;{nocolor};
+}
+
+#==========================================
+# setMigrationOptions
+#------------------------------------------
+sub setMigrationOptions {
+	my $this    = shift;
+	my $exclude = shift;
+	my $skip    = shift;
+	my $nofiles = shift;
+	my $notempl = shift;
+	my @result;
+	push @result,$exclude;
+	push @result,$skip;
+	push @result,$nofiles;
+	push @result,$notempl;
+	$this-&gt;{migrationOptions} = \@result;
+	return 1;
+}
+
+#==========================================
+# getMigrationOptions
+#------------------------------------------
+sub getMigrationOptions {
+	my $this = shift;
+	return $this-&gt;{migrationOptions};
+}
+
+#==========================================
+# setDebug
+#------------------------------------------
+sub setDebug {
+	my $this = shift;
+	my $value= shift;
+	$this-&gt;{debug} = $value;
+	return 1;
+}
+
+#==========================================
+# getDebug
+#------------------------------------------
+sub getDebug {
+	my $this = shift;
+	return $this-&gt;{debug};
+}
+
+#==========================================
+# setTestCase
+#------------------------------------------
+sub setTestCase {
+	my $this = shift;
+	my $value= shift;
+	$this-&gt;{testcase} = $value;
+	return 1;
+}
+
+#==========================================
+# getTestCase
+#------------------------------------------
+sub getTestCase {
+	my $this = shift;
+	return $this-&gt;{testcase};
+}
+
 1;
diff --git a/modules/KIWIGlobals.pm b/modules/KIWIGlobals.pm
index 8eba7a4..12d80e1 100644
--- a/modules/KIWIGlobals.pm
+++ b/modules/KIWIGlobals.pm
@@ -37,13 +37,16 @@ sub new {
 	my $class = shift;
 	bless $this,$class;
 	#==========================================
-	# Variable setup
+	# Globals (generic)
 	#------------------------------------------
 	my %data;
 	$data{Version}       = &quot;4.89&quot;;
 	$data{Publisher}     = &quot;SUSE LINUX Products GmbH&quot;;
 	$data{Preparer}      = &quot;KIWI - <A HREF="http://kiwi.berlios.de">http://kiwi.berlios.de</A>&quot;;
 	$data{ConfigName}    = &quot;config.xml&quot;;
+	$data{Partitioner}   = &quot;parted&quot;;
+	$data{FSInodeRatio}  = 16384;
+	$data{FSInodeSize}   = 256;
 	#============================================
 	# Read .kiwirc
 	#--------------------------------------------
@@ -84,6 +87,9 @@ sub new {
 	}
 	use strict 'vars';
 	my $BasePath = $data{BasePath};
+	#==========================================
+	# Globals (path names)
+	#------------------------------------------
 	$data{Tools}     = $BasePath.&quot;/tools&quot;;
 	$data{Schema}    = $BasePath.&quot;/modules/KIWISchema.rng&quot;;
 	$data{SchemaTST} = $BasePath.&quot;/modules/KIWISchemaTest.rng&quot;;
diff --git a/modules/KIWIXMLInfo.pm b/modules/KIWIXMLInfo.pm
index 5ed33d9..e5e0620 100644
--- a/modules/KIWIXMLInfo.pm
+++ b/modules/KIWIXMLInfo.pm
@@ -538,19 +538,21 @@ sub __xmlSetup {
 	}
 	if ($this -&gt; {replRepo}) {
 		my %replRepo = %{$this -&gt; {replRepo}};
-		$xml -&gt; setRepository ($replRepo{repositoryType},
-							$replRepo{repository},
-							$replRepo{repositoryAlias},
-							$replRepo{respositoryPriority}
-							);
+		$xml -&gt; setRepository (
+			$replRepo{repositoryType},
+			$replRepo{repository},
+			$replRepo{repositoryAlias},
+			$replRepo{respositoryPriority}
+		);
 	}
 	if ($this -&gt; {addlRepos}) {
 		my %addlRepos = %{$this -&gt; {addlRepos}};
-		$xml -&gt; addRepository ($addlRepos{repositoryTypes},
-							$addlRepos{repositories},
-							$addlRepos{repositoryAlia},
-							$addlRepos{repositoryPriorities}
-							);
+		$xml -&gt; addRepository (
+			$addlRepos{repositoryTypes},
+			$addlRepos{repositories},
+			$addlRepos{repositoryAlia},
+			$addlRepos{repositoryPriorities}
+		);
 	}
 	return $xml;
 }


hooks/post-receive
-- 
Project kiwi at BerliOS

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="003457.html">[Kiwi-devel] [Git]Project kiwi at BerliOS branch, master,	updated. 006ed05164d19c55c097171940a07090c6823ec4
</A></li>
	<LI>Next message: <A HREF="003459.html">[Kiwi-devel] [Git]Project kiwi at BerliOS branch, master,	updated. 96ca08b1b03e3ed30c71e59d60f0d160f823910d
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3458">[ date ]</a>
              <a href="thread.html#3458">[ thread ]</a>
              <a href="subject.html#3458">[ subject ]</a>
              <a href="author.html#3458">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/kiwi-devel">More information about the Kiwi-devel
mailing list</a><br>
</body></html>

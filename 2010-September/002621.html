<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Kiwi-devel] [Git]Project kiwi at BerliOS branch,	KIWI-443-SuSE-11-3-Devel,	updated. 718d3cdf2acaf8331f535b30bfe6714a660157da
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/kiwi-devel/2010-September/index.html" >
   <LINK REL="made" HREF="mailto:kiwi-devel%40lists.berlios.de?Subject=Re%3A%20%5BKiwi-devel%5D%20%5BGit%5DProject%20kiwi%20at%20BerliOS%20branch%2C%0A%09KIWI-443-SuSE-11-3-Devel%2C%0A%09updated.%20718d3cdf2acaf8331f535b30bfe6714a660157da&In-Reply-To=%3C20100902094744.02ACF48100F%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002620.html">
   <LINK REL="Next"  HREF="002622.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Kiwi-devel] [Git]Project kiwi at BerliOS branch,	KIWI-443-SuSE-11-3-Devel,	updated. 718d3cdf2acaf8331f535b30bfe6714a660157da</H1>
    <B>marcus_schaefer at BerliOS</B> 
    <A HREF="mailto:kiwi-devel%40lists.berlios.de?Subject=Re%3A%20%5BKiwi-devel%5D%20%5BGit%5DProject%20kiwi%20at%20BerliOS%20branch%2C%0A%09KIWI-443-SuSE-11-3-Devel%2C%0A%09updated.%20718d3cdf2acaf8331f535b30bfe6714a660157da&In-Reply-To=%3C20100902094744.02ACF48100F%40sheep.berlios.de%3E"
       TITLE="[Kiwi-devel] [Git]Project kiwi at BerliOS branch,	KIWI-443-SuSE-11-3-Devel,	updated. 718d3cdf2acaf8331f535b30bfe6714a660157da">marcus_schaefer at mail.berlios.de
       </A><BR>
    <I>Thu Sep  2 11:47:43 CEST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="002620.html">[Kiwi-devel] [Git]Project kiwi at BerliOS branch, master,	updated. c88bc523321a44b86e8136ea569512ab62d2b567
</A></li>
        <LI>Next message: <A HREF="002622.html">[Kiwi-devel] [Git]Project kiwi at BerliOS branch,	KIWI-374-SuSE-11-1-SLE-SP-Devel,	updated. b1eaaa6d6714afc5f953fc58b5b8802d06590117
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2621">[ date ]</a>
              <a href="thread.html#2621">[ thread ]</a>
              <a href="subject.html#2621">[ subject ]</a>
              <a href="author.html#2621">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>This is an automated email from the git hooks/post-receive script. It was
generated because a ref change was pushed to the repository containing
the project &quot;Project kiwi at BerliOS&quot;.

The branch, KIWI-443-SuSE-11-3-Devel has been updated
       via  718d3cdf2acaf8331f535b30bfe6714a660157da (commit)
       via  d56266c3655f91410c4675691a9b609d3cb88cc1 (commit)
       via  ceada9ee9ab4eec3a04891c141ddff512d731e5c (commit)
       via  645b0496e35bc7954f23f70754c377c8cd7164ae (commit)
      from  76cbb48d712ad0b438bdc76eeb9e4f00c15a023a (commit)

Those revisions listed above that are new to this repository have
not appeared on any other notification email; so we list those
revisions in full, below.

- Log -----------------------------------------------------------------
commit 718d3cdf2acaf8331f535b30bfe6714a660157da
Author: Marcus Sch&#195;&#164;fer &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/kiwi-devel">ms at novell.com</A>&gt;
Date:   Thu Sep 2 11:47:25 2010 +0200

    - added changelog entry for last three commits

commit d56266c3655f91410c4675691a9b609d3cb88cc1
Author: Marcus Sch&#195;&#164;fer &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/kiwi-devel">ms at novell.com</A>&gt;
Date:   Thu Sep 2 11:19:41 2010 +0200

    - added check for dhcpcd options. On sle10 we don't have
      the options -p or --noipv4ll

commit ceada9ee9ab4eec3a04891c141ddff512d731e5c
Author: Marcus Sch&#195;&#164;fer &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/kiwi-devel">ms at novell.com</A>&gt;
Date:   Wed Aug 25 13:03:05 2010 +0200

    - call dhcpcd with the option --noipv4ll to be able to check the
      return code of dhcpcd and to prevent the interface from an ip address
      if there was a DHCP timeout (bnc #634057)

commit 645b0496e35bc7954f23f70754c377c8cd7164ae
Author: Marcus Sch&#195;&#164;fer &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/kiwi-devel">ms at novell.com</A>&gt;
Date:   Tue Aug 24 17:00:13 2010 +0200

    - don't check the return code of dhcpcd it's always zero.
      Therefore the check has been changed to check for the creation
      of the /var/lib/dhcpcd/dhcpcd-$PXE_IFACE.info file (bnc #634057)

-----------------------------------------------------------------------

Summary of changes:
diff --git a/modules/KIWILinuxRC.sh b/modules/KIWILinuxRC.sh
index c381705..ea75c44 100644
--- a/modules/KIWILinuxRC.sh
+++ b/modules/KIWILinuxRC.sh
@@ -45,6 +45,7 @@ test -z &quot;$UTIMER&quot;             &amp;&amp; export UTIMER=0
 test -z &quot;$VGROUP&quot;             &amp;&amp; export VGROUP=kiwiVG
 test -z &quot;$PARTED_HAVE_ALIGN&quot;  &amp;&amp; export PARTED_HAVE_ALIGN=0
 test -z &quot;$PARTED_HAVE_MACHINE&quot;&amp;&amp; export PARTED_HAVE_MACHINE=0
+test -z &quot;$DHCPCD_HAVE_PERSIST&quot;&amp;&amp; export DHCPCD_HAVE_PERSIST=1
 if [ -x /sbin/blogd ];then
 	test -z &quot;$CONSOLE&quot;            &amp;&amp; export CONSOLE=/dev/console
 	test -z &quot;$REDIRECT&quot;           &amp;&amp; export REDIRECT=/dev/tty1
@@ -58,6 +59,9 @@ fi
 if [ $PARTED_HAVE_MACHINE -eq 0 ];then
 	export PARTITIONER=sfdisk
 fi
+if dhcpcd -p 2&gt;&amp;1 | grep -q 'Usage';then
+	export DHCPCD_HAVE_PERSIST=0
+fi
 
 #======================================
 # Dialog
@@ -3073,6 +3077,7 @@ function setupNetwork {
 	local index=0
 	local hwicmd=/usr/sbin/hwinfo
 	local iface=eth0
+	local opts=&quot;--noipv4ll -p&quot;
 	for i in `$hwicmd --netcard`;do
 		IFS=$IFS_ORIG
 		if echo $i | grep -q &quot;HW Address:&quot;;then
@@ -3109,17 +3114,30 @@ function setupNetwork {
 		done
 	fi
 	export PXE_IFACE=$iface
-	dhcpcd -p $PXE_IFACE 1&gt;&amp;2
-	if test $? != 0;then
+	if $DHCPCD_HAVE_PERSIST -eq 0;then
+		# /.../
+		# older version of dhcpd which doesn't have the
+		# options we want to pass
+		# ----
+		unset opts
+	fi
+	if ! dhcpcd $opts $PXE_IFACE 1&gt;&amp;2;then
 		systemException \
 			&quot;Failed to setup DHCP network interface !&quot; \
 		&quot;reboot&quot;
 	fi
-	ifconfig lo 127.0.0.1 netmask 255.0.0.0 up
 	for i in 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20;do
-		[ -s /var/lib/dhcpcd/dhcpcd-$PXE_IFACE.info ] &amp;&amp; break
+		if [ -s /var/lib/dhcpcd/dhcpcd-$PXE_IFACE.info ];then
+			break
+		fi
 		sleep 2
 	done
+	if [ ! -s /var/lib/dhcpcd/dhcpcd-$PXE_IFACE.info ];then
+		systemException \
+			&quot;Can't find DHCP info file: dhcpcd-$PXE_IFACE.info !&quot; \
+		&quot;reboot&quot;
+	fi
+	ifconfig lo 127.0.0.1 netmask 255.0.0.0 up
 	importFile &lt; /var/lib/dhcpcd/dhcpcd-$PXE_IFACE.info
 	if [ -z &quot;$DOMAIN&quot; ] &amp;&amp; [ -n &quot;$DNSDOMAIN&quot; ];then
 		export DOMAIN=$DNSDOMAIN
diff --git a/rpm/kiwi.changes b/rpm/kiwi.changes
index 7533205..1a6808c 100644
--- a/rpm/kiwi.changes
+++ b/rpm/kiwi.changes
@@ -1,4 +1,16 @@
 -------------------------------------------------------------------
+Thu Sep  2 11:45:17 CEST 2010 - <A HREF="https://lists.berlios.de/mailman/listinfo/kiwi-devel">ms at suse.de</A>
+
+- added check for dhcpcd options. On sle10 we don't have
+  the options -p or --noipv4ll (bnc #636121)
+- call dhcpcd with the option --noipv4ll to be able to check the
+  return code of dhcpcd and to prevent the interface from an ip address
+  if there was a DHCP timeout (bnc #634057)
+- don't check the return code of dhcpcd it's always zero.
+  Therefore the check has been changed to check for the creation
+  of the /var/lib/dhcpcd/dhcpcd-$PXE_IFACE.info file (bnc #634057)
+
+-------------------------------------------------------------------
 Tue Aug 31 16:01:05 CEST 2010 - <A HREF="https://lists.berlios.de/mailman/listinfo/kiwi-devel">ms at suse.de</A>
 
 - LVM: added 1% spare space for each volume to store the metadata


hooks/post-receive
-- 
Project kiwi at BerliOS

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002620.html">[Kiwi-devel] [Git]Project kiwi at BerliOS branch, master,	updated. c88bc523321a44b86e8136ea569512ab62d2b567
</A></li>
	<LI>Next message: <A HREF="002622.html">[Kiwi-devel] [Git]Project kiwi at BerliOS branch,	KIWI-374-SuSE-11-1-SLE-SP-Devel,	updated. b1eaaa6d6714afc5f953fc58b5b8802d06590117
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2621">[ date ]</a>
              <a href="thread.html#2621">[ thread ]</a>
              <a href="subject.html#2621">[ subject ]</a>
              <a href="author.html#2621">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/kiwi-devel">More information about the Kiwi-devel
mailing list</a><br>
</body></html>

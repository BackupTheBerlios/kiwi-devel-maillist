<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Kiwi-devel] [Git]Project kiwi at BerliOS branch, master,	updated. 4be3eeee9a1e6bf5fabab5e678353cf4be9e2dd7
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/kiwi-devel/2010-April/index.html" >
   <LINK REL="made" HREF="mailto:kiwi-devel%40lists.berlios.de?Subject=Re%3A%20%5BKiwi-devel%5D%20%5BGit%5DProject%20kiwi%20at%20BerliOS%20branch%2C%20master%2C%0A%09updated.%204be3eeee9a1e6bf5fabab5e678353cf4be9e2dd7&In-Reply-To=%3C201004211408.o3LE8EgX020245%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002115.html">
   <LINK REL="Next"  HREF="002117.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Kiwi-devel] [Git]Project kiwi at BerliOS branch, master,	updated. 4be3eeee9a1e6bf5fabab5e678353cf4be9e2dd7</H1>
    <B>marcus_schaefer at BerliOS</B> 
    <A HREF="mailto:kiwi-devel%40lists.berlios.de?Subject=Re%3A%20%5BKiwi-devel%5D%20%5BGit%5DProject%20kiwi%20at%20BerliOS%20branch%2C%20master%2C%0A%09updated.%204be3eeee9a1e6bf5fabab5e678353cf4be9e2dd7&In-Reply-To=%3C201004211408.o3LE8EgX020245%40sheep.berlios.de%3E"
       TITLE="[Kiwi-devel] [Git]Project kiwi at BerliOS branch, master,	updated. 4be3eeee9a1e6bf5fabab5e678353cf4be9e2dd7">marcus_schaefer at mail.berlios.de
       </A><BR>
    <I>Wed Apr 21 16:08:14 CEST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="002115.html">[Kiwi-devel] [Git]Project kiwi at BerliOS branch, master,	updated. 71ca1cff6ea0f24e08594620bf1637eaf5401eeb
</A></li>
        <LI>Next message: <A HREF="002117.html">[Kiwi-devel] [Git]Project kiwi at BerliOS branch, master,	updated. 3cdb8ca32d426d57c2ac491a3d356449805e22c6
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2116">[ date ]</a>
              <a href="thread.html#2116">[ thread ]</a>
              <a href="subject.html#2116">[ subject ]</a>
              <a href="author.html#2116">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>This is an automated email from the git hooks/post-receive script. It was
generated because a ref change was pushed to the repository containing
the project &quot;Project kiwi at BerliOS&quot;.

The branch, master has been updated
       via  4be3eeee9a1e6bf5fabab5e678353cf4be9e2dd7 (commit)
      from  71ca1cff6ea0f24e08594620bf1637eaf5401eeb (commit)

Those revisions listed above that are new to this repository have
not appeared on any other notification email; so we list those
revisions in full, below.

- Log -----------------------------------------------------------------
commit 4be3eeee9a1e6bf5fabab5e678353cf4be9e2dd7
Author: Marcus Sch&#195;&#164;fer &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/kiwi-devel">ms at novell.com</A>&gt;
Date:   Wed Apr 21 16:07:20 2010 +0200

    - added support for OEM partition based install (bnc #597679)

-----------------------------------------------------------------------

Summary of changes:
diff --git a/doc/LaTex/oem.tex b/doc/LaTex/oem.tex
index e02ac58..eb63393 100644
--- a/doc/LaTex/oem.tex
+++ b/doc/LaTex/oem.tex
@@ -88,9 +88,10 @@ be executed. The following commnads show this procedure using QEMU.
 
 \begin{Command}{12cm}
 \begin{verbatim}
-qemu-img create -f qcow2 /tmp/test-oem-preload.img
-qemu /tmp/test-oem-preload.img \
-     -cdrom /tmp/myoem-result/suse-11.2-oem-preload.i686-1.1.2.iso \
+cd /tmp/myoem-result
+qemu-img create /tmp/mydisk 20G
+qemu -hda /tmp/mydisk -cdrom \
+     suse-11.2-oem-preload.i686-1.1.2.iso \
      -boot d
 \end{verbatim}
 \end{Command}
@@ -175,3 +176,40 @@ kiwi --create /tmp/myoem --type oem \
 With the optional \textbf{lvmvolumes} section you can specify to have 
 one or more top level directories in a separate volume. See the
 \textit{KIWI image description} chapter for a detailed explanation.
+
+\subsection{Partition based installation}
+
+The default installation method of an OEM is dumping the entire
+virtual disk on the selected target disk and repartition the disk
+to the real geometry. This works but will also wipe everything which
+was on the disk before. Kiwi also supports the installation into
+already existing partitions. This means the user can setup a disk
+with free partitions for the kiwi OEM installation process. This
+way already existing data will not be touched. In order to activate
+the partition based install mode the following oem option has to
+be set in config.xml:
+
+\begin{Command}{14cm}
+\begin{verbatim}
+&lt;oem-partition-install&gt;true&lt;/oem-partition-install&gt;
+\end{verbatim}
+\end{Command}
+
+Compared to the disk based install the following differences
+should be mentioned:
+
+\begin{itemize}
+\item The bootloader will be setup to boot the installed system. There
+      is no multiboot setup. The user has to take care for the setup
+      of a multiboot bootloader himself.
+\item The oem options for system, swap and home doesn't have any effect
+      if the installation happens in predefined partitions
+\item There is no support for remote (PXE) OEM installation because kiwi
+      has to loop mount the disk image in order to access the partitions
+      which can't be done remotely
+\item The raw disk image is stored uncompressed on the install media.
+      This is because kiwi needs to loop mount the disk image which it can't
+      do if the file is only available as compressed version. This means
+      the install media in this mode will be approximately double the size
+      of a standard install media
+\end{itemize}
diff --git a/doc/kiwi-man/KIWI::config.sh.1 b/doc/kiwi-man/KIWI::config.sh.1
index a0cb2c5..fdc7be9 100644
--- a/doc/kiwi-man/KIWI::config.sh.1
+++ b/doc/kiwi-man/KIWI::config.sh.1
@@ -1,12 +1,12 @@
 .\&quot;     Title: kiwi::config.sh
 .\&quot;    Author: Marcus Sch&#195;&#164;fer &lt;ms (AT) suse.de&gt;
 .\&quot; Generator: DocBook XSL Stylesheets v1.74.0 &lt;<A HREF="http://docbook.sf.net/">http://docbook.sf.net/</A>&gt;
-.\&quot;      Date: Created: 04/16/2010
+.\&quot;      Date: Created: 04/21/2010
 .\&quot;    Manual: KIWI Manualpage
 .\&quot;    Source: KIWI v3.65
 .\&quot;  Language: English
 .\&quot;
-.TH &quot;KIWI::CONFIG\&amp;.SH&quot; &quot;1&quot; &quot;Created: 04/16/2010&quot; &quot;KIWI v3\&amp;.65&quot; &quot;KIWI Manualpage&quot;
+.TH &quot;KIWI::CONFIG\&amp;.SH&quot; &quot;1&quot; &quot;Created: 04/21/2010&quot; &quot;KIWI v3\&amp;.65&quot; &quot;KIWI Manualpage&quot;
 .\&quot; -----------------------------------------------------------------
 .\&quot; * (re)Define some macros
 .\&quot; -----------------------------------------------------------------
diff --git a/doc/kiwi-man/KIWI::images.sh.1 b/doc/kiwi-man/KIWI::images.sh.1
index 045c088..8a73e1e 100644
--- a/doc/kiwi-man/KIWI::images.sh.1
+++ b/doc/kiwi-man/KIWI::images.sh.1
@@ -1,12 +1,12 @@
 .\&quot;     Title: kiwi::images.sh
 .\&quot;    Author: Marcus Sch&#195;&#164;fer &lt;ms (AT) suse.de&gt;
 .\&quot; Generator: DocBook XSL Stylesheets v1.74.0 &lt;<A HREF="http://docbook.sf.net/">http://docbook.sf.net/</A>&gt;
-.\&quot;      Date: Created: 04/16/2010
+.\&quot;      Date: Created: 04/21/2010
 .\&quot;    Manual: KIWI Manualpage
 .\&quot;    Source: KIWI v3.65
 .\&quot;  Language: English
 .\&quot;
-.TH &quot;KIWI::IMAGES\&amp;.SH&quot; &quot;1&quot; &quot;Created: 04/16/2010&quot; &quot;KIWI v3\&amp;.65&quot; &quot;KIWI Manualpage&quot;
+.TH &quot;KIWI::IMAGES\&amp;.SH&quot; &quot;1&quot; &quot;Created: 04/21/2010&quot; &quot;KIWI v3\&amp;.65&quot; &quot;KIWI Manualpage&quot;
 .\&quot; -----------------------------------------------------------------
 .\&quot; * (re)Define some macros
 .\&quot; -----------------------------------------------------------------
diff --git a/doc/kiwi-man/kiwi.1 b/doc/kiwi-man/kiwi.1
index effbf9f..55b1e77 100644
--- a/doc/kiwi-man/kiwi.1
+++ b/doc/kiwi-man/kiwi.1
@@ -1,12 +1,12 @@
 .\&quot;     Title: kiwi
 .\&quot;    Author: Marcus Schaefer &lt;ms (AT) suse.de&gt;
 .\&quot; Generator: DocBook XSL Stylesheets v1.74.0 &lt;<A HREF="http://docbook.sf.net/">http://docbook.sf.net/</A>&gt;
-.\&quot;      Date: Created: 04/16/2010
+.\&quot;      Date: Created: 04/21/2010
 .\&quot;    Manual: KIWI Manualpage
 .\&quot;    Source: KIWI v3.65
 .\&quot;  Language: English
 .\&quot;
-.TH &quot;KIWI&quot; &quot;1&quot; &quot;Created: 04/16/2010&quot; &quot;KIWI v3\&amp;.65&quot; &quot;KIWI Manualpage&quot;
+.TH &quot;KIWI&quot; &quot;1&quot; &quot;Created: 04/21/2010&quot; &quot;KIWI v3\&amp;.65&quot; &quot;KIWI Manualpage&quot;
 .\&quot; -----------------------------------------------------------------
 .\&quot; * (re)Define some macros
 .\&quot; -----------------------------------------------------------------
diff --git a/doc/kiwi.pdf b/doc/kiwi.pdf
index 54478f5..89eeedc 100644
Binary files a/doc/kiwi.pdf and b/doc/kiwi.pdf differ
diff --git a/locale/ar/LC_MESSAGES/kiwi.po b/locale/ar/LC_MESSAGES/kiwi.po
index c59cd58..452e773 100644
--- a/locale/ar/LC_MESSAGES/kiwi.po
+++ b/locale/ar/LC_MESSAGES/kiwi.po
@@ -80,3 +80,6 @@ msgstr &quot;&quot;
 
 msgid &quot;Select disk for installation:&quot;
 msgstr &quot;&quot;
+
+msgid &quot;Select %1 partition for installation:&quot;
+msgstr &quot;&quot;
diff --git a/locale/cs/LC_MESSAGES/kiwi.po b/locale/cs/LC_MESSAGES/kiwi.po
index 5e476a2..eee376c 100644
--- a/locale/cs/LC_MESSAGES/kiwi.po
+++ b/locale/cs/LC_MESSAGES/kiwi.po
@@ -80,3 +80,6 @@ msgstr &quot;&quot;
 
 msgid &quot;Select disk for installation:&quot;
 msgstr &quot;&quot;
+
+msgid &quot;Select %1 partition for installation:&quot;
+msgstr &quot;&quot;
diff --git a/locale/de/LC_MESSAGES/kiwi.po b/locale/de/LC_MESSAGES/kiwi.po
index 60d6782..6c0f5f9 100644
--- a/locale/de/LC_MESSAGES/kiwi.po
+++ b/locale/de/LC_MESSAGES/kiwi.po
@@ -80,3 +80,6 @@ msgstr &quot;&quot;
 
 msgid &quot;Select disk for installation:&quot;
 msgstr &quot;&quot;
+
+msgid &quot;Select %1 partition for installation:&quot;
+msgstr &quot;&quot;
diff --git a/locale/el/LC_MESSAGES/kiwi.po b/locale/el/LC_MESSAGES/kiwi.po
index cafada4..4fa59ed 100644
--- a/locale/el/LC_MESSAGES/kiwi.po
+++ b/locale/el/LC_MESSAGES/kiwi.po
@@ -80,3 +80,6 @@ msgstr &quot;&quot;
 
 msgid &quot;Select disk for installation:&quot;
 msgstr &quot;&quot;
+
+msgid &quot;Select %1 partition for installation:&quot;
+msgstr &quot;&quot;
diff --git a/locale/es/LC_MESSAGES/kiwi.po b/locale/es/LC_MESSAGES/kiwi.po
index 00ccf93..281f712 100644
--- a/locale/es/LC_MESSAGES/kiwi.po
+++ b/locale/es/LC_MESSAGES/kiwi.po
@@ -80,3 +80,6 @@ msgstr &quot;&quot;
 
 msgid &quot;Select disk for installation:&quot;
 msgstr &quot;&quot;
+
+msgid &quot;Select %1 partition for installation:&quot;
+msgstr &quot;&quot;
diff --git a/locale/fi/LC_MESSAGES/kiwi.po b/locale/fi/LC_MESSAGES/kiwi.po
index ac13394..09d56c0 100644
--- a/locale/fi/LC_MESSAGES/kiwi.po
+++ b/locale/fi/LC_MESSAGES/kiwi.po
@@ -80,3 +80,6 @@ msgstr &quot;&quot;
 
 msgid &quot;Select disk for installation:&quot;
 msgstr &quot;&quot;
+
+msgid &quot;Select %1 partition for installation:&quot;
+msgstr &quot;&quot;
diff --git a/locale/fr/LC_MESSAGES/kiwi.po b/locale/fr/LC_MESSAGES/kiwi.po
index b2422c1..c96fff5 100644
--- a/locale/fr/LC_MESSAGES/kiwi.po
+++ b/locale/fr/LC_MESSAGES/kiwi.po
@@ -80,3 +80,6 @@ msgstr &quot;&quot;
 
 msgid &quot;Select disk for installation:&quot;
 msgstr &quot;&quot;
+
+msgid &quot;Select %1 partition for installation:&quot;
+msgstr &quot;&quot;
diff --git a/locale/hu/LC_MESSAGES/kiwi.po b/locale/hu/LC_MESSAGES/kiwi.po
index 9cac8c4..41805a6 100644
--- a/locale/hu/LC_MESSAGES/kiwi.po
+++ b/locale/hu/LC_MESSAGES/kiwi.po
@@ -80,3 +80,6 @@ msgstr &quot;&quot;
 
 msgid &quot;Select disk for installation:&quot;
 msgstr &quot;&quot;
+
+msgid &quot;Select %1 partition for installation:&quot;
+msgstr &quot;&quot;
diff --git a/locale/it/LC_MESSAGES/kiwi.po b/locale/it/LC_MESSAGES/kiwi.po
index 43e8c92..c2b4c87 100644
--- a/locale/it/LC_MESSAGES/kiwi.po
+++ b/locale/it/LC_MESSAGES/kiwi.po
@@ -80,3 +80,6 @@ msgstr &quot;&quot;
 
 msgid &quot;Select disk for installation:&quot;
 msgstr &quot;&quot;
+
+msgid &quot;Select %1 partition for installation:&quot;
+msgstr &quot;&quot;
diff --git a/locale/ja/LC_MESSAGES/kiwi.po b/locale/ja/LC_MESSAGES/kiwi.po
index 88d4b2b..27c11f7 100644
--- a/locale/ja/LC_MESSAGES/kiwi.po
+++ b/locale/ja/LC_MESSAGES/kiwi.po
@@ -80,3 +80,6 @@ msgstr &quot;&quot;
 
 msgid &quot;Select disk for installation:&quot;
 msgstr &quot;&quot;
+
+msgid &quot;Select %1 partition for installation:&quot;
+msgstr &quot;&quot;
diff --git a/locale/kiwi-template/kiwi.pot b/locale/kiwi-template/kiwi.pot
index 5474f3c..e0a39a3 100644
--- a/locale/kiwi-template/kiwi.pot
+++ b/locale/kiwi-template/kiwi.pot
@@ -82,3 +82,6 @@ msgstr &quot;&quot;
 
 msgid &quot;Select disk for installation:&quot;
 msgstr &quot;&quot;
+
+msgid &quot;Select %1 partition for installation:&quot;
+msgstr &quot;&quot;
diff --git a/locale/ko/LC_MESSAGES/kiwi.po b/locale/ko/LC_MESSAGES/kiwi.po
index 156ef12..784fb01 100644
--- a/locale/ko/LC_MESSAGES/kiwi.po
+++ b/locale/ko/LC_MESSAGES/kiwi.po
@@ -80,3 +80,6 @@ msgstr &quot;&quot;
 
 msgid &quot;Select disk for installation:&quot;
 msgstr &quot;&quot;
+
+msgid &quot;Select %1 partition for installation:&quot;
+msgstr &quot;&quot;
diff --git a/locale/nl/LC_MESSAGES/kiwi.po b/locale/nl/LC_MESSAGES/kiwi.po
index 7f53e98..7f28a00 100644
--- a/locale/nl/LC_MESSAGES/kiwi.po
+++ b/locale/nl/LC_MESSAGES/kiwi.po
@@ -80,3 +80,6 @@ msgstr &quot;&quot;
 
 msgid &quot;Select disk for installation:&quot;
 msgstr &quot;&quot;
+
+msgid &quot;Select %1 partition for installation:&quot;
+msgstr &quot;&quot;
diff --git a/locale/pl/LC_MESSAGES/kiwi.po b/locale/pl/LC_MESSAGES/kiwi.po
index 9f60a24..0a9ce4e 100644
--- a/locale/pl/LC_MESSAGES/kiwi.po
+++ b/locale/pl/LC_MESSAGES/kiwi.po
@@ -81,3 +81,6 @@ msgstr &quot;&quot;
 
 msgid &quot;Select disk for installation:&quot;
 msgstr &quot;&quot;
+
+msgid &quot;Select %1 partition for installation:&quot;
+msgstr &quot;&quot;
diff --git a/locale/pt_BR/LC_MESSAGES/kiwi.po b/locale/pt_BR/LC_MESSAGES/kiwi.po
index 55dd357..f939540 100644
--- a/locale/pt_BR/LC_MESSAGES/kiwi.po
+++ b/locale/pt_BR/LC_MESSAGES/kiwi.po
@@ -80,3 +80,6 @@ msgstr &quot;&quot;
 
 msgid &quot;Select disk for installation:&quot;
 msgstr &quot;&quot;
+
+msgid &quot;Select %1 partition for installation:&quot;
+msgstr &quot;&quot;
diff --git a/locale/ru/LC_MESSAGES/kiwi.po b/locale/ru/LC_MESSAGES/kiwi.po
index 62c4a2f..7d90cb9 100644
--- a/locale/ru/LC_MESSAGES/kiwi.po
+++ b/locale/ru/LC_MESSAGES/kiwi.po
@@ -81,3 +81,6 @@ msgstr &quot;&quot;
 
 msgid &quot;Select disk for installation:&quot;
 msgstr &quot;&quot;
+
+msgid &quot;Select %1 partition for installation:&quot;
+msgstr &quot;&quot;
diff --git a/locale/sv/LC_MESSAGES/kiwi.po b/locale/sv/LC_MESSAGES/kiwi.po
index e057da5..7e2749c 100644
--- a/locale/sv/LC_MESSAGES/kiwi.po
+++ b/locale/sv/LC_MESSAGES/kiwi.po
@@ -80,3 +80,6 @@ msgstr &quot;&quot;
 
 msgid &quot;Select disk for installation:&quot;
 msgstr &quot;&quot;
+
+msgid &quot;Select %1 partition for installation:&quot;
+msgstr &quot;&quot;
diff --git a/locale/tr/LC_MESSAGES/kiwi.po b/locale/tr/LC_MESSAGES/kiwi.po
index f8b0830..2ea028c 100644
--- a/locale/tr/LC_MESSAGES/kiwi.po
+++ b/locale/tr/LC_MESSAGES/kiwi.po
@@ -80,3 +80,6 @@ msgstr &quot;&quot;
 
 msgid &quot;Select disk for installation:&quot;
 msgstr &quot;&quot;
+
+msgid &quot;Select %1 partition for installation:&quot;
+msgstr &quot;&quot;
diff --git a/locale/uk/LC_MESSAGES/kiwi.po b/locale/uk/LC_MESSAGES/kiwi.po
index 0d2662a..900162a 100644
--- a/locale/uk/LC_MESSAGES/kiwi.po
+++ b/locale/uk/LC_MESSAGES/kiwi.po
@@ -81,3 +81,6 @@ msgstr &quot;&quot;
 
 msgid &quot;Select disk for installation:&quot;
 msgstr &quot;&quot;
+
+msgid &quot;Select %1 partition for installation:&quot;
+msgstr &quot;&quot;
diff --git a/locale/zh_CN/LC_MESSAGES/kiwi.po b/locale/zh_CN/LC_MESSAGES/kiwi.po
index 700c1fc..143320e 100644
--- a/locale/zh_CN/LC_MESSAGES/kiwi.po
+++ b/locale/zh_CN/LC_MESSAGES/kiwi.po
@@ -80,3 +80,6 @@ msgstr &quot;&quot;
 
 msgid &quot;Select disk for installation:&quot;
 msgstr &quot;&quot;
+
+msgid &quot;Select %1 partition for installation:&quot;
+msgstr &quot;&quot;
diff --git a/locale/zh_TW/LC_MESSAGES/kiwi.po b/locale/zh_TW/LC_MESSAGES/kiwi.po
index 5be209a..44a03e3 100644
--- a/locale/zh_TW/LC_MESSAGES/kiwi.po
+++ b/locale/zh_TW/LC_MESSAGES/kiwi.po
@@ -80,3 +80,6 @@ msgstr &quot;&quot;
 
 msgid &quot;Select disk for installation:&quot;
 msgstr &quot;&quot;
+
+msgid &quot;Select %1 partition for installation:&quot;
+msgstr &quot;&quot;
diff --git a/modules/KIWIBoot.pm b/modules/KIWIBoot.pm
index 2df771e..d668278 100644
--- a/modules/KIWIBoot.pm
+++ b/modules/KIWIBoot.pm
@@ -1446,6 +1446,7 @@ sub setupInstallCD {
 	my $zipped    = $this-&gt;{zipped};
 	my $isxen     = $this-&gt;{isxen};
 	my $xml       = $this-&gt;{xml};
+	my $pinst     = $xml-&gt;getOEMPartitionInstall();
 	my $md5name   = $system;
 	my $imgtype   = &quot;oem&quot;;
 	my $gotsys    = 1;
@@ -1562,32 +1563,44 @@ sub setupInstallCD {
 	#==========================================
 	# Compress system image
 	#------------------------------------------
-	$kiwi -&gt; info (&quot;Compressing installation image...&quot;);
-	$md5name=~ s/\.raw$/\.md5/;
-	$status = qxx (&quot;$main::Gzip -f $system 2&gt;&amp;1&quot;);
-	$result = $? &gt;&gt; 8;
-	if ($result != 0) {
-		$kiwi -&gt; failed ();
-		$kiwi -&gt; error  (&quot;Failed to compress system image: $status&quot;);
-		$kiwi -&gt; failed ();
-		$this -&gt; cleanTmp ();
-		return undef;
+	$md5name =~ s/\.raw$/\.md5/;
+	if (! $pinst) {
+		$kiwi -&gt; info (&quot;Compressing installation image...&quot;);
+		$status = qxx (&quot;$main::Gzip -f $system 2&gt;&amp;1&quot;);
+		$result = $? &gt;&gt; 8;
+		if ($result != 0) {
+			$kiwi -&gt; failed ();
+			$kiwi -&gt; error  (&quot;Failed to compress system image: $status&quot;);
+			$kiwi -&gt; failed ();
+			$this -&gt; cleanTmp ();
+			return undef;
+		}
+		$kiwi -&gt; done();
+		$system = $system.&quot;.gz&quot;;
 	}
-	$kiwi -&gt; done();
-	$system = $system.&quot;.gz&quot;;
 	#==========================================
 	# Setup image basename
 	#------------------------------------------
 	my $namecd = basename ($system);
 	if ($gotsys) {
-		if ($namecd !~ /(.*)-(\d+\.\d+\.\d+)\.raw\.gz$/) {
+		my $suffix = '\.raw\.gz';
+		if ($pinst) {
+			$suffix = '\.raw';
+		}
+		if ($namecd !~ /(.*)-(\d+\.\d+\.\d+)$suffix$/) {
 			$kiwi -&gt; error  (&quot;Couldn't extract version information&quot;);
 			$kiwi -&gt; failed ();
 			$this -&gt; cleanTmp ();
-			qxx ( &quot;$main::Gzip -d $system&quot; );
+			if (! $pinst) {
+				qxx ( &quot;$main::Gzip -d $system&quot; );
+			}
 			return undef;
 		}
-		$ibasename = $1.&quot;.gz&quot;;
+		if (! $pinst) {
+			$ibasename = $1.&quot;.gz&quot;;
+		} else {
+			$ibasename = $1;
+		}
 	}
 	#==========================================
 	# Setup initrd for install purpose
@@ -1595,7 +1608,9 @@ sub setupInstallCD {
 	$initrd = $this -&gt; setupInstallFlags();
 	if (! defined $initrd) {
 		$this -&gt; cleanTmp ();
-		qxx ( &quot;$main::Gzip -d $system&quot; );
+		if (! $pinst) {
+			qxx ( &quot;$main::Gzip -d $system&quot; );
+		}
 		return undef;
 	}
 	#==========================================
@@ -1605,7 +1620,9 @@ sub setupInstallCD {
 	if (! $this -&gt; createBootStructure()) {
 		$this-&gt;{initrd} = $oldird;
 		$this -&gt; cleanTmp ();
-		qxx ( &quot;$main::Gzip -d $system&quot; );
+		if (! $pinst) {
+			qxx ( &quot;$main::Gzip -d $system&quot; );
+		}
 		return undef;
 	}
 	#==========================================
@@ -1613,7 +1630,9 @@ sub setupInstallCD {
 	#------------------------------------------
 	if (! $this -&gt; setupBootLoaderStages (&quot;grub&quot;,&quot;iso&quot;)) {
 		$this -&gt; cleanTmp ();
-		qxx ( &quot;$main::Gzip -d $system&quot; );
+		if (! $pinst) {
+			qxx ( &quot;$main::Gzip -d $system&quot; );
+		}
 		return undef;
 	}
 	qxx (&quot;rm -rf $tmpdir/usr 2&gt;&amp;1&quot;);
@@ -1628,7 +1647,9 @@ sub setupInstallCD {
 	}
 	if (! $this -&gt; setupBootLoaderConfiguration (&quot;grub&quot;,$title)) {
 		$this -&gt; cleanTmp ();
-		qxx ( &quot;$main::Gzip -d $system&quot; );
+		if (! $pinst) {
+			qxx ( &quot;$main::Gzip -d $system&quot; );
+		}
 		return undef;
 	}
 	#==========================================
@@ -1639,7 +1660,9 @@ sub setupInstallCD {
 			$kiwi -&gt; error  (&quot;Couldn't create CD install flag file&quot;);
 			$kiwi -&gt; failed ();
 			$this -&gt; cleanTmp ();
-			qxx ( &quot;$main::Gzip -d $system&quot; );
+			if (! $pinst) {
+				qxx ( &quot;$main::Gzip -d $system&quot; );
+			}
 			return undef;
 		}
 		print FD &quot;IMAGE=$ibasename\n&quot;;
@@ -1652,7 +1675,9 @@ sub setupInstallCD {
 			$kiwi -&gt; error  (&quot;Failed importing system image: $status&quot;);
 			$kiwi -&gt; failed ();
 			$this -&gt; cleanTmp ();
-			qxx ( &quot;$main::Gzip -d $system&quot; );
+			if (! $pinst) {
+				qxx ( &quot;$main::Gzip -d $system&quot; );
+			}
 			return undef;
 		}
 		$status = qxx (&quot;cp $md5name $tmpdir/$ibasename.md5 2&gt;&amp;1&quot;);
@@ -1662,11 +1687,15 @@ sub setupInstallCD {
 			$kiwi -&gt; error  (&quot;Failed importing system md5 sum: $status&quot;);
 			$kiwi -&gt; failed ();
 			$this -&gt; cleanTmp ();
-			qxx ( &quot;$main::Gzip -d $system&quot; );
+			if (! $pinst) {
+				qxx ( &quot;$main::Gzip -d $system&quot; );
+			}
 			return undef;
 		}
-		qxx ( &quot;$main::Gzip -d $system&quot; );
-		$system =~ s/\.gz$//;
+		if (! $pinst) {
+			qxx ( &quot;$main::Gzip -d $system&quot; );
+			$system =~ s/\.gz$//;
+		}
 		$kiwi -&gt; done();
 	}
 	#==========================================
@@ -1729,6 +1758,7 @@ sub setupInstallStick {
 	my $zipped    = $this-&gt;{zipped};
 	my $isxen     = $this-&gt;{isxen};
 	my $xml       = $this-&gt;{xml};
+	my $pinst     = $xml-&gt;getOEMPartitionInstall();
 	my $irdsize   = -s $initrd;
 	my $diskname  = $system.&quot;.install.raw&quot;;
 	my $md5name   = $system;
@@ -1841,19 +1871,21 @@ sub setupInstallStick {
 	#==========================================
 	# Compress system image
 	#------------------------------------------
-	$kiwi -&gt; info (&quot;Compressing installation image...&quot;);
 	$md5name=~ s/\.raw$/\.md5/;
-	$status = qxx (&quot;$main::Gzip -f $system 2&gt;&amp;1&quot;);
-	$result = $? &gt;&gt; 8;
-	if ($result != 0) {
-		$kiwi -&gt; failed ();
-		$kiwi -&gt; error  (&quot;Failed to compress system image: $status&quot;);
-		$kiwi -&gt; failed ();
-		$this -&gt; cleanTmp ();
-		return undef;
+	if (! $pinst) {
+		$kiwi -&gt; info (&quot;Compressing installation image...&quot;);
+		$status = qxx (&quot;$main::Gzip -f $system 2&gt;&amp;1&quot;);
+		$result = $? &gt;&gt; 8;
+		if ($result != 0) {
+			$kiwi -&gt; failed ();
+			$kiwi -&gt; error  (&quot;Failed to compress system image: $status&quot;);
+			$kiwi -&gt; failed ();
+			$this -&gt; cleanTmp ();
+			return undef;
+		}
+		$kiwi -&gt; done();
+		$system = $system.&quot;.gz&quot;;
 	}
-	$kiwi -&gt; done();
-	$system = $system.&quot;.gz&quot;;
 	#==========================================
 	# setup required disk size
 	#------------------------------------------
@@ -1868,14 +1900,22 @@ sub setupInstallStick {
 	#------------------------------------------
 	my $nameusb = basename ($system);
 	if ($gotsys) {
-		if ($nameusb !~ /(.*)-(\d+\.\d+\.\d+)\.raw\.gz$/) {
+		my $suffix = '\.raw\.gz';
+		if ($pinst) {
+			$suffix = '\.raw';
+		}
+		if ($nameusb !~ /(.*)-(\d+\.\d+\.\d+)$suffix$/) {
 			$kiwi -&gt; error  (&quot;Couldn't extract version information&quot;);
 			$kiwi -&gt; failed ();
 			$this -&gt; cleanTmp ();
 			qxx ( &quot;$main::Gzip -d $system&quot; );
 			return undef;
 		}
-		$ibasename = $1.&quot;.gz&quot;;
+		if (! $pinst) {
+			$ibasename = $1.&quot;.gz&quot;;
+		} else {
+			$ibasename = $1;
+		}
 	}
 	#==========================================
 	# Setup initrd for install purpose
@@ -1883,7 +1923,9 @@ sub setupInstallStick {
 	$initrd = $this -&gt; setupInstallFlags();
 	if (! defined $initrd) {
 		$this -&gt; cleanTmp ();
-		qxx ( &quot;$main::Gzip -d $system&quot; );
+		if (! $pinst) {
+			qxx ( &quot;$main::Gzip -d $system&quot; );
+		}
 		return undef;
 	}
 	$this-&gt;{initrd} = $initrd;
@@ -1893,7 +1935,9 @@ sub setupInstallStick {
 	if (! $this -&gt; createBootStructure(&quot;vmx&quot;)) {
 		$this-&gt;{initrd} = $oldird;
 		$this -&gt; cleanTmp ();
-		qxx ( &quot;$main::Gzip -d $system&quot; );
+		if (! $pinst) {
+			qxx ( &quot;$main::Gzip -d $system&quot; );
+		}
 		return undef;
 	}
 	#==========================================
@@ -1901,7 +1945,9 @@ sub setupInstallStick {
 	#------------------------------------------
 	if (! $this -&gt; setupBootLoaderStages (&quot;grub&quot;)) {
 		$this -&gt; cleanTmp ();
-		qxx ( &quot;$main::Gzip -d $system&quot; );
+		if (! $pinst) {
+			qxx ( &quot;$main::Gzip -d $system&quot; );
+		}
 		return undef;
 	}
 	#==========================================
@@ -1913,7 +1959,9 @@ sub setupInstallStick {
 	}
 	if (! $this -&gt; setupBootLoaderConfiguration (&quot;grub&quot;,$title)) {
 		$this -&gt; cleanTmp ();
-		qxx ( &quot;$main::Gzip -d $system&quot; );
+		if (! $pinst) {
+			qxx ( &quot;$main::Gzip -d $system&quot; );
+		}
 		return undef;
 	}
 	$this-&gt;{initrd} = $oldird;
@@ -1928,7 +1976,9 @@ sub setupInstallStick {
 		$kiwi -&gt; error  (&quot;Failed creating virtual disk: $status&quot;);
 		$kiwi -&gt; failed ();
 		$this -&gt; cleanTmp ();
-		qxx ( &quot;$main::Gzip -d $system&quot; );
+		if (! $pinst) {
+			qxx ( &quot;$main::Gzip -d $system&quot; );
+		}
 		return undef;
 	}
 	$kiwi -&gt; done();
@@ -1936,7 +1986,9 @@ sub setupInstallStick {
 	if (! $this -&gt; bindLoopDevice ($diskname)) {
 		$kiwi -&gt; failed ();
 		$this -&gt; cleanTmp ();
-		qxx ( &quot;$main::Gzip -d $system&quot; );
+		if (! $pinst) {
+			qxx ( &quot;$main::Gzip -d $system&quot; );
+		}
 		return undef;
 	}
 	$kiwi -&gt; done();
@@ -1961,7 +2013,9 @@ sub setupInstallStick {
 		$kiwi -&gt; error  (&quot;Couldn't create partition table&quot;);
 		$kiwi -&gt; failed ();
 		$this -&gt; cleanLoop();
-		qxx ( &quot;$main::Gzip -d $system&quot; );
+		if (! $pinst) {
+			qxx ( &quot;$main::Gzip -d $system&quot; );
+		}
 		return undef;
 	}
 	$kiwi -&gt; done();
@@ -1980,7 +2034,9 @@ sub setupInstallStick {
 		$kiwi -&gt; error  (&quot;Failed mapping virtual partition: $status&quot;);
 		$kiwi -&gt; failed ();
 		$this -&gt; cleanLoop ();
-		qxx ( &quot;$main::Gzip -d $system&quot; );
+		if (! $pinst) {
+			qxx ( &quot;$main::Gzip -d $system&quot; );
+		}
 		return undef;
 	}
 	my $boot = $deviceMap{1};
@@ -2008,7 +2064,9 @@ sub setupInstallStick {
 			$kiwi -&gt; error  (&quot;Failed creating filesystem: $status&quot;);
 			$kiwi -&gt; failed ();
 			$this -&gt; cleanLoop ();
-			qxx ( &quot;$main::Gzip -d $system&quot; );
+			if (! $pinst) {
+				qxx ( &quot;$main::Gzip -d $system&quot; );
+			}
 			return undef;
 		}
 		$kiwi -&gt; done();
@@ -2022,7 +2080,9 @@ sub setupInstallStick {
 		$kiwi -&gt; error  (&quot;Couldn't mount boot partition: $status&quot;);
 		$kiwi -&gt; failed ();
 		$this -&gt; cleanLoop ();
-		qxx ( &quot;$main::Gzip -d $system&quot; );
+		if (! $pinst) {
+			qxx ( &quot;$main::Gzip -d $system&quot; );
+		}
 		return undef;
 	}
 	$status = qxx (&quot;cp -a $tmpdir/boot $loopdir 2&gt;&amp;1&quot;);
@@ -2032,7 +2092,9 @@ sub setupInstallStick {
 		$kiwi -&gt; error  (&quot;Couldn't install boot data: $status&quot;);
 		$kiwi -&gt; failed ();
 		$this -&gt; cleanLoop ();
-		qxx ( &quot;$main::Gzip -d $system&quot; );
+		if (! $pinst) {
+			qxx ( &quot;$main::Gzip -d $system&quot; );
+		}
 		return undef;
 	}
 	main::umount();
@@ -2047,7 +2109,9 @@ sub setupInstallStick {
 			$kiwi -&gt; error  (&quot;Couldn't mount data partition: $status&quot;);
 			$kiwi -&gt; failed ();
 			$this -&gt; cleanLoop ();
-			qxx ( &quot;$main::Gzip -d $system&quot; );
+			if (! $pinst) {
+				qxx ( &quot;$main::Gzip -d $system&quot; );
+			}
 			return undef;
 		}
 		$status = qxx (&quot;cp $system $loopdir/$ibasename 2&gt;&amp;1&quot;);
@@ -2057,7 +2121,9 @@ sub setupInstallStick {
 			$kiwi -&gt; error  (&quot;Failed importing system image: $status&quot;);
 			$kiwi -&gt; failed ();
 			$this -&gt; cleanLoop ();
-			qxx ( &quot;$main::Gzip -d $system&quot; );
+			if (! $pinst) {
+				qxx ( &quot;$main::Gzip -d $system&quot; );
+			}
 			return undef;
 		}
 		$status = qxx (&quot;cp $md5name $loopdir/$ibasename.md5 2&gt;&amp;1&quot;);
@@ -2067,7 +2133,9 @@ sub setupInstallStick {
 			$kiwi -&gt; error  (&quot;Failed importing system md5 sum: $status&quot;);
 			$kiwi -&gt; failed ();
 			$this -&gt; cleanLoop ();
-			qxx ( &quot;$main::Gzip -d $system&quot; );
+			if (! $pinst) {
+				qxx ( &quot;$main::Gzip -d $system&quot; );
+			}
 			return undef;
 		}
 		if (! open (FD,&quot;&gt;$loopdir/config.usbclient&quot;)) {
@@ -2075,13 +2143,17 @@ sub setupInstallStick {
 			$kiwi -&gt; error  (&quot;Couldn't create USB install flag file&quot;);
 			$kiwi -&gt; failed ();
 			$this -&gt; cleanLoop ();
-			qxx ( &quot;$main::Gzip -d $system&quot; );
+			if (! $pinst) {
+				qxx ( &quot;$main::Gzip -d $system&quot; );
+			}
 			return undef;
 		}
 		print FD &quot;IMAGE=$ibasename\n&quot;;
 		close FD;
 		main::umount();
-		qxx ( &quot;$main::Gzip -d $system&quot; );
+		if (! $pinst) {
+			qxx ( &quot;$main::Gzip -d $system&quot; );
+		}
 		$kiwi -&gt; done();
 	}
 	#==========================================
@@ -3041,6 +3113,8 @@ sub setupInstallFlags {
 	my $initrd = $this-&gt;{initrd};
 	my $system = $this-&gt;{system};
 	my $irddir = $initrd.&quot;_&quot;.$$.&quot;.vmxsystem&quot;;
+	my $xml    = $this-&gt;{xml};
+	my $pinst  = $xml-&gt;getOEMPartitionInstall();
 	my $ibasename;
 	my $iversion;
 	my $newird;
@@ -3095,7 +3169,11 @@ sub setupInstallFlags {
 			qxx (&quot;rm -rf $irddir&quot;);
 			return undef;
 		}
-		print FD &quot;IMAGE=nope;$ibasename;$iversion;compressed\n&quot;;
+		if (! $pinst) {
+			print FD &quot;IMAGE=nope;$ibasename;$iversion;compressed\n&quot;;
+		} else {
+			print FD &quot;IMAGE=nope;$ibasename;$iversion\n&quot;;
+		}
 		close FD;
 	}
 	#==========================================
diff --git a/modules/KIWIConfig.sh b/modules/KIWIConfig.sh
index 4088fd9..f1575a5 100644
--- a/modules/KIWIConfig.sh
+++ b/modules/KIWIConfig.sh
@@ -222,6 +222,10 @@ function baseSetupOEMPartition {
 		echo &quot;Setting up OEM_WITHOUTSWAP=1&quot;
 		echo &quot;OEM_WITHOUTSWAP=1&quot; &gt;&gt; $oemfile
 	fi
+	if [ ! -z &quot;$kiwi_oempartition_install&quot; ];then
+		echo &quot;Setting up OEM_PARTITION_INSTALL=1&quot;
+		echo &quot;OEM_PARTITION_INSTALL=1&quot; &gt;&gt; $oemfile
+	fi
 	if [ ! -z &quot;$kiwi_oemswapMB&quot; ];then
 		echo &quot;Setting up OEM_SWAPSIZE=$kiwi_oemswapMB&quot;
 		echo &quot;OEM_SWAPSIZE=$kiwi_oemswapMB&quot; &gt;&gt; $oemfile
@@ -954,7 +958,7 @@ function suseStripInitrd {
 		lvchange lvresize lvextend lvcreate grub dcounter tty
 		dmsetup dialog awk gawk clicfs cryptsetup clear blkid fbiterm
 		gettext diff bc utimer cmp busybox kexec pam_console_apply
-		setterm
+		setterm kpartx
 	&quot;
 	tools=&quot;$tools $@&quot;
 	for path in /sbin /usr/sbin /usr/bin /bin;do
diff --git a/modules/KIWIImage.pm b/modules/KIWIImage.pm
index f6e4e49..846a599 100644
--- a/modules/KIWIImage.pm
+++ b/modules/KIWIImage.pm
@@ -1016,6 +1016,7 @@ sub createImageUSB {
 	$main::ForeignRepo{&quot;xmlnode&quot;} = $xml -&gt; getForeignNodeList();
 	$main::ForeignRepo{&quot;xmlpacnode&quot;} = $xml -&gt; getForeignPackageNodeList();
 	$main::ForeignRepo{&quot;packagemanager&quot;} = $xml -&gt; getPackageManager();
+	$main::ForeignRepo{&quot;oem-partition-install&quot;} =$xml-&gt;getOEMPartitionInstall();
 	$main::ForeignRepo{&quot;oem-swap&quot;}       = $xml -&gt; getOEMSwap();
 	$main::ForeignRepo{&quot;oem-swapsize&quot;}   = $xml -&gt; getOEMSwapSize();
 	$main::ForeignRepo{&quot;oem-systemsize&quot;} = $xml -&gt; getOEMSystemSize();
@@ -2871,6 +2872,7 @@ sub createImageSplit {
 	$main::ForeignRepo{&quot;xmlnode&quot;} = $xml -&gt; getForeignNodeList();
 	$main::ForeignRepo{&quot;xmlpacnode&quot;} = $xml -&gt; getForeignPackageNodeList();
 	$main::ForeignRepo{&quot;packagemanager&quot;} = $xml -&gt; getPackageManager();
+	$main::ForeignRepo{&quot;oem-partition-install&quot;} =$xml-&gt;getOEMPartitionInstall();
 	$main::ForeignRepo{&quot;oem-swap&quot;}       = $xml -&gt; getOEMSwap();
 	$main::ForeignRepo{&quot;oem-swapsize&quot;}   = $xml -&gt; getOEMSwapSize();
 	$main::ForeignRepo{&quot;oem-systemsize&quot;} = $xml -&gt; getOEMSystemSize();
diff --git a/modules/KIWILinuxRC.sh b/modules/KIWILinuxRC.sh
index 0887514..828962d 100644
--- a/modules/KIWILinuxRC.sh
+++ b/modules/KIWILinuxRC.sh
@@ -1220,9 +1220,7 @@ function setupBootLoaderGrub {
 	#======================================
 	# check for UNIONFS_CONFIG
 	#--------------------------------------
-	if [ &quot;$haveLVM&quot; = &quot;yes&quot; ]; then
-		gnum=1
-	elif [ &quot;$haveDMSquash&quot; = &quot;yes&quot; ];then
+	if [ &quot;$haveDMSquash&quot; = &quot;yes&quot; ];then
 		gnum=2
 	elif [ &quot;$haveClicFS&quot; = &quot;yes&quot; ];then
 		gnum=2
@@ -1482,9 +1480,7 @@ function setupBootLoaderLilo {
 	#======================================
 	# check for UNIONFS_CONFIG
 	#--------------------------------------
-	if [ &quot;$haveLVM&quot; = &quot;yes&quot; ]; then
-		lnum=1
-	elif [ &quot;$haveDMSquash&quot; = &quot;yes&quot; ];then
+	if [ &quot;$haveDMSquash&quot; = &quot;yes&quot; ];then
 		lnum=2
 	elif [ &quot;$haveClicFS&quot; = &quot;yes&quot; ];then
 		lnum=2
@@ -3036,8 +3032,7 @@ function partedGetPartitionID {
 	# /.../
 	# prints the partition ID for the given device and number
 	# ----
-	local disk=`echo $1 | sed -e s&quot;@[0-9]@@g&quot;`
-	parted -m -s $disk print | grep ^$2: | cut -f2 -d, |\
+	parted -m -s $1 print | grep ^$2: | cut -f2 -d, |\
 		cut -f2 -d= | tr -d &quot;;&quot; | tr -d 0
 }
 #======================================
diff --git a/modules/KIWISchema.rnc b/modules/KIWISchema.rnc
index 52191ea..f51a5cd 100644
--- a/modules/KIWISchema.rnc
+++ b/modules/KIWISchema.rnc
@@ -962,6 +962,31 @@ div {
 }
 
 #==========================================
+# common element &lt;oem-partition-install&gt;
+#
+div {
+	k.oem-partition-install.content = xsd:boolean
+	k.oem-partition-install.attlist = empty
+	k.oem-partition-install =
+		## For oemboot driven images: install the system not as
+		## disk but into a free partition. If this option is set
+		## all other oem-* options concerning the partition table
+		## will not have any effect
+		[
+		db:para [
+			&quot;For oemboot driven images: install the system not as\x{a}&quot;~
+			&quot;disk but into a free partition. If this option is set\x{a}&quot;~
+			&quot;all other oem-* options concerning the partition table\x{a}&quot;~
+			&quot;will not have any effect&quot;
+		]
+		]
+		element oem-partition-install {
+			k.oem-partition-install.attlist,
+			k.oem-partition-install.content
+		}
+}
+
+#==========================================
 # common element &lt;oem-home&gt;
 #
 div {
@@ -1934,6 +1959,7 @@ div {
 			k.oemconfig.attlist &amp;
 			k.oem-systemsize? &amp;
 			k.oem-swap? &amp;
+			k.oem-partition-install? &amp;
 			k.oem-home? &amp;
 			k.oem-boot-title? &amp;
 			k.oem-kiwi-initrd? &amp;
diff --git a/modules/KIWISchema.rng b/modules/KIWISchema.rng
index ad9fc13..6340251 100644
--- a/modules/KIWISchema.rng
+++ b/modules/KIWISchema.rng
@@ -1375,6 +1375,33 @@ recovery partition. Default value is 83 (Linux)&lt;/db:para&gt;
   &lt;/div&gt;
   &lt;!--
     ==========================================
+    common element &lt;oem-partition-install&gt;
+    
+  --&gt;
+  &lt;div&gt;
+    &lt;define name=&quot;k.oem-partition-install.content&quot;&gt;
+      &lt;data type=&quot;boolean&quot;/&gt;
+    &lt;/define&gt;
+    &lt;define name=&quot;k.oem-partition-install.attlist&quot;&gt;
+      &lt;empty/&gt;
+    &lt;/define&gt;
+    &lt;define name=&quot;k.oem-partition-install&quot;&gt;
+      &lt;element name=&quot;oem-partition-install&quot;&gt;
+        &lt;a:documentation&gt;For oemboot driven images: install the system not as
+disk but into a free partition. If this option is set
+all other oem-* options concerning the partition table
+will not have any effect&lt;/a:documentation&gt;
+        &lt;db:para&gt;For oemboot driven images: install the system not as
+disk but into a free partition. If this option is set
+all other oem-* options concerning the partition table
+will not have any effect&lt;/db:para&gt;
+        &lt;ref name=&quot;k.oem-partition-install.attlist&quot;/&gt;
+        &lt;ref name=&quot;k.oem-partition-install.content&quot;/&gt;
+      &lt;/element&gt;
+    &lt;/define&gt;
+  &lt;/div&gt;
+  &lt;!--
+    ==========================================
     common element &lt;oem-home&gt;
     
   --&gt;
@@ -2806,6 +2833,9 @@ and setup the system disk&lt;/db:para&gt;
             &lt;ref name=&quot;k.oem-swap&quot;/&gt;
           &lt;/optional&gt;
           &lt;optional&gt;
+            &lt;ref name=&quot;k.oem-partition-install&quot;/&gt;
+          &lt;/optional&gt;
+          &lt;optional&gt;
             &lt;ref name=&quot;k.oem-home&quot;/&gt;
           &lt;/optional&gt;
           &lt;optional&gt;
diff --git a/modules/KIWIXML.pm b/modules/KIWIXML.pm
index 6a07fa5..e76135f 100644
--- a/modules/KIWIXML.pm
+++ b/modules/KIWIXML.pm
@@ -353,6 +353,9 @@ sub new {
 		if (defined $foreignRepo-&gt;{&quot;oem-swap&quot;}) {
 			$this -&gt; setForeignOEMOptionsElement (&quot;oem-swap&quot;);
 		}
+		if (defined $foreignRepo-&gt;{&quot;oem-partition-install&quot;}) {
+			$this -&gt; setForeignOEMOptionsElement (&quot;oem-partition-install&quot;);
+		}
 		if (defined $foreignRepo-&gt;{&quot;oem-swapsize&quot;}) {
 			$this -&gt; setForeignOEMOptionsElement (&quot;oem-swapsize&quot;);
 		}
@@ -1387,6 +1390,26 @@ sub getOEMSwap {
 }
 
 #==========================================
+# getOEMPartitionInstall
+#------------------------------------------
+sub getOEMPartitionInstall {
+	# ...
+	# Obtain the oem-partition-install value or return undef
+	# ---
+	my $this = shift;
+	my $tnode= $this-&gt;{typeNode};
+	my $node = $tnode -&gt; getElementsByTagName (&quot;oemconfig&quot;) -&gt; get_node(1);
+	if (! defined $node) {
+		return undef;
+	}
+	my $pinst = $node -&gt; getElementsByTagName (&quot;oem-partition-install&quot;);
+	if ((! defined $pinst) || (&quot;$pinst&quot; eq &quot;&quot;)) {
+		return undef;
+	}
+	return $pinst;
+}
+
+#==========================================
 # getOEMRecovery
 #------------------------------------------
 sub getOEMRecovery {
@@ -2317,6 +2340,7 @@ sub getImageConfig {
 		my $oemswapMB= $element -&gt; getElementsByTagName (&quot;oem-swapsize&quot;);
 		my $oemrootMB= $element -&gt; getElementsByTagName (&quot;oem-systemsize&quot;);
 		my $oemswap  = $element -&gt; getElementsByTagName (&quot;oem-swap&quot;);
+		my $oempinst = $element -&gt; getElementsByTagName (&quot;oem-partition-install&quot;);
 		my $oemhome  = $element -&gt; getElementsByTagName (&quot;oem-home&quot;);
 		my $oemtitle = $element -&gt; getElementsByTagName (&quot;oem-boot-title&quot;);
 		my $oemkboot = $element -&gt; getElementsByTagName (&quot;oem-kiwi-initrd&quot;);
@@ -2335,6 +2359,9 @@ sub getImageConfig {
 		if ((defined $boottheme) &amp;&amp; (&quot;$boottheme&quot; ne &quot;&quot;)) {
 			$result{kiwi_boottheme}= $boottheme;
 		}
+		if ((defined $oempinst) &amp;&amp; (&quot;$oempinst&quot; eq &quot;true&quot;)) {
+			$result{kiwi_oempartition_install} = &quot;yes&quot;;
+		}
 		if ((defined $oemswap) &amp;&amp; (&quot;$oemswap&quot; eq &quot;false&quot;)) {
 			$result{kiwi_oemswap} = &quot;no&quot;;
 		} elsif ((defined $oemswapMB) &amp;&amp; (&quot;$oemswapMB&quot; &gt; 0)) {
diff --git a/rpm/kiwi.changes b/rpm/kiwi.changes
index b3b4a58..1f4f76f 100644
--- a/rpm/kiwi.changes
+++ b/rpm/kiwi.changes
@@ -1,6 +1,7 @@
 -------------------------------------------------------------------
 Tue Apr 20 12:12:44 CEST 2010 - <A HREF="https://lists.berlios.de/mailman/listinfo/kiwi-devel">ms at suse.de</A>
 
+- added support for OEM partition based install (bnc #597679)
 - use gfxboot.c32 if gfxboot.com does not exist
 - fixed function dn() which did not work for device names with
   the pX notation like /dev/mapper/loop0p1
diff --git a/system/boot/ix86/oemboot/suse-11.1/config.xml b/system/boot/ix86/oemboot/suse-11.1/config.xml
index c91b78c..0d6e9fa 100644
--- a/system/boot/ix86/oemboot/suse-11.1/config.xml
+++ b/system/boot/ix86/oemboot/suse-11.1/config.xml
@@ -139,6 +139,7 @@
 		&lt;package name=&quot;bc&quot;/&gt;
 		&lt;package name=&quot;gettext-runtime&quot;/&gt;
 		&lt;package name=&quot;kexec-tools&quot;/&gt;
+		&lt;package name=&quot;kpartx&quot;/&gt;
 	&lt;/packages&gt;
 	&lt;packages type=&quot;bootstrap&quot;&gt;
 		&lt;package name=&quot;filesystem&quot;/&gt;
diff --git a/system/boot/ix86/oemboot/suse-11.2/config.xml b/system/boot/ix86/oemboot/suse-11.2/config.xml
index 6070668..7907c34 100644
--- a/system/boot/ix86/oemboot/suse-11.2/config.xml
+++ b/system/boot/ix86/oemboot/suse-11.2/config.xml
@@ -129,6 +129,7 @@
 		&lt;package name=&quot;bc&quot;/&gt;
 		&lt;package name=&quot;gettext-runtime&quot;/&gt;
 		&lt;package name=&quot;kexec-tools&quot;/&gt;
+		&lt;package name=&quot;kpartx&quot;/&gt;
 	&lt;/packages&gt;
 	&lt;packages type=&quot;bootstrap&quot;&gt;
 		&lt;package name=&quot;filesystem&quot;/&gt;
diff --git a/system/boot/ix86/oemboot/suse-11.3/config.xml b/system/boot/ix86/oemboot/suse-11.3/config.xml
index 6afa957..d07ab00 100644
--- a/system/boot/ix86/oemboot/suse-11.3/config.xml
+++ b/system/boot/ix86/oemboot/suse-11.3/config.xml
@@ -129,6 +129,7 @@
 		&lt;package name=&quot;bc&quot;/&gt;
 		&lt;package name=&quot;gettext-runtime&quot;/&gt;
 		&lt;package name=&quot;kexec-tools&quot;/&gt;
+		&lt;package name=&quot;kpartx&quot;/&gt;
 	&lt;/packages&gt;
 	&lt;packages type=&quot;bootstrap&quot;&gt;
 		&lt;package name=&quot;filesystem&quot;/&gt;
diff --git a/system/boot/ix86/oemboot/suse-SLES11/config.xml b/system/boot/ix86/oemboot/suse-SLES11/config.xml
index d03eca3..c5bcfda 100644
--- a/system/boot/ix86/oemboot/suse-SLES11/config.xml
+++ b/system/boot/ix86/oemboot/suse-SLES11/config.xml
@@ -126,6 +126,7 @@
 		&lt;package name=&quot;bc&quot;/&gt;
 		&lt;package name=&quot;gettext-runtime&quot;/&gt;
 		&lt;package name=&quot;kexec-tools&quot;/&gt;
+		&lt;package name=&quot;kpartx&quot;/&gt;
 	&lt;/packages&gt;
 	&lt;packages type=&quot;bootstrap&quot;&gt;
 		&lt;package name=&quot;filesystem&quot;/&gt;
diff --git a/system/boot/ix86/oemboot/suse-dump b/system/boot/ix86/oemboot/suse-dump
index 975148f..65a8966 100755
--- a/system/boot/ix86/oemboot/suse-dump
+++ b/system/boot/ix86/oemboot/suse-dump
@@ -80,6 +80,40 @@ function OEMNetwork {
 	imageServer=$SERVER
 }
 #======================================
+# OEMFindPartitions
+#--------------------------------------
+function OEMFindPartitions {
+	# /.../
+	# find partitions without known filesystem on the given
+	# disk device and return an list containing the information
+	# device:size-KB,device:size-KB,...
+	# ----
+	local disk=$1
+	local result
+	disk=$(echo $disk | sed -e s@^/dev/@@)
+	for i in $(cat /proc/partitions |\
+		grep -E $disk.+ | sed &quot;s/^ *//;s/ *$//;s/ \{1,\}/:/g&quot; |\
+		cut -f3,4 -d:)
+	do
+		local device=/dev/$(echo $i | cut -f2 -d:)
+		local kbsize=$(echo $i | cut -f1 -d:)
+		local mbsize=$((kbsize / 1024))
+		local partid=$(partitionID /dev/$disk $(nd $device))
+		if [ ! &quot;$partid&quot; = &quot;83&quot; ] &amp;&amp; [ ! &quot;$partid&quot; = &quot;8e&quot; ] ;then
+			continue
+		fi
+		if blkid $device -s TYPE -o value &amp;&gt;/dev/null;then
+			continue
+		fi
+		if [ -z &quot;$result&quot; ];then
+			result=$device:$mbsize
+		else
+			result=$result,$device:$mbsize
+		fi
+	done
+	echo $result
+}
+#======================================
 # OEMInstall
 #--------------------------------------
 function OEMInstall {
@@ -100,6 +134,14 @@ function OEMInstall {
 		return
 	fi
 	#======================================
+	# Check for install mode combination
+	#--------------------------------------
+	if [ ! -z &quot;$OEM_PARTITION_INSTALL&quot; ] &amp;&amp; [ ! -z &quot;$pxe&quot; ];then
+		systemException \
+			&quot;Partition install via remote interface is not supported&quot; \
+		&quot;reboot&quot;
+	fi
+	#======================================
 	# Display license if text exists
 	#--------------------------------------
 	displayEULA
@@ -116,13 +158,14 @@ function OEMInstall {
 			Echo &quot;Found Stick: $stickRoot -&gt; $stickSerial&quot;
 			mkdir -p /cdrom &amp;&amp; mount $(ddn $stickRoot 2) /cdrom
 			export OEMInstallType=USB
+			unset stickSerial
 		fi
 	else
 		OEMNetwork
 		export OEMInstallType=PXE
 	fi
 	#======================================
-	# Search and ask for the install device
+	# Search and ask for the install disk
 	#--------------------------------------
 	IFS=$IFS_ORIG
 	Echo &quot;Searching harddrive for $OEMInstallType installation&quot;
@@ -188,32 +231,21 @@ function OEMInstall {
 			&quot;reboot&quot;
 		fi
 	fi
-	Echo &quot;Entering installation mode for disk: $instDisk&quot;
-	TEXT_INST=$(
-		getText &quot;Destroying ALL data on %1, continue ?&quot; $instDisk)
-	Dialog --yesno &quot;\&quot;$TEXT_INST\&quot;&quot; 5 70
-	if [ ! $? = 0 ];then
-		systemException \
-			&quot;System installation canceled&quot; \
-		&quot;user_reboot&quot;
-	fi
-	clear
+	imageDevice=$instDisk
 	#======================================
-	# Import vmx configuration file
+	# Setup device names for further boot
 	#--------------------------------------
-	importFile &lt; $VMX_SYSTEM
+	export imageDiskExclude=$instDisk
+	export imageDiskDevice=$instDisk
 	#======================================
-	# Install disk system
+	# Import vmx configuration file
 	#--------------------------------------
-	# install virtual disk image from the CD/DVD onto the
-	# real disk. All data on the disk will be lost
-	# ----
-	imageZipped=&quot;uncompressed&quot;
-	imageDevice=$instDisk
-	field=0
+	importFile &lt; $VMX_SYSTEM
 	#======================================
 	# Evaluate OEM install file
 	#--------------------------------------
+	field=0
+	imageZipped=&quot;uncompressed&quot;
 	IFS=&quot;;&quot; ; for n in $IMAGE;do
 	case $field in
 		0) field=1 ;; 
@@ -232,89 +264,350 @@ function OEMInstall {
 		imageName=&quot;$prefix/$imageName&quot;
 		imageMD5=&quot;$imageName.md5&quot;
 	fi
-	IFS=&quot; &quot;
+	IFS=$IFS_ORIG
 	#======================================
-	# Check MBR ID's...
+	# Search, ask for the install partition
 	#--------------------------------------
-	# /.../
-	# mbr ID check is deactivated by default
-	# see bug #525682 for details
-	# ----
-	nombridcheck=1
-	if [ -z &quot;$nombridcheck&quot; ];then
-		mbrD=$instDisk
-		mbrI=&quot;cat $imageName&quot;
-		if [ &quot;$imageZipped&quot; = &quot;compressed&quot; ];then
-			mbrI=&quot;gzip -cd $imageName&quot;
+	if [ ! -z &quot;$OEM_PARTITION_INSTALL&quot; ];then
+		#======================================
+		# Loop mount disk image file
+		#--------------------------------------
+		reqpart=1
+		loop=$(losetup -s -f $imageName)
+		loop=$(echo $loop | sed -e s@^/dev/@@)
+		if ! kpartx -a /dev/$loop;then
+			systemException \
+				&quot;Loop setup for $instDisk failed&quot; \
+			&quot;reboot&quot;
+		fi
+		imageName=/dev/mapper/${loop}p1
+		if [ -e /dev/mapper/${loop}p2 ];then
+			reqpart=2
 		fi
-		mbrM=`dd if=$mbrD bs=1 count=4 skip=$((0x1b8))|hexdump -n4 -e '&quot;0x%x&quot;'`
-		mbrI=`$mbrI | dd  bs=1 count=4 skip=$((0x1b8))|hexdump -n4 -e '&quot;0x%x&quot;'`
-		if [ $mbrM = $mbrI ];then
+		#======================================
+		# Lookup/Check available partitions
+		#--------------------------------------
+		if [ $reqpart -gt 2 ];then
+			Echo &quot;Sorry only disk images with a root and optional boot&quot;
+			Echo &quot;partition are supported in partition based install mode&quot;
+			Echo &quot;I found $reqpart partitions in the disk image&quot;
 			systemException \
-				&quot;Base system already installed&quot; \
+				&quot;Installation aborted...&quot; \
 			&quot;reboot&quot;
-		fi	
-	fi
-	#======================================
-	# read MD5 information...
-	#--------------------------------------
-	if [ ! -z &quot;$pxe&quot; ];then
-		multicast=&quot;disable&quot;
-		fetchFile $imageMD5 /image.md5 uncompressed $imageServer
-		if test $loadCode != 0 || ! loadOK &quot;$loadStatus&quot;;then
+		fi
+		partitions=$(OEMFindPartitions $instDisk)
+		if [ ! -z &quot;$partitions&quot; ];then
+			count=0
+			IFS=&quot;,&quot;
+			for i in $partitions;do
+				count=$((count + 1))
+			done
+			IFS=$IFS_ORIG
+		fi
+		if [ -z &quot;$partitions&quot; ] || [ $count -lt $reqpart ];then
+			if [ -z &quot;$partitions&quot; ];then
+				Echo &quot;No suitable partition(s) for installation found:&quot;
+			else
+				Echo &quot;Not enough partitions for installation found:&quot;
+				Echo &quot;Found $count but required $reqpart&quot;
+			fi
+			Echo &quot;Please prepare your disk first:&quot;
+			echo
+			Echo -b &quot;kiwi requires $reqpart partition(s) of the types below&quot;
+			Echo -b &quot;without any filesystem inside. I recommend to use YaST&quot;
+			Echo -b &quot;to do the re-partitioning. YaST also allows you to shrink&quot;
+			Echo -b &quot;existing partitions without loosing data.&quot;
+			echo
+			count=0
+			for i in /dev/mapper/${loop}*;do
+				psize=`partitionSize $i`
+				partid=$(partitionID /dev/$loop $(nd $i))
+				if [ $count = 0 ];then
+					Echo -b &quot;* Root partition requires at least $psize KB&quot;
+				fi
+				if [ $count = 1 ];then
+					Echo -b &quot;* Boot partition requires at least $psize KB&quot;
+				fi
+				Echo -b &quot;  Partition Type: 0x$partid&quot;
+				count=$((count + 1))
+			done
+			echo
 			systemException \
-				&quot;Download of $imageMD5 failed: $loadStatus&quot; \
+				&quot;Installation aborted...&quot; \
 			&quot;reboot&quot;
 		fi
-		imageMD5=/image.md5
+		#======================================
+		# Select all required partitions
+		#--------------------------------------
+		if [ $count -eq $reqpart ] &amp;&amp; [ $reqpart -eq 1 ];then
+			#======================================
+			# There is only one free and required
+			#--------------------------------------
+			pname=`echo $partitions | cut -f1 -d:`
+			imageDevice=$pname
+			rID=$(nd $pname)
+			instItems[0]=$imageName:$imageDevice
+		else
+			#======================================
+			# There is a choice, let the user do it
+			#--------------------------------------
+			for p in /dev/mapper/${loop}*;do
+				if [ $p = /dev/mapper/${loop}p1 ];then
+					select=&quot;root&quot;
+				elif [ $p = /dev/mapper/${loop}p2 ];then
+					select=&quot;boot&quot;
+				fi
+				TEXT_SELECT=$(
+					getText &quot;Select %1 partition for installation:&quot; $select)
+				count=0
+				IFS=&quot;,&quot;
+				for i in $partitions;do
+					psize=`echo $i | cut -f2 -d:`
+					pname=`echo $i | cut -f1 -d:`
+					if [ $count = 0 ];then
+						dpara=&quot;$pname \&quot;[ $psize MB ]\&quot; on&quot;
+						count=1
+					else
+						dpara=&quot;$dpara $pname \&quot;[ $psize MB ]\&quot; off&quot;
+					fi
+					count=$((count + 1))
+				done
+				IFS=$IFS_ORIG
+				selectedPart=$(runInteractive \
+					&quot;--stdout --radiolist \&quot;$TEXT_SELECT\&quot; 20 75 15 $dpara&quot;
+				)
+				if [ ! $? = 0 ];then
+					systemException \
+						&quot;System installation canceled&quot; \
+					&quot;reboot&quot;
+				fi
+				count=0
+				IFS=&quot;,&quot;
+				for i in $partitions;do
+					psize=`echo $i | cut -f2 -d:`
+					pname=`echo $i | cut -f1 -d:`
+					if [ ! $pname = $selectedPart ];then
+						if [ $count = 0 ];then
+							partitions_next=$pname:$psize
+						else
+							partitions_next=$partitions_next,$pname:$psize
+						fi
+					fi
+					count=$((count + 1))
+				done
+				IFS=$IFS_ORIG
+				partitions=$partitions_next
+				if [ $p = /dev/mapper/${loop}p1 ];then
+					imageDevice=$selectedPart
+					rID=$(nd $selectedPart)
+					instItems[0]=$imageName:$imageDevice
+				elif [ $p = /dev/mapper/${loop}p2 ];then
+					bID=$(nd $selectedPart)
+					instItems[1]=/dev/mapper/${loop}p2:$selectedPart
+				fi
+			done
+		fi
+		#======================================
+		# Search for a swap space
+		#--------------------------------------
+		sID=$(searchSwapSpace)
+		if [ ! -z &quot;$sID&quot; ];then
+			sID=$(nd $sID)
+		else
+			sID=no
+		fi
+		#======================================
+		# Setup device names for further boot
+		#--------------------------------------
+		# /.../
+		# no support for reocvery and extra home partition in
+		# partition install mode
+		# ----
+		export DONT_PARTITION=1
+		export OEM_WITHOUTHOME=1
+		unset  OEM_RECOVERY
+		if [ -z &quot;$bID&quot; ];then
+			bID=$rID
+		fi
+		setupDeviceNames $rID $sID no no $bID no
+	else
+		instItems[0]=$imageName:$imageDevice
 	fi
-	read sum1 blocks blocksize zblocks zblocksize &lt; $imageMD5
 	#======================================
-	# Get available disk space
+	# Checks and MD5 sums...
 	#--------------------------------------
-	haveKByte=`partitionSize $imageDevice`
-	#======================================
-	# Get required disk space, setup I/O
-	#--------------------------------------
-	needBytes=$(expr $blocks \* $blocksize)
-	needKByte=`expr $needBytes / 1024`
-	needMByte=`expr $needKByte / 1024`
+	if [ -z &quot;$OEM_PARTITION_INSTALL&quot; ];then
+		#======================================
+		# Check MBR ID's...
+		#--------------------------------------
+		# /.../
+		# mbr ID check is deactivated by default
+		# see bug #525682 for details
+		# ----
+		nombridcheck=1
+		if [ -z &quot;$nombridcheck&quot; ];then
+			mbrD=$instDisk
+			mbrI=&quot;cat $imageName&quot;
+			if [ &quot;$imageZipped&quot; = &quot;compressed&quot; ];then
+				mbrI=&quot;gzip -cd $imageName&quot;
+			fi
+			mbrM=$(dd if=$mbrD bs=1 count=4 \
+				skip=$((0x1b8))|hexdump -n4 -e '&quot;0x%x&quot;')
+			mbrI=$($mbrI | dd  bs=1 count=4 \
+				skip=$((0x1b8))|hexdump -n4 -e '&quot;0x%x&quot;')
+			if [ $mbrM = $mbrI ];then
+				systemException \
+					&quot;Base system already installed&quot; \
+				&quot;reboot&quot;
+			fi
+		fi
+		#======================================
+		# read MD5 information if PXE install
+		#--------------------------------------
+		if [ ! -z &quot;$pxe&quot; ];then
+			multicast=&quot;disable&quot;
+			fetchFile $imageMD5 /image.md5 uncompressed $imageServer
+			if test $loadCode != 0 || ! loadOK &quot;$loadStatus&quot;;then
+				systemException \
+					&quot;Download of $imageMD5 failed: $loadStatus&quot; \
+				&quot;reboot&quot;
+			fi
+			imageMD5=/image.md5
+		fi
+	fi
 	#======================================
-	# Check disk space...
+	# Warn me before performing the install
 	#--------------------------------------
-	haveMByte=`expr $haveKByte / 1024`
-	needMByte=`expr $needKByte / 1024`
-	Echo &quot;Have size: $imageDevice -&gt; $haveMByte MB&quot;
-	Echo &quot;Need size: $imageName -&gt; $needMByte MB&quot;
-	if [ $needMByte -gt $haveMByte ];then
+	for i in ${instItems[*]}; do
+		Target=$(echo $i | cut -f2 -d:)
+		items=&quot;$items,$Target&quot;
+	done
+	items=$(echo $items | sed -e s@^,@@)
+	Echo &quot;Entering installation mode for disk: $items&quot;
+	TEXT_INST=$(
+		getText &quot;Destroying ALL data on %1, continue ?&quot; $items)
+	Dialog --yesno &quot;\&quot;$TEXT_INST\&quot;&quot; 5 70
+	if [ ! $? = 0 ];then
 		systemException \
-			&quot;Not enough space available for this image&quot; \
-		&quot;reboot&quot;
+			&quot;System installation canceled&quot; \
+		&quot;user_reboot&quot;
 	fi
-	#======================================
-	# Dump image on disk
-	#--------------------------------------
-	if [ -z &quot;$pxe&quot; ];then
-		dump=&quot;cat $imageName&quot;
-		if test &quot;$imageZipped&quot; = &quot;compressed&quot;; then
-			dump=&quot;gzip -cd $imageName&quot;
+	clear
+	for i in ${instItems[*]};do
+		#======================================
+		# Setup source and target data
+		#--------------------------------------
+		Source=$(echo $i | cut -f1 -d:)
+		Target=$(echo $i | cut -f2 -d:)
+		if [ -z &quot;$OEM_PARTITION_INSTALL&quot; ];then
+			read sum1 blocks blocksize zblocks zblocksize &lt; $imageMD5
+		else
+			blocksize=4096
+			partKB=$(partitionSize $Source)
+			partBT=$((partKB * 1024))
+			blocks=$((partBT / blocksize))
 		fi
-		if [ -x /usr/bin/dcounter ];then
-			progressBaseName=$(basename $imageName)
-			TEXT_LOAD=$(getText &quot;Loading %1&quot; $progressBaseName)
-			dump=&quot;$dump | dcounter -s $needMByte -l \&quot;$TEXT_LOAD \&quot;&quot;
+		#======================================
+		# Get available disk space
+		#--------------------------------------
+		haveKByte=`partitionSize $Target`
+		#======================================
+		# Get required disk space, setup I/O
+		#--------------------------------------
+		needBytes=$(expr $blocks \* $blocksize)
+		needKByte=`expr $needBytes / 1024`
+		needMByte=`expr $needKByte / 1024`
+		#======================================
+		# Check disk space...
+		#--------------------------------------
+		haveMByte=`expr $haveKByte / 1024`
+		needMByte=`expr $needKByte / 1024`
+		Echo &quot;Have size: $Target -&gt; $haveMByte MB&quot;
+		Echo &quot;Need size: $Source -&gt; $needMByte MB&quot;
+		if [ $needMByte -gt $haveMByte ];then
+			systemException \
+				&quot;Not enough space available for this image&quot; \
+			&quot;reboot&quot;
 		fi
-		Echo &quot;Loading $imageName [$imageDevice] &quot;
-		if [ -x /usr/bin/dcounter ];then
-			mkfifo /progress; errorLogStop
-			(
-				if ! eval $dump 2&gt;/progress|dd bs=32k of=$imageDevice&amp;&gt;/dev/null
-				then
-					errorLogContinue
+		#======================================
+		# Dump image(s) on disk
+		#--------------------------------------
+		if [ -z &quot;$pxe&quot; ];then
+			dump=&quot;cat $Source&quot;
+			if test &quot;$imageZipped&quot; = &quot;compressed&quot;; then
+				dump=&quot;gzip -cd $Source&quot;
+			fi
+			if [ -x /usr/bin/dcounter ];then
+				progressBaseName=$(basename $Source)
+				TEXT_LOAD=$(getText &quot;Loading %1&quot; $progressBaseName)
+				dump=&quot;$dump | dcounter -s $needMByte -l \&quot;$TEXT_LOAD \&quot;&quot;
+			fi
+			Echo &quot;Loading $Source [$Target] &quot;
+			if [ -x /usr/bin/dcounter ];then
+				mkfifo /progress; errorLogStop
+				(
+					if ! eval $dump 2&gt;/progress|dd bs=32k of=$Target &amp;&gt;/dev/null
+					then
+						errorLogContinue
+						systemException \
+							&quot;Failed to install image: $Source -&gt; $Target&quot; \
+						&quot;reboot&quot;
+					fi
+				)&amp;
+				echo &quot;cat /progress | dialog \
+					--backtitle \&quot;$TEXT_INSTALLTITLE\&quot; \
+					--progressbox 3 65
+				&quot; &gt; /tmp/progress.sh
+				if [ -e /dev/fb0 ];then
+					fbiterm -m $UFONT -- bash -e /tmp/progress.sh
+				else
+					bash -e /tmp/progress.sh
+				fi
+				clear
+			else
+				if ! eval $dump | dd bs=32k of=$Target &amp;&gt;/dev/null; then
 					systemException \
-						&quot;Failed to install image: $imageName -&gt; $imageDevice&quot; \
+						&quot;Failed to install image: $Source -&gt; $Target&quot; \
 					&quot;reboot&quot;
 				fi
+			fi
+			if [ -x /usr/bin/dcounter ];then
+				errorLogContinue
+			fi
+		else
+			multicast=&quot;disable&quot;
+			Echo &quot;Loading $Source [$Target BS:$imageBlkSize Byte]...&quot;
+			fetchFile $Source $Target $imageZipped $imageServer
+			if test $loadCode != 0 || ! loadOK &quot;$loadStatus&quot;;then
+				systemException \
+					&quot;Download of $imageName failed: $loadStatus&quot; \
+				&quot;reboot&quot;
+			fi
+		fi
+	done
+	#======================================
+	# Clear loops if required
+	#--------------------------------------
+	if [ ! -z &quot;$OEM_PARTITION_INSTALL&quot; ];then
+		dmsetup remove_all
+		losetup -d /dev/$loop
+	fi
+	#======================================
+	# Check the md5sum of the raw disk
+	#--------------------------------------
+	if [ -z &quot;$OEM_PARTITION_INSTALL&quot; ];then
+		Echo &quot;Install complete, checking data...&quot;
+		verifyBytes=$((blocks * blocksize))
+		verifyMByte=$((verifyBytes / 1048576))
+		if [ -x /usr/bin/dcounter ];then
+			test -e /progress || mkfifo /progress
+			TEXT_VERIFY=$(getText &quot;Verifying %1&quot; $imageDevice)
+			dump=&quot;cat $imageDevice&quot;
+			dump=&quot;$dump | dcounter -s $verifyMByte -l \&quot;$TEXT_VERIFY \&quot;&quot;
+			errorLogStop
+			(
+				eval $dump 2&gt;/progress |\
+					head --bytes=$verifyBytes | md5sum - &gt; /etc/ireal.md5
 			)&amp;
 			echo &quot;cat /progress | dialog \
 				--backtitle \&quot;$TEXT_INSTALLTITLE\&quot; \
@@ -326,86 +619,40 @@ function OEMInstall {
 				bash -e /tmp/progress.sh
 			fi
 			clear
-		else
-			if ! eval $dump | dd bs=32k of=$imageDevice &amp;&gt;/dev/null; then
-				systemException \
-					&quot;Failed to install image: $imageName -&gt; $imageDevice&quot; \
-				&quot;reboot&quot;
-			fi
-		fi
-		if [ -x /usr/bin/dcounter ];then
 			errorLogContinue
+		else
+			dd if=$imageDevice bs=1024 |\
+				head --bytes=$verifyBytes |\
+				md5sum - &gt; /etc/ireal.md5
 		fi
-	else
-		multicast=&quot;disable&quot;
-		Echo &quot;Loading $imageName [$imageDevice BS:$imageBlkSize Byte]...&quot;
-		fetchFile $imageName $imageDevice $imageZipped $imageServer
-		if test $loadCode != 0 || ! loadOK &quot;$loadStatus&quot;;then
+		read sum2 dumy &lt; /etc/ireal.md5
+		if [ $sum1 != $sum2 ];then
 			systemException \
-				&quot;Download of $imageName failed: $loadStatus&quot; \
+				&quot;Image checksum test failed&quot; \
 			&quot;reboot&quot;
 		fi
+		Echo &quot;Image checksum test: fine :-)&quot;
+		Echo &quot;System installation has finished&quot;
 	fi
 	#======================================
-	# Check the md5sum of the raw disk
-	#--------------------------------------
-	Echo &quot;Install complete, checking data...&quot;
-	verifyBytes=$((blocks * blocksize))
-	verifyMByte=$((verifyBytes / 1048576))
-	if [ -x /usr/bin/dcounter ];then
-		test -e /progress || mkfifo /progress
-		TEXT_VERIFY=$(getText &quot;Verifying %1&quot; $imageDevice)
-		dump=&quot;cat $imageDevice&quot;
-		dump=&quot;$dump | dcounter -s $verifyMByte -l \&quot;$TEXT_VERIFY \&quot;&quot;
-		errorLogStop
-		(
-			eval $dump 2&gt;/progress |\
-				head --bytes=$verifyBytes | md5sum - &gt; /etc/ireal.md5
-		)&amp;
-		echo &quot;cat /progress | dialog \
-			--backtitle \&quot;$TEXT_INSTALLTITLE\&quot; \
-			--progressbox 3 65
-		&quot; &gt; /tmp/progress.sh
-		if [ -e /dev/fb0 ];then
-			fbiterm -m $UFONT -- bash -e /tmp/progress.sh
-		else
-			bash -e /tmp/progress.sh
-		fi
-		clear
-		errorLogContinue
-	else
-		dd if=$imageDevice bs=1024 |\
-			head --bytes=$verifyBytes |\
-			md5sum - &gt; /etc/ireal.md5
-	fi
-	read sum2 dumy &lt; /etc/ireal.md5
-	if [ $sum1 != $sum2 ];then
-		systemException \
-			&quot;Image checksum test failed&quot; \
-		&quot;reboot&quot;
-	fi
-	Echo &quot;Image checksum test: fine :-)&quot;
-	Echo &quot;System installation has finished&quot;
-	#======================================
 	# Umount CD/DVD USB
 	#--------------------------------------
 	umount /cdrom
 	#======================================
 	# Reread partition table
 	#--------------------------------------
-	blockdev --rereadpt $imageDevice
-	deviceTest=$(ddn $imageDevice 1)
-	if ! waitForStorageDevice $deviceTest;then
-		systemException \
-			&quot;Partition $deviceTest doesn't appear... fatal !&quot; \
-		&quot;reboot&quot;
+	if [ -z &quot;$OEM_PARTITION_INSTALL&quot; ];then
+		blockdev --rereadpt $imageDevice
+		deviceTest=$(ddn $imageDevice 1)
+		if ! waitForStorageDevice $deviceTest;then
+			systemException \
+				&quot;Partition $deviceTest doesn't appear... fatal !&quot; \
+			&quot;reboot&quot;
+		fi
 	fi
 	#======================================
-	# Setup/Reset values for further boot
+	# Release network on PXE install
 	#--------------------------------------
-	export imageDiskExclude=$instDisk
-	export imageDiskDevice=$imageDevice
-	unset stickSerial
 	if [ ! -z &quot;$pxe&quot; ];then
 		dhcpcd -p -k $PXE_IFACE
 	fi
diff --git a/system/boot/ix86/oemboot/suse-linuxrc b/system/boot/ix86/oemboot/suse-linuxrc
index 883276b..e58f79a 100755
--- a/system/boot/ix86/oemboot/suse-linuxrc
+++ b/system/boot/ix86/oemboot/suse-linuxrc
@@ -249,7 +249,6 @@ setupInitialDeviceNames
 #======================================
 # 12) repartition the disk device
 #--------------------------------------
-Echo &quot;Filesystem of OEM system is: $FSTYPE -&gt; $imageRootDevice&quot;
 if [ &quot;$LOCAL_BOOT&quot; = &quot;no&quot; ];then
 	OEMRepart
 fi
@@ -265,6 +264,7 @@ fi
 #======================================
 # 14) Resize filesystem to full space
 #--------------------------------------
+Echo &quot;Filesystem of OEM system is: $FSTYPE -&gt; $imageRootDevice&quot;
 if [ &quot;$LOCAL_BOOT&quot; = &quot;no&quot; ];then
 	deviceResize=$imageRootDevice
 	fstypeRootFS=$FSTYPE
diff --git a/system/boot/ix86/oemboot/suse-repart b/system/boot/ix86/oemboot/suse-repart
index 6fc4163..51c49c7 100755
--- a/system/boot/ix86/oemboot/suse-repart
+++ b/system/boot/ix86/oemboot/suse-repart
@@ -770,6 +770,55 @@ function OEMRepartLuks {
 }
 
 #======================================
+# OEMPartitionInstall
+#--------------------------------------
+function OEMPartitionInstall {
+	#======================================
+	# no recovery support for part install
+	#--------------------------------------
+	unset OEM_RECOVERY
+	#======================================
+	# no homepart support for part install
+	#--------------------------------------
+	export OEM_WITHOUTHOME=1
+	#======================================
+	# check for LVM, resize to full space
+	#--------------------------------------
+	if searchVolumeGroup;then
+		#======================================
+		# resize PV's
+		#--------------------------------------
+		pvresize $imageRootDevice
+		#======================================
+		# setup LVM device names
+		#--------------------------------------
+		export haveLVM=yes
+		if [ -e /dev/$VGROUP/LVComp ];then
+			export imageRootDevice=/dev/$VGROUP/LVComp
+		else
+			export imageRootDevice=/dev/$VGROUP/LVRoot
+		fi
+		export imageRWDevice=/dev/$VGROUP/LVRoot
+		export imageRODevice=/dev/$VGROUP/LVComp
+		export imageIOWRDevice=$imageRWDevice
+		#======================================
+		# resize LV's
+		#--------------------------------------
+		lvresize -l 100%FREE $imageRootDevice
+	fi
+	#======================================
+	# resize boot filesystem if needed
+	#--------------------------------------
+	if [ ! $imageBootDevice = $imageRootDevice ];then
+		resizeFilesystem $imageBootDevice
+	fi
+	#======================================
+	# cleanup temporary flags
+	#--------------------------------------
+	unset DONT_PARTITION
+}
+
+#======================================
 # OEMRepart
 #--------------------------------------
 function OEMRepart {
@@ -786,7 +835,9 @@ function OEMRepart {
 	#======================================
 	# Do the repartitioning
 	#--------------------------------------
-	if [ ! -z &quot;$haveLVM&quot; ];then
+	if [ ! -z &quot;$OEM_PARTITION_INSTALL&quot; ];then
+		OEMPartitionInstall
+	elif [ ! -z &quot;$haveLVM&quot; ];then
 		OEMRepartLVM
 	elif [ &quot;$haveLuks&quot; = &quot;yes&quot; ];then
 		OEMRepartLuks


hooks/post-receive
-- 
Project kiwi at BerliOS

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002115.html">[Kiwi-devel] [Git]Project kiwi at BerliOS branch, master,	updated. 71ca1cff6ea0f24e08594620bf1637eaf5401eeb
</A></li>
	<LI>Next message: <A HREF="002117.html">[Kiwi-devel] [Git]Project kiwi at BerliOS branch, master,	updated. 3cdb8ca32d426d57c2ac491a3d356449805e22c6
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2116">[ date ]</a>
              <a href="thread.html#2116">[ thread ]</a>
              <a href="subject.html#2116">[ subject ]</a>
              <a href="author.html#2116">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/kiwi-devel">More information about the Kiwi-devel
mailing list</a><br>
</body></html>

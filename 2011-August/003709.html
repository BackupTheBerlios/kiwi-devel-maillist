<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Kiwi-devel] [Git]Project kiwi at BerliOS branch, master,	updated. 8fb9cb6e13f4a6485f4f33dd495c880a54967d90
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/kiwi-devel/2011-August/index.html" >
   <LINK REL="made" HREF="mailto:kiwi-devel%40lists.berlios.de?Subject=Re%3A%20%5BKiwi-devel%5D%20%5BGit%5DProject%20kiwi%20at%20BerliOS%20branch%2C%20master%2C%0A%09updated.%208fb9cb6e13f4a6485f4f33dd495c880a54967d90&In-Reply-To=%3C20110819153405.4A0F44812DE%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="003733.html">
   <LINK REL="Next"  HREF="003710.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Kiwi-devel] [Git]Project kiwi at BerliOS branch, master,	updated. 8fb9cb6e13f4a6485f4f33dd495c880a54967d90</H1>
    <B>marcus_schaefer at BerliOS</B> 
    <A HREF="mailto:kiwi-devel%40lists.berlios.de?Subject=Re%3A%20%5BKiwi-devel%5D%20%5BGit%5DProject%20kiwi%20at%20BerliOS%20branch%2C%20master%2C%0A%09updated.%208fb9cb6e13f4a6485f4f33dd495c880a54967d90&In-Reply-To=%3C20110819153405.4A0F44812DE%40sheep.berlios.de%3E"
       TITLE="[Kiwi-devel] [Git]Project kiwi at BerliOS branch, master,	updated. 8fb9cb6e13f4a6485f4f33dd495c880a54967d90">marcus_schaefer at mail.berlios.de
       </A><BR>
    <I>Fri Aug 19 17:34:04 CEST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="003733.html">[Kiwi-devel] Allow parted versions that don't support machine format
</A></li>
        <LI>Next message: <A HREF="003710.html">[Kiwi-devel] [Git]Project kiwi at BerliOS branch,	KIWI-485-SuSE-11-1-SLE-SP-Devel,	updated. cf02a5b57fc313adf300f3165640b873e0fe835b
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3709">[ date ]</a>
              <a href="thread.html#3709">[ thread ]</a>
              <a href="subject.html#3709">[ subject ]</a>
              <a href="author.html#3709">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>This is an automated email from the git hooks/post-receive script. It was
generated because a ref change was pushed to the repository containing
the project &quot;Project kiwi at BerliOS&quot;.

The branch, master has been updated
       via  8fb9cb6e13f4a6485f4f33dd495c880a54967d90 (commit)
       via  0e71c77f2c620db827f09df3716dbe988b81de83 (commit)
       via  83b5ea4b51857839b29901b1d58e59414ced811f (commit)
       via  bf0362f1f39b78adacdaf7b3c55de15f93822d0f (commit)
       via  e3b48afe383a1ae2a82fba14ad755c954092bcb4 (commit)
      from  894547e1e03870f398cdb48ac634d9f0add13205 (commit)

Those revisions listed above that are new to this repository have
not appeared on any other notification email; so we list those
revisions in full, below.

- Log -----------------------------------------------------------------
commit 8fb9cb6e13f4a6485f4f33dd495c880a54967d90
Author: Marcus Sch&#195;&#164;fer &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/kiwi-devel">ms at novell.com</A>&gt;
Date:   Fri Aug 19 17:33:27 2011 +0200

    - v4.94.3 released

commit 0e71c77f2c620db827f09df3716dbe988b81de83
Author: Marcus Sch&#195;&#164;fer &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/kiwi-devel">ms at novell.com</A>&gt;
Date:   Fri Aug 19 17:30:33 2011 +0200

    - don't remove netcfg from boot images. This would remove the
      etc/hosts file which might be required. Along with this change
      also fixed the cleanupResolvConf() function which has to
      reset the needResolvConf and needHosts flags in order to prevent
      a deletion at a later point in time (bnc #713158)

commit 83b5ea4b51857839b29901b1d58e59414ced811f
Author: Marcus Sch&#195;&#164;fer &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/kiwi-devel">ms at novell.com</A>&gt;
Date:   Fri Aug 19 16:47:26 2011 +0200

    - don't call restoreCDRootData() and restoreSplitExtend()
      inside the global destructor of the KIWIImageCreator.
      If the functions are applied to the creation of a boot
      image it leads to errors because they are designed to
      operate on the system image root tree

commit bf0362f1f39b78adacdaf7b3c55de15f93822d0f
Author: Marcus Sch&#195;&#164;fer &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/kiwi-devel">ms at novell.com</A>&gt;
Date:   Fri Aug 19 15:11:56 2011 +0200

    - removed broken state setup in KIWILog which was used to detect
      whether we need a CR when printing the line or not. All that
      sucked and caused mystery empty lines in the log

commit e3b48afe383a1ae2a82fba14ad755c954092bcb4
Author: Marcus Sch&#195;&#164;fer &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/kiwi-devel">ms at novell.com</A>&gt;
Date:   Fri Aug 19 10:48:03 2011 +0200

    - make sure loop maps are closed before installing grub. Also
      changed the way grub is called. We are creating a file with
      the commands first and then call grub ... --batch &lt; file.
      It makes the code more readable and also allows to include
      the commands as part of the log file

-----------------------------------------------------------------------

Summary of changes:
diff --git a/modules/KIWIBoot.pm b/modules/KIWIBoot.pm
index bec03ee..c07b4fe 100644
--- a/modules/KIWIBoot.pm
+++ b/modules/KIWIBoot.pm
@@ -3615,6 +3615,11 @@ sub installBootLoader {
 	if ($loader eq &quot;grub&quot;) {
 		$kiwi -&gt; info (&quot;Installing grub on device: $diskname&quot;);
 		#==========================================
+		# Clean loop maps
+		#------------------------------------------
+		$this -&gt; cleanLoopMaps();
+		$this -&gt; cleanLoop();
+		#==========================================
 		# Create device map for the disk
 		#------------------------------------------
 		my $dmfile = &quot;$tmpdir/grub-device.map&quot;;
@@ -3628,6 +3633,25 @@ sub installBootLoader {
 		print $dmfd &quot;(hd0) $diskname\n&quot;;
 		$dmfd -&gt; close();
 		#==========================================
+		# Create command list to install grub
+		#------------------------------------------
+		my $cmdfile = &quot;$tmpdir/grub-device.cmds&quot;;
+		if (! $dmfd -&gt; open(&quot;&gt;$cmdfile&quot;)) {
+			$kiwi -&gt; failed ();
+			$kiwi -&gt; error (&quot;Couldn't create grub command list: $!&quot;);
+			$kiwi -&gt; failed ();
+			return undef;
+		}
+		print $dmfd &quot;device (hd0) $diskname\n&quot;;
+		print $dmfd &quot;root (hd0,$bootpart)\n&quot;;
+		if ($chainload) {
+			print $dmfd &quot;setup (hd0,0)\n&quot;;
+		} else {
+			print $dmfd &quot;setup (hd0)\n&quot;;
+		}
+		print $dmfd &quot;quit\n&quot;;
+		$dmfd -&gt; close();
+		#==========================================
 		# Install grub in batch mode
 		#------------------------------------------
 		my $grub = $locator -&gt; getExecPath ('grub');
@@ -3638,32 +3662,22 @@ sub installBootLoader {
 			return undef;
 		}
 		my $grubOptions = &quot;--device-map $dmfile --no-floppy --batch&quot;;
-		$kiwi -&gt; loginfo (&quot;GRUB: $grub $grubOptions\n&quot;);
 		qxx (&quot;mount --bind $tmpdir/boot/grub /boot/grub&quot;);
-		if (! open (FD,&quot;|$grub $grubOptions &amp;&gt; $tmpdir/grub.log&quot;)) {
-			$kiwi -&gt; failed ();
-			$kiwi -&gt; error  (&quot;Couldn't call grub: $!&quot;);
-			$kiwi -&gt; failed ();
-			return undef;
-		}
-		print FD &quot;device (hd0) $diskname\n&quot;;
-		print FD &quot;root (hd0,$bootpart)\n&quot;;
-		if ($chainload) {
-			print FD &quot;setup (hd0,0)\n&quot;;
-		} else {
-			print FD &quot;setup (hd0)\n&quot;;
-		}
-		print FD &quot;quit\n&quot;;
-		close FD;
+		qxx (&quot;$grub $grubOptions &lt; $cmdfile &amp;&gt; $tmpdir/grub.log&quot;);
 		qxx (&quot;umount /boot/grub&quot;);
 		my $glog;
-		if (open (FD,&quot;$tmpdir/grub.log&quot;)) {
-			my @glog = &lt;FD&gt;; close FD;
+		if ($dmfd -&gt; open (&quot;$tmpdir/grub.log&quot;)) {
+			my @glog = &lt;$dmfd&gt;; $dmfd -&gt; close();
+			if ($dmfd -&gt; open (&quot;$cmdfile&quot;)) {
+				my @cmdlog = &lt;$dmfd&gt;; $dmfd -&gt; close();
+				push @glog,&quot;GRUB: commands:&quot;;
+				push @<A HREF="https://lists.berlios.de/mailman/listinfo/kiwi-devel">glog, at cmdlog</A>;
+			}
 			my $stage1 = grep { /^\s*Running.*succeeded$/ } @glog;
 			my $stage1_5 = grep { /^\s*Running.*are embedded\.$/ } @glog;
 			$result = !(($stage1 == 1) &amp;&amp; ($stage1_5 == 1));
 			$glog = join (&quot;\n&quot;<A HREF="https://lists.berlios.de/mailman/listinfo/kiwi-devel">, at glog</A>);
-			$kiwi -&gt; loginfo (&quot;GRUB: $glog&quot;);
+			$kiwi -&gt; loginfo (&quot;GRUB: $glog\n&quot;);
 		}
 		if ($result != 1) {
 			my $boot = &quot;'boot sector'&quot;;
diff --git a/modules/KIWIConfig.sh b/modules/KIWIConfig.sh
index d3da542..780fa01 100644
--- a/modules/KIWIConfig.sh
+++ b/modules/KIWIConfig.sh
@@ -1013,7 +1013,7 @@ function suseStripInitrd {
 		/etc/protocols /etc/services /etc/termcap /etc/aliases
 		/etc/bash.bashrc /etc/filesystems /etc/ld.so.conf /etc/magic
 		/etc/group /etc/passwd /etc/nsswitch.conf /etc/scsi_id.config
-		/etc/netconfig
+		/etc/netconfig /etc/hosts /etc/resolv.conf
 	&quot;
 	for i in $files;do
 		if [ -e $i ];then
diff --git a/modules/KIWIGlobals.pm b/modules/KIWIGlobals.pm
index 0809fc2..da441a9 100644
--- a/modules/KIWIGlobals.pm
+++ b/modules/KIWIGlobals.pm
@@ -40,7 +40,7 @@ sub new {
 	# Globals (generic)
 	#------------------------------------------
 	my %data;
-	$data{Version}         = &quot;4.94.2&quot;;
+	$data{Version}         = &quot;4.94.3&quot;;
 	$data{Publisher}       = &quot;SUSE LINUX Products GmbH&quot;;
 	$data{Preparer}        = &quot;KIWI - <A HREF="http://kiwi.berlios.de">http://kiwi.berlios.de</A>&quot;;
 	$data{ConfigName}      = &quot;config.xml&quot;;
diff --git a/modules/KIWIImageCreator.pm b/modules/KIWIImageCreator.pm
index 7dedb20..bf6a76d 100644
--- a/modules/KIWIImageCreator.pm
+++ b/modules/KIWIImageCreator.pm
@@ -1357,8 +1357,6 @@ sub DESTROY {
 	}
 	if ($image) {
 		$image -&gt; cleanMount ();
-		$image -&gt; restoreCDRootData ();
-		$image -&gt; restoreSplitExtend ();
 	}
 }
 
diff --git a/modules/KIWILog.pm b/modules/KIWILog.pm
index 868c70e..2345454 100644
--- a/modules/KIWILog.pm
+++ b/modules/KIWILog.pm
@@ -56,7 +56,6 @@ sub new {
 	$this-&gt;{showLevel} = [0,1,2,3,4,5];
 	$this-&gt;{channel}   = *STDOUT;
 	$this-&gt;{errorOk}   = 0;
-	$this-&gt;{state}     = &quot;O&quot;;
 	$this-&gt;{message}   = &quot;initialize&quot;;
 	$this-&gt;{used}      = 1;
 	$this -&gt; getPrefix (1);
@@ -224,7 +223,6 @@ sub done {
 		print $FD &quot;   done\n&quot;;
 	}
 	$this -&gt; saveInCache (&quot;   done\n&quot;);
-	$this-&gt;{state} = &quot;O&quot;;
 }
 
 #==========================================
@@ -248,7 +246,6 @@ sub failed {
 		print $FD &quot;   failed\n&quot;;
 	}
 	$this -&gt; saveInCache (&quot;   failed\n&quot;);
-	$this-&gt;{state} = &quot;O&quot;;
 }
 
 #==========================================
@@ -272,7 +269,6 @@ sub skipped {
 		print $FD &quot;   skipped\n&quot;;
 	}
 	$this -&gt; saveInCache (&quot;   skipped\n&quot;);
-	$this-&gt;{state} = &quot;O&quot;;
 }
 
 #==========================================
@@ -296,7 +292,6 @@ sub notset {
 		print $FD &quot;   notset\n&quot;;
 	}
 	$this -&gt; saveInCache (&quot;   notset\n&quot;);
-	$this-&gt;{state} = &quot;O&quot;;
 }
 
 #==========================================
@@ -420,7 +415,6 @@ sub printLog {
 	my $logdata = $_[1];
 	my $flag    = $_[2];
 	my @mcache  = ();
-	my $needcr  = &quot;&quot;;
 	my $date    = $this -&gt; getPrefix ( $lglevel );
 	#==========================================
 	# check log status 
@@ -429,21 +423,10 @@ sub printLog {
 		$logdata = $lglevel;
 		$lglevel = 1;
 	}
-	if (($this-&gt;{state} eq &quot;I&quot;) &amp;&amp; ($lglevel != 5)) {
-		$needcr = &quot;\n&quot;;
-	}
 	if (defined $this-&gt;{mcache}) {
 		@mcache = @{$this-&gt;{mcache}};
 	}
 	#==========================================
-	# save log status 
-	#------------------------------------------
-	if ($logdata !~ /\n$/) {
-		$this-&gt;{state} = &quot;I&quot;;
-	} else {
-		$this-&gt;{state} = &quot;O&quot;;
-	}
-	#==========================================
 	# set log status 
 	#------------------------------------------
 	my @showLevel = @{$this-&gt;{showLevel}};
@@ -460,16 +443,16 @@ sub printLog {
 			next;
 		}
 		if (($lglevel == 1) || ($lglevel == 2)) {
-			$result = $needcr.$date.$logdata;
+			$result = $date.$logdata;
 		} elsif ($lglevel == 5) {
-			$result = $needcr.$logdata;
+			$result = $logdata;
 		} elsif ($lglevel == 3) {
-			$result = $needcr.$date.$logdata;
+			$result = $date.$logdata;
 			if ($this-&gt;trace()) {
 				$main::BT[$main::TL] = eval { Carp::longmess ($main::TT.$main::TL++) };
 			}
 		} else {
-			$result = Carp::longmess($needcr.$logdata);
+			$result = Carp::longmess($logdata);
 		}
 	}
 	#==========================================
@@ -646,17 +629,6 @@ sub note {
 }
 
 #==========================================
-# state
-#------------------------------------------
-sub state {
-	# ...
-	# get current cursor log state
-	# ---
-	my $this = shift;
-	return $this-&gt;{state};
-}
-
-#==========================================
 # terminalLogging
 #------------------------------------------
 sub terminalLogging {
diff --git a/modules/KIWIRoot.pm b/modules/KIWIRoot.pm
index 9c96906..efbdf01 100644
--- a/modules/KIWIRoot.pm
+++ b/modules/KIWIRoot.pm
@@ -673,9 +673,11 @@ sub cleanupResolvConf {
 	my $needHosts = $this-&gt;{needHosts};
 	if ($needResolvConf) {
 		qxx (&quot;rm -f $root/etc/resolv.conf&quot;);
+		undef $this-&gt;{needResolvConf};
 	}
 	if ($needHosts) {
 		qxx (&quot;rm -f $root/etc/hosts&quot;);
+		undef $this-&gt;{needHosts};
 	}
 }
 
diff --git a/rpm/kiwi.spec b/rpm/kiwi.spec
index ff96cdb..f33844f 100644
--- a/rpm/kiwi.spec
+++ b/rpm/kiwi.spec
@@ -1,5 +1,5 @@
 #
-# spec file for package kiwi (Version 4.94.2)
+# spec file for package kiwi (Version 4.94.3)
 #
 # Copyright (c) 2010 SUSE LINUX Products GmbH, Nuernberg, Germany.
 #
@@ -68,7 +68,7 @@ Requires:       clicfs &gt;= 1.3.9
 %endif
 %endif
 Summary:        OpenSuSE - KIWI Image System
-Version:        4.94.2
+Version:        4.94.3
 Release:        1
 Group:          System/Management
 License:        GPLv2
diff --git a/system/boot/ix86/isoboot/suse-11.3/config.xml b/system/boot/ix86/isoboot/suse-11.3/config.xml
index 82ffece..936c65f 100644
--- a/system/boot/ix86/isoboot/suse-11.3/config.xml
+++ b/system/boot/ix86/isoboot/suse-11.3/config.xml
@@ -171,7 +171,6 @@
 		&lt;package name=&quot;mktemp&quot;/&gt;
 		&lt;package name=&quot;mtools&quot;/&gt;
 		&lt;package name=&quot;net-tools&quot;/&gt;
-		&lt;package name=&quot;netcfg&quot;/&gt;
 		&lt;package name=&quot;openSUSE-release&quot;/&gt;
 		&lt;package name=&quot;openldap2-client&quot;/&gt;
 		&lt;package name=&quot;openslp&quot;/&gt;
diff --git a/system/boot/ix86/isoboot/suse-11.4/config.xml b/system/boot/ix86/isoboot/suse-11.4/config.xml
index 32d7e23..2af64c9 100644
--- a/system/boot/ix86/isoboot/suse-11.4/config.xml
+++ b/system/boot/ix86/isoboot/suse-11.4/config.xml
@@ -175,7 +175,6 @@
 		&lt;package name=&quot;mktemp&quot;/&gt;
 		&lt;package name=&quot;mtools&quot;/&gt;
 		&lt;package name=&quot;net-tools&quot;/&gt;
-		&lt;package name=&quot;netcfg&quot;/&gt;
 		&lt;package name=&quot;openSUSE-release&quot;/&gt;
 		&lt;package name=&quot;openldap2-client&quot;/&gt;
 		&lt;package name=&quot;openslp&quot;/&gt;
diff --git a/system/boot/ix86/isoboot/suse-12.1/config.xml b/system/boot/ix86/isoboot/suse-12.1/config.xml
index 1642abc..5e866c5 100644
--- a/system/boot/ix86/isoboot/suse-12.1/config.xml
+++ b/system/boot/ix86/isoboot/suse-12.1/config.xml
@@ -175,7 +175,6 @@
 		&lt;package name=&quot;mktemp&quot;/&gt;
 		&lt;package name=&quot;mtools&quot;/&gt;
 		&lt;package name=&quot;net-tools&quot;/&gt;
-		&lt;package name=&quot;netcfg&quot;/&gt;
 		&lt;package name=&quot;openSUSE-release&quot;/&gt;
 		&lt;package name=&quot;openldap2-client&quot;/&gt;
 		&lt;package name=&quot;openslp&quot;/&gt;
diff --git a/system/boot/ix86/isoboot/suse-SLED11/config.xml b/system/boot/ix86/isoboot/suse-SLED11/config.xml
index d0e8865..90b473f 100644
--- a/system/boot/ix86/isoboot/suse-SLED11/config.xml
+++ b/system/boot/ix86/isoboot/suse-SLED11/config.xml
@@ -183,7 +183,6 @@
 		&lt;package name=&quot;mktemp&quot;/&gt;
 		&lt;package name=&quot;mtools&quot;/&gt;
 		&lt;package name=&quot;net-tools&quot;/&gt;
-		&lt;package name=&quot;netcfg&quot;/&gt;
 		&lt;package name=&quot;openldap2-client&quot;/&gt;
 		&lt;package name=&quot;openslp&quot;/&gt;
 		&lt;package name=&quot;openssl-certs&quot;/&gt;
diff --git a/system/boot/ix86/isoboot/suse-SLES11/config.xml b/system/boot/ix86/isoboot/suse-SLES11/config.xml
index ea0dc7e..9517e61 100644
--- a/system/boot/ix86/isoboot/suse-SLES11/config.xml
+++ b/system/boot/ix86/isoboot/suse-SLES11/config.xml
@@ -184,7 +184,6 @@
 		&lt;package name=&quot;mktemp&quot;/&gt;
 		&lt;package name=&quot;mtools&quot;/&gt;
 		&lt;package name=&quot;net-tools&quot;/&gt;
-		&lt;package name=&quot;netcfg&quot;/&gt;
 		&lt;package name=&quot;openldap2-client&quot;/&gt;
 		&lt;package name=&quot;openslp&quot;/&gt;
 		&lt;package name=&quot;openssl-certs&quot;/&gt;


hooks/post-receive
-- 
Project kiwi at BerliOS

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="003733.html">[Kiwi-devel] Allow parted versions that don't support machine format
</A></li>
	<LI>Next message: <A HREF="003710.html">[Kiwi-devel] [Git]Project kiwi at BerliOS branch,	KIWI-485-SuSE-11-1-SLE-SP-Devel,	updated. cf02a5b57fc313adf300f3165640b873e0fe835b
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3709">[ date ]</a>
              <a href="thread.html#3709">[ thread ]</a>
              <a href="subject.html#3709">[ subject ]</a>
              <a href="author.html#3709">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/kiwi-devel">More information about the Kiwi-devel
mailing list</a><br>
</body></html>

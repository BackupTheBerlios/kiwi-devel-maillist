<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Kiwi-devel] [Git]Project kiwi at BerliOS branch,	KIWI-374-SuSE-11-1-SLE-SP-Devel,	updated. f8aa04c377b791493625377b837d18cd6d08ccd3
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/kiwi-devel/2010-March/index.html" >
   <LINK REL="made" HREF="mailto:kiwi-devel%40lists.berlios.de?Subject=Re%3A%20%5BKiwi-devel%5D%20%5BGit%5DProject%20kiwi%20at%20BerliOS%20branch%2C%0A%09KIWI-374-SuSE-11-1-SLE-SP-Devel%2C%0A%09updated.%20f8aa04c377b791493625377b837d18cd6d08ccd3&In-Reply-To=%3C201003041237.o24CbAun005347%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001972.html">
   <LINK REL="Next"  HREF="001978.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Kiwi-devel] [Git]Project kiwi at BerliOS branch,	KIWI-374-SuSE-11-1-SLE-SP-Devel,	updated. f8aa04c377b791493625377b837d18cd6d08ccd3</H1>
    <B>adrians at BerliOS</B> 
    <A HREF="mailto:kiwi-devel%40lists.berlios.de?Subject=Re%3A%20%5BKiwi-devel%5D%20%5BGit%5DProject%20kiwi%20at%20BerliOS%20branch%2C%0A%09KIWI-374-SuSE-11-1-SLE-SP-Devel%2C%0A%09updated.%20f8aa04c377b791493625377b837d18cd6d08ccd3&In-Reply-To=%3C201003041237.o24CbAun005347%40sheep.berlios.de%3E"
       TITLE="[Kiwi-devel] [Git]Project kiwi at BerliOS branch,	KIWI-374-SuSE-11-1-SLE-SP-Devel,	updated. f8aa04c377b791493625377b837d18cd6d08ccd3">adrians at mail.berlios.de
       </A><BR>
    <I>Thu Mar  4 13:37:10 CET 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="001972.html">[Kiwi-devel] [Git]Project kiwi at BerliOS branch, master,	updated. e09aaa10abb4d229c3b259dd50a2777c6527341f
</A></li>
        <LI>Next message: <A HREF="001978.html">[Kiwi-devel] [Git]Project kiwi at BerliOS branch, master,	updated. 1ad66b248518947bea10402ae67b0596548411f8
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1973">[ date ]</a>
              <a href="thread.html#1973">[ thread ]</a>
              <a href="subject.html#1973">[ subject ]</a>
              <a href="author.html#1973">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>This is an automated email from the git hooks/post-receive script. It was
generated because a ref change was pushed to the repository containing
the project &quot;Project kiwi at BerliOS&quot;.

The branch, KIWI-374-SuSE-11-1-SLE-SP-Devel has been updated
       via  f8aa04c377b791493625377b837d18cd6d08ccd3 (commit)
       via  de2dbf9bf966c8a3ad71bc36c64b1e5151c6d28e (commit)
      from  45548cf773c09b819f16c3ffa9756b8b1f543d75 (commit)

Those revisions listed above that are new to this repository have
not appeared on any other notification email; so we list those
revisions in full, below.

- Log -----------------------------------------------------------------
commit f8aa04c377b791493625377b837d18cd6d08ccd3
Author: Adrian Schr&#195;&#182;ter &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/kiwi-devel">adrian at suse.de</A>&gt;
Date:   Thu Mar 4 13:35:35 2010 +0100

    change string in README.BETA to &quot;SUMMARY + BETA_VERSION&quot;

commit de2dbf9bf966c8a3ad71bc36c64b1e5151c6d28e
Author: Adrian Schr&#195;&#182;ter &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/kiwi-devel">adrian at suse.de</A>&gt;
Date:   Thu Mar 4 13:34:35 2010 +0100

    * fix multiarch medias, when using metapackages with onlyarch
    * sync arch fallback handling between repo and meta packages

-----------------------------------------------------------------------

Summary of changes:
diff --git a/modules/KIWICollect.pm b/modules/KIWICollect.pm
index 7736179..b8eeddb 100644
--- a/modules/KIWICollect.pm
+++ b/modules/KIWICollect.pm
@@ -783,16 +783,12 @@ sub setupPackageFiles
     ARCH:foreach my $requestedArch(@archs) {
       $this-&gt;logMsg(&quot;I&quot;, &quot;  Evaluate package $packName for requested arch $requestedArch&quot;) if $this-&gt;{m_debug} &gt;= 5;
 
-      my @fallbacklist;
+      my @fallbacklist = ($requestedArch);
       if($nofallback==0 &amp;&amp; $mode != 2) {
 	@fallbacklist = $this-&gt;{m_archlist}-&gt;fallbacks($requestedArch);
         $this-&gt;logMsg(&quot;I&quot;, &quot; Look for fallbacks fallbacks&quot;) if $this-&gt;{m_debug} &gt;= 6;
       }
-      if ( ! @fallbacklist ) {
-        $nofallback = 1;
-	@fallbacklist = ($requestedArch);
-        $this-&gt;logMsg(&quot;I&quot;, &quot;    Run without fallbacks&quot;) if $this-&gt;{m_debug} &gt;= 6;
-      }
+
       $this-&gt;logMsg(&quot;I&quot;, &quot;    Use as expanded architectures &gt;&quot;.join(&quot; &quot;, @fallbacklist).&quot;&lt;&quot;) if $this-&gt;{m_debug} &gt;= 5;
       my $fb_available = 0;
       FA:foreach my $arch(@fallbacklist) {
@@ -1057,11 +1053,15 @@ sub unpackMetapackages
     ARCH:foreach my $reqArch($this-&gt;getArchList($this-&gt;{m_metaPacks}-&gt;{$metapack}, $metapack, \$nofallback)) {
       next if($reqArch =~ m{(src|nosrc)});
       next if defined($packOptions{'arch'}) and $packOptions{'arch'} ne $reqArch;
-      my @archs;
-      push @archs, $reqArch;
-      push @archs, $this-&gt;{m_archlist}-&gt;fallbacks($reqArch) if ($nofallback==0);
+      my @fallbacklist;
+      @fallbacklist = ($reqArch);
+      if($nofallback==0 ) {
+        @fallbacklist = $this-&gt;{m_archlist}-&gt;fallbacks($reqArch);
+        $this-&gt;logMsg(&quot;I&quot;, &quot; Look for fallbacks fallbacks&quot;) if $this-&gt;{m_debug} &gt;= 6;
+      }
+      $this-&gt;logMsg(&quot;I&quot;, &quot;    Use as expanded architectures &gt;&quot;.join(&quot; &quot;, @fallbacklist).&quot;&lt;&quot;) if $this-&gt;{m_debug} &gt;= 5;
 
-      FARCH:foreach my $arch(@archs) {
+      FARCH:foreach my $arch(@fallbacklist) {
         PACKKEY:foreach my $packKey( sort{$poolPackages-&gt;{$a}-&gt;{priority} &lt;=&gt; $poolPackages-&gt;{$b}-&gt;{priority}} keys(%{$poolPackages})) {
           my $packPointer = $poolPackages-&gt;{$packKey};
           next PACKKEY if(!$packPointer-&gt;{'localfile'}); # should not be needed
@@ -1174,8 +1174,8 @@ sub unpackMetapackages
             $this-&gt;logMsg(&quot;W&quot;, &quot;No script defined for metapackage $metapack&quot;);
           }
 
-          # found a package, we do not support multiarch here, but jump to the next package.
-          next METAPACKAGE;
+          # found a package, jump to next required arch.
+          next ARCH;
         }
       }
       # Package was not found
@@ -1703,7 +1703,7 @@ sub createMetadata
   $this-&gt;logMsg(&quot;I&quot;, &quot;Handling Beta information on media:&quot;);
   my $beta_version = $this-&gt;{m_proddata}-&gt;getOpt(&quot;BETA_VERSION&quot;);
   if (defined($beta_version)) {
-    my $dist_string = $this-&gt;{m_proddata}-&gt;getVar(&quot;DISTNAME&quot;).&quot; &quot;.$this-&gt;{m_proddata}-&gt;getVar(&quot;PRODUCT_VERSION&quot;).&quot; &quot;.${beta_version};
+    my $dist_string = $this-&gt;{m_proddata}-&gt;getVar(&quot;SUMMARY&quot;).&quot; &quot;.${beta_version};
     if ( -e &quot;$this-&gt;{m_basesubdir}-&gt;{'1'}/README.BETA&quot; ) {
       if (system(&quot;sed&quot;,&quot;-i&quot;,&quot;s/BETA_DIST_VERSION/$dist_string/&quot;,&quot;$this-&gt;{m_basesubdir}-&gt;{'1'}/README.BETA&quot;) == 0 ) {
         if (system(&quot;ln&quot;, &quot;-sf&quot;, &quot;../README.BETA&quot;, &quot;$this-&gt;{m_basesubdir}-&gt;{'1'}/media.1/info.txt&quot;) != 0 ) {
diff --git a/rpm/kiwi.changes b/rpm/kiwi.changes
index 6a51b15..f5c1747 100644
--- a/rpm/kiwi.changes
+++ b/rpm/kiwi.changes
@@ -1,10 +1,16 @@
 -------------------------------------------------------------------
+Wed Mar  3 12:43:53 UTC 2010 - <A HREF="https://lists.berlios.de/mailman/listinfo/kiwi-devel">adrian at suse.de</A>
+
+- fix multiarch medias, when using metapackages with onlyarch
+- change string in README.BETA to &quot;SUMMARY + BETA_VERSION&quot;
+
+-------------------------------------------------------------------
 Thu Mar  4 12:35:30 CET 2010 - <A HREF="https://lists.berlios.de/mailman/listinfo/kiwi-devel">ms at suse.de</A>
 
 - added better log information about size calculation
 
 -------------------------------------------------------------------
-Wed Mar  3 12:47:28 CET 2010 - <A HREF="https://lists.berlios.de/mailman/listinfo/kiwi-devel">ms at suse.de</A>
+Wed Mar  3 11:42:47 CET 2010 - <A HREF="https://lists.berlios.de/mailman/listinfo/kiwi-devel">ms at suse.de</A>
 
 - added 'boot from harddrive' as default menu selection for
   the installation images (CD+USB). Thus remove the request to


hooks/post-receive
-- 
Project kiwi at BerliOS

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001972.html">[Kiwi-devel] [Git]Project kiwi at BerliOS branch, master,	updated. e09aaa10abb4d229c3b259dd50a2777c6527341f
</A></li>
	<LI>Next message: <A HREF="001978.html">[Kiwi-devel] [Git]Project kiwi at BerliOS branch, master,	updated. 1ad66b248518947bea10402ae67b0596548411f8
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1973">[ date ]</a>
              <a href="thread.html#1973">[ thread ]</a>
              <a href="subject.html#1973">[ subject ]</a>
              <a href="author.html#1973">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/kiwi-devel">More information about the Kiwi-devel
mailing list</a><br>
</body></html>

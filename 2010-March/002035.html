<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Kiwi-devel] [Git]Project kiwi at BerliOS branch, master,	updated. 68e199882ee03dfa7ef68b6bba076e818a671db6
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/kiwi-devel/2010-March/index.html" >
   <LINK REL="made" HREF="mailto:kiwi-devel%40lists.berlios.de?Subject=Re%3A%20%5BKiwi-devel%5D%20%5BGit%5DProject%20kiwi%20at%20BerliOS%20branch%2C%20master%2C%0A%09updated.%2068e199882ee03dfa7ef68b6bba076e818a671db6&In-Reply-To=%3C201003181033.o2IAX3KN019980%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002033.html">
   <LINK REL="Next"  HREF="002034.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Kiwi-devel] [Git]Project kiwi at BerliOS branch, master,	updated. 68e199882ee03dfa7ef68b6bba076e818a671db6</H1>
    <B>marcus_schaefer at BerliOS</B> 
    <A HREF="mailto:kiwi-devel%40lists.berlios.de?Subject=Re%3A%20%5BKiwi-devel%5D%20%5BGit%5DProject%20kiwi%20at%20BerliOS%20branch%2C%20master%2C%0A%09updated.%2068e199882ee03dfa7ef68b6bba076e818a671db6&In-Reply-To=%3C201003181033.o2IAX3KN019980%40sheep.berlios.de%3E"
       TITLE="[Kiwi-devel] [Git]Project kiwi at BerliOS branch, master,	updated. 68e199882ee03dfa7ef68b6bba076e818a671db6">marcus_schaefer at mail.berlios.de
       </A><BR>
    <I>Thu Mar 18 11:33:03 CET 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="002033.html">[Kiwi-devel] [Git]Project kiwi at BerliOS branch, RHEL,	updated. 9392434acac8c77031fc3cda73d452734bfdfbd5
</A></li>
        <LI>Next message: <A HREF="002034.html">[Kiwi-devel] [Git]Project kiwi at BerliOS branch, RHEL,	deleted. 9392434acac8c77031fc3cda73d452734bfdfbd5
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2035">[ date ]</a>
              <a href="thread.html#2035">[ thread ]</a>
              <a href="subject.html#2035">[ subject ]</a>
              <a href="author.html#2035">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>This is an automated email from the git hooks/post-receive script. It was
generated because a ref change was pushed to the repository containing
the project &quot;Project kiwi at BerliOS&quot;.

The branch, master has been updated
       via  68e199882ee03dfa7ef68b6bba076e818a671db6 (commit)
       via  ec680ab37d74084a2f9a6bb013462ce80e6ab7d4 (commit)
      from  c817e040e632086fb9060a8fadc52fa1e79c1848 (commit)

Those revisions listed above that are new to this repository have
not appeared on any other notification email; so we list those
revisions in full, below.

- Log -----------------------------------------------------------------
commit 68e199882ee03dfa7ef68b6bba076e818a671db6
Author: Marcus Sch&#195;&#164;fer &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/kiwi-devel">ms at novell.com</A>&gt;
Date:   Thu Mar 18 11:11:36 2010 +0100

    - fixed build

commit ec680ab37d74084a2f9a6bb013462ce80e6ab7d4
Author: Marcus Sch&#195;&#164;fer &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/kiwi-devel">ms at novell.com</A>&gt;
Date:   Thu Mar 18 11:06:09 2010 +0100

    - added support for RHEL 5.4 in kiwi. This includes:
      * custom rhel-repo with hwinfo, gfxboot and friends
      * support for yum package manager backend
      * JeOS template for RHEL 5.4
      * isoboot boot image description for RHEL 5.4
      * NOTE: only the iso type has been implemented so far

-----------------------------------------------------------------------

Summary of changes:
diff --git a/modules/KIWIConfig.sh b/modules/KIWIConfig.sh
index 1ee029a..755ce69 100644
--- a/modules/KIWIConfig.sh
+++ b/modules/KIWIConfig.sh
@@ -20,6 +20,19 @@
 export LANG=C
 export LC_ALL=C
 #======================================
+# check base tools
+#--------------------------------------
+for tool in basename dirname;do
+	if [ -x /bin/$tool ] &amp;&amp; [ ! -e /usr/bin/$tool ];then
+		ln -s /bin/$tool /usr/bin/$tool
+	fi
+done
+for tool in setctsid klogconsole;do
+	if [ -x /usr/bin/$tool ] &amp;&amp; [ ! -e /usr/sbin/$tool ];then
+		ln -s /usr/bin/$tool /usr/sbin/$tool
+	fi
+done
+#======================================
 # suseInsertService
 #--------------------------------------
 function suseInsertService {
@@ -856,10 +869,13 @@ function suseStripInitrd {
 	#------------------------------------------
 	rm -rf `find -type d | grep .svn`
 	local files=&quot;
+		/usr/share/backgrounds/images /usr/share/zoneinfo
+		/var/lib/yum /var/lib/dpkg /usr/kerberos /usr/lib*/gconv
+		/usr/share/apps/ksplash /usr/share/apps/firstboot
 		/usr/share/info /usr/share/man /usr/share/cracklib /usr/lib*/python*
 		/usr/lib*/perl* /usr/share/doc/packages /var/lib/rpm
 		/usr/lib*/rpm /var/lib/smart /opt/* /usr/include /root/.gnupg
-		/etc/PolicyKit /etc/sysconfig /etc/init.d /etc/profile.d /etc/skel
+		/etc/PolicyKit /etc/init.d /etc/profile.d /etc/skel
 		/etc/ssl /etc/java /etc/default /etc/cron* /etc/dbus*
 		/etc/pam.d* /etc/DIR_COLORS /etc/rc* /usr/share/hal /usr/share/ssl
 		/usr/lib*/hal /usr/lib*/*.a /usr/lib*/*.la /usr/lib*/librpm*
@@ -941,7 +957,7 @@ function suseStripInitrd {
 		pvchange pvresize pvscan vgscan vgchange vgextend vgdisplay
 		lvchange lvresize lvextend lvcreate grub dcounter tty
 		dmsetup dialog awk gawk clicfs cryptsetup clear blkid fbiterm
-		gettext diff bc utimer cmp busybox kexec
+		gettext diff bc utimer cmp busybox kexec pam_console_apply
 	&quot;
 	tools=&quot;$tools $@&quot;
 	for path in /sbin /usr/sbin /usr/bin /bin;do
@@ -979,6 +995,20 @@ function suseStripInitrd {
 }
 
 #======================================
+# rhelStripInitrd
+#--------------------------------------
+function rhelStripInitrd {
+	suseStripInitrd
+}
+
+#======================================
+# rhelGFXBoot
+#--------------------------------------
+function rhelGFXBoot {
+	suseGFXBoot $@
+}
+
+#======================================
 # suseGFXBoot
 #--------------------------------------
 function suseGFXBoot {
@@ -1144,17 +1174,17 @@ function suseGFXBoot {
 	#======================================
 	# copy bootloader binaries of required
 	#--------------------------------------
-	if [ $loader = &quot;isolinux&quot; ];then
+	if [ &quot;$loader&quot; = &quot;isolinux&quot; ];then
 		# isolinux boot code...
 		mv /usr/share/syslinux/isolinux.bin /image/loader
-		if [ -f &quot;/usr/share/syslinux/gfxboot.com&quot; ];then
+		if [ -f /usr/share/syslinux/gfxboot.com ];then
 			mv /usr/share/syslinux/gfxboot.com /image/loader
 		fi
-		if [ -f &quot;/usr/share/syslinux/mboot.c32&quot; ];then
+		if [ -f /usr/share/syslinux/mboot.c32 ];then
 			mv /usr/share/syslinux/mboot.c32 /image/loader
 		fi
-		if [ -f &quot;/boot/memtest.bin&quot; ];then 
-			mv /boot/memtest.bin /image/loader/memtest
+		if [ -f /boot/memtest* ];then 
+			mv /boot/memtest* /image/loader/memtest
 		fi
 	else
 		# boot loader binary part of MBR
@@ -1375,6 +1405,8 @@ function suseStripKernel {
 			if [ -f vmlinux-$VERSION.gz ];then
 				mv vmlinux-$VERSION.gz vmlinux.gz
 				mv vmlinuz-$VERSION vmlinuz
+			elif [ -f vmlinuz-$VERSION.el5 ];then
+				mv vmlinux-$VERSION.el5 vmlinuz
 			elif [ -f vmlinuz-$VERSION ];then
 				mv vmlinuz-$VERSION vmlinuz
 			else
@@ -1388,6 +1420,13 @@ function suseStripKernel {
 }
 
 #======================================
+# rhelStripKernel
+#--------------------------------------
+function rhelStripKernel {
+	suseStripKernel
+}
+
+#======================================
 # suseSetupProduct
 #--------------------------------------
 function suseSetupProduct {
diff --git a/modules/KIWIConfigure.pm b/modules/KIWIConfigure.pm
index 0582ab8..8e65971 100644
--- a/modules/KIWIConfigure.pm
+++ b/modules/KIWIConfigure.pm
@@ -409,6 +409,45 @@ sub setupFirstBootYaST {
 }
 
 #==========================================
+# setupFirstBootAnaconda
+#------------------------------------------
+sub setupFirstBootAnaconda {
+	# ...
+	# This function activates the RHEL firstboot mechanism.
+	# So far I did not find a way to tell firstboot what
+	# modules it should call. firstboot is activated if the
+	# file config-anaconda-firstboot exists as part of your
+	# image description
+	# ---
+	my $this = shift;
+	my $kiwi = $this-&gt;{kiwi};
+	my $root = $this-&gt;{root};
+	my $imageDesc = $this-&gt;{imageDesc};
+	if (! -f &quot;$imageDesc/config-anaconda-firstboot&quot;) {
+		return &quot;skipped&quot;;
+	}
+	$kiwi -&gt; info (&quot;Setting up Anaconda firstboot service...&quot;);
+	#==========================================
+	# touch/remove some files
+	#------------------------------------------
+	qxx (&quot;touch $root/etc/reconfigSys 2&gt;&amp;1&quot;);
+	qxx (&quot;rm -f /etc/sysconfig/firstboot 2&gt;&amp;1&quot;);
+	#==========================================
+	# activate service
+	#------------------------------------------
+	my $data = qxx (&quot;chroot $root chkconfig --level 35 firstboot on 2&gt;&amp;1&quot;);
+	my $code = $? &gt;&gt; 8;
+	if ($code != 0) {
+		$kiwi -&gt; failed ();
+		$kiwi -&gt; error (&quot;Failed to activate firstboot: $data&quot;);
+		$kiwi -&gt; failed ();
+		return &quot;failed&quot;;
+	}
+	$kiwi -&gt; done();
+	return &quot;success&quot;;
+}
+
+#==========================================
 # quoteshell
 #------------------------------------------
 sub quoteshell {
diff --git a/modules/KIWIImage.pm b/modules/KIWIImage.pm
index 2fd4aa1..f9b8913 100644
--- a/modules/KIWIImage.pm
+++ b/modules/KIWIImage.pm
@@ -3745,6 +3745,7 @@ sub extractLinux {
 	my $xml       = $this-&gt;{xml};
 	my %xenc      = $xml-&gt;getXenConfig();
 	if ((-f &quot;$imageTree/boot/vmlinux.gz&quot;)  ||
+		(-f &quot;$imageTree/boot/vmlinuz.el5&quot;) ||
 		(-f &quot;$imageTree/boot/vmlinux&quot;)     ||
 		(-f &quot;$imageTree/boot/vmlinuz&quot;)
 	) {
diff --git a/modules/KIWIIsoLinux.pm b/modules/KIWIIsoLinux.pm
index beb61a7..2593750 100644
--- a/modules/KIWIIsoLinux.pm
+++ b/modules/KIWIIsoLinux.pm
@@ -652,10 +652,16 @@ sub createISOLinuxConfig {
 	);
 	my $code = $? &gt;&gt; 8;
 	if ($code != 0) {
-		$kiwi -&gt; error  (&quot;Failed to call isolinux-config binary: $data&quot;);
-		$kiwi -&gt; failed ();
-		$this -&gt; cleanISO();
-		return undef;
+		# /.../
+		# Could not set base directory to isolinux, therefore we
+		# create a compat directory /isolinux and hardlink all files
+		# ----
+		my $data = qxx (&quot;mkdir -p $src/isolinux 2&gt;&amp;1&quot;);
+		my $code = $? &gt;&gt; 8;
+		if ($code == 0) {
+			$data = qxx (&quot;ln $src/$boot/loader/* $src/isolinux/ 2&gt;&amp;1&quot;);
+			$code = $? &gt;&gt; 8;
+		};
 	}
 	return $this;
 }
diff --git a/modules/KIWILinuxRC.sh b/modules/KIWILinuxRC.sh
index fdc9085..ceb2916 100644
--- a/modules/KIWILinuxRC.sh
+++ b/modules/KIWILinuxRC.sh
@@ -42,8 +42,10 @@ test -z &quot;$TERM&quot;               &amp;&amp; export TERM=linux
 test -z &quot;$LANG&quot;               &amp;&amp; export LANG=en_US.utf8
 test -z &quot;$UTIMER&quot;             &amp;&amp; export UTIMER=0
 test -z &quot;$VGROUP&quot;             &amp;&amp; export VGROUP=kiwiVG
-test -z &quot;$CONSOLE&quot;            &amp;&amp; export CONSOLE=/dev/console
-test -z &quot;$REDIRECT&quot;           &amp;&amp; export REDIRECT=/dev/tty1
+if [ -x /sbin/blogd ];then
+	test -z &quot;$CONSOLE&quot;            &amp;&amp; export CONSOLE=/dev/console
+	test -z &quot;$REDIRECT&quot;           &amp;&amp; export REDIRECT=/dev/tty1
+fi
     
 #======================================
 # Dialog
@@ -1905,6 +1907,9 @@ function probeFileSystem {
 		if grep -q ^CLIC /tmp/filesystem-$$;then
 			FSTYPE=clicfs
 		fi
+		if grep -q ^hsqs /tmp/filesystem-$$;then
+			FSTYPE=squashfs
+		fi
 	fi
 	export FSTYPE
 }
diff --git a/modules/KIWILog.pm b/modules/KIWILog.pm
index 63e47f3..16224e9 100644
--- a/modules/KIWILog.pm
+++ b/modules/KIWILog.pm
@@ -695,7 +695,11 @@ sub printLogExcerpt {
 		last if ($line =~ /$search/);
 		push @result,$line;
 	}
-	@lines  = splice @result,-50;
+	if (@result &gt; 50) {
+		@lines  = splice @result,-50;
+	} else {
+		@lines = @result;
+	}
 	@result = ();
 	$ignore = 0;
 	foreach my $line (@lines) {
diff --git a/modules/KIWIManager.pm b/modules/KIWIManager.pm
index df5e2f8..7b907c1 100644
--- a/modules/KIWIManager.pm
+++ b/modules/KIWIManager.pm
@@ -39,6 +39,7 @@ our %packageManager;
 $packageManager{smart}   = &quot;/usr/bin/smart&quot;;
 $packageManager{zypper}  = &quot;/usr/bin/zypper&quot;;
 $packageManager{ensconce}= &quot;/usr/bin/ensconce&quot;;
+$packageManager{yum}     = &quot;/usr/bin/yum&quot;;
 $packageManager{default} = &quot;smart&quot;;
 
 #==========================================
@@ -150,14 +151,27 @@ sub new {
 		$packageManager{ensconce},
 		&quot;-r /&quot;
 	];
+	$this-&gt;{yum}         = [
+		$packageManager{yum},
+		&quot;-c $dataDir/yum.conf&quot;,
+		&quot;-y&quot;
+	];
 	$this-&gt;{kchroot}     = [
 		&quot;chroot \&quot;$root\&quot;&quot;
 	];
 	#==========================================
 	# remove pre-defined smart channels
 	#------------------------------------------
-	if (glob (&quot;$root//etc/smart/channels/*&quot;)) {
-		qxx ( &quot;rm -f $root/etc/smart/channels/*&quot; );
+	if ($manager eq &quot;smart&quot;) {
+		if (glob (&quot;$root//etc/smart/channels/*&quot;)) {
+			qxx ( &quot;rm -f $root/etc/smart/channels/*&quot; );
+		}
+	}
+	#==========================================
+	# create yum config if required
+	#------------------------------------------
+	if ($manager eq &quot;yum&quot;) {
+		$this-&gt;{yumconfig} = $this-&gt;createYumConfig();
 	}
 	return $this;
 }
@@ -343,15 +357,14 @@ sub setupSignatureCheck {
 	my $chroot  = $this-&gt;{chroot};
 	my $root    = $this-&gt;{root};
 	my @kchroot = @{$this-&gt;{kchroot}};
+	my $yumc    = $this-&gt;{yumconfig};
 	my $data;
 	my $code;
-
 	#==========================================
 	# Get signature information
 	#------------------------------------------
 	my $imgCheckSig = $xml -&gt; getRPMCheckSignatures();
 	$this-&gt;{imgCheckSig} = $imgCheckSig;
-
 	#==========================================
 	# smart
 	#------------------------------------------
@@ -389,6 +402,20 @@ sub setupSignatureCheck {
 	if ($manager eq &quot;ensconce&quot;) {
 		# nothing to do here for ensconce...
 	}
+	#==========================================
+	# yum
+	#------------------------------------------
+	if ($manager eq &quot;yum&quot;) {
+		$data = new Config::IniFiles (
+			-file =&gt; $yumc, -allowedcommentchars =&gt; '#'
+		);
+		my $optval = 0;
+		if ($imgCheckSig eq &quot;true&quot;) {
+			$optval = 1;
+		}
+		$data -&gt; newval (&quot;main&quot;, &quot;gpgcheck&quot;, $optval);
+		$data -&gt; RewriteConfig();
+	}
 	return $this;
 }
 
@@ -406,7 +433,8 @@ sub resetSignatureCheck {
 	my $manager= $this-&gt;{manager};
 	my $root   = $this-&gt;{root};
 	my @smart  = @{$this-&gt;{smart}};
-	my @kchroot = @{$this-&gt;{kchroot}};
+	my @kchroot= @{$this-&gt;{kchroot}};
+	my $yumc   = $this-&gt;{yumconfig};
 	my $curCheckSig = $this-&gt;{curCheckSig};
 	my $data;
 	my $code;
@@ -445,6 +473,16 @@ sub resetSignatureCheck {
 	if ($manager eq &quot;ensconce&quot;) {
 		# nothing to do here for ensconce...
 	}
+	#==========================================
+	# yum
+	#------------------------------------------
+	if ($manager eq &quot;yum&quot;) {
+		$data = new Config::IniFiles (
+			-file =&gt; $yumc, -allowedcommentchars =&gt; '#'
+		);
+		$data -&gt; newval (&quot;main&quot;, &quot;gpgcheck&quot;, &quot;0&quot;);
+		$data -&gt; RewriteConfig();
+	}
 	return $this;
 }
 
@@ -521,6 +559,12 @@ sub setupExcludeDocs {
 	if ($manager eq &quot;ensconce&quot;) {
 		# nothing to do here for ensconce...
 	}
+	#==========================================
+	# yum
+	#------------------------------------------
+	if ($manager eq &quot;yum&quot;) {
+		# nothing to do here for yum...
+	}
 	return $this;
 }
 
@@ -589,6 +633,12 @@ sub resetExcludeDocs {
 	if ($manager eq &quot;ensconce&quot;) {
 		# nothing to do here for ensconce...
 	}
+	#==========================================
+	# yum
+	#------------------------------------------
+	if ($manager eq &quot;yum&quot;) {
+		# nothing to do here for yum...
+	}
 	return $this;
 }
 
@@ -611,6 +661,7 @@ sub setupInstallationSource {
 	my @smart  = @{$this-&gt;{smart}};
 	my @rootdir= @{$this-&gt;{smartroot}};
 	my $dataDir= $this-&gt;{dataDir};
+	my @yum    = @{$this-&gt;{yum}};
 	my $data;
 	my $code;
 	#==========================================
@@ -757,6 +808,69 @@ sub setupInstallationSource {
 	if ($manager eq &quot;ensconce&quot;) {
 		# Ignored for ensconce
 	}
+	#==========================================
+	# yum
+	#------------------------------------------
+	if ($manager eq &quot;yum&quot;) {
+		my $stype  = &quot;private&quot;;
+		if (! $chroot) {
+			$stype = &quot;public&quot;;
+		}
+		foreach my $alias (keys %{$source{$stype}}) {
+			my @sopts = @{$source{$stype}{$alias}};
+			my $repo  = &quot;$dataDir/$alias.repo&quot;;
+			#==========================================
+			# create new repo file and open it
+			#------------------------------------------
+			qxx (&quot;echo '[$alias]' &gt; $repo&quot;);
+			$data = new Config::IniFiles (
+				-file =&gt; $repo, -allowedcommentchars =&gt; '#'
+			);
+			#==========================================
+			# walk through the repo options
+			#------------------------------------------
+			foreach my $opt (@sopts) {
+				next if ! defined $opt;
+				$opt =~ /(.*?)=(.*)/;
+				my $key = $1;
+				my $val = $2;
+				#==========================================
+				# Set baseurl and name parameter
+				#------------------------------------------
+				if (($key eq &quot;baseurl&quot;) || ($key eq &quot;path&quot;)) {
+					if ($val =~ /^'\//) {
+						$val =~ s/^'(.*)'$/&quot;file:\/\/$1&quot;/
+					}
+					$val =~ s/^\&quot;//;
+					$val =~ s/\&quot;$//;
+					$data -&gt; newval ($alias, &quot;name&quot;   , $alias);
+					$data -&gt; newval ($alias, &quot;baseurl&quot;, $val);
+				}
+			}
+			if (! $chroot) {
+				$kiwi -&gt; info (&quot;Adding bootstrap yum repo: $alias&quot;);
+			} else {
+				$kiwi -&gt; info (&quot;Adding chroot yum repo: $alias&quot;);
+			}
+			push (@channelList,$alias);
+			$data -&gt; RewriteConfig();
+			$kiwi -&gt; done();
+		}
+		#==========================================
+		# create cache file
+		#------------------------------------------
+		if (! $chroot) {
+			$kiwi -&gt; info (&quot;Creating yum metadata cache...&quot;);
+			$data = qxx (&quot;@yum makecache 2&gt;&amp;1&quot;);
+			$code = $? &gt;&gt; 8;
+			if ($code != 0) {
+				$kiwi -&gt; failed ();
+				$kiwi -&gt; error  (&quot;yum: $data&quot;);
+				return undef;
+			}
+			$kiwi -&gt; done();
+		}
+	}
 	$this-&gt;{channelList} = \@channelList;
 	return $this;
 }
@@ -778,6 +892,7 @@ sub resetInstallationSource {
 	my @zypper = @{$this-&gt;{zypper}};
 	my @smart  = @{$this-&gt;{smart}};
 	my @rootdir= @{$this-&gt;{smartroot}};
+	my $dataDir= $this-&gt;{dataDir};
 	my @channelList = @{$this-&gt;{channelList}};
 	my $data;
 	my $code;
@@ -847,6 +962,14 @@ sub resetInstallationSource {
 	if ($manager eq &quot;ensconce&quot;) {
 		# Ignored for ensconce
 	}
+	#==========================================
+	# yum
+	#------------------------------------------
+	if ($manager eq &quot;yum&quot;) {
+		$kiwi -&gt; info (&quot;Removing yum repo(s) in: $dataDir&quot;);
+		qxx (&quot;rm -f $dataDir/*.repo 2&gt;&amp;1&quot;);
+		$kiwi -&gt; done ();
+	}
 	return $this;
 }
 
@@ -906,7 +1029,7 @@ sub setupDownload {
 	# zypper
 	#------------------------------------------
 	if ($manager eq &quot;zypper&quot;) {
-		# TODO
+		# FIXME
 		$kiwi -&gt; failed ();
 		$kiwi -&gt; error  (&quot;*** not implemeted ***&quot;);
 		$kiwi -&gt; failed ();
@@ -916,7 +1039,17 @@ sub setupDownload {
 	# ensconce
 	#------------------------------------------
 	if ($manager eq &quot;ensconce&quot;) {
-		# TODO
+		# FIXME
+		$kiwi -&gt; failed ();
+		$kiwi -&gt; error  (&quot;*** not implemeted ***&quot;);
+		$kiwi -&gt; failed ();
+		return undef;
+	}
+	#==========================================
+	# yum
+	#------------------------------------------
+	if ($manager eq &quot;yum&quot;) {
+		# FIXME
 		$kiwi -&gt; failed ();
 		$kiwi -&gt; error  (&quot;*** not implemeted ***&quot;);
 		$kiwi -&gt; failed ();
@@ -933,15 +1066,16 @@ sub installPackages {
 	# install packages in the previosly installed root
 	# system using the package manager install method
 	# ---
-	my $this = shift;
-	my $instPacks = shift;
-	my $kiwi = $this-&gt;{kiwi};
-	my $root = $this-&gt;{root};
-	my @kchroot = @{$this-&gt;{kchroot}};
-	my $manager = $this-&gt;{manager};
-	my @smart   = @{$this-&gt;{smart}};
-	my @zypper  = @{$this-&gt;{zypper}};
-	my @ensconce = @{$this-&gt;{ensconce}};
+	my $this       = shift;
+	my $instPacks  = shift;
+	my $kiwi       = $this-&gt;{kiwi};
+	my $root       = $this-&gt;{root};
+	my @kchroot    = @{$this-&gt;{kchroot}};
+	my $manager    = $this-&gt;{manager};
+	my @smart      = @{$this-&gt;{smart}};
+	my @zypper     = @{$this-&gt;{zypper}};
+	my @yum        = @{$this-&gt;{yum}};
+	my @ensconce   = @{$this-&gt;{ensconce}};
 	my $screenCall = $this-&gt;{screenCall};
 	#==========================================
 	# check addon packages
@@ -1034,6 +1168,28 @@ sub installPackages {
 		print $fd &quot;exit \$ECODE\n&quot;;
 		$fd -&gt; close();
 	}
+	#==========================================
+	# yum
+	#------------------------------------------
+	if ($manager eq &quot;yum&quot;) {
+		#==========================================
+		# Create screen call file
+		#------------------------------------------
+		$kiwi -&gt; info (&quot;Installing addon packages...&quot;);
+		print $fd &quot;function clean { kill \$SPID;&quot;;
+		print $fd &quot;while kill -0 \$SPID &amp;&gt;/dev/null; do sleep 1;&quot;;
+		print $fd &quot;if [ \&quot;\$c\&quot; = 5 ];then kill \$SPID;break;fi;&quot;;
+		print $fd &quot;c=\$((\$c+1));done;\n&quot;;
+		print $fd &quot;while kill -0 \$SPID &amp;&gt;/dev/null; do sleep 1;done\n&quot;;
+		print $fd &quot;echo 1 &gt; $screenCall.exit; exit 1; }\n&quot;;
+		print $fd &quot;trap clean INT TERM\n&quot;;
+		print $fd &quot;@kchroot @yum install @addonPackages &amp;\n&quot;;
+		print $fd &quot;SPID=\$!;wait \$SPID\n&quot;;
+		print $fd &quot;ECODE=\$?\n&quot;;
+		print $fd &quot;echo \$ECODE &gt; $screenCall.exit\n&quot;;
+		print $fd &quot;exit \$ECODE\n&quot;;
+		$fd -&gt; close();
+	}
 	return $this -&gt; setupScreenCall();
 }
 
@@ -1045,15 +1201,16 @@ sub removePackages {
 	# remove packages from the previosly installed root
 	# system using the package manager remove method
 	# ---
-	my $this = shift;
-	my $removePacks = shift;
-	my $kiwi = $this-&gt;{kiwi};
-	my $root = $this-&gt;{root};
-	my @kchroot = @{$this-&gt;{kchroot}};
-	my $manager = $this-&gt;{manager};
-	my @smart   = @{$this-&gt;{smart}};
-	my @zypper  = @{$this-&gt;{zypper}};
-	my @ensconce = @{$this-&gt;{ensconce}};
+	my $this       = shift;
+	my $removePacks= shift;
+	my $kiwi       = $this-&gt;{kiwi};
+	my $root       = $this-&gt;{root};
+	my @kchroot    = @{$this-&gt;{kchroot}};
+	my $manager    = $this-&gt;{manager};
+	my @smart      = @{$this-&gt;{smart}};
+	my @zypper     = @{$this-&gt;{zypper}};
+	my @yum        = @{$this-&gt;{yum}};
+	my @ensconce   = @{$this-&gt;{ensconce}};
 	my $screenCall = $this-&gt;{screenCall};
 	#==========================================
 	# check to be removed packages
@@ -1149,6 +1306,28 @@ sub removePackages {
 		print $fd &quot;exit \$ECODE\n&quot;;
 		$fd -&gt; close();
 	}
+	#==========================================
+	# yum
+	#------------------------------------------
+	if ($manager eq &quot;yum&quot;) {
+		#==========================================
+		# Create screen call file
+		#------------------------------------------
+		$kiwi -&gt; info (&quot;Removing addon packages...&quot;);
+		print $fd &quot;function clean { kill \$SPID;&quot;;
+		print $fd &quot;while kill -0 \$SPID &amp;&gt;/dev/null; do sleep 1;&quot;;
+		print $fd &quot;if [ \&quot;\$c\&quot; = 5 ];then kill \$SPID;break;fi;&quot;;
+		print $fd &quot;c=\$((\$c+1));done;\n&quot;;
+		print $fd &quot;while kill -0 \$SPID &amp;&gt;/dev/null; do sleep 1;done\n&quot;;
+		print $fd &quot;echo 1 &gt; $screenCall.exit; exit 1; }\n&quot;;
+		print $fd &quot;trap clean INT TERM\n&quot;;
+		print $fd &quot;@kchroot @yum remove @removePackages &amp;\n&quot;;
+		print $fd &quot;SPID=\$!;wait \$SPID\n&quot;;
+		print $fd &quot;ECODE=\$?\n&quot;;
+		print $fd &quot;echo \$ECODE &gt; $screenCall.exit\n&quot;;
+		print $fd &quot;exit \$ECODE\n&quot;;
+		$fd -&gt; close();
+	}
 	return $this -&gt; setupScreenCall();
 }
 
@@ -1160,17 +1339,18 @@ sub setupUpgrade {
 	# upgrade the previosly installed root system
 	# using the package manager upgrade functionality
 	# ---
-	my $this = shift;
-	my $addPacks = shift;
-	my $delPacks = shift;
-	my $kiwi = $this-&gt;{kiwi};
-	my $root = $this-&gt;{root};
-	my $xml  = $this-&gt;{xml};
-	my @kchroot = @{$this-&gt;{kchroot}};
-	my $manager = $this-&gt;{manager};
-	my @smart   = @{$this-&gt;{smart}};
-	my @zypper  = @{$this-&gt;{zypper}};
-	my @ensconce = @{$this-&gt;{ensconce}};
+	my $this       = shift;
+	my $addPacks   = shift;
+	my $delPacks   = shift;
+	my $kiwi       = $this-&gt;{kiwi};
+	my $root       = $this-&gt;{root};
+	my $xml        = $this-&gt;{xml};
+	my @kchroot    = @{$this-&gt;{kchroot}};
+	my $manager    = $this-&gt;{manager};
+	my @smart      = @{$this-&gt;{smart}};
+	my @zypper     = @{$this-&gt;{zypper}};
+	my @yum        = @{$this-&gt;{yum}};
+	my @ensconce   = @{$this-&gt;{ensconce}};
 	my $screenCall = $this-&gt;{screenCall};
 	#==========================================
 	# setup screen call
@@ -1280,7 +1460,7 @@ sub setupUpgrade {
 			my @newpacks = ();
 			foreach my $pac (@addonPackages) {
 				if ($pac =~ /^pattern:(.*)/) {
-					push @newpatts,$1;
+					push @newpatts,&quot;\&quot;$1\&quot;&quot;;
 				} elsif ($pac =~ /^product:(.*)/) {
 					push @newprods,$1;
 				} else {
@@ -1323,6 +1503,60 @@ sub setupUpgrade {
 		$fd -&gt; close();
 		return $this;
 	}
+	#==========================================
+	# yum
+	#------------------------------------------
+	if ($manager eq &quot;yum&quot;) {
+		#==========================================
+		# Create screen call file
+		#------------------------------------------
+		$kiwi -&gt; info (&quot;Upgrading image...&quot;);
+		print $fd &quot;function clean { kill \$SPID;&quot;;
+		print $fd &quot;while kill -0 \$SPID &amp;&gt;/dev/null; do sleep 1;&quot;;
+		print $fd &quot;if [ \&quot;\$c\&quot; = 5 ];then kill \$SPID;break;fi;&quot;; 
+		print $fd &quot;c=\$((\$c+1));done;\n&quot;;
+		print $fd &quot;while kill -0 \$SPID &amp;&gt;/dev/null; do sleep 1;done\n&quot;;
+		print $fd &quot;echo 1 &gt; $screenCall.exit; exit 1; }\n&quot;;
+		print $fd &quot;trap clean INT TERM\n&quot;;
+		if (defined $delPacks) {
+			my @removePackages = @{$delPacks};
+			if (@removePackages) {
+				print $fd &quot;@kchroot @yum remove @removePackages &amp;\n&quot;;
+				print $fd &quot;SPID=\$!;wait \$SPID\n&quot;;
+				print $fd &quot;test \$? = 0 &amp;&amp; &quot;;
+			}
+		}
+		if (defined $addPacks) {
+			my @addonPackages = @{$addPacks};
+			my @newpatts = ();
+			my @newpacks = ();
+			foreach my $pac (@addonPackages) {
+				if ($pac =~ /^pattern:(.*)/) {
+					push @newpatts,&quot;\&quot;$1\&quot;&quot;;
+				} else {
+					push @newpacks,$pac;
+				}
+			}
+			@addonPackages = @newpacks;
+			print $fd &quot;@kchroot @yum upgrade &amp;\n&quot;;
+			print $fd &quot;SPID=\$!;wait \$SPID\n&quot;;
+			if (@newpatts) {
+				print $fd &quot;test \$? = 0 &amp;&amp; @kchroot @yum groupinstall @newpatts &amp;\n&quot;;
+				print $fd &quot;SPID=\$!;wait \$SPID\n&quot;;
+			}
+			if (@addonPackages) {
+				print $fd &quot;test \$? = 0 &amp;&amp; @kchroot @yum install @addonPackages &amp;\n&quot;;
+				print $fd &quot;SPID=\$!;wait \$SPID\n&quot;;
+			}
+		} else {
+			print $fd &quot;@kchroot @yum upgrade &amp;\n&quot;;
+			print $fd &quot;SPID=\$!;wait \$SPID\n&quot;;
+		}
+		print $fd &quot;ECODE=\$?\n&quot;;
+		print $fd &quot;echo \$ECODE &gt; $screenCall.exit\n&quot;;
+		print $fd &quot;exit \$ECODE\n&quot;;
+		$fd -&gt; close();
+	}
 	return $this -&gt; setupScreenCall();
 }
 
@@ -1464,20 +1698,21 @@ sub setupRootSystem {
 	# install the bootstrap system to be able to
 	# chroot into this minimal image
 	# ---
-	my $this   = shift;
-	my @packs  = @_;
-	my $kiwi   = $this-&gt;{kiwi};
-	my $chroot = $this-&gt;{chroot};
-	my @kchroot= @{$this-&gt;{kchroot}};
-	my $root   = $this-&gt;{root};
-	my $xml    = $this-&gt;{xml};
-	my $manager= $this-&gt;{manager};
-	my @zypper = @{$this-&gt;{zypper}};
-	my @smart  = @{$this-&gt;{smart}};
-	my @rootdir= @{$this-&gt;{smartroot}};
-	my @ensconce = @{$this-&gt;{ensconce}};
+	my $this        = shift;
+	my @packs       = @_;
+	my $kiwi        = $this-&gt;{kiwi};
+	my $chroot      = $this-&gt;{chroot};
+	my @kchroot     = @{$this-&gt;{kchroot}};
+	my $root        = $this-&gt;{root};
+	my $xml         = $this-&gt;{xml};
+	my $manager     = $this-&gt;{manager};
+	my @zypper      = @{$this-&gt;{zypper}};
+	my @smart       = @{$this-&gt;{smart}};
+	my @rootdir     = @{$this-&gt;{smartroot}};
+	my @ensconce    = @{$this-&gt;{ensconce}};
 	my @channelList = @{$this-&gt;{channelList}};
 	my $screenCall  = $this-&gt;{screenCall};
+	my @yum         = @{$this-&gt;{yum}};
 	#==========================================
 	# setup screen call
 	#------------------------------------------
@@ -1620,7 +1855,7 @@ sub setupRootSystem {
 			my @newprods = ();
 			foreach my $pac (@packs) {
 				if ($pac =~ /^pattern:(.*)/) {
-					push @newpatts,$1;
+					push @newpatts,&quot;\&quot;$1\&quot;&quot;;
 				} elsif ($pac =~ /^product:(.*)/) {
 					push @newprods,$1;
 				} else {
@@ -1678,7 +1913,7 @@ sub setupRootSystem {
 			my @newprods  = ();
 			foreach my $need (@packs) {
 				if ($need =~ /^pattern:(.*)/) {
-					push @newpatts,$1;
+					push @newpatts,&quot;\&quot;$1\&quot;&quot;;
 					next;
 				} elsif ($need =~ /^product:(.*)/) {
 					push @newprods,$1;
@@ -1778,6 +2013,109 @@ sub setupRootSystem {
 		$fd -&gt; close();
 	}
 	#==========================================
+	# yum
+	#------------------------------------------
+	if ($manager eq &quot;yum&quot;) {
+		if (! $chroot) {
+			#==========================================
+			# Add package manager to package list
+			#------------------------------------------
+			if ($this -&gt; setupInstallPackages()) {
+				push (@packs,$manager);
+			}
+			#==========================================
+			# Setup baselibs
+			#------------------------------------------
+			$kiwi -&gt; info (&quot;Setting up bootstrap baselibs...&quot;);
+			if (! $this -&gt; rpmLibs()) {
+				$kiwi -&gt; failed();
+				return undef;
+			}
+			$kiwi -&gt; done();
+			$kiwi -&gt; info (&quot;Initializing image system on: $root...&quot;);
+			#==========================================
+			# check input list for group names
+			#------------------------------------------
+			my @newpacks = ();
+			my @newpatts = ();
+			foreach my $pac (@packs) {
+				if ($pac =~ /^pattern:(.*)/) {
+					push @newpatts,&quot;\&quot;$1\&quot;&quot;;
+				} else {
+					push @newpacks,$pac;
+				}
+			}
+			@packs = @newpacks;
+			#==========================================
+			# Create screen call file
+			#------------------------------------------
+			mkdir &quot;$root/tmp&quot;;
+			print $fd &quot;function clean { kill \$SPID;&quot;;
+			print $fd &quot;while kill -0 \$SPID &amp;&gt;/dev/null; do sleep 1;&quot;;
+			print $fd &quot;if [ \&quot;\$c\&quot; = 5 ];then kill \$SPID;break;fi;&quot;; 
+			print $fd &quot;c=\$((\$c+1));done;\n&quot;;
+			print $fd &quot;while kill -0 \$SPID &amp;&gt;/dev/null; do sleep 1;done\n&quot;;
+			print $fd &quot;echo 1 &gt; $screenCall.exit; exit 1; }\n&quot;;
+			print $fd &quot;trap clean INT TERM\n&quot;;
+			if (@newpatts) {
+				print $fd &quot;@yum --installroot=$root groupinstall @newpatts &amp;\n&quot;;
+				print $fd &quot;SPID=\$!;wait \$SPID\n&quot;;
+			}
+			if (@packs) {
+				if (@newpatts) {
+					print $fd &quot;test \$? = 0 &amp;&amp; &quot;;
+				}
+				print $fd &quot;@yum --installroot=$root install @packs &amp;\n&quot;;
+				print $fd &quot;SPID=\$!;wait \$SPID\n&quot;;
+			}
+			print $fd &quot;ECODE=\$?\n&quot;;
+			print $fd &quot;echo \$ECODE &gt; $screenCall.exit\n&quot;;
+			print $fd &quot;exit \$ECODE\n&quot;;
+		} else {
+			#==========================================
+			# select groups and packages
+			#------------------------------------------
+			my @install   = ();
+			my @newpatts  = ();
+			foreach my $need (@packs) {
+				if ($need =~ /^pattern:(.*)/) {
+					push @newpatts,&quot;\&quot;$1\&quot;&quot;;
+					next;
+				}
+				push @install,$need;
+			}
+			#==========================================
+			# Create screen call file
+			#------------------------------------------
+			$kiwi -&gt; info (&quot;Installing image packages...&quot;);
+			print $fd &quot;function clean { kill \$SPID;&quot;;
+			print $fd &quot;while kill -0 \$SPID &amp;&gt;/dev/null; do sleep 1;&quot;;
+			print $fd &quot;if [ \&quot;\$c\&quot; = 5 ];then kill \$SPID;break;fi;&quot;; 
+			print $fd &quot;c=\$((\$c+1));done;\n&quot;;
+			print $fd &quot;while kill -0 \$SPID &amp;&gt;/dev/null; do sleep 1;done\n&quot;;
+			print $fd &quot;echo 1 &gt; $screenCall.exit; exit 1; }\n&quot;;
+			print $fd &quot;trap clean INT TERM\n&quot;;
+			print $fd &quot;@kchroot rpm --rebuilddb &amp;\n&quot;;
+			print $fd &quot;SPID=\$!;wait \$SPID\n&quot;;
+			print $fd &quot;test \$? = 0 &amp;&amp; &quot;;
+			if (@newpatts) {
+				print $fd &quot;@kchroot @yum groupinstall @newpatts &amp;\n&quot;;
+				print $fd &quot;SPID=\$!;wait \$SPID\n&quot;;
+			}
+			if (@install) {
+				if (@newpatts) {
+					print $fd &quot;test \$? = 0 &amp;&amp; &quot;;
+				}
+				print $fd &quot;@kchroot @yum install @install &amp;\n&quot;;
+				print $fd &quot;SPID=\$!;wait \$SPID\n&quot;;
+			}
+			print $fd &quot;ECODE=\$?\n&quot;;
+			print $fd &quot;echo \$ECODE &gt; $screenCall.exit\n&quot;;
+			print $fd &quot;exit \$ECODE\n&quot;;
+		}
+		$fd -&gt; close();
+	}
+	#==========================================
 	# run process
 	#------------------------------------------
 	if (! $this -&gt; setupScreenCall()) {
@@ -1831,6 +2169,13 @@ sub resetSource {
 	if ($manager eq &quot;ensconce&quot;) {
 		# Ignored for ensconce
 	}
+	#==========================================
+	# yum
+	#------------------------------------------
+	if ($manager eq &quot;yum&quot;) {
+		$kiwi -&gt; info (&quot;Removing yum repo(s) in: $dataDir&quot;);
+		qxx (&quot;rm -f $dataDir/*.repo 2&gt;&amp;1&quot;);
+	}
 	return $this;
 }
 
@@ -1884,9 +2229,9 @@ sub setupPackageInfo {
 		return $code;
 	}
 	#==========================================
-	# zypper
+	# zypper + yum
 	#------------------------------------------
-	if ($manager eq &quot;zypper&quot;) {
+	if (($manager eq &quot;zypper&quot;) || ($manager eq &quot;yum&quot;)) {
 		my $str = &quot;not installed&quot;;
 		if (! $chroot) {
 			$kiwi -&gt; info (&quot;Checking for package: $pack&quot;);
@@ -2074,6 +2419,7 @@ sub rpmLibs {
 			# no baselibs stored/copied...
 			return $this;
 		}
+		qxx (&quot;@kchroot rpm --rebuilddb 2&gt;&amp;1&quot;);
 		@result = @{$result};
 		my %dirlist = ();
 		foreach my $l (@result) {
@@ -2123,4 +2469,26 @@ sub rpmLibs {
 	return $this;
 }
 
+#==========================================
+# createYumConfig
+#------------------------------------------
+sub createYumConfig {
+	my $this   = shift;
+	my $root   = $this-&gt;{root};
+	my $meta   = $this-&gt;{dataDir};
+	my $config = $meta.&quot;/yum.conf&quot;;
+	qxx (&quot;echo '[main]' &gt; $config&quot;);
+	qxx (&quot;echo 'cachedir=$meta' &gt;&gt; $config&quot;);
+	qxx (&quot;echo 'reposdir=$meta' &gt;&gt; $config&quot;);
+	qxx (&quot;echo 'keepcache=0' &gt;&gt; $config&quot;);
+	qxx (&quot;echo 'debuglevel=2' &gt;&gt; $config&quot;);
+	qxx (&quot;echo 'pkgpolicy=newest' &gt;&gt; $config&quot;);
+	qxx (&quot;echo 'tolerant=1' &gt;&gt; $config&quot;);
+	qxx (&quot;echo 'exactarch=1' &gt;&gt; $config&quot;);
+	qxx (&quot;echo 'obsoletes=1' &gt;&gt; $config&quot;);
+	qxx (&quot;echo 'plugins=1' &gt;&gt; $config&quot;);
+	qxx (&quot;echo 'metadata_expire=1800' &gt;&gt; $config&quot;);
+	return $config;
+}
+
 1;
diff --git a/modules/KIWIRoot.pm b/modules/KIWIRoot.pm
index bf5aca7..2b97e95 100644
--- a/modules/KIWIRoot.pm
+++ b/modules/KIWIRoot.pm
@@ -899,6 +899,9 @@ sub setup {
 	if ($status eq &quot;skipped&quot;) {
 		$status = $configure -&gt; setupAutoYaST();
 	}
+	if ($status eq &quot;skipped&quot;) {
+		$status = $configure -&gt; setupFirstBootAnaconda();
+	}
 	if ($status eq &quot;failed&quot;) {
 		return undef;
 	}
@@ -1061,6 +1064,7 @@ sub setupMount {
 		push (@mountList,&quot;$root/dev&quot;);
 	}
 	if (! -f &quot;$root/var/run/dbus/pid&quot;) {
+		qxx (&quot;mkdir -p $root/var/run/dbus&quot;);
 		qxx (&quot;mount --bind /var/run/dbus $root/var/run/dbus&quot;);
 		push (@mountList,&quot;$root/var/run/dbus&quot;);
 	}
diff --git a/modules/KIWISchema.rnc b/modules/KIWISchema.rnc
index 3372342..4afe74f 100644
--- a/modules/KIWISchema.rnc
+++ b/modules/KIWISchema.rnc
@@ -536,6 +536,23 @@ div {
 }
 
 #==========================================
+# common element &lt;rhelGroup&gt;
+#
+div {
+	k.rhelgroup.name.attribute = k.name.attribute
+	k.rhelgroup.arch.attribute = k.arch.attribute
+	k.rhelgroup.attlist =
+		k.rhelgroup.name.attribute &amp;
+		k.rhelgroup.arch.attribute?
+	k.rhelgroup =
+		## Name of RHEL package group 
+		element rhelGroup {
+			k.rhelgroup.attlist,
+			empty
+		}
+}
+
+#==========================================
 # common element &lt;opensuseProduct&gt;
 #
 div {
@@ -641,7 +658,7 @@ div {
 # common element &lt;packagemanager&gt;
 #
 div {
-	k.packagemanager.content = &quot;smart&quot; | &quot;zypper&quot; | &quot;ensconce&quot;
+	k.packagemanager.content = &quot;smart&quot; | &quot;zypper&quot; | &quot;ensconce&quot; | &quot;yum&quot;
 	k.packagemanager.attlist = empty
 	k.packagemanager =
 		## Name of the Package Manager
@@ -2066,6 +2083,7 @@ div {
 			k.packages.attlist &amp;
 			k.package* &amp;
 			k.opensusepattern* &amp;
+			k.rhelgroup* &amp;
 			k.opensuseproduct* &amp;
 			k.ignore* &amp;
 			k.archive*
diff --git a/modules/KIWISchema.rng b/modules/KIWISchema.rng
index 857232f..412ba56 100644
--- a/modules/KIWISchema.rng
+++ b/modules/KIWISchema.rng
@@ -752,6 +752,34 @@ archive is extracted in a specific way.&lt;/db:para&gt;
   &lt;/div&gt;
   &lt;!--
     ==========================================
+    common element &lt;rhelGroup&gt;
+    
+  --&gt;
+  &lt;div&gt;
+    &lt;define name=&quot;k.rhelgroup.name.attribute&quot;&gt;
+      &lt;ref name=&quot;k.name.attribute&quot;/&gt;
+    &lt;/define&gt;
+    &lt;define name=&quot;k.rhelgroup.arch.attribute&quot;&gt;
+      &lt;ref name=&quot;k.arch.attribute&quot;/&gt;
+    &lt;/define&gt;
+    &lt;define name=&quot;k.rhelgroup.attlist&quot;&gt;
+      &lt;interleave&gt;
+        &lt;ref name=&quot;k.rhelgroup.name.attribute&quot;/&gt;
+        &lt;optional&gt;
+          &lt;ref name=&quot;k.rhelgroup.arch.attribute&quot;/&gt;
+        &lt;/optional&gt;
+      &lt;/interleave&gt;
+    &lt;/define&gt;
+    &lt;define name=&quot;k.rhelgroup&quot;&gt;
+      &lt;element name=&quot;rhelGroup&quot;&gt;
+        &lt;a:documentation&gt;Name of RHEL package group &lt;/a:documentation&gt;
+        &lt;ref name=&quot;k.rhelgroup.attlist&quot;/&gt;
+        &lt;empty/&gt;
+      &lt;/element&gt;
+    &lt;/define&gt;
+  &lt;/div&gt;
+  &lt;!--
+    ==========================================
     common element &lt;opensuseProduct&gt;
     
   --&gt;
@@ -949,6 +977,7 @@ to the specific medium number (CD1, DVD7, ...)&lt;/a:documentation&gt;
         &lt;value&gt;smart&lt;/value&gt;
         &lt;value&gt;zypper&lt;/value&gt;
         &lt;value&gt;ensconce&lt;/value&gt;
+        &lt;value&gt;yum&lt;/value&gt;
       &lt;/choice&gt;
     &lt;/define&gt;
     &lt;define name=&quot;k.packagemanager.attlist&quot;&gt;
@@ -3031,6 +3060,9 @@ and also depends of the selected image output type.&lt;/db:para&gt;
             &lt;ref name=&quot;k.opensusepattern&quot;/&gt;
           &lt;/zeroOrMore&gt;
           &lt;zeroOrMore&gt;
+            &lt;ref name=&quot;k.rhelgroup&quot;/&gt;
+          &lt;/zeroOrMore&gt;
+          &lt;zeroOrMore&gt;
             &lt;ref name=&quot;k.opensuseproduct&quot;/&gt;
           &lt;/zeroOrMore&gt;
           &lt;zeroOrMore&gt;
diff --git a/modules/KIWIURL.pm b/modules/KIWIURL.pm
index a312efe..90a33cd 100644
--- a/modules/KIWIURL.pm
+++ b/modules/KIWIURL.pm
@@ -310,6 +310,7 @@ sub isoPath {
 	my $status;
 	my $file;
 	my $path;
+	my $search;
 	#==========================================
 	# normalize URL data
 	#------------------------------------------
@@ -342,6 +343,10 @@ sub isoPath {
 		my $pwd = qxx (&quot;pwd&quot;); chomp $pwd;
 		$module = $pwd.&quot;/&quot;.$module;
 	}
+	if ($module =~ /(.*\.iso)(.*)/) {
+		$module = $1;
+		$search = $2;
+	}
 	my ( $module_test ) = glob ($module);
 	if (! -e $module_test) {
 		$kiwi -&gt; warning (&quot;ISO path: $module_test doesn't exist: $!&quot;);
@@ -349,7 +354,7 @@ sub isoPath {
 		return undef;
 	}
 	my $name   = basename ($module);
-	my $tmpdir = &quot;/tmp/kiwimount-$name-$$&quot;;
+	my $tmpdir = &quot;/tmp/kiwimount-$name&quot;;
 	#==========================================
 	# create ISO mount point and perform mount
 	#------------------------------------------
@@ -374,7 +379,11 @@ sub isoPath {
 	# add loop mount to mount list of root obj
 	#------------------------------------------
 	$root -&gt; addToMountList ($tmpdir);
-	return $tmpdir;
+	if ($search) {
+		return &quot;$tmpdir/$search&quot;;
+	} else {
+		return $tmpdir;
+	}
 }
 
 #==========================================
diff --git a/modules/KIWIXML.pm b/modules/KIWIXML.pm
index 2f81ae1..50eb36b 100644
--- a/modules/KIWIXML.pm
+++ b/modules/KIWIXML.pm
@@ -2896,7 +2896,10 @@ sub getList {
 				}
 				push @pattlist,&quot;product:&quot;.$product;
 			}
-			@slist = $node -&gt; getElementsByTagName (&quot;opensusePattern&quot;);
+			my @slist_suse = $node -&gt; getElementsByTagName (&quot;opensusePattern&quot;);
+			my @slist_rhel = $node -&gt; getElementsByTagName (&quot;rhelGroup&quot;);
+			push @<A HREF="https://lists.berlios.de/mailman/listinfo/kiwi-devel">slist, at slist_suse</A>;
+			push @<A HREF="https://lists.berlios.de/mailman/listinfo/kiwi-devel">slist, at slist_rhel</A>; 
 			foreach my $element (@slist) {
 				if (! $this -&gt; isArchAllowed ($element,$type)) {
 					next;
@@ -2908,7 +2911,7 @@ sub getList {
 				push @pattlist,&quot;pattern:&quot;.$pattern;
 			}
 			if (@pattlist) {
-				if ($manager ne &quot;zypper&quot;) {
+				if (($manager ne &quot;zypper&quot;) &amp;&amp; ($manager ne &quot;yum&quot;)) {
 					#==========================================
 					# turn patterns into pacs for this manager
 					#------------------------------------------
@@ -2941,7 +2944,7 @@ sub getList {
 					push @<A HREF="https://lists.berlios.de/mailman/listinfo/kiwi-devel">result, at packageList</A>;
 				} else {
 					#==========================================
-					# zypper knows about patterns
+					# zypper/yum knows about patterns/groups
 					#------------------------------------------
 					foreach my $pname (@pattlist) {
 						$kiwi -&gt; info (&quot;--&gt; Requesting $pname&quot;);
diff --git a/rpm/kiwi.changes b/rpm/kiwi.changes
index 7d8ff74..249274f 100644
--- a/rpm/kiwi.changes
+++ b/rpm/kiwi.changes
@@ -12,6 +12,7 @@ Mon Mar 15 10:53:26 CET 2010 - <A HREF="https://lists.berlios.de/mailman/listinfo/kiwi-devel">ms at suse.de</A>
 - fixed Xen dom0 bootloader configuration
 - fixed default pxeboot file, use kiwiserver
 - fixed --build option in kiwi
+- added support for RHEL
 
 -------------------------------------------------------------------
 Wed Mar 10 11:32:20 CET 2010 - <A HREF="https://lists.berlios.de/mailman/listinfo/kiwi-devel">ms at suse.de</A>
diff --git a/rpm/kiwi.spec b/rpm/kiwi.spec
index 9afe59b..1c19ff4 100644
--- a/rpm/kiwi.spec
+++ b/rpm/kiwi.spec
@@ -530,6 +530,7 @@ rm -rf $RPM_BUILD_ROOT
 %dir %{_datadir}/kiwi/image/isoboot
 %doc %{_datadir}/kiwi/image/isoboot/README
 %{_datadir}/kiwi/image/isoboot/suse*
+%{_datadir}/kiwi/image/isoboot/rhel*
 %endif
 
 %ifarch %ix86 x86_64
@@ -579,4 +580,5 @@ rm -rf $RPM_BUILD_ROOT
 %{_datadir}/kiwi/image/suse-11.1-JeOS
 %{_datadir}/kiwi/image/suse-SLE10-JeOS
 %{_datadir}/kiwi/image/suse-SLE11-JeOS
+%{_datadir}/kiwi/image/rhel-05.4-JeOS
 %endif
diff --git a/system/boot/ix86/isoboot/rhel-05.4/config.sh b/system/boot/ix86/isoboot/rhel-05.4/config.sh
new file mode 100755
index 0000000..3536af7
--- /dev/null
+++ b/system/boot/ix86/isoboot/rhel-05.4/config.sh
@@ -0,0 +1,41 @@
+#!/bin/bash
+#================
+# FILE          : config.sh
+#----------------
+# PROJECT       : OpenSuSE KIWI Image System
+# COPYRIGHT     : (c) 2006 SUSE LINUX Products GmbH. All rights reserved
+#               :
+# AUTHOR        : Marcus Schaefer &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/kiwi-devel">ms at suse.de</A>&gt;
+#               :
+# BELONGS TO    : Operating System images
+#               :
+# DESCRIPTION   : configuration script for SUSE based
+#               : operating systems
+#               :
+#               :
+# STATUS        : BETA
+#----------------
+#======================================
+# Functions...
+#--------------------------------------
+test -f /.kconfig &amp;&amp; . /.kconfig
+test -f /.profile &amp;&amp; . /.profile
+
+#======================================
+# Greeting...
+#--------------------------------------
+echo &quot;Configure image: [$kiwi_iname]...&quot;
+
+#======================================
+# Keep UTF-8 locale
+#--------------------------------------
+baseStripLocales \
+	$(for i in $(echo $kiwi_language | tr &quot;,&quot; &quot; &quot;);do echo -n &quot;$i.utf8 &quot;;done)
+baseStripTranslations kiwi.mo
+
+#======================================
+# Umount kernel filesystems
+#--------------------------------------
+baseCleanMount
+
+exit 0
diff --git a/system/boot/ix86/isoboot/rhel-05.4/config.xml b/system/boot/ix86/isoboot/rhel-05.4/config.xml
new file mode 100644
index 0000000..92d1bf4
--- /dev/null
+++ b/system/boot/ix86/isoboot/rhel-05.4/config.xml
@@ -0,0 +1,140 @@
+&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
+
+&lt;image schemaversion=&quot;4.4&quot; name=&quot;initrd-isoboot-rhel-05.4&quot;&gt;
+	&lt;description type=&quot;boot&quot;&gt;
+		&lt;author&gt;Marcus Schaefer&lt;/author&gt;
+		&lt;contact&gt;<A HREF="https://lists.berlios.de/mailman/listinfo/kiwi-devel">ms at novell.com</A>&lt;/contact&gt;
+		&lt;specification&gt;boot/initrd image used for LiveDVD media&lt;/specification&gt;
+	&lt;/description&gt;
+	&lt;preferences&gt;
+		&lt;type image=&quot;cpio&quot; bootprofile=&quot;default&quot; bootkernel=&quot;std&quot;/&gt;
+		&lt;version&gt;2.1.2&lt;/version&gt;
+		&lt;packagemanager&gt;yum&lt;/packagemanager&gt;
+		&lt;rpm-check-signatures&gt;false&lt;/rpm-check-signatures&gt;
+	&lt;/preferences&gt;
+	&lt;profiles&gt;
+		&lt;profile name=&quot;default&quot; description=&quot;Booting default setup&quot;/&gt;
+		&lt;profile name=&quot;std&quot; description=&quot;KERNEL: Default&quot;/&gt;
+	&lt;/profiles&gt;
+	&lt;drivers type=&quot;drivers&quot;&gt;
+		&lt;file name=&quot;crypto/*&quot;/&gt;
+		&lt;file name=&quot;drivers/virtio/*&quot;/&gt;
+		&lt;file name=&quot;drivers/block/virtio_blk.ko&quot;/&gt;
+		&lt;file name=&quot;drivers/char/hw_random/virtio-rng.ko&quot;/&gt;
+		&lt;file name=&quot;drivers/net/virtio_net.ko&quot;/&gt;
+		&lt;file name=&quot;drivers/md/*&quot;/&gt;
+		&lt;file name=&quot;drivers/hid/*&quot;/&gt;
+		&lt;file name=&quot;drivers/input/keyboard/*&quot;/&gt;
+		&lt;file name=&quot;drivers/input/mouse/*&quot;/&gt;
+		&lt;file name=&quot;drivers/usb/*&quot;/&gt;
+		&lt;file name=&quot;drivers/ide/*&quot;/&gt;
+		&lt;file name=&quot;drivers/block/loop.ko&quot;/&gt;
+		&lt;file name=&quot;drivers/block/brd.ko&quot;/&gt;
+		&lt;file name=&quot;fs/ext3/*&quot;/&gt;
+		&lt;file name=&quot;fs/ext4/*&quot;/&gt;
+		&lt;file name=&quot;fs/ext2/*&quot;/&gt;
+		&lt;file name=&quot;fs/fat/*&quot;/&gt;
+		&lt;file name=&quot;fs/vfat/*&quot;/&gt;
+		&lt;file name=&quot;fs/binfmt_aout.ko&quot;/&gt;
+		&lt;file name=&quot;fs/binfmt_misc.ko&quot;/&gt;
+		&lt;file name=&quot;fs/mbcache.ko&quot;/&gt;
+		&lt;file name=&quot;fs/quota_v1.ko&quot;/&gt;
+		&lt;file name=&quot;fs/quota_v2.ko&quot;/&gt;
+		&lt;file name=&quot;fs/jbd/*&quot;/&gt;
+		&lt;file name=&quot;fs/jbd2/*&quot;/&gt;
+		&lt;file name=&quot;fs/fuse/*&quot;/&gt;
+		&lt;file name=&quot;fs/squashfs/*&quot;/&gt;
+		&lt;file name=&quot;fs/nls/nls_utf8.ko&quot;/&gt;
+		&lt;file name=&quot;fs/nls/nls_cp437.ko&quot;/&gt;
+		&lt;file name=&quot;fs/nls/nls_iso8859-1.ko&quot;/&gt;
+		&lt;file name=&quot;drivers/cdrom/*&quot;/&gt;
+		&lt;file name=&quot;drivers/scsi/*&quot;/&gt;
+		&lt;file name=&quot;drivers/message/fusion/*&quot;/&gt;
+		&lt;file name=&quot;drivers/ata/*&quot;/&gt;
+		&lt;file name=&quot;drivers/ieee1394/*&quot;/&gt;
+		&lt;file name=&quot;drivers/parport/*&quot;/&gt;
+		&lt;file name=&quot;drivers/acpi/dock.ko&quot;/&gt;
+		&lt;file name=&quot;drivers/firmware/edd.ko&quot;/&gt;
+		&lt;file name=&quot;lib/crc-t10dif.ko&quot;/&gt;
+		&lt;file name=&quot;lib/crc16.ko&quot;/&gt;
+	&lt;/drivers&gt;
+	&lt;repository type=&quot;rpm-md&quot; status=&quot;replaceable&quot;&gt;
+		&lt;source path=&quot;<A HREF="iso:///image/CDs/RHEL-5.4-%arch-DVD.iso/Server">iso:///image/CDs/RHEL-5.4-%arch-DVD.iso/Server</A>&quot;/&gt;
+	&lt;/repository&gt;
+	&lt;repository type=&quot;rpm-md&quot; status=&quot;fixed&quot;&gt;
+		&lt;source path=&quot;/usr/share/kiwi/repo/rhel-repo/rhel-054-repo&quot;/&gt;
+	&lt;/repository&gt;
+	&lt;packages type=&quot;bootstrap&quot; profiles=&quot;std&quot;&gt;
+		&lt;package name=&quot;kernel&quot;/&gt;
+	&lt;/packages&gt;
+	&lt;packages type=&quot;bootstrap&quot;&gt;
+		&lt;package name=&quot;filesystem&quot;/&gt;
+		&lt;package name=&quot;basesystem&quot;/&gt;
+	&lt;/packages&gt;
+	&lt;packages type=&quot;image&quot;&gt;
+		&lt;package name=&quot;psmisc&quot;/&gt;
+		&lt;package name=&quot;bind-libs&quot;/&gt;
+		&lt;package name=&quot;bind-utils&quot;/&gt;
+		&lt;package name=&quot;gawk&quot;/&gt;
+		&lt;package name=&quot;iproute&quot;/&gt;
+		&lt;package name=&quot;lvm2&quot;/&gt;
+		&lt;package name=&quot;setup&quot;/&gt;
+		&lt;package name=&quot;initscripts&quot;/&gt;
+		&lt;package name=&quot;sysfsutils&quot;/&gt;
+		&lt;package name=&quot;file&quot;/&gt;
+		&lt;package name=&quot;syslinux&quot;/&gt;
+		&lt;package name=&quot;make&quot;/&gt;
+		&lt;package name=&quot;memtest86+&quot;/&gt;
+		&lt;package name=&quot;hdparm&quot;/&gt;
+		&lt;package name=&quot;grub&quot;/&gt;
+		&lt;package name=&quot;tar&quot;/&gt;
+		&lt;package name=&quot;rpm&quot;/&gt;
+		&lt;package name=&quot;cryptsetup-luks&quot;/&gt;
+		&lt;package name=&quot;dialog&quot;/&gt;
+		&lt;package name=&quot;kiwi-tools&quot;/&gt;
+		&lt;package name=&quot;coreutils&quot;/&gt;
+		&lt;package name=&quot;hwinfo&quot;/&gt;
+		&lt;package name=&quot;pam&quot;/&gt;
+	&lt;/packages&gt;
+	&lt;packages type=&quot;delete&quot;&gt;
+		&lt;package name=&quot;cracklib-dicts&quot;/&gt;
+		&lt;package name=&quot;audit-libs&quot;/&gt;
+		&lt;package name=&quot;bind-libs&quot;/&gt;
+		&lt;package name=&quot;bind-utils&quot;/&gt;
+		&lt;package name=&quot;binutils&quot;/&gt;
+		&lt;package name=&quot;cpio&quot;/&gt;
+		&lt;package name=&quot;cyrus-sasl&quot;/&gt;
+		&lt;package name=&quot;db4&quot;/&gt;
+		&lt;package name=&quot;dbus-glib&quot;/&gt;
+		&lt;package name=&quot;diffutils&quot;/&gt;
+		&lt;package name=&quot;expat&quot;/&gt;
+		&lt;package name=&quot;freetype&quot;/&gt;
+		&lt;package name=&quot;gawk&quot;/&gt;
+		&lt;package name=&quot;gdbm&quot;/&gt;
+		&lt;package name=&quot;glib2&quot;/&gt;
+		&lt;package name=&quot;grub&quot;/&gt;
+		&lt;package name=&quot;hdparm&quot;/&gt;
+		&lt;package name=&quot;info&quot;/&gt;
+		&lt;package name=&quot;iproute&quot;/&gt;
+		&lt;package name=&quot;irqbalance&quot;/&gt;
+		&lt;package name=&quot;logrotate&quot;/&gt;
+		&lt;package name=&quot;lvm2&quot;/&gt;
+		&lt;package name=&quot;make&quot;/&gt;
+		&lt;package name=&quot;mdadm&quot;/&gt;
+		&lt;package name=&quot;memtest86+&quot;/&gt;
+		&lt;package name=&quot;mingetty&quot;/&gt;
+		&lt;package name=&quot;mktemp&quot;/&gt;
+		&lt;package name=&quot;mtools&quot;/&gt;
+		&lt;package name=&quot;net-tools&quot;/&gt;
+		&lt;package name=&quot;openldap-clients&quot;/&gt;
+		&lt;package name=&quot;parted&quot;/&gt;
+		&lt;package name=&quot;perl&quot;/&gt;
+		&lt;package name=&quot;perl-HTML-Parser&quot;/&gt;
+		&lt;package name=&quot;perl-HTML-Tagset&quot;/&gt;
+		&lt;package name=&quot;pm-utils&quot;/&gt;
+		&lt;package name=&quot;setserial&quot;/&gt;
+		&lt;package name=&quot;syslinux&quot;/&gt;
+		&lt;package name=&quot;postfix&quot;/&gt;
+		&lt;package name=&quot;keyutils-libs&quot;/&gt;
+	&lt;/packages&gt;
+&lt;/image&gt;
diff --git a/system/boot/ix86/isoboot/rhel-05.4/images.sh b/system/boot/ix86/isoboot/rhel-05.4/images.sh
new file mode 100755
index 0000000..6c0ab5a
--- /dev/null
+++ b/system/boot/ix86/isoboot/rhel-05.4/images.sh
@@ -0,0 +1,33 @@
+#!/bin/sh
+test -f /.kconfig &amp;&amp; . /.kconfig
+test -f /.profile &amp;&amp; . /.profile
+
+echo &quot;Configure image: [$kiwi_iname]...&quot;
+
+#==========================================
+# remove unneded kernel files
+#------------------------------------------
+rhelStripKernel
+
+#==========================================
+# setup gfxboot
+#------------------------------------------
+rhelGFXBoot SLES isolinux
+
+#==========================================
+# remove unneeded packages
+#------------------------------------------
+rpm -e --nodeps --noscripts \
+	$(rpm -q `baseGetPackagesForDeletion` | grep -v &quot;is not installed&quot;)
+
+#==========================================
+# remove unneeded files
+#------------------------------------------
+rhelStripInitrd
+
+#==========================================
+# umount /proc
+#------------------------------------------
+umount /proc &amp;&gt;/dev/null
+
+exit 0
diff --git a/system/boot/ix86/isoboot/suse-11.0/root/etc/modprobe.conf.local b/system/boot/ix86/isoboot/rhel-05.4/root/etc/modprobe.conf.local
similarity index 100%
copy from system/boot/ix86/isoboot/suse-11.0/root/etc/modprobe.conf.local
copy to system/boot/ix86/isoboot/rhel-05.4/root/etc/modprobe.conf.local
diff --git a/system/boot/ix86/isoboot/suse-11.0/root/include b/system/boot/ix86/isoboot/rhel-05.4/root/include
similarity index 100%
copy from system/boot/ix86/isoboot/suse-11.0/root/include
copy to system/boot/ix86/isoboot/rhel-05.4/root/include
diff --git a/system/boot/ix86/isoboot/rhel-05.4/root/linuxrc b/system/boot/ix86/isoboot/rhel-05.4/root/linuxrc
new file mode 120000
index 0000000..2a8a565
--- /dev/null
+++ b/system/boot/ix86/isoboot/rhel-05.4/root/linuxrc
@@ -0,0 +1 @@
+../../rhel-linuxrc
\ No newline at end of file
diff --git a/system/boot/ix86/isoboot/rhel-05.4/root/preinit b/system/boot/ix86/isoboot/rhel-05.4/root/preinit
new file mode 120000
index 0000000..d94974a
--- /dev/null
+++ b/system/boot/ix86/isoboot/rhel-05.4/root/preinit
@@ -0,0 +1 @@
+../../rhel-preinit
\ No newline at end of file
diff --git a/system/boot/ix86/isoboot/rhel-linuxrc b/system/boot/ix86/isoboot/rhel-linuxrc
new file mode 100755
index 0000000..c38cc84
--- /dev/null
+++ b/system/boot/ix86/isoboot/rhel-linuxrc
@@ -0,0 +1,371 @@
+#!/bin/bash
+#================
+# FILE          : linuxrc
+#----------------
+# PROJECT       : OpenSuSE KIWI Image System
+# COPYRIGHT     : (c) 2006 SUSE LINUX Products GmbH. All rights reserved
+#               :
+# AUTHOR        : Marcus Schaefer &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/kiwi-devel">ms at suse.de</A>&gt;
+#               :
+# BELONGS TO    : Operating System images
+#               :
+# DESCRIPTION   : This file is changed to become the real
+#               : linuxrc script which is used to prepare the
+#               : operating system for the main image
+#               :
+#               :
+# STATUS        : BETA
+#----------------
+#======================================
+# Exports (General)...
+#--------------------------------------
+export PATH=&quot;/sbin:/bin:/usr/sbin:/usr/bin&quot;
+export IFS_ORIG=$IFS
+export DEBUG=0
+export ARCH=`arch`
+
+#======================================
+# Exports (Configuration)...
+#--------------------------------------
+export systemIntegrity=clean
+export LIVECD_CONFIG=&quot;/cdrom/config.isoclient&quot;
+export LIVECD=&quot;/livecd&quot;
+export LOCAL_BOOT=&quot;no&quot;
+
+#======================================
+# Functions...
+#--------------------------------------
+. /include
+initialize
+
+#======================================
+# Beautify Startup
+#--------------------------------------
+echo &quot;Loading KIWI CD Boot-System...&quot;
+echo &quot;------------------------------&quot;
+
+#======================================
+# Update library path
+#--------------------------------------
+ldconfig
+
+#======================================
+# 1) Mounting local file systems
+#--------------------------------------
+mountSystemFilesystems &amp;&gt;/dev/null
+closeKernelConsole
+
+#======================================
+# 2) probe for livecd_config in cmdline
+#--------------------------------------
+includeKernelParameters
+if grep -i -q &quot;livecd_config=[a-zA-Z0-9/]&quot; /proc/cmdline; then
+	export LIVECD_CONFIG=`sed 's/.*livecd_config=\([^ ]*\).*/\1/' /proc/cmdline`
+fi
+
+#======================================
+# 3) Prepare module load support 
+#--------------------------------------
+touch /etc/modules.conf
+touch /lib/modules/*/modules.dep
+
+#======================================
+# 4) run udevd
+#--------------------------------------
+udevStart
+
+#======================================
+# 5) start boot shell and logging
+#--------------------------------------
+startBlogD
+startShell
+errorLogStart
+openKernelConsole
+
+#======================================
+# 6) Including required kernel modules
+#--------------------------------------
+probeDevices
+
+#======================================
+# 7) Mount the CD device
+#--------------------------------------
+CDMount
+
+#======================================
+# 8) Load configuration
+#--------------------------------------
+importFile &lt; $LIVECD_CONFIG
+if [ ! -z &quot;$HYBRID_RW&quot; ];then
+	if [ ! -z &quot;$UNIONFS_CONFIG&quot; ];then
+		UNIONFS_CONFIG=$(echo $UNIONFS_CONFIG | sed -e s@/dev/ram1@$HYBRID_RW@)
+	else
+		IMAGE=$(echo $IMAGE | sed -e s@/dev/ram1@$HYBRID_RW@)
+	fi
+fi
+
+#======================================
+# 9) Download RW part of the CD image
+#--------------------------------------
+IFS=&quot;,&quot; ; for i in $IMAGE;do
+	field=0
+	IFS=&quot;;&quot; ; for n in $i;do
+	case $field in
+		0) imageDevice=$n ; field=1 ;;
+		1) imageName=$n   ; field=2 ;;
+		2) imageVersion=$n
+	esac
+	done
+	imageReadOnly=&quot;$imageName&quot;
+	imageReadOnly=`echo $imageReadOnly | sed -e <A HREF="https://lists.berlios.de/mailman/listinfo/kiwi-devel">s at .</A>$ARCH@@`
+	imageReadOnly=&quot;$imageReadOnly-read-only.$ARCH-$imageVersion&quot;
+	imageName=&quot;/cdrom/$imageName-$imageVersion&quot;
+	gzippName=$imageName.gz
+	imageMD5s=&quot;$imageName.md5&quot;
+	if [ ! -z &quot;$UNIONFS_CONFIG&quot; ] || [ ! -z &quot;$COMBINED_IMAGE&quot; ];then
+		continue
+	fi
+	while true;do
+		IFS=&quot; &quot;
+		read sum1 blocks blocksize zblocks zblocksize &lt; $imageMD5s
+		if ! validateSize;then
+			systemException \
+				&quot;Not enough RAM available for this image&quot; \
+			&quot;reboot&quot;
+		fi
+		needBytes=`gzip -l $gzippName|tail -n1|sed -e &quot;s@ \+@:@g&quot;|cut -f3 -d:`
+		needMByte=`expr $needBytes / 1024 / 1024`
+		if [ -x /usr/bin/dcounter ];then
+			errorLogStop
+			Echo -n &quot;Loading $imageName [$imageDevice] &quot;
+			gzip -cd $gzippName |\
+				dcounter -s $needMByte | dd of=$imageDevice &amp;&gt;/dev/null
+			errorLogContinue
+			echo
+		else
+			Echo &quot;Loading $imageName [$imageDevice]...&quot;
+			gzip -cd $gzippName | dd of=$imageDevice
+		fi
+		dd if=$imageDevice bs=1024 |\
+			head --bytes=$((blocks * blocksize)) |\
+			md5sum - &gt; /etc/ireal.md5
+		read sum2 dumy &lt; /etc/ireal.md5
+		if test $sum1 = $sum2;then
+			Echo &quot;Image checksum test: fine :-)&quot;
+			break
+		fi
+		Echo &quot;Image checksum test failed:&quot;
+		echo
+		Echo -b &quot;1) Data corruption while loading the image:&quot;
+		Echo -b &quot;   will give it a new try...&quot;
+		echo
+		Echo -b &quot;2) ramdisk size is too small for the image:&quot;
+		Echo -b &quot;   try to set the kernel parameter ramdisk_size=&lt;size&gt;&quot;
+		echo
+		Echo &quot;Retry to load image...&quot;
+		sleep 15
+	done
+	rm -f /etc/ireal.md5
+done
+CDUmount
+
+#======================================
+# 10) Get filesystem type
+#--------------------------------------
+if [ -z &quot;$UNIONFS_CONFIG&quot; ];then
+	probeFileSystem $imageDevice
+	if [ &quot;$FSTYPE&quot; = &quot;luks&quot; ];then
+		imageDevice=$(luksOpen $imageDevice)
+		probeFileSystem $imageDevice
+		export haveLuks=yes
+	fi
+	if test &quot;$FSTYPE&quot; = &quot;reiserfs&quot;;then
+		Echo &quot;Resize Reiser filesystem to full ramdisk space...&quot;
+		luksResize $imageDevice
+		resize_reiserfs $imageDevice
+	fi
+	if test &quot;$FSTYPE&quot; = &quot;ext2&quot;;then
+		Echo &quot;Resize EXT2 filesystem to full ramdisk space...&quot;
+		luksResize $imageDevice
+		resize2fs -f $imageDevice
+	fi
+	if test &quot;$FSTYPE&quot; = &quot;ext3&quot;;then
+		Echo &quot;Resize EXT3 filesystem to full ramdisk space...&quot;
+		luksResize $imageDevice
+		resize2fs -f $imageDevice
+	fi
+	if test &quot;$FSTYPE&quot; = &quot;ext4&quot;;then
+		Echo &quot;Resize EXT4 filesystem to full ramdisk space...&quot;
+		luksResize $imageDevice
+		resize2fs -f $imageDevice
+	fi
+fi
+
+#======================================
+# 11) Check for swap space
+#--------------------------------------
+swapSpace=`searchSwapSpace`
+if [ ! -z &quot;$swapSpace&quot; ];then
+	#======================================
+	# 11.1) use an existing swap partition
+	#--------------------------------------
+	Echo &quot;Found swap space on: $swapSpace&quot;
+else
+	#======================================
+	# 11.1) use a swap file on a free part.
+	#--------------------------------------
+	swapDevice=`searchDiskSpace`
+	if [ ! -z &quot;$swapDevice&quot; ];then
+		FSTYPE_SAVE=$FSTYPE
+		probeFileSystem $swapDevice
+		SWTYPE=$FSTYPE
+		FSTYPE=$FSTYPE_SAVE
+		if [ $SWTYPE = &quot;unknown&quot; ];then
+			Echo &quot;Can't use unknown filesystem for swap file... skipped&quot;
+		else
+			Echo &quot;Setting up swap file on: $swapDevice -&gt; $SWTYPE&quot;
+			mRAM=`cat /proc/meminfo | grep MemTotal | cut -f2 -d:`
+			mRAM=`echo $mRAM | cut -f1 -d&quot; &quot;`
+			SWSIZE=`expr $mRAM / 1024`
+			SWSIZE=`expr $SWSIZE \* 2`
+			if [ $SWSIZE -lt 64 ];then
+				SWSIZE=64
+			fi
+			SWDIR=/liveswap
+			SWFILE=$SWDIR/kiwiswap
+			mkdir -p $SWDIR
+			if ! mount -t $SWTYPE $swapDevice $SWDIR;then
+				Echo &quot;Failed to mount swap device on: $swapDevice&quot;
+				unset swapDevice
+			fi
+			if [ ! -f $SWFILE ];then
+				dd if=/dev/zero of=$SWFILE bs=1M count=$SWSIZE &gt;/dev/null
+				if [ ! $? = 0 ];then
+					Echo &quot;Failed to create swap file on: $swapDevice&quot;
+					unset swapDevice
+				fi
+				if ! mkswap $SWFILE &gt;/dev/null;then
+					Echo &quot;Failed to initialize swap file&quot;
+					unset swapDevice
+				fi
+			fi
+			Echo &quot;Created swap file: kiwiswap [ $SWSIZE MB ]&quot;
+			umount $SWDIR
+		fi
+	fi
+fi
+
+#======================================
+# 12) Mount OS image to /mnt
+#--------------------------------------
+runHook premount
+if [ -z &quot;$UNIONFS_CONFIG&quot; ] &amp;&amp; [ -z &quot;$COMBINED_IMAGE&quot; ];then
+	#======================================
+	# 12.1) mount RW part and CD to /mnt
+	#--------------------------------------
+	if ! mount $imageDevice /mnt &gt;/dev/null;then
+		systemException &quot;Failed to mount RW root filesystem&quot; &quot;reboot&quot;
+	fi
+	cdopt=$(CDMountOption $cddev)
+	mkdir -p $LIVECD &amp;&amp; eval mount $cdopt $cddev $LIVECD
+	#======================================
+	# 12.2) Create RO Link list
+	#--------------------------------------
+	cd /mnt
+	if [ ! -d $LIVECD/read-only-system ];then
+		Echo &quot;Mounting compressed read only tree...&quot;
+		rosys=&quot;/read-only&quot;
+		rosrc=&quot;$LIVECD/$imageReadOnly&quot;
+		mkdir -p $rosys
+		if ! kiwiMount $rosrc $rosys &quot;-o loop&quot;;then
+			systemException &quot;Failed to mount RO root filesystem&quot; &quot;reboot&quot;
+		fi
+		Echo &quot;Creating live media links...&quot;
+		for dir in bin boot lib lib64 opt sbin usr;do
+			ln -s read-only/$dir $dir
+		done
+	else
+		Echo &quot;Creating live media links...&quot;
+		for dir in bin boot lib lib64 opt sbin usr;do
+			if [ -d $LIVECD/read-only-system/$dir ];then
+				ln -s $LIVECD/read-only-system/$dir $dir
+			fi
+		done
+	fi
+	cd /
+else
+	#======================================
+	# 12.1) mount CD to /mnt and unify
+	#--------------------------------------
+	if [ ! -z &quot;$COMBINED_IMAGE&quot; ]; then
+		Echo &quot;Mounting compressed split tree...&quot;
+		imageReadOnly=`echo $imageReadOnly | sed -e &quot;s/-read-only//&quot;`
+	else
+		Echo &quot;Mounting compressed unified tree...&quot;
+	fi
+	cdopt=$(CDMountOption $cddev)
+	mkdir -p $LIVECD &amp;&amp; eval mount $cdopt $cddev $LIVECD
+	if ! mountSystem /dev/loop1 $LIVECD/$imageReadOnly;then
+		systemException &quot;Failed to mount root filesystem&quot; &quot;reboot&quot;
+	fi
+fi
+validateRootTree
+runHook postmount
+
+#======================================
+# 13) Create system dependant files
+#--------------------------------------
+setupDefaultFstab /config
+updateRootDeviceFstab /config $imageDevice
+if [ ! -z &quot;$swapSpace&quot; ];then
+	updateSwapDeviceFstab /config $swapSpace
+elif [ ! -z &quot;$swapDevice&quot; ];then
+	mkdir -p /mnt/liveswap
+	echo &quot;$swapDevice /liveswap $SWTYPE defaults 1 1&quot;  &gt;&gt; /config/etc/fstab
+	echo &quot;/liveswap/kiwiswap swap swap prio=42 0 0&quot;    &gt;&gt; /config/etc/fstab
+fi
+
+#======================================
+# 14) copy system dependant files
+#--------------------------------------
+setupConfigFiles
+
+#======================================
+# 15) update system dependant files
+#--------------------------------------
+setupInittab /mnt
+
+#======================================
+# 16) setup real root device
+#--------------------------------------
+echo 256 &gt; /proc/sys/kernel/real-root-dev
+
+#======================================
+# 17) umount system filesystems
+#--------------------------------------
+umountSystemFilesystems
+
+#======================================
+# 18) copy initrd files to image
+#--------------------------------------
+importBranding
+cp /usr/sbin/setctsid /mnt/usr/sbin
+cp /usr/sbin/klogconsole /mnt/usr/sbin
+cp /preinit /mnt
+cp /include /mnt
+
+#======================================
+# 19) kill boot shell
+#--------------------------------------
+killShell
+killBlogD
+
+#======================================
+# 20) Activate new root
+#--------------------------------------
+activateImage
+
+#======================================
+# 21) Unmount initrd / system init
+#--------------------------------------
+bootImage $@
diff --git a/system/boot/ix86/isoboot/rhel-preinit b/system/boot/ix86/isoboot/rhel-preinit
new file mode 100755
index 0000000..4388bef
--- /dev/null
+++ b/system/boot/ix86/isoboot/rhel-preinit
@@ -0,0 +1,26 @@
+#!/bin/bash
+#================
+# FILE          : preinit
+#----------------
+# PROJECT       : OpenSuSE KIWI Image System
+# COPYRIGHT     : (c) 2006 SUSE LINUX Products GmbH. All rights reserved
+#               :
+# AUTHOR        : Marcus Schaefer &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/kiwi-devel">ms at suse.de</A>&gt;
+#               :
+# BELONGS TO    : Operating System images
+#               :
+# DESCRIPTION   : This file is called after the image root
+#               : has changed by the linuxrc script
+#               :
+# STATUS        : BETA
+#----------------
+#======================================
+# Functions...
+#--------------------------------------
+. /include
+
+#======================================
+# 1) start error log
+#--------------------------------------
+Echo &quot;Calling pre-init stage in system image&quot;
+errorLogStart
diff --git a/system/rhel-repo/rhel-054-repo/gfxboot-4.1.41-5.1.i386.rpm b/system/rhel-repo/rhel-054-repo/gfxboot-4.1.41-5.1.i386.rpm
new file mode 100644
index 0000000..dcfd2a8
Binary files /dev/null and b/system/rhel-repo/rhel-054-repo/gfxboot-4.1.41-5.1.i386.rpm differ
diff --git a/system/rhel-repo/rhel-054-repo/gfxboot-4.1.41-5.1.x86_64.rpm b/system/rhel-repo/rhel-054-repo/gfxboot-4.1.41-5.1.x86_64.rpm
new file mode 100644
index 0000000..0785ac1
Binary files /dev/null and b/system/rhel-repo/rhel-054-repo/gfxboot-4.1.41-5.1.x86_64.rpm differ
diff --git a/system/rhel-repo/rhel-054-repo/gfxboot-branding-upstream-4.1.41-5.1.i386.rpm b/system/rhel-repo/rhel-054-repo/gfxboot-branding-upstream-4.1.41-5.1.i386.rpm
new file mode 100644
index 0000000..593dba4
Binary files /dev/null and b/system/rhel-repo/rhel-054-repo/gfxboot-branding-upstream-4.1.41-5.1.i386.rpm differ
diff --git a/system/rhel-repo/rhel-054-repo/gfxboot-branding-upstream-4.1.41-5.1.x86_64.rpm b/system/rhel-repo/rhel-054-repo/gfxboot-branding-upstream-4.1.41-5.1.x86_64.rpm
new file mode 100644
index 0000000..f741c6f
Binary files /dev/null and b/system/rhel-repo/rhel-054-repo/gfxboot-branding-upstream-4.1.41-5.1.x86_64.rpm differ
diff --git a/system/rhel-repo/rhel-054-repo/gfxboot-devel-4.1.41-5.1.i386.rpm b/system/rhel-repo/rhel-054-repo/gfxboot-devel-4.1.41-5.1.i386.rpm
new file mode 100644
index 0000000..2a20acc
Binary files /dev/null and b/system/rhel-repo/rhel-054-repo/gfxboot-devel-4.1.41-5.1.i386.rpm differ
diff --git a/system/rhel-repo/rhel-054-repo/gfxboot-devel-4.1.41-5.1.x86_64.rpm b/system/rhel-repo/rhel-054-repo/gfxboot-devel-4.1.41-5.1.x86_64.rpm
new file mode 100644
index 0000000..42add16
Binary files /dev/null and b/system/rhel-repo/rhel-054-repo/gfxboot-devel-4.1.41-5.1.x86_64.rpm differ
diff --git a/system/rhel-repo/rhel-054-repo/hwinfo-16.12-4.1.i386.rpm b/system/rhel-repo/rhel-054-repo/hwinfo-16.12-4.1.i386.rpm
new file mode 100644
index 0000000..2fe1b40
Binary files /dev/null and b/system/rhel-repo/rhel-054-repo/hwinfo-16.12-4.1.i386.rpm differ
diff --git a/system/rhel-repo/rhel-054-repo/hwinfo-16.12-4.1.x86_64.rpm b/system/rhel-repo/rhel-054-repo/hwinfo-16.12-4.1.x86_64.rpm
new file mode 100644
index 0000000..e348703
Binary files /dev/null and b/system/rhel-repo/rhel-054-repo/hwinfo-16.12-4.1.x86_64.rpm differ
diff --git a/system/rhel-repo/rhel-054-repo/kiwi-tools-4.22-85.1.i386.rpm b/system/rhel-repo/rhel-054-repo/kiwi-tools-4.22-85.1.i386.rpm
new file mode 100644
index 0000000..ea7e3d6
Binary files /dev/null and b/system/rhel-repo/rhel-054-repo/kiwi-tools-4.22-85.1.i386.rpm differ
diff --git a/system/rhel-repo/rhel-054-repo/kiwi-tools-4.22-85.1.x86_64.rpm b/system/rhel-repo/rhel-054-repo/kiwi-tools-4.22-85.1.x86_64.rpm
new file mode 100644
index 0000000..061d9af
Binary files /dev/null and b/system/rhel-repo/rhel-054-repo/kiwi-tools-4.22-85.1.x86_64.rpm differ
diff --git a/system/rhel-repo/rhel-054-repo/libx86emu1-1.1-3.1.i386.rpm b/system/rhel-repo/rhel-054-repo/libx86emu1-1.1-3.1.i386.rpm
new file mode 100644
index 0000000..5d75c58
Binary files /dev/null and b/system/rhel-repo/rhel-054-repo/libx86emu1-1.1-3.1.i386.rpm differ
diff --git a/system/rhel-repo/rhel-054-repo/libx86emu1-1.1-3.1.x86_64.rpm b/system/rhel-repo/rhel-054-repo/libx86emu1-1.1-3.1.x86_64.rpm
new file mode 100644
index 0000000..debc514
Binary files /dev/null and b/system/rhel-repo/rhel-054-repo/libx86emu1-1.1-3.1.x86_64.rpm differ
diff --git a/system/rhel-repo/rhel-054-repo/repodata/filelists.xml.gz b/system/rhel-repo/rhel-054-repo/repodata/filelists.xml.gz
new file mode 100644
index 0000000..732a823
Binary files /dev/null and b/system/rhel-repo/rhel-054-repo/repodata/filelists.xml.gz differ
diff --git a/system/rhel-repo/rhel-054-repo/repodata/other.xml.gz b/system/rhel-repo/rhel-054-repo/repodata/other.xml.gz
new file mode 100644
index 0000000..0259f6d
Binary files /dev/null and b/system/rhel-repo/rhel-054-repo/repodata/other.xml.gz differ
diff --git a/system/rhel-repo/rhel-054-repo/repodata/primary.xml.gz b/system/rhel-repo/rhel-054-repo/repodata/primary.xml.gz
new file mode 100644
index 0000000..57a45f5
Binary files /dev/null and b/system/rhel-repo/rhel-054-repo/repodata/primary.xml.gz differ
diff --git a/system/rhel-repo/rhel-054-repo/repodata/repomd.xml b/system/rhel-repo/rhel-054-repo/repodata/repomd.xml
new file mode 100644
index 0000000..44afcde
--- /dev/null
+++ b/system/rhel-repo/rhel-054-repo/repodata/repomd.xml
@@ -0,0 +1,21 @@
+&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
+&lt;repomd xmlns=&quot;<A HREF="http://linux.duke.edu/metadata/repo">http://linux.duke.edu/metadata/repo</A>&quot;&gt;
+  &lt;data type=&quot;other&quot;&gt;
+    &lt;location href=&quot;repodata/other.xml.gz&quot;/&gt;
+    &lt;checksum type=&quot;sha&quot;&gt;22d66c6ac390e5f2b7715db20604649850cd06d7&lt;/checksum&gt;
+    &lt;timestamp&gt;1268902260&lt;/timestamp&gt;
+    &lt;open-checksum type=&quot;sha&quot;&gt;e9285fa8ba48502fd8ade454014b48fd2c364e28&lt;/open-checksum&gt;
+  &lt;/data&gt;
+  &lt;data type=&quot;filelists&quot;&gt;
+    &lt;location href=&quot;repodata/filelists.xml.gz&quot;/&gt;
+    &lt;checksum type=&quot;sha&quot;&gt;534d7a84062c97b0e139a35be67140237e3be1df&lt;/checksum&gt;
+    &lt;timestamp&gt;1268902260&lt;/timestamp&gt;
+    &lt;open-checksum type=&quot;sha&quot;&gt;95f8d898683be70cb22683fb0240cbe09e735f7b&lt;/open-checksum&gt;
+  &lt;/data&gt;
+  &lt;data type=&quot;primary&quot;&gt;
+    &lt;location href=&quot;repodata/primary.xml.gz&quot;/&gt;
+    &lt;checksum type=&quot;sha&quot;&gt;af5d3e9b60d4058a2cf849b1301c66d4263ab27f&lt;/checksum&gt;
+    &lt;timestamp&gt;1268902260&lt;/timestamp&gt;
+    &lt;open-checksum type=&quot;sha&quot;&gt;724742147f7f4e58df40efbb39cf3713f03be38e&lt;/open-checksum&gt;
+  &lt;/data&gt;
+&lt;/repomd&gt;
diff --git a/system/rhel-repo/rhel-054-repo/syslinux-3.83-2.1.i386.rpm b/system/rhel-repo/rhel-054-repo/syslinux-3.83-2.1.i386.rpm
new file mode 100644
index 0000000..f16db38
Binary files /dev/null and b/system/rhel-repo/rhel-054-repo/syslinux-3.83-2.1.i386.rpm differ
diff --git a/system/rhel-repo/rhel-054-repo/syslinux-3.83-2.1.x86_64.rpm b/system/rhel-repo/rhel-054-repo/syslinux-3.83-2.1.x86_64.rpm
new file mode 100644
index 0000000..f29fe98
Binary files /dev/null and b/system/rhel-repo/rhel-054-repo/syslinux-3.83-2.1.x86_64.rpm differ
diff --git a/template/rhel-05.4-JeOS/README b/template/rhel-05.4-JeOS/README
new file mode 100644
index 0000000..03a4dfc
--- /dev/null
+++ b/template/rhel-05.4-JeOS/README
@@ -0,0 +1,8 @@
+Build instructions for local build
+==================================
+* tip: create a local RHEL 5.4 installation source to speed up the build process
+  tip: copy RHEL 5.4 DVD
+
+* call kiwi:
+  kiwi --build rhel-05.4-JeOS --set-repo /path/to/RHEL/repo \
+	   -d /tmp/myimage --type vmx
diff --git a/template/rhel-05.4-JeOS/config-anaconda-firstboot b/template/rhel-05.4-JeOS/config-anaconda-firstboot
new file mode 100644
index 0000000..893355d
--- /dev/null
+++ b/template/rhel-05.4-JeOS/config-anaconda-firstboot
@@ -0,0 +1,13 @@
+# /.../
+# At the moment the information in this file is not evaluated
+# by the firstboot setup because I don't know if RHEL has something
+# like an auto configuration modues where we can pass the following
+# information into the firstboot service
+# ----
+lang en_US.UTF-8
+keyboard us
+network --device eth0 --bootproto dhcp
+firewall --enabled --port=22:tcp
+authconfig --enableshadow --enablemd5
+selinux --enforcing
+timezone --utc Europe/Berlin
diff --git a/template/rhel-05.4-JeOS/config.sh b/template/rhel-05.4-JeOS/config.sh
new file mode 100755
index 0000000..075444b
--- /dev/null
+++ b/template/rhel-05.4-JeOS/config.sh
@@ -0,0 +1,38 @@
+#!/bin/bash
+#======================================
+# Functions...
+#--------------------------------------
+test -f /.kconfig &amp;&amp; . /.kconfig
+test -f /.profile &amp;&amp; . /.profile
+
+#======================================
+# Greeting...
+#--------------------------------------
+echo &quot;Configure image: [$kiwi_iname]...&quot;
+
+#======================================
+# Activate services
+#--------------------------------------
+# TODO
+
+#======================================
+# Add missing gpg keys to rpm
+#--------------------------------------
+# TODO
+    
+#==========================================
+# remove unneeded packages
+#------------------------------------------
+# TODO
+
+#======================================
+# Remove all documentation
+#--------------------------------------
+baseStripDocs
+
+#======================================
+# Umount kernel filesystems
+#--------------------------------------
+baseCleanMount
+
+exit 0
diff --git a/template/rhel-05.4-JeOS/config.xml b/template/rhel-05.4-JeOS/config.xml
new file mode 100644
index 0000000..1e7cdfa
--- /dev/null
+++ b/template/rhel-05.4-JeOS/config.xml
@@ -0,0 +1,90 @@
+&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
+
+&lt;image schemaversion=&quot;4.4&quot; name=&quot;LimeJeOS-RHEL-05.4&quot;&gt;
+	&lt;description type=&quot;system&quot;&gt;
+		&lt;author&gt;Marcus Sch&#195;&#164;fer&lt;/author&gt;
+		&lt;contact&gt;<A HREF="https://lists.berlios.de/mailman/listinfo/kiwi-devel">ms at novell.com</A>&lt;/contact&gt;
+		&lt;specification&gt;RHEL Enterprise 5 JeOS&lt;/specification&gt;
+	&lt;/description&gt;
+	&lt;profiles&gt;
+		&lt;profile name=&quot;xenFlavour&quot; description=&quot;VMX with Xen kernel&quot;/&gt;
+		&lt;profile name=&quot;vmxFlavour&quot; description=&quot;VMX with default kernel&quot; import=&quot;true&quot;/&gt;
+	&lt;/profiles&gt;
+	&lt;preferences&gt;
+		&lt;version&gt;1.1.0&lt;/version&gt;
+		&lt;packagemanager&gt;yum&lt;/packagemanager&gt;
+		&lt;boot-theme&gt;upstream&lt;/boot-theme&gt;
+		&lt;locale&gt;en_US&lt;/locale&gt;
+		&lt;keytable&gt;us.map.gz&lt;/keytable&gt;
+		&lt;timezone&gt;Europe/Berlin&lt;/timezone&gt;
+		&lt;rpm-check-signatures&gt;false&lt;/rpm-check-signatures&gt;
+		&lt;type image=&quot;iso&quot; boot=&quot;isoboot/rhel-05.4&quot; flags=&quot;compressed&quot;/&gt;
+	&lt;/preferences&gt;
+	&lt;preferences profiles=&quot;xenFlavour&quot;&gt;
+		&lt;type image=&quot;vmx&quot; filesystem=&quot;ext3&quot; boot=&quot;vmxboot/rhel-05.4&quot; bootprofile=&quot;xen&quot; bootkernel=&quot;xenk&quot;&gt;
+			&lt;xenconfig memory=&quot;512&quot; domain=&quot;domU&quot;&gt;
+				&lt;xendisk device=&quot;/dev/xvda&quot;/&gt;
+				&lt;xenbridge name=&quot;&quot;/&gt;
+			&lt;/xenconfig&gt;
+		&lt;/type&gt;
+		&lt;type image=&quot;oem&quot; filesystem=&quot;ext3&quot; boot=&quot;oemboot/rhel-05.4&quot; bootprofile=&quot;xen&quot; bootkernel=&quot;xenk&quot; format=&quot;iso&quot;&gt;
+			&lt;oemconfig&gt;
+				&lt;oem-home&gt;false&lt;/oem-home&gt;
+				&lt;oem-systemsize&gt;2048&lt;/oem-systemsize&gt;
+			&lt;/oemconfig&gt;
+			&lt;xenconfig domain=&quot;dom0&quot;/&gt;
+		&lt;/type&gt;
+	&lt;/preferences&gt;
+	&lt;preferences profiles=&quot;vmxFlavour&quot;&gt;
+		&lt;type image=&quot;vmx&quot; filesystem=&quot;ext3&quot; boot=&quot;vmxboot/rhel-05.4&quot; format=&quot;vmdk&quot;&gt;
+			&lt;vmwareconfig memory=&quot;512&quot; guestOS=&quot;RHEL&quot; HWversion=&quot;4&quot;&gt;
+				&lt;vmwaredisk controller=&quot;scsi&quot; id=&quot;0&quot;/&gt;
+				&lt;vmwarenic driver=&quot;e1000&quot; interface=&quot;0&quot; mode=&quot;bridged&quot;/&gt;
+			&lt;/vmwareconfig&gt;
+		&lt;/type&gt;
+		&lt;type image=&quot;oem&quot; filesystem=&quot;ext3&quot; boot=&quot;oemboot/rhel-05.4&quot; format=&quot;iso&quot;&gt;
+			&lt;oemconfig&gt;
+				&lt;oem-home&gt;false&lt;/oem-home&gt;
+				&lt;oem-systemsize&gt;2048&lt;/oem-systemsize&gt;
+			&lt;/oemconfig&gt;
+			&lt;vmwareconfig memory=&quot;512&quot; guestOS=&quot;RHEL&quot; HWversion=&quot;4&quot;&gt;
+				&lt;vmwaredisk controller=&quot;scsi&quot; id=&quot;0&quot;/&gt;
+				&lt;vmwarenic driver=&quot;e1000&quot; interface=&quot;0&quot; mode=&quot;bridged&quot;/&gt;
+			&lt;/vmwareconfig&gt;
+		&lt;/type&gt;
+	&lt;/preferences&gt;
+	&lt;users group=&quot;root&quot;&gt;
+		&lt;user pwd=&quot;$1$wYJUgpM5$RXMMeASDc035eX.NbYWFl0&quot; home=&quot;/root&quot; name=&quot;root&quot;/&gt;
+	&lt;/users&gt;
+	&lt;repository type=&quot;rpm-md&quot;&gt;
+		&lt;source path=&quot;<A HREF="iso:///image/CDs/RHEL-5.4-%arch-DVD.iso/Server">iso:///image/CDs/RHEL-5.4-%arch-DVD.iso/Server</A>&quot;/&gt;
+	&lt;/repository&gt;
+	&lt;repository type=&quot;rpm-md&quot;&gt;
+		&lt;source path=&quot;/usr/share/kiwi/repo/rhel-repo/rhel-054-repo&quot;/&gt;
+	&lt;/repository&gt;
+	&lt;packages type=&quot;image&quot;&gt;
+		&lt;package name=&quot;grub&quot;/&gt;
+		&lt;package name=&quot;device-mapper-multipath&quot;/&gt;
+		&lt;package name=&quot;screen&quot;/&gt;
+		&lt;package name=&quot;firstboot&quot;/&gt;
+		&lt;package name=&quot;vim-minimal&quot;/&gt;
+		&lt;package name=&quot;selinux-policy-targeted&quot;/&gt;
+		&lt;package name=&quot;selinux-policy-devel&quot;/&gt;
+		&lt;package name=&quot;libselinux-utils&quot;/&gt;
+		&lt;package name=&quot;dhclient&quot;/&gt;
+		&lt;rhelGroup name=&quot;System Tools&quot;/&gt;
+		&lt;rhelGroup name=&quot;Text-based Internet&quot;/&gt;
+		&lt;package name=&quot;gfxboot-branding-upstream&quot; bootinclude=&quot;true&quot; bootdelete=&quot;true&quot;/&gt;
+	&lt;/packages&gt;
+	&lt;packages type=&quot;image&quot; profiles=&quot;xenFlavour&quot;&gt;
+		&lt;package name=&quot;kernel-xen&quot; replaces=&quot;kernel&quot;/&gt;
+		&lt;package name=&quot;xen&quot; replaces=&quot;&quot;/&gt;
+	&lt;/packages&gt;
+	&lt;packages type=&quot;image&quot; profiles=&quot;vmxFlavour&quot;&gt;
+		&lt;package name=&quot;kernel&quot; replaces=&quot;kernel-xen&quot;/&gt;
+	&lt;/packages&gt;
+	&lt;packages type=&quot;bootstrap&quot;&gt;
+		&lt;package name=&quot;filesystem&quot;/&gt;
+		&lt;package name=&quot;basesystem&quot;/&gt;
+	&lt;/packages&gt;
+&lt;/image&gt;
diff --git a/template/suse-11.1-JeOS/suse-11.1-JeOS.kiwi b/template/rhel-05.4-JeOS/rhel-05.4-JeOS.kiwi
similarity index 100%
copy from template/suse-11.1-JeOS/suse-11.1-JeOS.kiwi
copy to template/rhel-05.4-JeOS/rhel-05.4-JeOS.kiwi
diff --git a/template/suse-11.1-JeOS/root/etc/X11/xorg.conf b/template/rhel-05.4-JeOS/root/etc/X11/xorg.conf
similarity index 100%
copy from template/suse-11.1-JeOS/root/etc/X11/xorg.conf
copy to template/rhel-05.4-JeOS/root/etc/X11/xorg.conf
diff --git a/tools/klogconsole/Makefile b/tools/klogconsole/Makefile
new file mode 100644
index 0000000..8a9b11c
--- /dev/null
+++ b/tools/klogconsole/Makefile
@@ -0,0 +1,21 @@
+#
+# Makefiel for klogconsole
+#
+# Author: Werner Fink &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/kiwi-devel">werner at suse.de</A>&gt;
+#
+
+CC	= gcc
+ifeq ($(RPM_OPT_FLAGS),)
+ CFLAGS	= $(RPM_OPT_FLAGS) -Wall
+else
+ CFLAGS	= -O2 -pipe -Wall
+endif
+INSTALL	= install
+
+all:	klogconsole
+
+klogconsole:	klogconsole.c
+	$(CC) $(CFLAGS) -o $@ $&lt;
+
+clean:
+	$(RM) klogconsole
diff --git a/tools/klogconsole/klogconsole.c b/tools/klogconsole/klogconsole.c
new file mode 100644
index 0000000..61cbb4b
--- /dev/null
+++ b/tools/klogconsole/klogconsole.c
@@ -0,0 +1,106 @@
+/* (C) 1996 under GPL, Hans Lermen &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/kiwi-devel">lermen at elserv.ffm.fgan.de</A>&gt;,
+ * parts of switch_printk_console() stolen from Kevin Buhr &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/kiwi-devel">buhr at stat.wisc.edu</A>&gt;
+ */
+
+
+/* klogconsole -l 1 -r MAX_CONSOLE */
+/* Tells the kernel to what terminal and starting from what level
+ * it should copy printk() messages */
+
+#include &lt;stdio.h&gt;
+#include &lt;stdlib.h&gt;
+#include &lt;getopt.h&gt;
+#include &lt;unistd.h&gt;
+#include &lt;termios.h&gt;
+#if !(defined __GLIBC__ &amp;&amp; __GLIBC__ &gt;= 2)
+# include &lt;linux/unistd.h&gt;
+# include &lt;linux/termios.h&gt;
+#endif
+#include &lt;fcntl.h&gt;
+#include &lt;sys/ioctl.h&gt;
+#include &lt;errno.h&gt;
+
+#if !(defined __GLIBC__ &amp;&amp; __GLIBC__ &gt;= 2)
+static _syscall3(int, syslog, int, type, char *, bufp, int, len);
+#else
+# include &lt;sys/klog.h&gt;
+#endif
+
+#ifndef  MAX_CONSOLE
+# define MAX_CONSOLE 24
+#endif
+
+void usage(void) __attribute__((noreturn));
+
+static void console_level(int level)
+{
+#if !(defined __GLIBC__ &amp;&amp; __GLIBC__ &gt;= 2)
+  syslog(8,0,level);
+#else
+  klogctl(8, 0, level);
+#endif
+}
+
+static void switch_printk_console(int new_console)
+{
+  char newvt[2];
+  int vt;
+
+  if ((new_console &lt; 0) || (new_console &gt; MAX_CONSOLE)) {
+    fprintf(stderr,&quot;wrong console number\n&quot;);
+    exit(1);
+  }
+
+  newvt[0] = 11;
+  newvt[1] = new_console;
+  vt = open( &quot;/dev/tty1&quot;, O_RDONLY );
+  if( vt == -1 ) {
+    perror(&quot;open(/dev/tty1)&quot;);
+    exit(1);
+  }
+  if( ioctl( vt, TIOCLINUX, &amp;newvt ) ) {
+    /* shut up perror(&quot;ioctl(TIOCLINUX)&quot;); */
+    exit(1);
+  }
+  close(vt);
+}
+
+void usage(void)
+{
+  printf(
+    &quot;USAGE:\n&quot;
+    &quot;  klogconsole [-l console_loglevel ] [ -r console ]\n\n&quot;
+    &quot;  console_loglevel  0..7 (kernel may dissallow values &lt;5)\n&quot;
+    &quot;  console           0..%i console to which printk() dups messages\n&quot;
+    &quot;                     (0 = current console)\n&quot;, MAX_CONSOLE
+  );
+  exit(1);
+}
+
+int
+main (int argc, char** argv)
+{
+  int op,i;
+  
+  if (argc &lt;= 1) usage();
+  opterr = 0;
+  while ((op = getopt(argc, argv, &quot;l:r:&quot;)) != EOF) {
+    switch (op) {
+      case 'l': {
+        i=atoi(optarg);
+        console_level(i);
+        break;
+      }
+      case 'r': {
+        i=atoi(optarg);
+        switch_printk_console(i);
+        break;
+      }
+      default: {
+        usage();
+        /* doesn't return */
+      }
+    }
+  }
+  return 0;
+}
diff --git a/tools/runinit/Makefile b/tools/runinit/Makefile
new file mode 100644
index 0000000..701d8b6
--- /dev/null
+++ b/tools/runinit/Makefile
@@ -0,0 +1,10 @@
+OBJ = run-init
+CC  = gcc -Wall -fpic -O2
+
+all:${OBJ}
+
+run-init: run-init.c
+	${CC} ${CFLAGS} run-init.c -o run-init
+
+clean:
+	rm -f run-init
diff --git a/tools/runinit/run-init.c b/tools/runinit/run-init.c
new file mode 100644
index 0000000..524bf00
--- /dev/null
+++ b/tools/runinit/run-init.c
@@ -0,0 +1,255 @@
+/* ----------------------------------------------------------------------- *
+ *   
+ *   Copyright 2004 H. Peter Anvin - All Rights Reserved
+ *
+ *   Permission is hereby granted, free of charge, to any person
+ *   obtaining a copy of this software and associated documentation
+ *   files (the &quot;Software&quot;), to deal in the Software without
+ *   restriction, including without limitation the rights to use,
+ *   copy, modify, merge, publish, distribute, sublicense, and/or
+ *   sell copies of the Software, and to permit persons to whom
+ *   the Software is furnished to do so, subject to the following
+ *   conditions:
+ *   
+ *   The above copyright notice and this permission notice shall
+ *   be included in all copies or substantial portions of the Software.
+ *   
+ *   THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND,
+ *   EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES
+ *   OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
+ *   NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT
+ *   HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,
+ *   WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
+ *   FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR
+ *   OTHER DEALINGS IN THE SOFTWARE.
+ *
+ * ----------------------------------------------------------------------- */
+
+/*
+ * run-init.c
+ *
+ * Usage: exec run-init [-c /dev/console] /real-root /sbin/init &quot;$@&quot;
+ *
+ * This program should be called as the last thing in a shell script
+ * acting as /init in an initramfs; it does the following:
+ *
+ * - Delete all files in the initramfs;
+ * - Remounts /real-root onto the root filesystem;
+ * - Chroots;
+ * - Opens /dev/console;
+ * - Spawns the specified init program (with arguments.)
+ */
+
+#include &lt;alloca.h&gt;
+#include &lt;assert.h&gt;
+#include &lt;dirent.h&gt;
+#include &lt;errno.h&gt;
+#include &lt;fcntl.h&gt;
+#include &lt;string.h&gt;
+#include &lt;stdlib.h&gt;
+#include &lt;stdio.h&gt;
+#include &lt;unistd.h&gt;
+#include &lt;sys/mount.h&gt;
+#include &lt;sys/stat.h&gt;
+#include &lt;sys/types.h&gt;
+#include &lt;sys/vfs.h&gt;
+
+/* Make it possible to compile on glibc by including constants that the
+   always-behind shipped glibc headers may not include.  Classic example
+   on why the lack of ABI headers screw us up. */
+#ifndef TMPFS_MAGIC
+# define TMPFS_MAGIC	0x01021994
+#endif
+#ifndef RAMFS_MAGIC
+# define RAMFS_MAGIC	0x858458f6
+#endif
+#ifndef MS_MOVE
+# define MS_MOVE	8192
+#endif
+
+static const char *program;
+
+static void __attribute__((noreturn)) die(const char *msg)
+{
+  fprintf(stderr, &quot;%s: %s: %s\n&quot;, program, msg, strerror(errno));
+  exit(1);
+}
+
+static int nuke(const char *what);
+
+static int nuke_dirent(int len, const char *dir, const char *name, dev_t me)
+{
+  int bytes = len+strlen(name)+2;
+  char path[bytes];
+  int xlen;
+  struct stat st;
+
+  xlen = snprintf(path, bytes, &quot;%s/%s&quot;, dir, name);
+  assert(xlen &lt; bytes);
+
+  if ( lstat(path, &amp;st) )
+    return ENOENT;		/* Return 0 since already gone? */
+
+  if ( st.st_dev != me )
+    return 0;			/* DO NOT recurse down mount points!!!!! */
+
+  return nuke(path);
+}
+
+/* Wipe the contents of a directory, but not the directory itself */
+static int nuke_dir(const char *what)
+{
+  int len = strlen(what);
+  DIR *dir;
+  struct dirent *d;
+  int err = 0;
+  struct stat st;
+
+  if ( lstat(what, &amp;st) )
+    return errno;
+  
+  if ( !S_ISDIR(st.st_mode) )
+    return ENOTDIR;
+
+  if ( !(dir = opendir(what)) ) {
+    /* EACCES means we can't read it.  Might be empty and removable;
+       if not, the rmdir() in nuke() will trigger an error. */
+    return (errno == EACCES) ? 0 : errno;
+  }
+  
+  while ( (d = readdir(dir)) ) {
+    /* Skip . and .. */
+    if ( d-&gt;d_name[0] == '.' &amp;&amp;
+	 (d-&gt;d_name[1] == '\0' ||
+	  (d-&gt;d_name[1] == '.' &amp;&amp; d-&gt;d_name[2] == '\0')) )
+      continue;
+    
+    err = nuke_dirent(len, what, d-&gt;d_name, st.st_dev);
+    if ( err ) {
+      closedir(dir);
+      return err;
+    }
+  }
+  
+  closedir(dir);
+
+  return 0;
+}
+
+static int nuke(const char *what)
+{
+  int rv;
+  int err = 0;
+
+  rv = unlink(what);
+  if ( rv &lt; 0 ) {
+    if ( errno == EISDIR ) {
+      /* It's a directory. */
+      err = nuke_dir(what);
+      if ( !err ) err = rmdir(what) ? errno : err;
+    } else {
+      err = errno;
+    }
+  }
+
+  if ( err ) {
+    errno = err;
+    die(what);
+  } else {
+    return 0;
+  }
+}
+
+
+static void __attribute__((noreturn)) usage(void)
+{
+  fprintf(stderr, &quot;Usage: exec %s [-c consoledev] /real-root /sbin/init [args]\n&quot;, program);
+  exit(1);
+}
+
+
+int main(int argc, char *argv[])
+{
+  struct stat   rst, cst, ist;
+  struct statfs sfs;
+  int confd;
+  int optind = 1;
+
+  /* Command-line options and defaults */
+  const char *console = &quot;/dev/console&quot;;
+  const char *realroot;
+  const char *init;
+  char **initargs;
+
+  /* First, parse the command line */
+  program = argv[0];
+
+  if (argc &gt; 1) {
+      if (!strcmp(argv[1],&quot;-c&quot;)) {
+	  if (argc &gt;= 3) {
+	      console = argv[2];
+	      optind += 2;
+	  } else {
+	      usage();
+	  }
+      }
+  }
+
+  if ( argc-optind &lt; 2 )
+    usage();
+
+  realroot = argv[optind];
+  init     = argv[optind+1];
+  initargs = argv+optind+1;
+
+  /* First, change to the new root directory */
+  if ( chdir(realroot) )
+    die(&quot;chdir to new root&quot;);
+
+  /* This is a potentially highly destructive program.  Take some
+     extra precautions. */
+
+  /* Make sure the current directory is not on the same filesystem
+     as the root directory */
+  if ( stat(&quot;/&quot;, &amp;rst) || stat(&quot;.&quot;, &amp;cst) )
+    die(&quot;stat&quot;);
+
+  if ( rst.st_dev == cst.st_dev )
+    die(&quot;current directory on the same filesystem as the root&quot;);
+  
+  /* The initramfs should have /init */
+  if ( stat(&quot;/init&quot;, &amp;ist) || !S_ISREG(ist.st_mode) )
+    die(&quot;can't find /init on initramfs&quot;);
+
+  /* Make sure we're on a ramfs */
+  if ( statfs(&quot;/&quot;, &amp;sfs) )
+    die(&quot;statfs /&quot;);
+  if ( sfs.f_type != RAMFS_MAGIC &amp;&amp; sfs.f_type != TMPFS_MAGIC )
+    die(&quot;rootfs not a ramfs or tmpfs&quot;);
+
+  /* Okay, I think we should be safe... */
+
+  /* Delete rootfs contents */
+  if ( nuke_dir(&quot;/&quot;) )
+    die(&quot;nuking initramfs contents&quot;);
+
+  /* Overmount the root */
+  if ( mount(&quot;.&quot;, &quot;/&quot;, NULL, MS_MOVE, NULL) )
+    die(&quot;overmounting root&quot;);
+  
+  /* chroot, chdir */
+  if ( chroot(&quot;.&quot;) || chdir(&quot;/&quot;) )
+    die(&quot;chroot&quot;);
+
+  /* Open /dev/console */
+  if ( (confd = open(console, O_RDWR)) &lt; 0 )
+    die(&quot;opening console&quot;);
+  dup2(confd, 0);
+  dup2(confd, 1);
+  dup2(confd, 2);
+  close(confd);
+
+  /* Spawn init */
+  execv(init, initargs);
+  die(init);			/* Failed to spawn init */
+}
diff --git a/tools/setctsid/Makefile b/tools/setctsid/Makefile
new file mode 100644
index 0000000..32665a1
--- /dev/null
+++ b/tools/setctsid/Makefile
@@ -0,0 +1,10 @@
+OBJ = setctsid
+CC  = gcc -Wall -fpic -O2
+
+all:${OBJ}
+
+setctsid: setctsid.c
+	${CC} ${CFLAGS} setctsid.c -o setctsid
+
+clean:
+	rm -f setctsid
diff --git a/tools/setctsid/setctsid.c b/tools/setctsid/setctsid.c
new file mode 100644
index 0000000..f45d780
--- /dev/null
+++ b/tools/setctsid/setctsid.c
@@ -0,0 +1,90 @@
+/*
+ * setctsid.c -- execute a command in a new session and with
+ *		 new controlling terminal
+ *
+ * derviated from: setctsid.c of Rick Sladkey &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/kiwi-devel">jrs at world.std.com</A>&gt;
+ *		   In the public domain.
+ *
+ * Changed by Werner Fink, &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/kiwi-devel">werner at suse.de</A>&gt;
+ */
+
+#include &lt;stdio.h&gt;
+#include &lt;unistd.h&gt;
+#include &lt;stdlib.h&gt;
+#include &lt;sys/types.h&gt;
+#include &lt;sys/stat.h&gt;
+#include &lt;sys/ioctl.h&gt;
+#include &lt;sys/syslog.h&gt;
+#include &lt;sys/stat.h&gt;
+#include &lt;fcntl.h&gt;
+#include &lt;errno.h&gt;
+#include &lt;string.h&gt;
+
+#define xerror(n)	do { int error = errno; \
+			     if (!isatty(fileno(stderr))) \
+			       syslog(LOG_ERR, n &quot;: %s&quot;, strerror(error)); \
+			     else \
+			       errno = error, perror(n); \
+			} while (0)
+
+int main(int argc, char *argv[])
+{
+	int fd;
+	struct stat buf;
+	int dofork = 0;
+
+        if (argc &gt; 1 &amp;&amp; !strcmp(argv[1], &quot;-f&quot;)) {
+		dofork = 1;
+		argc--;
+		argv++;
+	}
+	if (argc &lt; 3) {
+		fprintf(stderr, &quot;usage: setctsid [-f] tty program [arg ...]\n&quot;);
+		exit(1);
+	}
+	if (stat(argv[1], &amp;buf) &lt; 0) {
+		perror(argv[1]);
+		exit(1);
+	}
+	if (!(S_ISCHR(buf.st_mode))) {
+		/* why do we care? */
+		fprintf(stderr, &quot;%s: not a character device\n&quot;, argv[1]);
+		exit(1);
+	}
+	if (dofork) {
+		switch (fork()) {
+		case -1:
+			perror(&quot;fork&quot;);
+			exit(1);
+		case 0:
+			break;
+		default:
+			exit(0);
+		}
+	}
+	if (setsid() &lt; 0) {
+		perror(&quot;setsid&quot;);
+		exit(1);
+	}
+	if ((fd = open(argv[1], O_RDWR, 0)) &lt; 0) {
+		xerror(&quot;open&quot;);
+		exit(1);
+	}
+	dup2(fd, fileno(stdin));
+	dup2(fd, fileno(stdout));
+	dup2(fd, fileno(stderr));
+
+	if (isatty(fd)) {
+		if (ioctl(fileno(stdin), TIOCSCTTY, argv[1]) &lt; 0) {
+			xerror(&quot;ioctl&quot;);
+			exit(1);
+		}
+	}
+
+	if (fd &gt; fileno(stderr))
+		close(fd);
+
+	execvp(argv[2], argv + 2);
+	xerror(&quot;execvp&quot;);
+	exit(1);
+}


hooks/post-receive
-- 
Project kiwi at BerliOS

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002033.html">[Kiwi-devel] [Git]Project kiwi at BerliOS branch, RHEL,	updated. 9392434acac8c77031fc3cda73d452734bfdfbd5
</A></li>
	<LI>Next message: <A HREF="002034.html">[Kiwi-devel] [Git]Project kiwi at BerliOS branch, RHEL,	deleted. 9392434acac8c77031fc3cda73d452734bfdfbd5
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2035">[ date ]</a>
              <a href="thread.html#2035">[ thread ]</a>
              <a href="subject.html#2035">[ subject ]</a>
              <a href="author.html#2035">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/kiwi-devel">More information about the Kiwi-devel
mailing list</a><br>
</body></html>

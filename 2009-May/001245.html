<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Kiwi-devel] [Git]Project kiwi at BerliOS branch, master,	updated. 28d61dadb98b98dcbd3a95b3b03def2248fb46bb
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/kiwi-devel/2009-May/index.html" >
   <LINK REL="made" HREF="mailto:kiwi-devel%40lists.berlios.de?Subject=Re%3A%20%5BKiwi-devel%5D%20%5BGit%5DProject%20kiwi%20at%20BerliOS%20branch%2C%20master%2C%0A%09updated.%2028d61dadb98b98dcbd3a95b3b03def2248fb46bb&In-Reply-To=%3C200905190930.n4J9UG4e004406%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001244.html">
   <LINK REL="Next"  HREF="001246.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Kiwi-devel] [Git]Project kiwi at BerliOS branch, master,	updated. 28d61dadb98b98dcbd3a95b3b03def2248fb46bb</H1>
    <B>marcus_schaefer at BerliOS</B> 
    <A HREF="mailto:kiwi-devel%40lists.berlios.de?Subject=Re%3A%20%5BKiwi-devel%5D%20%5BGit%5DProject%20kiwi%20at%20BerliOS%20branch%2C%20master%2C%0A%09updated.%2028d61dadb98b98dcbd3a95b3b03def2248fb46bb&In-Reply-To=%3C200905190930.n4J9UG4e004406%40sheep.berlios.de%3E"
       TITLE="[Kiwi-devel] [Git]Project kiwi at BerliOS branch, master,	updated. 28d61dadb98b98dcbd3a95b3b03def2248fb46bb">marcus_schaefer at mail.berlios.de
       </A><BR>
    <I>Tue May 19 11:30:16 CEST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="001244.html">[Kiwi-devel] [Git]Project kiwi at BerliOS branch, master,	updated. 0aab899814e998fdaca0dbfc12a1c05f0651717e
</A></li>
        <LI>Next message: <A HREF="001246.html">[Kiwi-devel] [Git]Project kiwi at BerliOS branch, master,	updated. 9af71f98d5744389ddbca69c8ce41ab4d11f944d
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1245">[ date ]</a>
              <a href="thread.html#1245">[ thread ]</a>
              <a href="subject.html#1245">[ subject ]</a>
              <a href="author.html#1245">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>This is an automated email from the git hooks/post-receive script. It was
generated because a ref change was pushed to the repository containing
the project &quot;Project kiwi at BerliOS&quot;.

The branch, master has been updated
       via  28d61dadb98b98dcbd3a95b3b03def2248fb46bb (commit)
      from  0aab899814e998fdaca0dbfc12a1c05f0651717e (commit)

Those revisions listed above that are new to this repository have
not appeared on any other notification email; so we list those
revisions in full, below.

- Log -----------------------------------------------------------------
commit 28d61dadb98b98dcbd3a95b3b03def2248fb46bb
Author: Marcus Sch&#195;&#164;fer &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/kiwi-devel">ms at novell.com</A>&gt;
Date:   Tue May 19 11:29:11 2009 +0200

    - update documentation for bootinclude/bootdelete and boot-theme
      setup
    
    - implement &lt;boot-theme&gt; setup

-----------------------------------------------------------------------

Summary of changes:
diff --git a/doc/LaTex/Revision.txt b/doc/LaTex/Revision.txt
index 215881b..a84067e 100644
--- a/doc/LaTex/Revision.txt
+++ b/doc/LaTex/Revision.txt
@@ -1 +1 @@
-3.51
\ No newline at end of file
+3.52
\ No newline at end of file
diff --git a/doc/LaTex/description.tex b/doc/LaTex/description.tex
index 247cbd6..4f96d36 100644
--- a/doc/LaTex/description.tex
+++ b/doc/LaTex/description.tex
@@ -356,6 +356,13 @@ attributes:
       Specifies the name of the locale to use, which defines the
       contents of the RC\_LANG system environment variable in
       /etc/sysconfig/language
+\item \textbf{boot-theme}\\
+      Specifies the name of the gfxboot and bootsplash theme to use
+      when kiwi creates these files. kiwi is only able to do this file
+      creation if the gfxboot devel data is installed. If only a branding
+      package is installed the value for boot-theme has no effect
+      because the installed branding package decides what theme will
+      be used
 \item \textbf{defaultdestination}\\
       Used if the --destdir option is not specified when calling KIWI
 \item \textbf{defaultroot}\\
@@ -537,6 +544,8 @@ the latest packages available.
 \hspace*{2.5cm}\textit{patternPackageType=&quot;type&quot;}\\
 \hspace*{1cm}&lt;package name=&quot;name&quot; arch=&quot;arch&quot;/&gt;\\
 \hspace*{1cm}&lt;package name=&quot;name&quot; replaces=&quot;name&quot;/&gt;\\
+\hspace*{1cm}&lt;package name=&quot;name&quot;\\
+\hspace*{2.5cm}bootinclude=&quot;yes&quot; bootdelete=&quot;yes&quot;/&gt;\\
 \hspace*{1cm}&lt;package .../&gt;\\
 \hspace*{1cm}&lt;opensusePattern name=&quot;name&quot;/&gt;\\
 \hspace*{1cm}&lt;opensusePattern .../&gt;\\
@@ -581,6 +590,7 @@ rpm -e --nodeps --noscripts \
       needs support for VMware- or generic based full virtualization.
 \end{itemize}
 
+\subsubsection{Using patterns}
 Using a pattern name enhances the package list with a number of
 additional packages belonging to this pattern. Support for patterns
 is SUSE-specific, and available with openSUSE 10.1 or later.
@@ -614,12 +624,14 @@ if it is required by a package dependency of another package in your list.
 The packagemanager will automatically pull in the package even if you have
 ignored it.
 
+\subsubsection{Architecture restrictions}
 To restrict a package to a specific architecture, use
 the \textbf{arch} attribute to specify a comma separated list of allowed
 architectures. Such a package is only installed if the build systems
 architecture (uname -m) matches one of the specified values of the arch
 attribute.
 
+\subsubsection{Image type specific packages}
 If a package is only required for a specific type of image
 and replaces another package you can use the \textbf{replaces} attribute
 to tell kiwi to install the package by replacing another one. For example
@@ -638,6 +650,19 @@ and in the type=xen section as
 The result is the xen kernel if you request a xen
 image and the default kernel in any other case.
 
+\subsubsection{Packages to become included into the boot image}
+The optional attributes \textbf{bootinclude} and \textbf{bootdelete}
+can be used to mark a package inside the system image description to
+become part of the corresponding boot image (initrd). This feature
+is most often used to specify bootsplash and/or graphics boot related
+packages inside the system image description but they are required
+to be part of the boot image as the data is used at boot time
+of the image. If the bootdelete attribute is specified along with
+the bootinclude attribute this means that the selected package
+will be marked as a \textit{to become deleted} package and is
+removed by the contents of the images.sh script of the corresponding
+boot image description
+
 \begin{Command}{12cm}
 &lt;vmwareconfig arch=&quot;arch&quot; memory=&quot;MB&quot;\\
 \hspace*{2.5cm}HWversion=&quot;number&quot;\\
diff --git a/doc/kiwi.pdf b/doc/kiwi.pdf
index e158e1c..9e690d4 100644
Binary files a/doc/kiwi.pdf and b/doc/kiwi.pdf differ
diff --git a/modules/KIWIConfig.sh b/modules/KIWIConfig.sh
index f63ab33..7671f21 100644
--- a/modules/KIWIConfig.sh
+++ b/modules/KIWIConfig.sh
@@ -989,6 +989,9 @@ function suseGFXBoot {
 	local theme=$1
 	local loader=$2
 	export PATH=$PATH:/usr/sbin
+	if [ ! -z &quot;$kiwi_boottheme&quot; ];then
+		theme=$kiwi_boottheme
+	fi
 	if [ -d /usr/share/gfxboot ];then
 		#======================================
 		# create boot theme with gfxboot-devel
diff --git a/modules/KIWIImage.pm b/modules/KIWIImage.pm
index 9a56a10..a64d188 100644
--- a/modules/KIWIImage.pm
+++ b/modules/KIWIImage.pm
@@ -522,9 +522,10 @@ sub createImageEC2 {
 	$main::ForeignRepo{&quot;xmlnode&quot;} = $xml -&gt; getForeignNodeList();
 	$main::ForeignRepo{&quot;xmlpacnode&quot;} = $xml -&gt; getForeignPackageList();
 	$main::ForeignRepo{&quot;packagemanager&quot;} = $xml -&gt; getPackageManager();
-	$main::ForeignRepo{&quot;locale&quot;}  = $xml -&gt; getLocale();
-	$main::ForeignRepo{&quot;prepare&quot;} = $main::Prepare;
-	$main::ForeignRepo{&quot;create&quot;}  = $main::Create;
+	$main::ForeignRepo{&quot;locale&quot;}    = $xml -&gt; getLocale();
+	$main::ForeignRepo{&quot;boot-theme&quot;}= $xml -&gt; getBootTheme();
+	$main::ForeignRepo{&quot;prepare&quot;}   = $main::Prepare;
+	$main::ForeignRepo{&quot;create&quot;}    = $main::Create;
 	$main::Create = $main::RootTree;
 	$xml = new KIWIXML ( $kiwi,$main::Prepare );
 	if (! defined $xml) {
@@ -953,9 +954,10 @@ sub createImageUSB {
 	$main::ForeignRepo{&quot;oem-sap-install&quot;}= $xml -&gt; getOEMSAPInstall();
 	$main::ForeignRepo{&quot;oem-reboot&quot;}     = $xml -&gt; getOEMReboot();
 	$main::ForeignRepo{&quot;oem-recovery&quot;}   = $xml -&gt; getOEMRecovery();
-	$main::ForeignRepo{&quot;locale&quot;}  = $xml -&gt; getLocale();
-	$main::ForeignRepo{&quot;prepare&quot;} = $main::Prepare;
-	$main::ForeignRepo{&quot;create&quot;}  = $main::Create;
+	$main::ForeignRepo{&quot;locale&quot;}    = $xml -&gt; getLocale();
+	$main::ForeignRepo{&quot;boot-theme&quot;}= $xml -&gt; getBootTheme();
+	$main::ForeignRepo{&quot;prepare&quot;}   = $main::Prepare;
+	$main::ForeignRepo{&quot;create&quot;}    = $main::Create;
 	$main::Compress = &quot;no&quot;;
 	$main::Create   = $main::RootTree;
 	my $imageTypeSaved = $main::SetImageType;
@@ -1615,9 +1617,10 @@ sub createImageLiveCD {
 	$main::ForeignRepo{&quot;xmlnode&quot;} = $xml -&gt; getForeignNodeList();
 	$main::ForeignRepo{&quot;xmlpacnode&quot;} = $xml -&gt; getForeignPackageList();
 	$main::ForeignRepo{&quot;packagemanager&quot;} = $xml -&gt; getPackageManager();
-	$main::ForeignRepo{&quot;locale&quot;}  = $xml -&gt; getLocale();
-	$main::ForeignRepo{&quot;prepare&quot;} = $main::Prepare;
-	$main::ForeignRepo{&quot;create&quot;}  = $main::Create;
+	$main::ForeignRepo{&quot;locale&quot;}    = $xml -&gt; getLocale();
+	$main::ForeignRepo{&quot;boot-theme&quot;}= $xml -&gt; getBootTheme();
+	$main::ForeignRepo{&quot;prepare&quot;}   = $main::Prepare;
+	$main::ForeignRepo{&quot;create&quot;}    = $main::Create;
 	$main::Create = $main::RootTree;
 	$xml = new KIWIXML ( $kiwi,$main::Prepare );
 	if (! defined $xml) {
@@ -2660,9 +2663,10 @@ sub createImageSplit {
 	$main::ForeignRepo{&quot;oem-sap-install&quot;}= $xml -&gt; getOEMSAPInstall();
 	$main::ForeignRepo{&quot;oem-reboot&quot;}     = $xml -&gt; getOEMReboot();
 	$main::ForeignRepo{&quot;oem-recovery&quot;}   = $xml -&gt; getOEMRecovery();
-	$main::ForeignRepo{&quot;locale&quot;}  = $xml -&gt; getLocale();
-	$main::ForeignRepo{&quot;prepare&quot;} = $main::Prepare;
-	$main::ForeignRepo{&quot;create&quot;}  = $main::Create;
+	$main::ForeignRepo{&quot;locale&quot;}    = $xml -&gt; getLocale();
+	$main::ForeignRepo{&quot;boot-theme&quot;}= $xml -&gt; getBootTheme();
+	$main::ForeignRepo{&quot;prepare&quot;}   = $main::Prepare;
+	$main::ForeignRepo{&quot;create&quot;}    = $main::Create;
 	$main::Create = $main::RootTree;
 	$xml = new KIWIXML ( $kiwi,$main::Prepare );
 	if (! defined $xml) {
diff --git a/modules/KIWIScheme.rnc b/modules/KIWIScheme.rnc
index c5811ba..bb8fc80 100644
--- a/modules/KIWIScheme.rnc
+++ b/modules/KIWIScheme.rnc
@@ -454,6 +454,24 @@ div { # locale
 }
 
 #==========================================
+# common element &lt;boot-theme&gt;
+#
+div { # boot-theme
+	k.boot-theme.attlist = empty
+	k.boot-theme =
+		## Image bootsplash/gfxboot theme setup.
+		[
+		db:para [
+			&quot;The value will be part used in suseGFXBoot&quot;
+		]
+		]
+		element boot-theme {
+			k.boot-theme.attlist,
+			text
+		}
+}
+
+#==========================================
 # common element &lt;metadata&gt;
 #
 div {
@@ -1872,6 +1890,7 @@ div {
 			k.keytable? &amp;
 			k.timezone? &amp;
 			k.locale? &amp;
+			k.boot-theme? &amp;
 			k.defaultdestination? &amp;
 			k.defaultroot? &amp;
 			k.defaultbaseroot?
diff --git a/modules/KIWIScheme.rng b/modules/KIWIScheme.rng
index 0d14711..0eaf44a 100644
--- a/modules/KIWIScheme.rng
+++ b/modules/KIWIScheme.rng
@@ -633,6 +633,25 @@ specifies the where to find the boot kernel.&lt;/db:para&gt;
   &lt;/div&gt;
   &lt;!--
     ==========================================
+    common element &lt;boot-theme&gt;
+    
+  --&gt;
+  &lt;div&gt;
+    &lt;!-- boot-theme --&gt;
+    &lt;define name=&quot;k.boot-theme.attlist&quot;&gt;
+      &lt;empty/&gt;
+    &lt;/define&gt;
+    &lt;define name=&quot;k.boot-theme&quot;&gt;
+      &lt;element name=&quot;boot-theme&quot;&gt;
+        &lt;a:documentation&gt;Image bootsplash/gfxboot theme setup.&lt;/a:documentation&gt;
+        &lt;db:para&gt;The value will be part used in suseGFXBoot&lt;/db:para&gt;
+        &lt;ref name=&quot;k.boot-theme.attlist&quot;/&gt;
+        &lt;text/&gt;
+      &lt;/element&gt;
+    &lt;/define&gt;
+  &lt;/div&gt;
+  &lt;!--
+    ==========================================
     common element &lt;metadata&gt;
     
   --&gt;
@@ -2734,6 +2753,9 @@ and also depends of the selected image output type.&lt;/db:para&gt;
             &lt;ref name=&quot;k.locale&quot;/&gt;
           &lt;/optional&gt;
           &lt;optional&gt;
+            &lt;ref name=&quot;k.boot-theme&quot;/&gt;
+          &lt;/optional&gt;
+          &lt;optional&gt;
             &lt;ref name=&quot;k.defaultdestination&quot;/&gt;
           &lt;/optional&gt;
           &lt;optional&gt;
diff --git a/modules/KIWIXML.pm b/modules/KIWIXML.pm
index 4357cbe..d0fccd5 100644
--- a/modules/KIWIXML.pm
+++ b/modules/KIWIXML.pm
@@ -297,6 +297,9 @@ sub new {
 		if (defined $foreignRepo-&gt;{&quot;locale&quot;}) {
 			$this -&gt; setForeignOptionsElement (&quot;locale&quot;);
 		}
+		if (defined $foreignRepo-&gt;{&quot;boot-theme&quot;}) {
+			$this -&gt; setForeignOptionsElement (&quot;boot-theme&quot;);
+		}
 		if (defined $foreignRepo-&gt;{&quot;packagemanager&quot;}) {
 			$this -&gt; setForeignOptionsElement (&quot;packagemanager&quot;);
 		}
@@ -1347,6 +1350,22 @@ sub getLocale {
 }
 
 #==========================================
+# getBootTheme
+#------------------------------------------
+sub getBootTheme {
+	# ...
+	# Obtain the boot-theme value or return undef
+	# ---
+	my $this = shift;
+	my $node = $this -&gt; getPreferencesNodeByTagName (&quot;boot-theme&quot;);
+	my $theme= $node -&gt; getElementsByTagName (&quot;boot-theme&quot;);
+	if ((! defined $theme) || (&quot;$theme&quot; eq &quot;&quot;)) {
+		return undef;
+	}
+	return $theme;
+}
+
+#==========================================
 # getRPMCheckSignatures
 #------------------------------------------
 sub getRPMCheckSignatures {
@@ -2061,6 +2080,7 @@ sub getImageConfig {
 		my $keytable = $element -&gt; getElementsByTagName (&quot;keytable&quot;);
 		my $timezone = $element -&gt; getElementsByTagName (&quot;timezone&quot;);
 		my $language = $element -&gt; getElementsByTagName (&quot;locale&quot;);
+		my $boottheme= $element -&gt; getElementsByTagName (&quot;boot-theme&quot;);
 		my $oemswapMB= $element -&gt; getElementsByTagName (&quot;oem-swapsize&quot;);
 		my $oemrootMB= $element -&gt; getElementsByTagName (&quot;oem-systemsize&quot;);
 		my $oemswap  = $element -&gt; getElementsByTagName (&quot;oem-swap&quot;);
@@ -2079,6 +2099,9 @@ sub getImageConfig {
 		if (defined $language) {
 			$result{kiwi_language} = $language;
 		}
+		if (defined $boottheme) {
+			$result{kiwi_boottheme}= $boottheme;
+		}
 		if ((defined $oemswap) &amp;&amp; (&quot;$oemswap&quot; eq &quot;no&quot;)) {
 			$result{kiwi_oemswap} = &quot;no&quot;;
 		} elsif ((defined $oemswapMB) &amp;&amp; (&quot;$oemswapMB&quot; &gt; 0)) {
diff --git a/template/suse-11.1-JeOS/config.xml b/template/suse-11.1-JeOS/config.xml
index 86e690d..749714e 100644
--- a/template/suse-11.1-JeOS/config.xml
+++ b/template/suse-11.1-JeOS/config.xml
@@ -37,6 +37,8 @@
 		&lt;keytable&gt;us.map.gz&lt;/keytable&gt;
 		&lt;timezone&gt;Europe/Berlin&lt;/timezone&gt;
 		&lt;rpm-excludedocs&gt;true&lt;/rpm-excludedocs&gt;
+		&lt;!-- if you change this make sure gfxboot-devel is boot included --&gt;
+		&lt;boot-theme&gt;openSUSE&lt;/boot-theme&gt;
 	&lt;/preferences&gt;
 	&lt;!-- Users setup --&gt;
 	&lt;users group=&quot;root&quot;&gt;
diff --git a/template/suse-SLE10-JeOS/config.xml b/template/suse-SLE10-JeOS/config.xml
index 2092324..514415e 100644
--- a/template/suse-SLE10-JeOS/config.xml
+++ b/template/suse-SLE10-JeOS/config.xml
@@ -35,6 +35,8 @@
 		&lt;keytable&gt;us.map.gz&lt;/keytable&gt;
 		&lt;timezone&gt;Europe/Berlin&lt;/timezone&gt;
 		&lt;rpm-excludedocs&gt;true&lt;/rpm-excludedocs&gt;
+		&lt;!-- if you change this make sure gfxboot is boot included --&gt;
+		&lt;boot-theme&gt;SLES&lt;/boot-theme&gt;
 	&lt;/preferences&gt;
 	&lt;!-- Users setup --&gt;
 	&lt;users group=&quot;root&quot;&gt;
diff --git a/template/suse-SLE11-JeOS/config.xml b/template/suse-SLE11-JeOS/config.xml
index 8918cf0..eef1fd3 100644
--- a/template/suse-SLE11-JeOS/config.xml
+++ b/template/suse-SLE11-JeOS/config.xml
@@ -37,6 +37,8 @@
 		&lt;keytable&gt;us.map.gz&lt;/keytable&gt;
 		&lt;timezone&gt;Europe/Berlin&lt;/timezone&gt;
 		&lt;rpm-excludedocs&gt;true&lt;/rpm-excludedocs&gt;
+		&lt;!-- if you change this make sure gfxboot-devel is boot included --&gt;
+		&lt;boot-theme&gt;SLES&lt;/boot-theme&gt;
 	&lt;/preferences&gt;
 	&lt;!-- Users setup --&gt;
 	&lt;users group=&quot;root&quot;&gt;


hooks/post-receive
-- 
Project kiwi at BerliOS

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001244.html">[Kiwi-devel] [Git]Project kiwi at BerliOS branch, master,	updated. 0aab899814e998fdaca0dbfc12a1c05f0651717e
</A></li>
	<LI>Next message: <A HREF="001246.html">[Kiwi-devel] [Git]Project kiwi at BerliOS branch, master,	updated. 9af71f98d5744389ddbca69c8ce41ab4d11f944d
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1245">[ date ]</a>
              <a href="thread.html#1245">[ thread ]</a>
              <a href="subject.html#1245">[ subject ]</a>
              <a href="author.html#1245">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/kiwi-devel">More information about the Kiwi-devel
mailing list</a><br>
</body></html>

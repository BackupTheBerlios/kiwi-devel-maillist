<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Kiwi-devel] r1887 - in kiwi-head: . doc doc/LaTex rpm	system/boot/ix86/netboot system/boot/ix86/netboot/suse-10.3	system/boot/ix86/netboot/suse-11.0	system/boot/ix86/netboot/suse-11.1	system/boot/ix86/netboot/suse-SLED10	system/boot/ix86/netboot/suse-SLED11	system/boot/ix86/netboot/suse-SLES10	system/boot/ix86/netboot/suse-SLES11 system/boot/ppc/netboot
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/kiwi-devel/2009-February/index.html" >
   <LINK REL="made" HREF="mailto:kiwi-devel%40lists.berlios.de?Subject=Re%3A%20%5BKiwi-devel%5D%20r1887%20-%20in%20kiwi-head%3A%20.%20doc%20doc/LaTex%20rpm%0A%09system/boot/ix86/netboot%20system/boot/ix86/netboot/suse-10.3%0A%09system/boot/ix86/netboot/suse-11.0%0A%09system/boot/ix86/netboot/suse-11.1%0A%09system/boot/ix86/netboot/suse-SLED10%0A%09system/boot/ix86/netboot/suse-SLED11%0A%09system/boot/ix86/netboot/suse-SLES10%0A%09system/boot/ix86/netboot/suse-SLES11%20system/boot/ppc/netboot&In-Reply-To=%3C200902031021.n13ALOEK001942%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   
   <LINK REL="Next"  HREF="001007.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Kiwi-devel] r1887 - in kiwi-head: . doc doc/LaTex rpm	system/boot/ix86/netboot system/boot/ix86/netboot/suse-10.3	system/boot/ix86/netboot/suse-11.0	system/boot/ix86/netboot/suse-11.1	system/boot/ix86/netboot/suse-SLED10	system/boot/ix86/netboot/suse-SLED11	system/boot/ix86/netboot/suse-SLES10	system/boot/ix86/netboot/suse-SLES11 system/boot/ppc/netboot</H1>
    <B>marcus_schaefer at mail.berlios.de</B> 
    <A HREF="mailto:kiwi-devel%40lists.berlios.de?Subject=Re%3A%20%5BKiwi-devel%5D%20r1887%20-%20in%20kiwi-head%3A%20.%20doc%20doc/LaTex%20rpm%0A%09system/boot/ix86/netboot%20system/boot/ix86/netboot/suse-10.3%0A%09system/boot/ix86/netboot/suse-11.0%0A%09system/boot/ix86/netboot/suse-11.1%0A%09system/boot/ix86/netboot/suse-SLED10%0A%09system/boot/ix86/netboot/suse-SLED11%0A%09system/boot/ix86/netboot/suse-SLES10%0A%09system/boot/ix86/netboot/suse-SLES11%20system/boot/ppc/netboot&In-Reply-To=%3C200902031021.n13ALOEK001942%40sheep.berlios.de%3E"
       TITLE="[Kiwi-devel] r1887 - in kiwi-head: . doc doc/LaTex rpm	system/boot/ix86/netboot system/boot/ix86/netboot/suse-10.3	system/boot/ix86/netboot/suse-11.0	system/boot/ix86/netboot/suse-11.1	system/boot/ix86/netboot/suse-SLED10	system/boot/ix86/netboot/suse-SLED11	system/boot/ix86/netboot/suse-SLES10	system/boot/ix86/netboot/suse-SLES11 system/boot/ppc/netboot">marcus_schaefer at mail.berlios.de
       </A><BR>
    <I>Tue Feb  3 11:21:24 CET 2009</I>
    <P><UL>
        
        <LI>Next message: <A HREF="001007.html">[Kiwi-devel] Installing RPM with noscripts / changing uname -r
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1006">[ date ]</a>
              <a href="thread.html#1006">[ thread ]</a>
              <a href="subject.html#1006">[ subject ]</a>
              <a href="author.html#1006">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: marcus_schaefer
Date: 2009-02-03 11:20:59 +0100 (Tue, 03 Feb 2009)
New Revision: 1887

Modified:
   kiwi-head/doc/LaTex/Revision.txt
   kiwi-head/doc/LaTex/pxe.tex
   kiwi-head/doc/kiwi.pdf
   kiwi-head/kiwi.pl
   kiwi-head/rpm/kiwi.changes
   kiwi-head/rpm/kiwi.spec
   kiwi-head/system/boot/ix86/netboot/suse-10.3/config.xml
   kiwi-head/system/boot/ix86/netboot/suse-11.0/config.xml
   kiwi-head/system/boot/ix86/netboot/suse-11.1/config.xml
   kiwi-head/system/boot/ix86/netboot/suse-SLED10/config.xml
   kiwi-head/system/boot/ix86/netboot/suse-SLED11/config.xml
   kiwi-head/system/boot/ix86/netboot/suse-SLES10/config.xml
   kiwi-head/system/boot/ix86/netboot/suse-SLES11/config.xml
   kiwi-head/system/boot/ix86/netboot/suse-linuxrc
   kiwi-head/system/boot/ppc/netboot/suse-linuxrc
Log:

- v3.11
- implemented support for ATA over Ethernet (bnc #441832)



Modified: kiwi-head/doc/LaTex/Revision.txt
===================================================================
--- kiwi-head/doc/LaTex/Revision.txt	2009-01-29 16:48:12 UTC (rev 1886)
+++ kiwi-head/doc/LaTex/Revision.txt	2009-02-03 10:20:59 UTC (rev 1887)
@@ -1 +1 @@
-3.10
\ No newline at end of file
+3.11
\ No newline at end of file

Modified: kiwi-head/doc/LaTex/pxe.tex
===================================================================
--- kiwi-head/doc/LaTex/pxe.tex	2009-01-29 16:48:12 UTC (rev 1886)
+++ kiwi-head/doc/LaTex/pxe.tex	2009-02-03 10:20:59 UTC (rev 1887)
@@ -367,6 +367,35 @@
         NBD-Swap-Port-Number, and /dev/nb1 for the NBD-Swap-Device).
         The swap space over the network using a network block device
         is only established if the client has less than 48 MB of RAM.
+    \item \textbf{AOEROOT}\\
+        Mount the system image root filesystem remotely via AoE
+        (ATA over Ethernet). This means there is a server which
+        exports a block device representing the the root directory of
+        the system image via the AoE subsystem. The block device
+        could be a partition of a real or a virtual disk. In order to
+        use the AoE subsystem I recommend to install the \textit{aoetools}
+        and \textit{vblade} packages from here first:\\
+        \url{<A HREF="http://download.opensuse.org/repositories/system:/aoetools">http://download.opensuse.org/repositories/system:/aoetools</A>}\\
+        Once installed the following example shows how to export
+        the local /dev/sdb1 partition via AoE:
+\begin{verbatim}
+vbladed 0 1 eth0 /dev/sdb1
+\end{verbatim}
+        Some explanation about this command, each AoE device is identified
+        by a couple Major/Minor, with major between 0-65535 and minor
+        between 0-255. AoE is based just over Ethernet on the OSI models
+        so we need to indicate which ethernet card we'll use. 
+        In this example we export /dev/sdb1 with a major value of 0 and
+        minor of 1 on the eth0 interface. We are ready to use our partition
+        on the network! To be able to use the device kiwi needs the
+        information which AoE device contains the root filesystem. In
+        our example this is the device \textit{/dev/etherd/e0.1}.
+        According to this the AOEROOT variable must be set as follows:
+\begin{verbatim}
+AOEROOT=/dev/etherd/e0.1
+\end{verbatim}
+        kiwi is now able to mount and use the specified AoE device
+        as the remote root filesystem.
     \item \textbf{NFSROOT}\\
          Mount the system image root filesystem remotely via NFS
          (Network File System). This means there is a server which
@@ -553,3 +582,28 @@
 \end{verbatim}
 \end{Command}
 \end{itemize}
+
+\subsection{root tree over AoE}
+
+As an alternative for root over NBD it is also possible to
+let the client mount the root device via a special ATA over
+Ethernet network block device. Below find an example:
+
+\begin{itemize}
+\item Use the vbladed command to bind a block device to an
+      ethernet interface. The block device can be a disk
+      partition or a loop device (losetup) but not a directory 
+      like with NBD
+\item sample config.&lt;MAC&gt;
+
+\begin{Command}{12cm}
+\begin{verbatim}
+AOEROOT=/dev/etherd/e0.1
+\end{verbatim}
+\end{Command}
+
+      This would require the command
+      \textbf{''vbladed 0 1 eth0 blockdevice''}
+      to be called first
+\end{itemize}
+

Modified: kiwi-head/doc/kiwi.pdf
===================================================================
(Binary files differ)

Modified: kiwi-head/kiwi.pl
===================================================================
--- kiwi-head/kiwi.pl	2009-01-29 16:48:12 UTC (rev 1886)
+++ kiwi-head/kiwi.pl	2009-02-03 10:20:59 UTC (rev 1887)
@@ -44,7 +44,7 @@
 #============================================
 # Globals (Version)
 #--------------------------------------------
-our $Version       = &quot;3.10&quot;;
+our $Version       = &quot;3.11&quot;;
 our $Publisher     = &quot;SUSE LINUX Products GmbH&quot;;
 our $Preparer      = &quot;KIWI - <A HREF="http://kiwi.berlios.de">http://kiwi.berlios.de</A>&quot;;
 our $openSUSE      = &quot;<A HREF="http://download.opensuse.org">http://download.opensuse.org</A>&quot;;

Modified: kiwi-head/rpm/kiwi.changes
===================================================================
--- kiwi-head/rpm/kiwi.changes	2009-01-29 16:48:12 UTC (rev 1886)
+++ kiwi-head/rpm/kiwi.changes	2009-02-03 10:20:59 UTC (rev 1887)
@@ -1,4 +1,10 @@
 -------------------------------------------------------------------
+Tue Feb  3 11:01:53 CET 2009 - <A HREF="https://lists.berlios.de/mailman/listinfo/kiwi-devel">ms at suse.de</A>
+
+- v3.11
+- implemented support for ATA over Ethernet (bnc #441832)
+
+-------------------------------------------------------------------
 Tue Jan 27 12:27:02 CET 2009 - <A HREF="https://lists.berlios.de/mailman/listinfo/kiwi-devel">ms at suse.de</A>
 
 - v3.10

Modified: kiwi-head/rpm/kiwi.spec
===================================================================
--- kiwi-head/rpm/kiwi.spec	2009-01-29 16:48:12 UTC (rev 1886)
+++ kiwi-head/rpm/kiwi.spec	2009-02-03 10:20:59 UTC (rev 1887)
@@ -1,5 +1,5 @@
 #
-# spec file for package kiwi (Version 3.10
+# spec file for package kiwi (Version 3.11
 #
 # Copyright (c) 2008 SUSE LINUX Products GmbH, Nuernberg, Germany.
 # This file and all modifications and additions to the pristine
@@ -43,7 +43,7 @@
 Summary:        OpenSuSE - KIWI Image System
 Provides:       kiwi2 &lt;= 2.14
 Obsoletes:      kiwi2 &lt;= 2.14
-Version:        3.10
+Version:        3.11
 Release:        80
 Group:          System/Management
 License:        GPL v2 or later

Modified: kiwi-head/system/boot/ix86/netboot/suse-10.3/config.xml
===================================================================
--- kiwi-head/system/boot/ix86/netboot/suse-10.3/config.xml	2009-01-29 16:48:12 UTC (rev 1886)
+++ kiwi-head/system/boot/ix86/netboot/suse-10.3/config.xml	2009-02-03 10:20:59 UTC (rev 1887)
@@ -59,6 +59,7 @@
 		&lt;file name=&quot;drivers/message/fusion/*&quot;/&gt;
 		&lt;file name=&quot;drivers/net/*&quot;/&gt;
 		&lt;file name=&quot;drivers/block/nbd.ko&quot;/&gt;
+		&lt;file name=&quot;drivers/block/aoe/aoe.ko&quot;/&gt;
 		&lt;file name=&quot;drivers/parport/*&quot;/&gt;
 		&lt;file name=&quot;drivers/char/lp.ko&quot;/&gt;
 		&lt;!-- DRIVERS END DEFAULT AND XEN --&gt;
@@ -79,6 +80,7 @@
 		&lt;file name=&quot;fs/nfs_common/*&quot;/&gt;
 		&lt;file name=&quot;drivers/message/fusion/*&quot;/&gt;
 		&lt;file name=&quot;drivers/block/nbd.ko&quot;/&gt;
+		&lt;file name=&quot;drivers/block/aoe/aoe.ko&quot;/&gt;
 		&lt;file name=&quot;drivers/net/3c59x.ko&quot;/&gt;
 		&lt;file name=&quot;drivers/net/8139cp.ko&quot;/&gt;
 		&lt;file name=&quot;drivers/net/8139too.ko&quot;/&gt;

Modified: kiwi-head/system/boot/ix86/netboot/suse-11.0/config.xml
===================================================================
--- kiwi-head/system/boot/ix86/netboot/suse-11.0/config.xml	2009-01-29 16:48:12 UTC (rev 1886)
+++ kiwi-head/system/boot/ix86/netboot/suse-11.0/config.xml	2009-02-03 10:20:59 UTC (rev 1887)
@@ -60,6 +60,7 @@
 		&lt;file name=&quot;drivers/message/fusion/*&quot;/&gt;
 		&lt;file name=&quot;drivers/net/*&quot;/&gt;
 		&lt;file name=&quot;drivers/block/nbd.ko&quot;/&gt;
+		&lt;file name=&quot;drivers/block/aoe/aoe.ko&quot;/&gt;
 		&lt;file name=&quot;drivers/parport/*&quot;/&gt;
 		&lt;file name=&quot;drivers/char/lp.ko&quot;/&gt;
 		&lt;file name=&quot;drivers/acpi/dock.ko&quot;/&gt;
@@ -81,6 +82,7 @@
 		&lt;file name=&quot;fs/nfs_common/*&quot;/&gt;
 		&lt;file name=&quot;drivers/message/fusion/*&quot;/&gt;
 		&lt;file name=&quot;drivers/block/nbd.ko&quot;/&gt;
+		&lt;file name=&quot;drivers/block/aoe/aoe.ko&quot;/&gt;
 		&lt;file name=&quot;drivers/net/3c59x.ko&quot;/&gt;
 		&lt;file name=&quot;drivers/net/8139cp.ko&quot;/&gt;
 		&lt;file name=&quot;drivers/net/8139too.ko&quot;/&gt;

Modified: kiwi-head/system/boot/ix86/netboot/suse-11.1/config.xml
===================================================================
--- kiwi-head/system/boot/ix86/netboot/suse-11.1/config.xml	2009-01-29 16:48:12 UTC (rev 1886)
+++ kiwi-head/system/boot/ix86/netboot/suse-11.1/config.xml	2009-02-03 10:20:59 UTC (rev 1887)
@@ -58,6 +58,7 @@
 		&lt;file name=&quot;drivers/message/fusion/*&quot;/&gt;
 		&lt;file name=&quot;drivers/net/*&quot;/&gt;
 		&lt;file name=&quot;drivers/block/nbd.ko&quot;/&gt;
+		&lt;file name=&quot;drivers/block/aoe/aoe.ko&quot;/&gt;
 		&lt;file name=&quot;drivers/parport/*&quot;/&gt;
 		&lt;file name=&quot;drivers/char/lp.ko&quot;/&gt;
 		&lt;file name=&quot;drivers/acpi/dock.ko&quot;/&gt;
@@ -80,6 +81,7 @@
 		&lt;file name=&quot;fs/nfs_common/*&quot;/&gt;
 		&lt;file name=&quot;drivers/message/fusion/*&quot;/&gt;
 		&lt;file name=&quot;drivers/block/nbd.ko&quot;/&gt;
+		&lt;file name=&quot;drivers/block/aoe/aoe.ko&quot;/&gt;
 		&lt;file name=&quot;drivers/net/3c59x.ko&quot;/&gt;
 		&lt;file name=&quot;drivers/net/8139cp.ko&quot;/&gt;
 		&lt;file name=&quot;drivers/net/8139too.ko&quot;/&gt;

Modified: kiwi-head/system/boot/ix86/netboot/suse-SLED10/config.xml
===================================================================
--- kiwi-head/system/boot/ix86/netboot/suse-SLED10/config.xml	2009-01-29 16:48:12 UTC (rev 1886)
+++ kiwi-head/system/boot/ix86/netboot/suse-SLED10/config.xml	2009-02-03 10:20:59 UTC (rev 1887)
@@ -53,6 +53,7 @@
 		&lt;file name=&quot;drivers/message/fusion/*&quot;/&gt;
 		&lt;file name=&quot;drivers/net/*&quot;/&gt;
 		&lt;file name=&quot;drivers/block/nbd.ko&quot;/&gt;
+		&lt;file name=&quot;drivers/block/aoe/aoe.ko&quot;/&gt;
 	&lt;/drivers&gt;
 	&lt;repository type=&quot;yast2&quot; status=&quot;replaceable&quot;&gt;
 		&lt;source path=&quot;<A HREF="ftp://dist.suse.de/install/SLP/SLED-10-SP2-GMC/%arch/DVD1">ftp://dist.suse.de/install/SLP/SLED-10-SP2-GMC/%arch/DVD1</A>&quot;/&gt;

Modified: kiwi-head/system/boot/ix86/netboot/suse-SLED11/config.xml
===================================================================
--- kiwi-head/system/boot/ix86/netboot/suse-SLED11/config.xml	2009-01-29 16:48:12 UTC (rev 1886)
+++ kiwi-head/system/boot/ix86/netboot/suse-SLED11/config.xml	2009-02-03 10:20:59 UTC (rev 1887)
@@ -57,6 +57,7 @@
 		&lt;file name=&quot;drivers/message/fusion/*&quot;/&gt;
 		&lt;file name=&quot;drivers/net/*&quot;/&gt;
 		&lt;file name=&quot;drivers/block/nbd.ko&quot;/&gt;
+		&lt;file name=&quot;drivers/block/aoe/aoe.ko&quot;/&gt;
 		&lt;file name=&quot;drivers/parport/*&quot;/&gt;
 		&lt;file name=&quot;drivers/char/lp.ko&quot;/&gt;
 		&lt;file name=&quot;drivers/acpi/dock.ko&quot;/&gt;
@@ -77,6 +78,7 @@
 		&lt;file name=&quot;fs/nfs_common/*&quot;/&gt;
 		&lt;file name=&quot;drivers/message/fusion/*&quot;/&gt;
 		&lt;file name=&quot;drivers/block/nbd.ko&quot;/&gt;
+		&lt;file name=&quot;drivers/block/aoe/aoe.ko&quot;/&gt;
 		&lt;file name=&quot;drivers/net/3c59x.ko&quot;/&gt;
 		&lt;file name=&quot;drivers/net/8139cp.ko&quot;/&gt;
 		&lt;file name=&quot;drivers/net/8139too.ko&quot;/&gt;

Modified: kiwi-head/system/boot/ix86/netboot/suse-SLES10/config.xml
===================================================================
--- kiwi-head/system/boot/ix86/netboot/suse-SLES10/config.xml	2009-01-29 16:48:12 UTC (rev 1886)
+++ kiwi-head/system/boot/ix86/netboot/suse-SLES10/config.xml	2009-02-03 10:20:59 UTC (rev 1887)
@@ -53,6 +53,7 @@
 		&lt;file name=&quot;drivers/message/fusion/*&quot;/&gt;
 		&lt;file name=&quot;drivers/net/*&quot;/&gt;
 		&lt;file name=&quot;drivers/block/nbd.ko&quot;/&gt;
+		&lt;file name=&quot;drivers/block/aoe/aoe.ko&quot;/&gt;
 	&lt;/drivers&gt;
 	&lt;repository type=&quot;yast2&quot; status=&quot;replaceable&quot;&gt;
 		&lt;source path=&quot;<A HREF="ftp://dist.suse.de/install/SLP/SLES-10-SP2-GMC/%arch/DVD1">ftp://dist.suse.de/install/SLP/SLES-10-SP2-GMC/%arch/DVD1</A>&quot;/&gt;

Modified: kiwi-head/system/boot/ix86/netboot/suse-SLES11/config.xml
===================================================================
--- kiwi-head/system/boot/ix86/netboot/suse-SLES11/config.xml	2009-01-29 16:48:12 UTC (rev 1886)
+++ kiwi-head/system/boot/ix86/netboot/suse-SLES11/config.xml	2009-02-03 10:20:59 UTC (rev 1887)
@@ -57,6 +57,7 @@
 		&lt;file name=&quot;drivers/message/fusion/*&quot;/&gt;
 		&lt;file name=&quot;drivers/net/*&quot;/&gt;
 		&lt;file name=&quot;drivers/block/nbd.ko&quot;/&gt;
+		&lt;file name=&quot;drivers/block/aoe/aoe.ko&quot;/&gt;
 		&lt;file name=&quot;drivers/parport/*&quot;/&gt;
 		&lt;file name=&quot;drivers/char/lp.ko&quot;/&gt;
 		&lt;file name=&quot;drivers/acpi/dock.ko&quot;/&gt;
@@ -77,6 +78,7 @@
 		&lt;file name=&quot;fs/nfs_common/*&quot;/&gt;
 		&lt;file name=&quot;drivers/message/fusion/*&quot;/&gt;
 		&lt;file name=&quot;drivers/block/nbd.ko&quot;/&gt;
+		&lt;file name=&quot;drivers/block/aoe/aoe.ko&quot;/&gt;
 		&lt;file name=&quot;drivers/net/3c59x.ko&quot;/&gt;
 		&lt;file name=&quot;drivers/net/8139cp.ko&quot;/&gt;
 		&lt;file name=&quot;drivers/net/8139too.ko&quot;/&gt;

Modified: kiwi-head/system/boot/ix86/netboot/suse-linuxrc
===================================================================
--- kiwi-head/system/boot/ix86/netboot/suse-linuxrc	2009-01-29 16:48:12 UTC (rev 1886)
+++ kiwi-head/system/boot/ix86/netboot/suse-linuxrc	2009-02-03 10:20:59 UTC (rev 1887)
@@ -251,8 +251,13 @@
 #======================================
 # 11) Is this a diskful station
 #--------------------------------------
-if [ ! -z &quot;$PART&quot; ] &amp;&amp; [ -z &quot;$NFSROOT&quot; ] &amp;&amp; \
-   [ -z &quot;$NBDROOT&quot; ] &amp;&amp; [ $LOCAL_BOOT = &quot;no&quot; ];then
+if \
+	[ $LOCAL_BOOT = &quot;no&quot; ] &amp;&amp; \
+	[ ! -z &quot;$PART&quot; ]       &amp;&amp; \
+	[ -z &quot;$NFSROOT&quot; ]      &amp;&amp; \
+	[ -z &quot;$NBDROOT&quot; ]      &amp;&amp; \
+	[ -z &quot;$AOEROOT&quot; ]
+then
 	#======================================
 	# Check for possible extended partition
 	#--------------------------------------
@@ -327,7 +332,12 @@
 # 12) Download network client image
 #--------------------------------------
 runHook predownload
-if [ -z &quot;$NFSROOT&quot; ] &amp;&amp; [ -z &quot;$NBDROOT&quot; ] &amp;&amp; [ $LOCAL_BOOT = &quot;no&quot; ];then
+if \
+	[ $LOCAL_BOOT = &quot;no&quot; ] &amp;&amp; \
+	[ -z &quot;$NFSROOT&quot; ]      &amp;&amp; \
+	[ -z &quot;$NBDROOT&quot; ]      &amp;&amp; \
+	[ -z &quot;$AOEROOT&quot; ]
+then
 	count=0
 	IFS=&quot;,&quot; ; for i in $IMAGE;do
 		imageZipped=&quot;uncompressed&quot;
@@ -576,6 +586,39 @@
 		imageRootName=&quot;NBDRoot-System&quot;
 		systemIntegrity=&quot;clean&quot;
 	fi
+	#======================================
+	# 12.4) Check for AOE root
+	#--------------------------------------
+	if [ ! -z &quot;$AOEROOT&quot; ];then
+		if ! modprobe aoe;then
+			systemException &quot;Failed to load AoE module&quot; &quot;reboot&quot;
+		fi
+		waitForBlockDevice $AOEROOT
+		if [ ! -b $AOEROOT ];then
+			systemException &quot;Device $AOEROOT doesn't appear&quot; &quot;reboot&quot;
+		fi
+		# /.../
+		# check ram space, if we don't have more than 62MB
+		# we can't use Ata over Ethernet and reboot
+		# ----
+		min_ram=63488
+		real_ram=$(cat /proc/meminfo |grep MemTotal|tr -d &quot; [a-z][A-Z]:&quot;)
+		if [ ${real_ram} -lt ${min_ram} ];then
+			Echo &quot;AoE: memory is below required 62M&quot;
+			systemException &quot;Not enough ram&quot; &quot;reboot&quot;
+		fi
+		Echo &quot;Mounting AoE root system: $AOEROOT...&quot;
+		imageRootDevice=$AOEROOT
+		probeFileSystem $imageRootDevice
+		Echo &quot;Filesystem of remote root system is: $FSTYPE&quot;
+		if [ -z &quot;$COMBINED_IMAGE&quot; ];then
+			if isFSTypeReadOnly;then
+				setupUnionFS /dev/ram1 &quot;$imageRootDevice&quot; aufs
+			fi
+		fi
+		imageRootName=&quot;AOERoot-System&quot;
+		systemIntegrity=&quot;clean&quot;
+	fi
 fi
 runHook postdownload
 #======================================
@@ -664,7 +707,12 @@
 #======================================
 # 17) make initrd available on unionfs
 #--------------------------------------
-if [ $LOCAL_BOOT = &quot;no&quot; ] &amp;&amp; [ -z &quot;$NFSROOT&quot; ] &amp;&amp; [ -z &quot;$NBDROOT&quot; ];then
+if \
+	[ $LOCAL_BOOT = &quot;no&quot; ] &amp;&amp; \
+	[ -z &quot;$NFSROOT&quot; ]      &amp;&amp; \
+	[ -z &quot;$NBDROOT&quot; ]      &amp;&amp; \
+	[ -z &quot;$AOEROOT&quot; ]
+then
 	if test ! -z &quot;$UNIONFS_CONFIG&quot; &amp;&amp; test $systemIntegrity = &quot;clean&quot;;then
 		# /.../
 		# have to do this so that /boot gets copied to the
@@ -761,7 +809,12 @@
 #======================================
 # 20) send DHCP_RELEASE, reset cache
 #--------------------------------------
-if [ $LOCAL_BOOT = &quot;no&quot; ] &amp;&amp; [ -z &quot;$NFSROOT&quot; ] &amp;&amp; [ -z &quot;$NBDROOT&quot; ];then
+if \
+	[ $LOCAL_BOOT = &quot;no&quot; ] &amp;&amp; \
+	[ -z &quot;$NFSROOT&quot; ]      &amp;&amp; \
+	[ -z &quot;$NBDROOT&quot; ]      &amp;&amp; \
+	[ -z &quot;$AOEROOT&quot; ]
+then
 	dhcpcd -k
 fi
 

Modified: kiwi-head/system/boot/ppc/netboot/suse-linuxrc
===================================================================
--- kiwi-head/system/boot/ppc/netboot/suse-linuxrc	2009-01-29 16:48:12 UTC (rev 1886)
+++ kiwi-head/system/boot/ppc/netboot/suse-linuxrc	2009-02-03 10:20:59 UTC (rev 1887)
@@ -251,8 +251,13 @@
 #======================================
 # 11) Is this a diskful station
 #--------------------------------------
-if [ ! -z &quot;$PART&quot; ] &amp;&amp; [ -z &quot;$NFSROOT&quot; ] &amp;&amp; \
-   [ -z &quot;$NBDROOT&quot; ] &amp;&amp; [ $LOCAL_BOOT = &quot;no&quot; ];then
+if \
+	[ $LOCAL_BOOT = &quot;no&quot; ] &amp;&amp; \
+	[ ! -z &quot;$PART&quot; ]       &amp;&amp; \
+	[ -z &quot;$NFSROOT&quot; ]      &amp;&amp; \
+	[ -z &quot;$NBDROOT&quot; ]      &amp;&amp; \
+	[ -z &quot;$AOEROOT&quot; ]
+then
 	#======================================
 	# Check for possible extended partition
 	#--------------------------------------
@@ -327,7 +332,12 @@
 # 12) Download network client image
 #--------------------------------------
 runHook predownload
-if [ -z &quot;$NFSROOT&quot; ] &amp;&amp; [ -z &quot;$NBDROOT&quot; ] &amp;&amp; [ $LOCAL_BOOT = &quot;no&quot; ];then
+if \
+	[ $LOCAL_BOOT = &quot;no&quot; ] &amp;&amp; \
+	[ -z &quot;$NFSROOT&quot; ]      &amp;&amp; \
+	[ -z &quot;$NBDROOT&quot; ]      &amp;&amp; \
+	[ -z &quot;$AOEROOT&quot; ]
+then
 	count=0
 	IFS=&quot;,&quot; ; for i in $IMAGE;do
 		imageZipped=&quot;uncompressed&quot;
@@ -576,6 +586,39 @@
 		imageRootName=&quot;NBDRoot-System&quot;
 		systemIntegrity=&quot;clean&quot;
 	fi
+	#======================================
+	# 12.4) Check for AOE root
+	#--------------------------------------
+	if [ ! -z &quot;$AOEROOT&quot; ];then
+		if ! modprobe aoe;then
+			systemException &quot;Failed to load AoE module&quot; &quot;reboot&quot;
+		fi
+		waitForBlockDevice $AOEROOT
+		if [ ! -b $AOEROOT ];then
+			systemException &quot;Device $AOEROOT doesn't appear&quot; &quot;reboot&quot;
+		fi
+		# /.../
+		# check ram space, if we don't have more than 62MB
+		# we can't use Ata over Ethernet and reboot
+		# ----
+		min_ram=63488
+		real_ram=$(cat /proc/meminfo |grep MemTotal|tr -d &quot; [a-z][A-Z]:&quot;)
+		if [ ${real_ram} -lt ${min_ram} ];then
+			Echo &quot;AoE: memory is below required 62M&quot;
+			systemException &quot;Not enough ram&quot; &quot;reboot&quot;
+		fi
+		Echo &quot;Mounting AoE root system: $AOEROOT...&quot;
+		imageRootDevice=$AOEROOT
+		probeFileSystem $imageRootDevice
+		Echo &quot;Filesystem of remote root system is: $FSTYPE&quot;
+		if [ -z &quot;$COMBINED_IMAGE&quot; ];then
+			if isFSTypeReadOnly;then
+				setupUnionFS /dev/ram1 &quot;$imageRootDevice&quot; aufs
+			fi
+		fi
+		imageRootName=&quot;AOERoot-System&quot;
+		systemIntegrity=&quot;clean&quot;
+	fi
 fi
 runHook postdownload
 #======================================
@@ -664,7 +707,12 @@
 #======================================
 # 17) make initrd available on unionfs
 #--------------------------------------
-if [ $LOCAL_BOOT = &quot;no&quot; ] &amp;&amp; [ -z &quot;$NFSROOT&quot; ] &amp;&amp; [ -z &quot;$NBDROOT&quot; ];then
+if \
+	[ $LOCAL_BOOT = &quot;no&quot; ] &amp;&amp; \
+	[ -z &quot;$NFSROOT&quot; ]      &amp;&amp; \
+	[ -z &quot;$NBDROOT&quot; ]      &amp;&amp; \
+	[ -z &quot;$AOEROOT&quot; ]
+then
 	if test ! -z &quot;$UNIONFS_CONFIG&quot; &amp;&amp; test $systemIntegrity = &quot;clean&quot;;then
 		# /.../
 		# have to do this so that /boot gets copied to the
@@ -761,7 +809,12 @@
 #======================================
 # 20) send DHCP_RELEASE, reset cache
 #--------------------------------------
-if [ $LOCAL_BOOT = &quot;no&quot; ] &amp;&amp; [ -z &quot;$NFSROOT&quot; ] &amp;&amp; [ -z &quot;$NBDROOT&quot; ];then
+if \
+	[ $LOCAL_BOOT = &quot;no&quot; ] &amp;&amp; \
+	[ -z &quot;$NFSROOT&quot; ]      &amp;&amp; \
+	[ -z &quot;$NBDROOT&quot; ]      &amp;&amp; \
+	[ -z &quot;$AOEROOT&quot; ]
+then
 	dhcpcd -k
 fi
 


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	
	<LI>Next message: <A HREF="001007.html">[Kiwi-devel] Installing RPM with noscripts / changing uname -r
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1006">[ date ]</a>
              <a href="thread.html#1006">[ thread ]</a>
              <a href="subject.html#1006">[ subject ]</a>
              <a href="author.html#1006">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/kiwi-devel">More information about the Kiwi-devel
mailing list</a><br>
</body></html>

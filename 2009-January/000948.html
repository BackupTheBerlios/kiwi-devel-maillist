<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Kiwi-devel] r1832 - in kiwi-head: . modules rpm	system/boot/ix86/oemboot system/boot/ix86/usbboot	system/boot/ix86/usbboot/suse-10.3	system/boot/ix86/usbboot/suse-11.0	system/boot/ix86/usbboot/suse-11.1	system/boot/ix86/usbboot/suse-SLED10	system/boot/ix86/usbboot/suse-SLED11	system/boot/ix86/usbboot/suse-SLES10	system/boot/ix86/usbboot/suse-SLES11 system/boot/ix86/vmxboot
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/kiwi-devel/2009-January/index.html" >
   <LINK REL="made" HREF="mailto:kiwi-devel%40lists.berlios.de?Subject=Re%3A%20%5BKiwi-devel%5D%20r1832%20-%20in%20kiwi-head%3A%20.%20modules%20rpm%0A%09system/boot/ix86/oemboot%20system/boot/ix86/usbboot%0A%09system/boot/ix86/usbboot/suse-10.3%0A%09system/boot/ix86/usbboot/suse-11.0%0A%09system/boot/ix86/usbboot/suse-11.1%0A%09system/boot/ix86/usbboot/suse-SLED10%0A%09system/boot/ix86/usbboot/suse-SLED11%0A%09system/boot/ix86/usbboot/suse-SLES10%0A%09system/boot/ix86/usbboot/suse-SLES11%20system/boot/ix86/vmxboot&In-Reply-To=%3C200901081728.n08HScqp021913%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000947.html">
   <LINK REL="Next"  HREF="000949.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Kiwi-devel] r1832 - in kiwi-head: . modules rpm	system/boot/ix86/oemboot system/boot/ix86/usbboot	system/boot/ix86/usbboot/suse-10.3	system/boot/ix86/usbboot/suse-11.0	system/boot/ix86/usbboot/suse-11.1	system/boot/ix86/usbboot/suse-SLED10	system/boot/ix86/usbboot/suse-SLED11	system/boot/ix86/usbboot/suse-SLES10	system/boot/ix86/usbboot/suse-SLES11 system/boot/ix86/vmxboot</H1>
    <B>marcus_schaefer at mail.berlios.de</B> 
    <A HREF="mailto:kiwi-devel%40lists.berlios.de?Subject=Re%3A%20%5BKiwi-devel%5D%20r1832%20-%20in%20kiwi-head%3A%20.%20modules%20rpm%0A%09system/boot/ix86/oemboot%20system/boot/ix86/usbboot%0A%09system/boot/ix86/usbboot/suse-10.3%0A%09system/boot/ix86/usbboot/suse-11.0%0A%09system/boot/ix86/usbboot/suse-11.1%0A%09system/boot/ix86/usbboot/suse-SLED10%0A%09system/boot/ix86/usbboot/suse-SLED11%0A%09system/boot/ix86/usbboot/suse-SLES10%0A%09system/boot/ix86/usbboot/suse-SLES11%20system/boot/ix86/vmxboot&In-Reply-To=%3C200901081728.n08HScqp021913%40sheep.berlios.de%3E"
       TITLE="[Kiwi-devel] r1832 - in kiwi-head: . modules rpm	system/boot/ix86/oemboot system/boot/ix86/usbboot	system/boot/ix86/usbboot/suse-10.3	system/boot/ix86/usbboot/suse-11.0	system/boot/ix86/usbboot/suse-11.1	system/boot/ix86/usbboot/suse-SLED10	system/boot/ix86/usbboot/suse-SLED11	system/boot/ix86/usbboot/suse-SLES10	system/boot/ix86/usbboot/suse-SLES11 system/boot/ix86/vmxboot">marcus_schaefer at mail.berlios.de
       </A><BR>
    <I>Thu Jan  8 18:28:38 CET 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="000947.html">[Kiwi-devel] r1831 - in kiwi-head: . doc/examples/suse-10.3/suse-oem-preload doc/examples/suse-11.0/suse-oem-preload doc/examples/suse-11.1/suse-oem-preload modules rpm system/boot/ix86/oemboot system/boot/ix86/oemboot/suse-10.3 system/boot/ix86/oemboot/suse-10.3/root system/boot/ix86/oemboot/suse-11.0 system/boot/ix86/oemboot/suse-11.0/root system/boot/ix86/oemboot/suse-11.1 system/boot/ix86/oemboot/suse-11.1/root system/boot/ix86/oemboot/suse-SLED10 system/boot/ix86/oemboot/suse-SLED10/root system/boot/ix86/oemboot/suse-SLED11 system/boot/ix86/oemboot/suse-SLED11/root system/boot/ix86/oemboot/suse-SLES10 system/boot/ix86/oemboot/suse-SLES10/root system/boot/ix86/oemboot/suse-SLES11 system/boot/ix86/oemboot/suse-SLES11/root system/boot/ix86/vmxboot system/boot/ix86/vmxboot/suse-10.3 system/boot/ix86/vmxboot/suse-11.0 system/boot/ix86/vmxboot/suse-11.1 system/boot/ix86/vmxboot/suse-SLED10 system/boot/ix86/vmxboot/suse-SLED11 system/boot/ix86/vmxboot/suse-SLES10 system/boot/ix86/! vmxboot/suse-SLES11
</A></li>
        <LI>Next message: <A HREF="000949.html">[Kiwi-devel] r1833 - kiwi-head/modules
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#948">[ date ]</a>
              <a href="thread.html#948">[ thread ]</a>
              <a href="subject.html#948">[ subject ]</a>
              <a href="author.html#948">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: marcus_schaefer
Date: 2009-01-08 18:28:28 +0100 (Thu, 08 Jan 2009)
New Revision: 1832

Modified:
   kiwi-head/kiwi.pl
   kiwi-head/modules/KIWILinuxRC.sh
   kiwi-head/modules/KIWIXML.pm
   kiwi-head/rpm/kiwi.changes
   kiwi-head/system/boot/ix86/oemboot/suse-linuxrc
   kiwi-head/system/boot/ix86/usbboot/suse-10.3/config.xml
   kiwi-head/system/boot/ix86/usbboot/suse-11.0/config.xml
   kiwi-head/system/boot/ix86/usbboot/suse-11.1/config.xml
   kiwi-head/system/boot/ix86/usbboot/suse-SLED10/config.xml
   kiwi-head/system/boot/ix86/usbboot/suse-SLED11/config.xml
   kiwi-head/system/boot/ix86/usbboot/suse-SLES10/config.xml
   kiwi-head/system/boot/ix86/usbboot/suse-SLES11/config.xml
   kiwi-head/system/boot/ix86/usbboot/suse-linuxrc
   kiwi-head/system/boot/ix86/vmxboot/suse-linuxrc
Log:

- fixed missing eval output in case of wrong eval call
- print internal backtrace only if --debug is set



Modified: kiwi-head/kiwi.pl
===================================================================
--- kiwi-head/kiwi.pl	2009-01-08 14:29:45 UTC (rev 1831)
+++ kiwi-head/kiwi.pl	2009-01-08 17:28:28 UTC (rev 1832)
@@ -199,6 +199,7 @@
 our $InstSourceLocal;       # create installation source from local metadata
 our $CheckKernel;           # check for kernel matches in boot and system image
 our $LVM;                   # use LVM partition setup for virtual disk
+our $Debug;                 # activates the internal stack trace output
 our $kiwi;                  # global logging handler object
 
 #============================================
@@ -1163,6 +1164,7 @@
 		&quot;target-arch=s&quot;         =&gt; \$TargetArch,
 		&quot;check-kernel&quot;          =&gt; \$CheckKernel,
 		&quot;lvm&quot;                   =&gt; \$LVM,
+		&quot;debug&quot;                 =&gt; \$Debug,
 		&quot;help|h&quot;                =&gt; \&amp;usage,
 		&quot;&lt;&gt;&quot;                    =&gt; \&amp;usage
 	);
@@ -1350,7 +1352,8 @@
 	print &quot;  kiwi --installstick &lt;initrd&gt;\n&quot;;
 	print &quot;     [ --installstick-system &lt;vmx-system-image&gt; ]\n&quot;;
 	print &quot;Installation source creation:\n&quot;;
-	print &quot;  kiwi --root &lt;targetpath&gt; --create-instsource &lt;config&gt; [ --local ] [ -v|--verbose &lt;1|2|3&gt; ]\n&quot;;
+	print &quot;  kiwi --root &lt;targetpath&gt; --create-instsource &lt;config&gt;\n&quot;;
+	print &quot;     [ --local ] [ -v|--verbose &lt;1|2|3&gt; ]\n&quot;;
 	print &quot;Helper Tools:\n&quot;;
 	print &quot;  kiwi --testsuite &lt;image-root&gt; [ --test name --test name ... ]\n&quot;;
 	print &quot;  kiwi --createpassword\n&quot;;
@@ -1518,9 +1521,11 @@
 	print &quot;    system image. The kernel check also tries to fix the boot\n&quot;;
 	print &quot;    image if no matching kernel was found.\n&quot;;
 	print &quot;\n&quot;;
+	print &quot;  [ --debug ]\n&quot;;
+	print &quot;    Prints a stack trace in case of internal errors\n&quot;;
+	print &quot;\n&quot;;
 	print &quot;  [ -v | --verbose &lt;1|2|3&gt; ]\n&quot;;
-	print &quot;    Control the verbosity level. At the moment this option\n&quot;;
-	print &quot;    has an effect on the create-instsource module only\n&quot;;
+	print &quot;    Controls the verbosity level for the instsource module\n&quot;;
 	print &quot;\n&quot;;
 	print &quot;  [ --instsource-local ]\n&quot;;
 	print &quot;    Loads the module KIWICollect_local instead of KIWICollect\n&quot;;
@@ -1638,7 +1643,9 @@
 	}
 	$kiwi -&gt; setLogHumanReadable();
 	if ($code != 0) {
-		$kiwi -&gt; printBackTrace();
+		if (defined $Debug) {
+			$kiwi -&gt; printBackTrace();
+		}
 		$kiwi -&gt; printLogExcerpt();
 		$kiwi -&gt; error  (&quot;KIWI exited with error(s)&quot;);
 		$kiwi -&gt; done ();

Modified: kiwi-head/modules/KIWILinuxRC.sh
===================================================================
--- kiwi-head/modules/KIWILinuxRC.sh	2009-01-08 14:29:45 UTC (rev 1831)
+++ kiwi-head/modules/KIWILinuxRC.sh	2009-01-08 17:28:28 UTC (rev 1832)
@@ -1431,19 +1431,25 @@
 				removable=`cat $isremovable`
 				if [ $removable -eq 1 ];then
 					stickRoot=$device
-					stickDevice=&quot;$device&quot;1
-					if ! kiwiMount &quot;$stickDevice&quot; &quot;/mnt&quot;;then
-						continue
-					fi
-					if \
-						[ ! -e /mnt/etc/ImageVersion ] &amp;&amp; \
-						[ ! -e /mnt/config.isoclient ]
-					then
+					stickDevice=$device&quot;1&quot;
+					for dev in $stickRoot&quot;1&quot; $stickRoot&quot;2&quot;;do
+						stickFound=0
+						if ! kiwiMount &quot;$dev&quot; &quot;/mnt&quot;;then
+							continue
+						fi
+						if \
+							[ ! -e /mnt/etc/ImageVersion ] &amp;&amp; \
+							[ ! -e /mnt/config.isoclient ]
+						then
+							umountSystem
+							stickFound=1
+							break
+						fi
 						umountSystem
+					done
+					if [ $stickFound = 0 ];then
 						continue
 					fi
-					umountSystem
-					stickFound=1
 					stickSerial=$serial
 					echo .
 					return

Modified: kiwi-head/modules/KIWIXML.pm
===================================================================
--- kiwi-head/modules/KIWIXML.pm	2009-01-08 14:29:45 UTC (rev 1831)
+++ kiwi-head/modules/KIWIXML.pm	2009-01-08 17:28:28 UTC (rev 1832)
@@ -175,9 +175,10 @@
 		$profilesNodeList = $systemTree -&gt; getElementsByTagName (&quot;profiles&quot;);
 	};
 	if ($@) {
+		my $evaldata=$@;
 		$kiwi -&gt; error  (&quot;Problem reading control file&quot;);
 		$kiwi -&gt; failed ();
-		$kiwi -&gt; error  (&quot;$@\n&quot;);
+		$kiwi -&gt; error  (&quot;$evaldata\n&quot;);
 		return undef;
 	}
 	#==========================================
@@ -187,9 +188,10 @@
 		$systemRNG -&gt;validate ( $systemTree );
 	};
 	if ($@) {
+		my $evaldata=$@;
 		$kiwi -&gt; error  (&quot;Scheme validation failed&quot;);
 		$kiwi -&gt; failed ();
-		$kiwi -&gt; error  (&quot;$@\n&quot;);
+		$kiwi -&gt; error  (&quot;$evaldata\n&quot;);
 		return undef;
 	}
 	#==========================================

Modified: kiwi-head/rpm/kiwi.changes
===================================================================
--- kiwi-head/rpm/kiwi.changes	2009-01-08 14:29:45 UTC (rev 1831)
+++ kiwi-head/rpm/kiwi.changes	2009-01-08 17:28:28 UTC (rev 1832)
@@ -3,8 +3,11 @@
 
 - v3.03
 - added LVM support for vmxboot (bnc #447059)
+- added LVM support for usbboot (bnc #447059)
 - restructured/cleaned up oemboot boot code and prepared
   it for use with LVM, related to (bnc #447059)
+- fixed missing eval output in case of wrong eval call
+- print internal backtrace only if --debug is set
 
 -------------------------------------------------------------------
 Tue Dec 30 19:45:45 CET 2008 - <A HREF="https://lists.berlios.de/mailman/listinfo/kiwi-devel">ms at suse.de</A>

Modified: kiwi-head/system/boot/ix86/oemboot/suse-linuxrc
===================================================================
--- kiwi-head/system/boot/ix86/oemboot/suse-linuxrc	2009-01-08 14:29:45 UTC (rev 1831)
+++ kiwi-head/system/boot/ix86/oemboot/suse-linuxrc	2009-01-08 17:28:28 UTC (rev 1832)
@@ -108,7 +108,6 @@
 export imageRootDevice=$imageDiskDevice&quot;1&quot;
 export imageRWDevice=$imageDiskDevice&quot;2&quot;
 export imageRODevice=$imageDiskDevice&quot;1&quot;
-export imageBootDevice=$imageDiskDevice&quot;1&quot;
 if [ ! -z &quot;$RECOVERY&quot; ];then
 	export imageRecoveryDevice=$imageDiskDevice&quot;4&quot;
 	export imageRootDevice=$imageDiskDevice&quot;2&quot;

Modified: kiwi-head/system/boot/ix86/usbboot/suse-10.3/config.xml
===================================================================
--- kiwi-head/system/boot/ix86/usbboot/suse-10.3/config.xml	2009-01-08 14:29:45 UTC (rev 1831)
+++ kiwi-head/system/boot/ix86/usbboot/suse-10.3/config.xml	2009-01-08 17:28:28 UTC (rev 1832)
@@ -25,6 +25,7 @@
 		&lt;file name=&quot;usb/storage/usb-storage.ko&quot;/&gt;
 	&lt;/drivers&gt;
 	&lt;drivers type=&quot;drivers&quot;&gt;
+		&lt;file name=&quot;drivers/md/dm-mod.ko&quot;/&gt;
 		&lt;file name=&quot;drivers/hid/*&quot;/&gt;
 		&lt;file name=&quot;drivers/ide/*&quot;/&gt;
 		&lt;file name=&quot;drivers/block/loop.ko&quot;/&gt;
@@ -91,6 +92,7 @@
 		&lt;package name=&quot;bootsplash&quot;/&gt;
 		&lt;package name=&quot;bootsplash-theme-SuSE&quot;/&gt;
 		&lt;package name=&quot;tar&quot;/&gt;
+		&lt;package name=&quot;lvm2&quot;/&gt;
 	&lt;/packages&gt;
 	&lt;packages type=&quot;bootstrap&quot;&gt;
 		&lt;package name=&quot;filesystem&quot;/&gt;

Modified: kiwi-head/system/boot/ix86/usbboot/suse-11.0/config.xml
===================================================================
--- kiwi-head/system/boot/ix86/usbboot/suse-11.0/config.xml	2009-01-08 14:29:45 UTC (rev 1831)
+++ kiwi-head/system/boot/ix86/usbboot/suse-11.0/config.xml	2009-01-08 17:28:28 UTC (rev 1832)
@@ -25,6 +25,7 @@
 		&lt;file name=&quot;usb/storage/usb-storage.ko&quot;/&gt;
 	&lt;/drivers&gt;
 	&lt;drivers type=&quot;drivers&quot;&gt;
+		&lt;file name=&quot;drivers/md/dm-mod.ko&quot;/&gt;
 		&lt;file name=&quot;drivers/hid/*&quot;/&gt;
 		&lt;file name=&quot;drivers/ide/*&quot;/&gt;
 		&lt;file name=&quot;drivers/block/loop.ko&quot;/&gt;
@@ -94,6 +95,7 @@
 		&lt;package name=&quot;bootsplash&quot;/&gt;
 		&lt;package name=&quot;bootsplash-branding-openSUSE&quot;/&gt;
 		&lt;package name=&quot;tar&quot;/&gt;
+		&lt;package name=&quot;lvm2&quot;/&gt;
 		&lt;package name=&quot;cromfs&quot;/&gt;
 	&lt;/packages&gt;
 	&lt;packages type=&quot;bootstrap&quot;&gt;

Modified: kiwi-head/system/boot/ix86/usbboot/suse-11.1/config.xml
===================================================================
--- kiwi-head/system/boot/ix86/usbboot/suse-11.1/config.xml	2009-01-08 14:29:45 UTC (rev 1831)
+++ kiwi-head/system/boot/ix86/usbboot/suse-11.1/config.xml	2009-01-08 17:28:28 UTC (rev 1832)
@@ -25,6 +25,7 @@
 		&lt;file name=&quot;usb/storage/usb-storage.ko&quot;/&gt;
 	&lt;/drivers&gt;
 	&lt;drivers type=&quot;drivers&quot;&gt;
+		&lt;file name=&quot;drivers/md/dm-mod.ko&quot;/&gt;
 		&lt;file name=&quot;drivers/hid/*&quot;/&gt;
 		&lt;file name=&quot;drivers/ide/*&quot;/&gt;
 		&lt;file name=&quot;drivers/block/loop.ko&quot;/&gt;
@@ -99,6 +100,7 @@
 		&lt;package name=&quot;bootsplash&quot;/&gt;
 		&lt;package name=&quot;bootsplash-branding-openSUSE&quot;/&gt;
 		&lt;package name=&quot;tar&quot;/&gt;
+		&lt;package name=&quot;lvm2&quot;/&gt;
 		&lt;package name=&quot;cromfs&quot;/&gt;
 	&lt;/packages&gt;
 	&lt;packages type=&quot;bootstrap&quot;&gt;

Modified: kiwi-head/system/boot/ix86/usbboot/suse-SLED10/config.xml
===================================================================
--- kiwi-head/system/boot/ix86/usbboot/suse-SLED10/config.xml	2009-01-08 14:29:45 UTC (rev 1831)
+++ kiwi-head/system/boot/ix86/usbboot/suse-SLED10/config.xml	2009-01-08 17:28:28 UTC (rev 1832)
@@ -29,6 +29,7 @@
 		&lt;file name=&quot;usb/input/usbhid.ko&quot;/&gt;
 	&lt;/drivers&gt;
 	&lt;drivers type=&quot;drivers&quot;&gt;
+		&lt;file name=&quot;drivers/md/dm-mod.ko&quot;/&gt;
 		&lt;file name=&quot;drivers/ide/*&quot;/&gt;
 		&lt;file name=&quot;drivers/block/loop.ko&quot;/&gt;
 		&lt;file name=&quot;net/packet/*&quot;/&gt;
@@ -84,6 +85,7 @@
 		&lt;package name=&quot;bootsplash&quot;/&gt;
 		&lt;package name=&quot;bootsplash-theme-SuSE-NLD&quot;/&gt;
 		&lt;package name=&quot;tar&quot;/&gt;
+		&lt;package name=&quot;lvm2&quot;/&gt;
 	&lt;/packages&gt;
 	&lt;packages type=&quot;bootstrap&quot;&gt;
 		&lt;package name=&quot;filesystem&quot;/&gt;

Modified: kiwi-head/system/boot/ix86/usbboot/suse-SLED11/config.xml
===================================================================
--- kiwi-head/system/boot/ix86/usbboot/suse-SLED11/config.xml	2009-01-08 14:29:45 UTC (rev 1831)
+++ kiwi-head/system/boot/ix86/usbboot/suse-SLED11/config.xml	2009-01-08 17:28:28 UTC (rev 1832)
@@ -25,6 +25,7 @@
 		&lt;file name=&quot;usb/storage/usb-storage.ko&quot;/&gt;
 	&lt;/drivers&gt;
 	&lt;drivers type=&quot;drivers&quot;&gt;
+		&lt;file name=&quot;drivers/md/dm-mod.ko&quot;/&gt;
 		&lt;file name=&quot;drivers/hid/*&quot;/&gt;
 		&lt;file name=&quot;drivers/ide/*&quot;/&gt;
 		&lt;file name=&quot;drivers/block/loop.ko&quot;/&gt;
@@ -92,6 +93,7 @@
 		&lt;package name=&quot;bootsplash&quot;/&gt;
 		&lt;package name=&quot;bootsplash-branding-SLED&quot;/&gt;
 		&lt;package name=&quot;tar&quot;/&gt;
+		&lt;package name=&quot;lvm2&quot;/&gt;
 	&lt;/packages&gt;
 	&lt;packages type=&quot;bootstrap&quot;&gt;
 		&lt;package name=&quot;filesystem&quot;/&gt;

Modified: kiwi-head/system/boot/ix86/usbboot/suse-SLES10/config.xml
===================================================================
--- kiwi-head/system/boot/ix86/usbboot/suse-SLES10/config.xml	2009-01-08 14:29:45 UTC (rev 1831)
+++ kiwi-head/system/boot/ix86/usbboot/suse-SLES10/config.xml	2009-01-08 17:28:28 UTC (rev 1832)
@@ -29,6 +29,7 @@
 		&lt;file name=&quot;usb/input/usbhid.ko&quot;/&gt;
 	&lt;/drivers&gt;
 	&lt;drivers type=&quot;drivers&quot;&gt;
+		&lt;file name=&quot;drivers/md/dm-mod.ko&quot;/&gt;
 		&lt;file name=&quot;drivers/ide/*&quot;/&gt;
 		&lt;file name=&quot;drivers/block/loop.ko&quot;/&gt;
 		&lt;file name=&quot;net/packet/*&quot;/&gt;
@@ -84,6 +85,7 @@
 		&lt;package name=&quot;bootsplash&quot;/&gt;
 		&lt;package name=&quot;bootsplash-theme-SuSE-SLES&quot;/&gt;
 		&lt;package name=&quot;tar&quot;/&gt;
+		&lt;package name=&quot;lvm2&quot;/&gt;
 	&lt;/packages&gt;
 	&lt;packages type=&quot;bootstrap&quot;&gt;
 		&lt;package name=&quot;filesystem&quot;/&gt;

Modified: kiwi-head/system/boot/ix86/usbboot/suse-SLES11/config.xml
===================================================================
--- kiwi-head/system/boot/ix86/usbboot/suse-SLES11/config.xml	2009-01-08 14:29:45 UTC (rev 1831)
+++ kiwi-head/system/boot/ix86/usbboot/suse-SLES11/config.xml	2009-01-08 17:28:28 UTC (rev 1832)
@@ -25,6 +25,7 @@
 		&lt;file name=&quot;usb/storage/usb-storage.ko&quot;/&gt;
 	&lt;/drivers&gt;
 	&lt;drivers type=&quot;drivers&quot;&gt;
+		&lt;file name=&quot;drivers/md/dm-mod.ko&quot;/&gt;
 		&lt;file name=&quot;drivers/hid/*&quot;/&gt;
 		&lt;file name=&quot;drivers/ide/*&quot;/&gt;
 		&lt;file name=&quot;drivers/block/loop.ko&quot;/&gt;
@@ -92,6 +93,7 @@
 		&lt;package name=&quot;bootsplash&quot;/&gt;
 		&lt;package name=&quot;bootsplash-branding-SLES&quot;/&gt;
 		&lt;package name=&quot;tar&quot;/&gt;
+		&lt;package name=&quot;lvm2&quot;/&gt;
 	&lt;/packages&gt;
 	&lt;packages type=&quot;bootstrap&quot;&gt;
 		&lt;package name=&quot;filesystem&quot;/&gt;

Modified: kiwi-head/system/boot/ix86/usbboot/suse-linuxrc
===================================================================
--- kiwi-head/system/boot/ix86/usbboot/suse-linuxrc	2009-01-08 14:29:45 UTC (rev 1831)
+++ kiwi-head/system/boot/ix86/usbboot/suse-linuxrc	2009-01-08 17:28:28 UTC (rev 1832)
@@ -73,24 +73,31 @@
 probeDevices
 
 #======================================
-# 6) Load USB storage modules
+# 6) Setup device names...
 #--------------------------------------
-for module in ehci-hcd uhci-hcd usb_storage sg sd_mod BusLogic;do
-	modprobe $module &amp;&gt;/dev/null
-done
-
-#======================================
-# 7) Search USB stick device
-#--------------------------------------
 USBStickDevice
 if [ $stickFound = 0 ];then
 	systemException \
 		&quot;No USB stick found... abort&quot; \
 	&quot;reboot&quot;
 fi
+Echo &quot;Searching for kiwiVG volume group...&quot;
+export stickRWDevice=$stickRoot&quot;2&quot;
+export stickRODevice=$stickRoot&quot;1&quot;
+if searchVolumeGroup; then
+	export haveLVM=yes
+	if [ -e /dev/kiwiVG/LVComp ];then
+		export stickDevice=/dev/kiwiVG/LVComp
+	else
+		export stickDevice=/dev/kiwiVG/LVRoot
+	fi
+	export stickRWDevice=/dev/kiwiVG/LVRoot
+	export stickRODevice=/dev/kiwiVG/LVComp
+	export stickBootDevice=$stickRoot&quot;2&quot;
+fi
 
 #======================================
-# 8) Probe filesystem of stick system
+# 7) Probe filesystem of stick system
 #--------------------------------------
 probeFileSystem $stickDevice
 if [ $FSTYPE = &quot;unknown&quot; ];then
@@ -100,15 +107,15 @@
 fi
 
 #======================================
-# 9) Setup union on compressed root
+# 8) Setup union on compressed root
 #--------------------------------------
 Echo &quot;Filesystem of stick system is: $FSTYPE -&gt; $stickDevice&quot;
 if isFSTypeReadOnly;then
-	setupUnionFS &quot;$stickRoot&quot;2 &quot;$stickRoot&quot;1 aufs
+	setupUnionFS $stickRWDevice $stickRODevice aufs
 fi
 
 #======================================
-# 10) Mount USB stick (system)
+# 9) Mount USB stick (system)
 #--------------------------------------
 if ! mountSystem $stickDevice;then
 	systemException &quot;Failed to mount root filesystem&quot; &quot;reboot&quot;
@@ -116,46 +123,62 @@
 validateRootTree
 
 #======================================
-# 11) check for local boot
+# 10) check for local boot
 #--------------------------------------
 if [ -e /mnt/etc/ImagePackages ];then
 	export LOCAL_BOOT=yes
 fi
 
 #======================================
+# 11) setup /lvmboot
+#--------------------------------------
+if [ $LOCAL_BOOT = &quot;no&quot; ] &amp;&amp; [ &quot;$haveLVM&quot; = &quot;yes&quot; ];then
+	mkdir /mnt/lvmboot
+	mount $stickBootDevice /mnt/lvmboot
+	if [ -z $UNIONFS_CONFIG ];then
+		cp -a /mnt/boot/* /mnt/lvmboot/boot
+	fi
+	rm -rf /mnt/boot
+	( cd /mnt &amp;&amp; ln -s lvmboot/boot boot )
+fi
+
+#======================================
 # 12) Create system dependant files
 #--------------------------------------
 if [ $LOCAL_BOOT = &quot;no&quot; ];then
 	setupDefaultFstab /config
 	updateRootDeviceFstab /config $stickDevice
+	if [ &quot;$haveLVM&quot; = &quot;yes&quot; ];then
+		updateLVMBootDeviceFstab /config $imageBootDevice
+	fi
 fi
 
 #======================================
-# 12) copy system dependant files
+# 13) copy system dependant files
 #--------------------------------------
 if [ $LOCAL_BOOT = &quot;no&quot; ];then
 	setupConfigFiles
 fi
 
 #======================================
-# 13) update system dependant files
+# 14) update system dependant files
 #--------------------------------------
 if [ $LOCAL_BOOT = &quot;no&quot; ];then
 	setupInittab /mnt
 fi
 
 #======================================
-# 14) setup real root device
+# 15) setup real root device
 #--------------------------------------
 echo 256 &gt; /proc/sys/kernel/real-root-dev
 
 #======================================
-# 15) umount system filesystems
+# 16) umount system filesystems
 #--------------------------------------
 umountSystemFilesystems
 
 #======================================
-# 16) copy initrd files to image
+# 17) copy initrd files to image
 #--------------------------------------
 if [ ! -f /mnt/boot/deployed ];then
 	touch /mnt/boot/deployed
@@ -165,17 +188,17 @@
 cp /include /mnt
 
 #======================================
-# 17) kill boot shell
+# 18) kill boot shell
 #--------------------------------------
 killShell
 killBlogD
 
 #======================================
-# 18) Activate new root
+# 19) Activate new root
 #--------------------------------------
 activateImage
 
 #======================================
-# 19) Unmount initrd / system init
+# 20) Unmount initrd / system init
 #--------------------------------------
 bootImage $@

Modified: kiwi-head/system/boot/ix86/vmxboot/suse-linuxrc
===================================================================
--- kiwi-head/system/boot/ix86/vmxboot/suse-linuxrc	2009-01-08 14:29:45 UTC (rev 1831)
+++ kiwi-head/system/boot/ix86/vmxboot/suse-linuxrc	2009-01-08 17:28:28 UTC (rev 1832)
@@ -119,7 +119,6 @@
 export imageRootDevice=$imageDiskDevice&quot;1&quot;
 export imageRWDevice=$imageDiskDevice&quot;2&quot;
 export imageRODevice=$imageDiskDevice&quot;1&quot;
-export imageBootDevice=$imageDiskDevice&quot;1&quot;
 if [ -z &quot;$imageDiskDevice&quot; ];then
 	systemException \
 		&quot;Couldn't find any boot device... abort&quot; \


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000947.html">[Kiwi-devel] r1831 - in kiwi-head: . doc/examples/suse-10.3/suse-oem-preload doc/examples/suse-11.0/suse-oem-preload doc/examples/suse-11.1/suse-oem-preload modules rpm system/boot/ix86/oemboot system/boot/ix86/oemboot/suse-10.3 system/boot/ix86/oemboot/suse-10.3/root system/boot/ix86/oemboot/suse-11.0 system/boot/ix86/oemboot/suse-11.0/root system/boot/ix86/oemboot/suse-11.1 system/boot/ix86/oemboot/suse-11.1/root system/boot/ix86/oemboot/suse-SLED10 system/boot/ix86/oemboot/suse-SLED10/root system/boot/ix86/oemboot/suse-SLED11 system/boot/ix86/oemboot/suse-SLED11/root system/boot/ix86/oemboot/suse-SLES10 system/boot/ix86/oemboot/suse-SLES10/root system/boot/ix86/oemboot/suse-SLES11 system/boot/ix86/oemboot/suse-SLES11/root system/boot/ix86/vmxboot system/boot/ix86/vmxboot/suse-10.3 system/boot/ix86/vmxboot/suse-11.0 system/boot/ix86/vmxboot/suse-11.1 system/boot/ix86/vmxboot/suse-SLED10 system/boot/ix86/vmxboot/suse-SLED11 system/boot/ix86/vmxboot/suse-SLES10 system/boot/ix86/! vmxboot/suse-SLES11
</A></li>
	<LI>Next message: <A HREF="000949.html">[Kiwi-devel] r1833 - kiwi-head/modules
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#948">[ date ]</a>
              <a href="thread.html#948">[ thread ]</a>
              <a href="subject.html#948">[ subject ]</a>
              <a href="author.html#948">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/kiwi-devel">More information about the Kiwi-devel
mailing list</a><br>
</body></html>

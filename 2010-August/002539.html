<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Kiwi-devel] [Git]Project kiwi at BerliOS branch, master,	updated. 414b91624380743e835592ddf3951857e4d6b366
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/kiwi-devel/2010-August/index.html" >
   <LINK REL="made" HREF="mailto:kiwi-devel%40lists.berlios.de?Subject=Re%3A%20%5BKiwi-devel%5D%20%5BGit%5DProject%20kiwi%20at%20BerliOS%20branch%2C%20master%2C%0A%09updated.%20414b91624380743e835592ddf3951857e4d6b366&In-Reply-To=%3C20100810083737.EF1064802F3%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002538.html">
   <LINK REL="Next"  HREF="002540.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Kiwi-devel] [Git]Project kiwi at BerliOS branch, master,	updated. 414b91624380743e835592ddf3951857e4d6b366</H1>
    <B>cwh at BerliOS</B> 
    <A HREF="mailto:kiwi-devel%40lists.berlios.de?Subject=Re%3A%20%5BKiwi-devel%5D%20%5BGit%5DProject%20kiwi%20at%20BerliOS%20branch%2C%20master%2C%0A%09updated.%20414b91624380743e835592ddf3951857e4d6b366&In-Reply-To=%3C20100810083737.EF1064802F3%40sheep.berlios.de%3E"
       TITLE="[Kiwi-devel] [Git]Project kiwi at BerliOS branch, master,	updated. 414b91624380743e835592ddf3951857e4d6b366">cwh at mail.berlios.de
       </A><BR>
    <I>Tue Aug 10 10:37:37 CEST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="002538.html">[Kiwi-devel] [Git]Project kiwi at BerliOS branch, master,	updated. 586bf95c469f464433a8f65c9028f518dd768854
</A></li>
        <LI>Next message: <A HREF="002540.html">[Kiwi-devel] [Git]Project kiwi at BerliOS branch, master,	updated. 538c6fc2668486956533034534be5e76b465f8a9
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2539">[ date ]</a>
              <a href="thread.html#2539">[ thread ]</a>
              <a href="subject.html#2539">[ subject ]</a>
              <a href="author.html#2539">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>This is an automated email from the git hooks/post-receive script. It was
generated because a ref change was pushed to the repository containing
the project &quot;Project kiwi at BerliOS&quot;.

The branch, master has been updated
       via  414b91624380743e835592ddf3951857e4d6b366 (commit)
       via  ad06a1bce277edf2b526ae7c9b466ca492db6711 (commit)
       via  662d0be0233278016f85b05bddbf0f20ecbd9a2b (commit)
       via  789081630764c849a88f8fc721bbf2146f38f8c1 (commit)
       via  2adde2e639ed9f7db40672e8d1daab6f786bbcbf (commit)
       via  41a60298e3e5a90ea91bd275fc251bf28376f71f (commit)
       via  068cdca21e5dcb44b676e0b8d032e2cca7f652e7 (commit)
       via  5a1ecbcb1d5c3dba48404334ef2351f64e4e919e (commit)
      from  586bf95c469f464433a8f65c9028f518dd768854 (commit)

Those revisions listed above that are new to this repository have
not appeared on any other notification email; so we list those
revisions in full, below.

- Log -----------------------------------------------------------------
commit 414b91624380743e835592ddf3951857e4d6b366
Merge: ad06a1b 586bf95
Author: Christopher Hofmann &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/kiwi-devel">cwh at suse.de</A>&gt;
Date:   Tue Aug 10 10:36:33 2010 +0200

    Merge branch 'master' of <A HREF="ssh://git.berlios.de/gitroot/kiwi">ssh://git.berlios.de/gitroot/kiwi</A>

commit ad06a1bce277edf2b526ae7c9b466ca492db6711
Merge: 662d0be f29f0bd
Author: Christopher Hofmann &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/kiwi-devel">cwh at suse.de</A>&gt;
Date:   Tue Aug 10 10:12:34 2010 +0200

    Merge branch 'master' of <A HREF="ssh://git.berlios.de/gitroot/kiwi">ssh://git.berlios.de/gitroot/kiwi</A> into DUD

commit 662d0be0233278016f85b05bddbf0f20ecbd9a2b
Merge: 7890816 8369ac7
Author: Christopher Hofmann &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/kiwi-devel">cwh at suse.de</A>&gt;
Date:   Tue Aug 3 09:44:26 2010 +0200

    Merge branch 'master' of <A HREF="ssh://git.berlios.de/gitroot/kiwi">ssh://git.berlios.de/gitroot/kiwi</A> into DUD

commit 789081630764c849a88f8fc721bbf2146f38f8c1
Merge: 2adde2e 44324fe
Author: Christopher Hofmann &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/kiwi-devel">cwh at suse.de</A>&gt;
Date:   Mon Jul 19 16:46:07 2010 +0200

    Merge branch 'master' of <A HREF="ssh://git.berlios.de/gitroot/kiwi">ssh://git.berlios.de/gitroot/kiwi</A> into DUD

commit 2adde2e639ed9f7db40672e8d1daab6f786bbcbf
Author: Christopher Hofmann &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/kiwi-devel">cwh at suse.de</A>&gt;
Date:   Fri Jul 16 16:50:34 2010 +0200

    Finally added driverupdate stuff to schema

commit 41a60298e3e5a90ea91bd275fc251bf28376f71f
Merge: 068cdca 0228e1a
Author: Christopher Hofmann &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/kiwi-devel">cwh at suse.de</A>&gt;
Date:   Fri Jul 16 16:43:00 2010 +0200

    Merge branch 'master' of <A HREF="ssh://git.berlios.de/gitroot/kiwi">ssh://git.berlios.de/gitroot/kiwi</A> into DUD

commit 068cdca21e5dcb44b676e0b8d032e2cca7f652e7
Merge: 5a1ecbc 67856a1
Author: Christopher Hofmann &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/kiwi-devel">cwh at suse.de</A>&gt;
Date:   Fri Jul 16 14:20:12 2010 +0200

    Merge branch 'master' of <A HREF="ssh://git.berlios.de/gitroot/kiwi">ssh://git.berlios.de/gitroot/kiwi</A> into DUD

commit 5a1ecbcb1d5c3dba48404334ef2351f64e4e919e
Author: Christopher Hofmann &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/kiwi-devel">cwh at suse.de</A>&gt;
Date:   Mon Jun 14 14:50:54 2010 +0200

    DriverUpdateDisk support

-----------------------------------------------------------------------

Summary of changes:
diff --git a/modules/KIWICollect.pm b/modules/KIWICollect.pm
index 2d827ba..4a7fe61 100644
--- a/modules/KIWICollect.pm
+++ b/modules/KIWICollect.pm
@@ -1,5 +1,5 @@
 #================
-# FILE          : KIWICollect2.pm
+# FILE          : KIWICollect.pm
 #----------------
 # PROJECT       : OpenSUSE Build-Service
 # COPYRIGHT     : (c) 2006 SUSE LINUX Products GmbH, Germany
@@ -588,6 +588,13 @@ sub mainTask
   ## create meta data
   $this-&gt;createMetadata();
 
+  ## DUD:
+  if ($this-&gt;{m_xml}-&gt;isDriverUpdateDisk()) {
+	  $this-&gt;unpackModules();
+	  $this-&gt;unpackInstSys();
+	  $this-&gt;createInstallPackageLinks();
+  }
+
   ## We create iso files by default, but keep this for manual override
   if($this-&gt;{m_proddata}-&gt;getVar(&quot;REPO_ONLY&quot;) eq &quot;true&quot;) {
     $this-&gt;logMsg(&quot;I&quot;, &quot;Skipping ISO generation due to REPO_ONLY setting&quot;);
@@ -1839,7 +1846,159 @@ sub createMetadata
 }
 # createMetadata
 
+# part of DUD:
+sub unpackModules
+{
+	my $this = shift;
+
+	my $tmp_dir = &quot;$this-&gt;{m_basesubdir}-&gt;{'1'}/temp&quot;;
+	if(-d $tmp_dir) {
+		qx(rm -rf $tmp_dir);
+	}
+
+	if(!mkpath(&quot;$tmp_dir&quot;, { mode =&gt; 0755 } )) {
+		$this-&gt;logMsg(&quot;E&quot;, &quot;can't create dir &lt;$tmp_dir&gt;&quot;);
+		return undef;
+	}
+
+	my @modules = $this-&gt;{m_xml}-&gt;getInstSourceDUDModules();
+	my %targets = $this-&gt;{m_xml}-&gt;getInstSourceDUDTargets();
+	my %target_archs = reverse %targets; # values of this hash are not used
+
+	# So far DUDs only have one single medium
+	my $medium = 1;
+	
+	# unpack module packages to temp dir for the used architectures
+	foreach my $arch (keys(%target_archs)) {
+		my $arch_tmp_dir = &quot;$tmp_dir/$arch&quot;;
+
+		foreach my $module (@modules) {
+			my $pack_file = $this-&gt;getBestPackFromRepos($module, $arch)-&gt;{'localfile'};
+			$this-&gt;logMsg(&quot;I&quot;, &quot;Unpacking $pack_file to $arch_tmp_dir/&quot;);
+			$this-&gt;{m_util}-&gt;unpac_package($pack_file, &quot;$arch_tmp_dir&quot;);
+		}
+	}
+
+	# copy modules from temp dir to targets
+	foreach my $target (keys(%targets)) {
+		my $arch = $targets{$target};
+		my $arch_tmp_dir = &quot;$tmp_dir/$arch&quot;;
+		my $target_dir = $this-&gt;{m_basesubdir}-&gt;{$medium}.&quot;/linux/suse/$target/modules/&quot;;
+
+		my @kos = split /\n/, qx(find $arch_tmp_dir -iname &quot;*.ko&quot;);
+
+		foreach my $ko (@kos) {
+			$this-&gt;logMsg(&quot;I&quot;, &quot;Copying module $ko to $target_dir&quot;);
+			qx(mkdir -p $target_dir &amp;&amp; cp $ko $target_dir);
+		}
+	}
+} # unpackModules
+
+# used only in DUD so far:
+sub getBestPackFromRepos {
+	my $this = shift;
+	my $pkg_name = shift;
+	my $arch = shift;
+
+	my $pkg_pool = $this-&gt;{m_packagePool};
+	my $pkg_repos = $pkg_pool-&gt;{$pkg_name};
+
+	foreach my $repo (sort{$pkg_repos-&gt;{$a}-&gt;{priority} &lt;=&gt; $pkg_repos-&gt;{$b}-&gt;{priority}} keys(%{$pkg_repos})) {
+		return $pkg_repos-&gt;{$repo} if $pkg_repos-&gt;{$repo}-&gt;{arch} eq $arch; #FIXME: fallback handling missing
+	}
+}
+
+
+# part of DUD:
+sub unpackInstSys
+{
+	my $this = shift;
+
+	my $tmp_dir = &quot;$this-&gt;{m_basesubdir}-&gt;{'1'}/temp&quot;;
+	if(-d $tmp_dir) {
+		qx(rm -rf $tmp_dir);
+	}
+
+	if(!mkpath(&quot;$tmp_dir&quot;, { mode =&gt; 0755 } )) {
+		$this-&gt;logMsg(&quot;E&quot;, &quot;can't create dir &lt;$tmp_dir&gt;&quot;);
+		return undef;
+	}
+
+	my @inst_sys_packages = $this-&gt;{m_xml}-&gt;getInstSourceDUDInstsys();
+	my %targets = $this-&gt;{m_xml}-&gt;getInstSourceDUDTargets();
+	my %target_archs = reverse %targets; # values of this hash are not used
+
+	# So far DUDs only have one single medium
+	my $medium = 1;
+	
+	# unpack module packages to temp dir for the used architectures
+	foreach my $arch (keys(%target_archs)) {
+		my $repo = &quot;repository_1\@$arch&quot;; # FIXME
+		my $arch_tmp_dir = &quot;$tmp_dir/$arch&quot;;
+
+		foreach my $module (@inst_sys_packages) {
+			my $pack_file = $this-&gt;getBestPackFromRepos($module, $arch)-&gt;{'localfile'};
+			$this-&gt;logMsg(&quot;I&quot;, &quot;Unpacking $pack_file to $arch_tmp_dir&quot;);
+			$this-&gt;{m_util}-&gt;unpac_package($pack_file, &quot;$arch_tmp_dir&quot;);
+		}
+	}
+
+	# copy inst_sys_packages from temp dir to targets
+	foreach my $target (keys(%targets)) {
+		my $arch = $targets{$target};
+		my $arch_tmp_dir = &quot;$tmp_dir/$arch&quot;;
+		my $target_dir = $this-&gt;{m_basesubdir}-&gt;{$medium}.&quot;/linux/suse/$target/inst-sys/&quot;;
+		
+		qx(cp -a $arch_tmp_dir $target_dir);
+	}
+} # unpackInstSys
+
+# part of DUD:
+sub createInstallPackageLinks
+{
+	my $this = shift;
+	return undef if not ref($this);
+
+	print Dumper($this-&gt;{m_repoPacks});
+	#die;
+
+	# So far DUDs only have one single medium
+	my $medium = 1;
+	my $retval = 0;
+	my @packlist = $this-&gt;{m_xml}-&gt;getInstSourceDUDModules();
+	push @packlist, $this-&gt;{m_xml}-&gt;getInstSourceDUDInstsys();
+	my %targets = $this-&gt;{m_xml}-&gt;getInstSourceDUDTargets();
+
+	foreach my $target (keys(%targets)) {
+		my $arch = $targets{$target};
+		my $target_dir = &quot;$this-&gt;{m_basesubdir}-&gt;{$medium}/linux/suse/$target/install/&quot;;
+		qx(mkdir -p $target_dir) unless -d $target_dir;
+		my @fallback_archs = $this-&gt;{m_archlist}-&gt;fallbacks($arch);
+
+      RPM:
+		foreach my $rpmname (@packlist) {
+			if(not defined($rpmname) or not defined($this-&gt;{m_repoPacks}-&gt;{$rpmname})) {
+				$this-&gt;logMsg(&quot;W&quot;, &quot;something wrong with rpmlist: undefined value $rpmname&quot;);
+				next RPM;
+			}
+
+		  FARCH:
+			foreach my $fallback_arch (@fallback_archs) {
+				#my $pack_file = $this-&gt;{m_packagePool}-&gt;{$module}-&gt;{$repo}-&gt;{'localfile'};
+				my $pPointer = $this-&gt;{m_repoPacks}-&gt;{$rpmname};
+				my $file = $pPointer-&gt;{$arch}-&gt;{'newpath'}.&quot;/&quot;.$pPointer-&gt;{$fallback_arch}-&gt;{'newfile'};
+				next FARCH unless (-e $file);
+
+				link($file, &quot;$target_dir/&quot;.$pPointer-&gt;{$fallback_arch}-&gt;{'newfile'});
+				$this-&gt;logMsg(&quot;I&quot;, &quot;linking $file to $target_dir/&quot;.$pPointer-&gt;{$fallback_arch}-&gt;{'newfile'}) if $this-&gt;{m_debug} &gt; 2;
+				$retval++;
+				next RPM;
+			}
+		}
+	}
+	return $retval;
 
+} # createInstallPackageLinks
 
 # returns the number of links created
 sub createBootPackageLinks
diff --git a/modules/KIWISchema.rnc b/modules/KIWISchema.rnc
index 46082ef..c92b3c6 100644
--- a/modules/KIWISchema.rnc
+++ b/modules/KIWISchema.rnc
@@ -1749,7 +1749,8 @@ div {
 			k.productoptions &amp;
 			k.instrepo+ &amp;
 			k.metadata &amp;
-			k.repopackages*
+			k.repopackages* &amp;
+			k.driverupdate?
 		}
 }
 
@@ -1985,6 +1986,101 @@ div {
 }
 
 #==========================================
+# main block: &lt;driverupdate&gt;
+#
+div {
+	k.driverupdate.attlist = empty
+	k.driverupdate =
+		## Describe Packages and Metadata
+		[
+		db:para [
+			&quot;Creating a driverupdate disk for using updated hardware\x{a}&quot;~
+						&quot;drivers on system installation with YaST.&quot;
+		]
+		]
+		element driverupdate {
+						k.driverupdate.attlist &amp;
+			k.target+ &amp;
+			k.install? &amp;
+			k.modules? &amp;
+			k.instsys?
+		}
+}
+
+#==========================================
+# main block: &lt;target&gt;
+#
+div {
+	k.target.arch.attribute = k.arch.attribute
+	k.target.attlist = k.target.arch.attribute
+	k.target =
+		## Describe Packages and Metadata
+		[
+		db:para [
+			&quot;List of update targets: &lt;dist&gt;-&lt;arch&gt;\x{a}&quot;
+		]
+		]
+		element target {
+			k.target.attlist &amp;
+			text
+		}
+}
+
+#==========================================
+# main block: &lt;install&gt;
+#
+div {
+	k.install.attlist = empty
+	k.install =
+		## Describe Packages and Metadata
+		[
+		db:para [
+			&quot;List of packages to be copied into the 'install' directory&quot;
+		]
+		]
+		element install {
+			k.install.attlist &amp;
+			k.repopackage*
+		}
+}
+
+#==========================================
+# main block: &lt;modules&gt;
+#
+div {
+	k.modules.attlist = empty
+	k.modules =
+		## Describe Packages and Metadata
+		[
+		db:para [
+			&quot;List of packages to be copied into the 'modules' directory&quot;
+		]
+		]
+		element modules {
+			k.modules.attlist &amp;
+			k.repopackage*
+		}
+}
+
+#==========================================
+# main block: &lt;instsys&gt;
+#
+div {
+	k.instsys.attlist = empty
+	k.instsys =
+		## Describe Packages and Metadata
+		[
+		db:para [
+			&quot;List of packages to be copied into the 'instsys' directory&quot;
+		]
+		]
+		element instsys {
+			k.instsys.attlist &amp;
+			k.repopackage*
+		}
+}
+
+#==========================================
 # main block: &lt;oemconfig&gt;
 #
 div {
diff --git a/modules/KIWISchema.rng b/modules/KIWISchema.rng
index ecffaea..4656f5a 100644
--- a/modules/KIWISchema.rng
+++ b/modules/KIWISchema.rng
@@ -2573,6 +2573,9 @@ repository for image building.&lt;/db:para&gt;
           &lt;zeroOrMore&gt;
             &lt;ref name=&quot;k.repopackages&quot;/&gt;
           &lt;/zeroOrMore&gt;
+          &lt;optional&gt;
+            &lt;ref name=&quot;k.driverupdate&quot;/&gt;
+          &lt;/optional&gt;
         &lt;/interleave&gt;
       &lt;/element&gt;
     &lt;/define&gt;
@@ -2863,6 +2866,128 @@ are used for creating a Novell SUSE installation source.&lt;/db:para&gt;
   &lt;/div&gt;
   &lt;!--
     ==========================================
+    main block: &lt;driverupdate&gt;
+    
+  --&gt;
+  &lt;div&gt;
+    &lt;define name=&quot;k.driverupdate.attlist&quot;&gt;
+      &lt;empty/&gt;
+    &lt;/define&gt;
+    &lt;define name=&quot;k.driverupdate&quot;&gt;
+      &lt;element name=&quot;driverupdate&quot;&gt;
+        &lt;a:documentation&gt;Describe Packages and Metadata&lt;/a:documentation&gt;
+        &lt;db:para&gt;Creating a driverupdate disk for using updated hardware
+drivers on system installation with YaST.&lt;/db:para&gt;
+        &lt;interleave&gt;
+          &lt;ref name=&quot;k.driverupdate.attlist&quot;/&gt;
+          &lt;oneOrMore&gt;
+            &lt;ref name=&quot;k.target&quot;/&gt;
+          &lt;/oneOrMore&gt;
+          &lt;optional&gt;
+            &lt;ref name=&quot;k.install&quot;/&gt;
+          &lt;/optional&gt;
+          &lt;optional&gt;
+            &lt;ref name=&quot;k.modules&quot;/&gt;
+          &lt;/optional&gt;
+          &lt;optional&gt;
+            &lt;ref name=&quot;k.instsys&quot;/&gt;
+          &lt;/optional&gt;
+        &lt;/interleave&gt;
+      &lt;/element&gt;
+    &lt;/define&gt;
+  &lt;/div&gt;
+  &lt;!--
+    ==========================================
+    main block: &lt;target&gt;
+    
+  --&gt;
+  &lt;div&gt;
+    &lt;define name=&quot;k.target.arch.attribute&quot;&gt;
+      &lt;ref name=&quot;k.arch.attribute&quot;/&gt;
+    &lt;/define&gt;
+    &lt;define name=&quot;k.target.attlist&quot;&gt;
+      &lt;ref name=&quot;k.target.arch.attribute&quot;/&gt;
+    &lt;/define&gt;
+    &lt;define name=&quot;k.target&quot;&gt;
+      &lt;element name=&quot;target&quot;&gt;
+        &lt;a:documentation&gt;Describe Packages and Metadata&lt;/a:documentation&gt;
+        &lt;db:para&gt;List of update targets: &lt;dist&gt;-&lt;arch&gt;
+&lt;/db:para&gt;
+        &lt;interleave&gt;
+          &lt;ref name=&quot;k.target.attlist&quot;/&gt;
+          &lt;text/&gt;
+        &lt;/interleave&gt;
+      &lt;/element&gt;
+    &lt;/define&gt;
+  &lt;/div&gt;
+  &lt;!--
+    ==========================================
+    main block: &lt;install&gt;
+    
+  --&gt;
+  &lt;div&gt;
+    &lt;define name=&quot;k.install.attlist&quot;&gt;
+      &lt;empty/&gt;
+    &lt;/define&gt;
+    &lt;define name=&quot;k.install&quot;&gt;
+      &lt;element name=&quot;install&quot;&gt;
+        &lt;a:documentation&gt;Describe Packages and Metadata&lt;/a:documentation&gt;
+        &lt;db:para&gt;List of packages to be copied into the 'install' directory&lt;/db:para&gt;
+        &lt;interleave&gt;
+          &lt;ref name=&quot;k.install.attlist&quot;/&gt;
+          &lt;zeroOrMore&gt;
+            &lt;ref name=&quot;k.repopackage&quot;/&gt;
+          &lt;/zeroOrMore&gt;
+        &lt;/interleave&gt;
+      &lt;/element&gt;
+    &lt;/define&gt;
+  &lt;/div&gt;
+  &lt;!--
+    ==========================================
+    main block: &lt;modules&gt;
+    
+  --&gt;
+  &lt;div&gt;
+    &lt;define name=&quot;k.modules.attlist&quot;&gt;
+      &lt;empty/&gt;
+    &lt;/define&gt;
+    &lt;define name=&quot;k.modules&quot;&gt;
+      &lt;element name=&quot;modules&quot;&gt;
+        &lt;a:documentation&gt;Describe Packages and Metadata&lt;/a:documentation&gt;
+        &lt;db:para&gt;List of packages to be copied into the 'modules' directory&lt;/db:para&gt;
+        &lt;interleave&gt;
+          &lt;ref name=&quot;k.modules.attlist&quot;/&gt;
+          &lt;zeroOrMore&gt;
+            &lt;ref name=&quot;k.repopackage&quot;/&gt;
+          &lt;/zeroOrMore&gt;
+        &lt;/interleave&gt;
+      &lt;/element&gt;
+    &lt;/define&gt;
+  &lt;/div&gt;
+  &lt;!--
+    ==========================================
+    main block: &lt;instsys&gt;
+    
+  --&gt;
+  &lt;div&gt;
+    &lt;define name=&quot;k.instsys.attlist&quot;&gt;
+      &lt;empty/&gt;
+    &lt;/define&gt;
+    &lt;define name=&quot;k.instsys&quot;&gt;
+      &lt;element name=&quot;instsys&quot;&gt;
+        &lt;a:documentation&gt;Describe Packages and Metadata&lt;/a:documentation&gt;
+        &lt;db:para&gt;List of packages to be copied into the 'instsys' directory&lt;/db:para&gt;
+        &lt;interleave&gt;
+          &lt;ref name=&quot;k.instsys.attlist&quot;/&gt;
+          &lt;zeroOrMore&gt;
+            &lt;ref name=&quot;k.repopackage&quot;/&gt;
+          &lt;/zeroOrMore&gt;
+        &lt;/interleave&gt;
+      &lt;/element&gt;
+    &lt;/define&gt;
+  &lt;/div&gt;
+  &lt;!--
+    ==========================================
     main block: &lt;oemconfig&gt;
     
   --&gt;
diff --git a/modules/KIWIXML.pm b/modules/KIWIXML.pm
index 3853a30..6230058 100644
--- a/modules/KIWIXML.pm
+++ b/modules/KIWIXML.pm
@@ -3014,7 +3014,17 @@ sub getInstSourcePackageAttributes {
 		$nodes = $base -&gt; getElementsByTagName (&quot;metadata&quot;);
 	} elsif ($what eq &quot;instpackages&quot;) {
 		$nodes = $base -&gt; getElementsByTagName (&quot;repopackages&quot;);
+	} elsif ($what eq &quot;DUDmodules&quot;) {
+		my $dud_node = $base -&gt; getElementsByTagName(&quot;driverupdate&quot;)-&gt;get_node(1);
+		$nodes = $dud_node-&gt;getElementsByTagName('modules');
+	} elsif ($what eq &quot;DUDinstall&quot;) {
+		my $dud_node = $base -&gt; getElementsByTagName(&quot;driverupdate&quot;)-&gt;get_node(1);
+		$nodes = $dud_node-&gt;getElementsByTagName('install')-&gt;get_node(1);
+	} elsif ($what eq &quot;DUDinstsys&quot;) {
+		my $dud_node = $base -&gt; getElementsByTagName(&quot;driverupdate&quot;)-&gt;get_node(1);
+		$nodes = $dud_node-&gt;getElementsByTagName('instsys')-&gt;get_node(1);
 	}
+
 	my %result;
 	my @attrib = (
 		&quot;forcerepo&quot; ,&quot;addarch&quot;, &quot;removearch&quot;, &quot;arch&quot;,
@@ -3293,6 +3303,99 @@ sub getList {
 }
 
 #==========================================
+# isDriverUpdateDisk
+#------------------------------------------
+sub isDriverUpdateDisk {
+	my $this = shift;
+
+	my $base = $this-&gt;{instsrcNodeList} -&gt; get_node(1);
+	my $dud_node = $base-&gt;getElementsByTagName(&quot;driverupdate&quot;)-&gt;get_node(1);
+
+	return ref $dud_node;
+}
+
+#==========================================
+# getInstSourceDUDTargets
+#------------------------------------------
+sub getInstSourceDUDTargets {
+	my $this = shift;
+
+	my $base = $this-&gt;{instsrcNodeList} -&gt; get_node(1);
+	my $dud_node = $base-&gt;getElementsByTagName(&quot;driverupdate&quot;)-&gt;get_node(1);
+
+	my %targets = ();
+
+	foreach my $target ($dud_node-&gt;getElementsByTagName('target')) {
+		$targets{$target-&gt;textContent()} =
+			$target-&gt;getAttribute(&quot;arch&quot;);
+	}
+
+	return %targets;
+}
+
+#==========================================
+# getInstSourceDUDConfig
+#------------------------------------------
+sub getInstSourceDUDConfig {
+	my $this = shift;
+
+	my $base = $this-&gt;{instsrcNodeList} -&gt; get_node(1);
+	my $dud_node = $base-&gt;getElementsByTagName(&quot;driverupdate&quot;)-&gt;get_node(1);
+
+	my @config = $dud_node-&gt;getElementsByTagName('config');
+	my %data;
+
+	foreach my $cfg (@config) {
+		$data{$cfg-&gt;getAttribute(&quot;key&quot;)} =
+			$cfg-&gt;getAttribute(&quot;value&quot;);
+	}
+
+	return \%data;
+}
+
+#==========================================
+# getInstSourceDUDModules
+#------------------------------------------
+
+sub getInstSourceDUDModules {
+	my $this = shift;
+
+	return $this-&gt;getInstSourceDUDPackList('modules');
+}
+
+sub getInstSourceDUDInstall {
+	my $this = shift;
+
+	return $this-&gt;getInstSourceDUDPackList('install');
+}
+
+sub getInstSourceDUDInstsys {
+	my $this = shift;
+
+	return $this-&gt;getInstSourceDUDPackList('instsys');
+}
+
+sub getInstSourceDUDPackList {
+	my $this = shift;
+	my $what = shift;
+	return unless $what;
+
+	my $base = $this-&gt;{instsrcNodeList} -&gt; get_node(1);
+	my $dud_node = $base-&gt;getElementsByTagName(&quot;driverupdate&quot;)-&gt;get_node(1);
+
+	my $modules_node = $dud_node-&gt;getElementsByTagName($what)-&gt;get_node(1);
+	my @module_packs = $modules_node-&gt;getElementsByTagName('repopackage');
+
+	my @modules;
+
+	foreach my $mod (@module_packs) {
+		push @modules, $mod-&gt;getAttribute(&quot;name&quot;);
+	}
+
+	return @modules;
+}
+
+#==========================================
 # getInstallSize
 #------------------------------------------
 sub getInstallSize {


hooks/post-receive
-- 
Project kiwi at BerliOS

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002538.html">[Kiwi-devel] [Git]Project kiwi at BerliOS branch, master,	updated. 586bf95c469f464433a8f65c9028f518dd768854
</A></li>
	<LI>Next message: <A HREF="002540.html">[Kiwi-devel] [Git]Project kiwi at BerliOS branch, master,	updated. 538c6fc2668486956533034534be5e76b465f8a9
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2539">[ date ]</a>
              <a href="thread.html#2539">[ thread ]</a>
              <a href="subject.html#2539">[ subject ]</a>
              <a href="author.html#2539">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/kiwi-devel">More information about the Kiwi-devel
mailing list</a><br>
</body></html>

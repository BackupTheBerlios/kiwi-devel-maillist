<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Kiwi-devel] [Git]Project kiwi at BerliOS branch, master,	updated. 5f05c920d6a33dc49c87e2c89fd8610a5403b521
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/kiwi-devel/2011-July/index.html" >
   <LINK REL="made" HREF="mailto:kiwi-devel%40lists.berlios.de?Subject=Re%3A%20%5BKiwi-devel%5D%20%5BGit%5DProject%20kiwi%20at%20BerliOS%20branch%2C%20master%2C%0A%09updated.%205f05c920d6a33dc49c87e2c89fd8610a5403b521&In-Reply-To=%3C20110714143528.A61EB481490%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="003616.html">
   <LINK REL="Next"  HREF="003617.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Kiwi-devel] [Git]Project kiwi at BerliOS branch, master,	updated. 5f05c920d6a33dc49c87e2c89fd8610a5403b521</H1>
    <B>marcus_schaefer at BerliOS</B> 
    <A HREF="mailto:kiwi-devel%40lists.berlios.de?Subject=Re%3A%20%5BKiwi-devel%5D%20%5BGit%5DProject%20kiwi%20at%20BerliOS%20branch%2C%20master%2C%0A%09updated.%205f05c920d6a33dc49c87e2c89fd8610a5403b521&In-Reply-To=%3C20110714143528.A61EB481490%40sheep.berlios.de%3E"
       TITLE="[Kiwi-devel] [Git]Project kiwi at BerliOS branch, master,	updated. 5f05c920d6a33dc49c87e2c89fd8610a5403b521">marcus_schaefer at mail.berlios.de
       </A><BR>
    <I>Thu Jul 14 16:35:28 CEST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="003616.html">[Kiwi-devel] Improving the OpenNebula example
</A></li>
        <LI>Next message: <A HREF="003617.html">[Kiwi-devel] [Git]Project kiwi at BerliOS branch, master,	updated. d0de4ea55c360979d09286bb7edac7c58c6a8ae1
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3615">[ date ]</a>
              <a href="thread.html#3615">[ thread ]</a>
              <a href="subject.html#3615">[ subject ]</a>
              <a href="author.html#3615">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>This is an automated email from the git hooks/post-receive script. It was
generated because a ref change was pushed to the repository containing
the project &quot;Project kiwi at BerliOS&quot;.

The branch, master has been updated
       via  5f05c920d6a33dc49c87e2c89fd8610a5403b521 (commit)
      from  0a118c6740ab9c77d4a96adc1955fa66498440a5 (commit)

Those revisions listed above that are new to this repository have
not appeared on any other notification email; so we list those
revisions in full, below.

- Log -----------------------------------------------------------------
commit 5f05c920d6a33dc49c87e2c89fd8610a5403b521
Author: Marcus Sch&#195;&#164;fer &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/kiwi-devel">ms at novell.com</A>&gt;
Date:   Thu Jul 14 16:34:56 2011 +0200

    - improve the OpenNebula example. I recently created a separate
      package for the OpenNebula Web-UI server (sunstone) and with
      the package &quot;cleanup/separation&quot; from the main opennebula package
      showing how to use the Web-UI is easier now.

-----------------------------------------------------------------------

Summary of changes:
diff --git a/doc/examples/extras/suse-11.3/suse-nebula-cloud/cloud_head/config.xml b/doc/examples/extras/suse-11.3/suse-nebula-cloud/cloud_head/config.xml
index 220cd8f..f9f2878 100644
--- a/doc/examples/extras/suse-11.3/suse-nebula-cloud/cloud_head/config.xml
+++ b/doc/examples/extras/suse-11.3/suse-nebula-cloud/cloud_head/config.xml
@@ -15,7 +15,7 @@
                 &lt;oem-unattended&gt;true&lt;/oem-unattended&gt;
 			&lt;/oemconfig&gt;
 		&lt;/type&gt;
-		&lt;version&gt;1.1.0&lt;/version&gt;
+		&lt;version&gt;1.2.0&lt;/version&gt;
 		&lt;packagemanager&gt;zypper&lt;/packagemanager&gt;
 		&lt;rpm-check-signatures&gt;false&lt;/rpm-check-signatures&gt;
 		&lt;rpm-force&gt;true&lt;/rpm-force&gt;
@@ -29,7 +29,7 @@
 		&lt;source path=&quot;<A HREF="opensuse://11.3/repo/oss/">opensuse://11.3/repo/oss/</A>&quot;/&gt;
 	&lt;/repository&gt;
     &lt;repository type=&quot;rpm-md&quot;&gt;
-        &lt;source path=&quot;<A HREF="http://download.opensuse.org/repositories/Virtualization:/Cloud:/OpenNebula/openSUSE_11.3">http://download.opensuse.org/repositories/Virtualization:/Cloud:/OpenNebula/openSUSE_11.3</A>&quot;/&gt;
+        &lt;source path=&quot;<A HREF="opensuse://repositories/Virtualization:/Cloud:/OpenNebula/openSUSE_11.3">opensuse://repositories/Virtualization:/Cloud:/OpenNebula/openSUSE_11.3</A>&quot;/&gt;
     &lt;/repository&gt;
     &lt;repository type=&quot;rpm-md&quot;&gt;
         &lt;source path=&quot;<A HREF="opensuse://11.3/repo/oss/suse/">opensuse://11.3/repo/oss/suse/</A>&quot;/&gt;
@@ -47,6 +47,7 @@
 		&lt;package name=&quot;kernel-default&quot;/&gt;
         &lt;package name=&quot;nfs-kernel-server&quot;/&gt;
         &lt;package name=&quot;opennebula&quot;/&gt;
+        &lt;package name=&quot;opennebula-sunstone&quot;/&gt;
         &lt;package name=&quot;openssh&quot;/&gt;
         &lt;package name=&quot;openssl&quot;/&gt;
         &lt;package name=&quot;python&quot;/&gt;
diff --git a/doc/examples/extras/suse-11.3/suse-nebula-cloud/cloud_head/root/etc/init.d/cloudinfo b/doc/examples/extras/suse-11.3/suse-nebula-cloud/cloud_head/root/etc/init.d/cloudinfo
index c43dc01..de81289 100755
--- a/doc/examples/extras/suse-11.3/suse-nebula-cloud/cloud_head/root/etc/init.d/cloudinfo
+++ b/doc/examples/extras/suse-11.3/suse-nebula-cloud/cloud_head/root/etc/init.d/cloudinfo
@@ -8,7 +8,7 @@
 #
 ### BEGIN INIT INFO
 # Provides:       cloudinfo
-# Required-Start: $remote_fs $syslog network
+# Required-Start: $remote_fs $syslog $network
 # Required-Stop:  $remote_fs $syslog
 # Default-Start:  3 5
 # Default-Stop:   0 1 2 6
diff --git a/doc/examples/extras/suse-11.3/suse-nebula-cloud/cloud_head/root/etc/init.d/noderegistrar b/doc/examples/extras/suse-11.3/suse-nebula-cloud/cloud_head/root/etc/init.d/noderegistrar
index b2ecaca..7f827d9 100755
--- a/doc/examples/extras/suse-11.3/suse-nebula-cloud/cloud_head/root/etc/init.d/noderegistrar
+++ b/doc/examples/extras/suse-11.3/suse-nebula-cloud/cloud_head/root/etc/init.d/noderegistrar
@@ -8,7 +8,7 @@
 #
 ### BEGIN INIT INFO
 # Provides:       noderegistrar
-# Required-Start: $remote_fs $syslog network
+# Required-Start: $remote_fs $syslog $network
 # Required-Stop:  $remote_fs $syslog
 # Should-Start:   cloudinfo
 # Default-Start:  3 5
diff --git a/doc/examples/extras/suse-11.3/suse-nebula-cloud/cloud_head/root/usr/share/firstboot/scripts/finalizeSetup b/doc/examples/extras/suse-11.3/suse-nebula-cloud/cloud_head/root/usr/share/firstboot/scripts/finalizeSetup
index 20a45bb..97ca916 100755
--- a/doc/examples/extras/suse-11.3/suse-nebula-cloud/cloud_head/root/usr/share/firstboot/scripts/finalizeSetup
+++ b/doc/examples/extras/suse-11.3/suse-nebula-cloud/cloud_head/root/usr/share/firstboot/scripts/finalizeSetup
@@ -14,20 +14,20 @@ import syslog
 confFiles = glob.glob('/etc/sysconfig/network/ifcfg-eth*')
 numConfInterf = len(confFiles)
 if numConfInterf &gt; 1:
-    syslog.openlog('BR_SETUP]', syslog.LOG_PID, syslog.LOG_DAEMON)
-    syslog.syslog(syslog.LOG_INFO, 'Bridge setup\n')
-    msg = 'Multiple configured eth devices found, cannot resolve ambiguity\n'
-    syslog.syslog(syslog.LOG_ERR, msg)
-    syslog.closelog()
-    sys.exit(1)
+	syslog.openlog('BR_SETUP]', syslog.LOG_PID, syslog.LOG_DAEMON)
+	syslog.syslog(syslog.LOG_INFO, 'Bridge setup\n')
+	msg = 'Multiple configured eth devices found, cannot resolve ambiguity\n'
+	syslog.syslog(syslog.LOG_ERR, msg)
+	syslog.closelog()
+	sys.exit(1)
 
 if numConfInterf &lt; 1:
-    syslog.openlog('BR_SETUP]', syslog.LOG_PID, syslog.LOG_DAEMON)
-    syslog.syslog(syslog.LOG_INFO, 'Bridge setup\n')
-    msg = 'No eth interface configured, cannot setup bridge\n'
-    syslog.syslog(syslog.LOG_ERR, msg)
-    syslog.closelog()
-    sys.exit(1)
+	syslog.openlog('BR_SETUP]', syslog.LOG_PID, syslog.LOG_DAEMON)
+	syslog.syslog(syslog.LOG_INFO, 'Bridge setup\n')
+	msg = 'No eth interface configured, cannot setup bridge\n'
+	syslog.syslog(syslog.LOG_ERR, msg)
+	syslog.closelog()
+	sys.exit(1)
 
 # Get the configured IP address (includes the subnet mask)
 interfConf = confFiles[0]
@@ -35,9 +35,9 @@ interfaceName = interfConf.split('-')[-1]
 lines = open(interfConf, 'r').readlines()
 ipAddr = None
 for ln in lines:
-    if ln.find('IPADDR') != -1:
-        ipAddr = ln.strip().split('=')[-1]
-        break
+	if ln.find('IPADDR') != -1:
+		ipAddr = ln.strip().split('=')[-1]
+		break
 
 # Stop the running network services
 os.system('/etc/init.d/dhcpd stop &gt;&amp; /dev/null')
@@ -50,6 +50,7 @@ brCfg.write(&quot;BOOTPROTO='static'\n&quot;)
 brCfg.write(&quot;BRIDGE='yes'\n&quot;)
 brCfg.write(&quot;BRIDGE_PORTS='%s'\n&quot; %interfaceName)
 brCfg.write(&quot;BRIDGE_STP='off'\n&quot;)
+brCfg.write(&quot;BRIDGE_FORWARDDELAY=0\n&quot;)
 brCfg.write(&quot;BROADCAST=''\n&quot;)
 brCfg.write(&quot;ETHTOOL_OPTIONS=''\n&quot;)
 brCfg.write(&quot;IPADDR=%s\n&quot; %ipAddr)
@@ -67,12 +68,28 @@ brCfg.close()
 lines = open('/etc/sysconfig/dhcpd', 'r').readlines()
 conf = open('/etc/sysconfig/dhcpd', 'w')
 for ln in lines:
-    if ln.find('DHCPD_INTERFACE') != -1:
-        conf.write('DHCPD_INTERFACE=&quot;br0&quot;\n')
-        continue
-    conf.write(ln)
+	if ln.find('DHCPD_INTERFACE') != -1:
+		conf.write('DHCPD_INTERFACE=&quot;br0&quot;\n')
+		continue
+	conf.write(ln)
 conf.close()
-                   
+
+# Modify the sunstone init script
+lines = open('/etc/init.d/sunstone', 'r').readlines()
+sServInit = open('/etc/init.d/sunstone', 'w')
+for ln in lines:
+	if ln.find('HOST=') != -1:
+		ip = ipAddr.split('/')[0][1:]
+		sServInit.write('HOST=&quot;%s&quot;\n' %ip)
+		sServInit.write('ONE_AUTH=/var/lib/one/.one/one_auth\n')
+		sServInit.write('export ONE_AUTH\n')
+		continue
+	if ln.find('ONE_AUTH') != -1:
+		# Removing the placeholder
+		continue
+	sServInit.write(ln)
+sServInit.close()
+		
 # Run the configuration setup
 os.system('/sbin/SuSEconfig &gt;&amp; /dev/null')
 
@@ -90,3 +107,6 @@ os.system('chown oneadmin:cloud /var/lib/one/.one/one_auth')
 os.system('env ONE_AUTH=/var/lib/one/.one/one_auth /etc/init.d/one start &gt;&amp; /dev/null')
 os.system('/sbin/insserv one')
 os.system('/etc/init.d/one stop &gt;&amp; /dev/null')
+# Insert the Web-UI server
+os.system('/sbin/insserv sunstone')
+
diff --git a/doc/examples/extras/suse-11.4/suse-nebula-cloud/cloud_head/config.xml b/doc/examples/extras/suse-11.4/suse-nebula-cloud/cloud_head/config.xml
index a0c86e6..f6bc05c 100644
--- a/doc/examples/extras/suse-11.4/suse-nebula-cloud/cloud_head/config.xml
+++ b/doc/examples/extras/suse-11.4/suse-nebula-cloud/cloud_head/config.xml
@@ -15,7 +15,7 @@
                 &lt;oem-unattended&gt;true&lt;/oem-unattended&gt;
 			&lt;/oemconfig&gt;
 		&lt;/type&gt;
-		&lt;version&gt;1.1.0&lt;/version&gt;
+		&lt;version&gt;1.2.0&lt;/version&gt;
 		&lt;packagemanager&gt;zypper&lt;/packagemanager&gt;
 		&lt;rpm-check-signatures&gt;false&lt;/rpm-check-signatures&gt;
 		&lt;rpm-force&gt;true&lt;/rpm-force&gt;
@@ -29,7 +29,7 @@
 		&lt;source path=&quot;<A HREF="opensuse://11.4/repo/oss/">opensuse://11.4/repo/oss/</A>&quot;/&gt;
 	&lt;/repository&gt;
     &lt;repository type=&quot;rpm-md&quot;&gt;
-        &lt;source path=&quot;<A HREF="http://download.opensuse.org/repositories/Virtualization:/Cloud:/OpenNebula/openSUSE_11.4">http://download.opensuse.org/repositories/Virtualization:/Cloud:/OpenNebula/openSUSE_11.4</A>&quot;/&gt;
+        &lt;source path=&quot;<A HREF="opensuse://repositories/Virtualization:/Cloud:/OpenNebula/openSUSE_11.4">opensuse://repositories/Virtualization:/Cloud:/OpenNebula/openSUSE_11.4</A>&quot;/&gt;
     &lt;/repository&gt;
     &lt;repository type=&quot;rpm-md&quot;&gt;
         &lt;source path=&quot;<A HREF="opensuse://11.4/repo/oss/suse/">opensuse://11.4/repo/oss/suse/</A>&quot;/&gt;
@@ -47,6 +47,7 @@
 		&lt;package name=&quot;kernel-default&quot;/&gt;
         &lt;package name=&quot;nfs-kernel-server&quot;/&gt;
         &lt;package name=&quot;opennebula&quot;/&gt;
+        &lt;package name=&quot;opennebula-sunstone&quot;/&gt;
         &lt;package name=&quot;openssh&quot;/&gt;
         &lt;package name=&quot;openssl&quot;/&gt;
         &lt;package name=&quot;python&quot;/&gt;
diff --git a/doc/examples/extras/suse-11.4/suse-nebula-cloud/cloud_head/root/etc/init.d/cloudinfo b/doc/examples/extras/suse-11.4/suse-nebula-cloud/cloud_head/root/etc/init.d/cloudinfo
index c43dc01..de81289 100755
--- a/doc/examples/extras/suse-11.4/suse-nebula-cloud/cloud_head/root/etc/init.d/cloudinfo
+++ b/doc/examples/extras/suse-11.4/suse-nebula-cloud/cloud_head/root/etc/init.d/cloudinfo
@@ -8,7 +8,7 @@
 #
 ### BEGIN INIT INFO
 # Provides:       cloudinfo
-# Required-Start: $remote_fs $syslog network
+# Required-Start: $remote_fs $syslog $network
 # Required-Stop:  $remote_fs $syslog
 # Default-Start:  3 5
 # Default-Stop:   0 1 2 6
diff --git a/doc/examples/extras/suse-11.4/suse-nebula-cloud/cloud_head/root/etc/init.d/noderegistrar b/doc/examples/extras/suse-11.4/suse-nebula-cloud/cloud_head/root/etc/init.d/noderegistrar
index b2ecaca..7f827d9 100755
--- a/doc/examples/extras/suse-11.4/suse-nebula-cloud/cloud_head/root/etc/init.d/noderegistrar
+++ b/doc/examples/extras/suse-11.4/suse-nebula-cloud/cloud_head/root/etc/init.d/noderegistrar
@@ -8,7 +8,7 @@
 #
 ### BEGIN INIT INFO
 # Provides:       noderegistrar
-# Required-Start: $remote_fs $syslog network
+# Required-Start: $remote_fs $syslog $network
 # Required-Stop:  $remote_fs $syslog
 # Should-Start:   cloudinfo
 # Default-Start:  3 5
diff --git a/doc/examples/extras/suse-11.4/suse-nebula-cloud/cloud_head/root/usr/share/firstboot/scripts/finalizeSetup b/doc/examples/extras/suse-11.4/suse-nebula-cloud/cloud_head/root/usr/share/firstboot/scripts/finalizeSetup
index 20a45bb..97ca916 100755
--- a/doc/examples/extras/suse-11.4/suse-nebula-cloud/cloud_head/root/usr/share/firstboot/scripts/finalizeSetup
+++ b/doc/examples/extras/suse-11.4/suse-nebula-cloud/cloud_head/root/usr/share/firstboot/scripts/finalizeSetup
@@ -14,20 +14,20 @@ import syslog
 confFiles = glob.glob('/etc/sysconfig/network/ifcfg-eth*')
 numConfInterf = len(confFiles)
 if numConfInterf &gt; 1:
-    syslog.openlog('BR_SETUP]', syslog.LOG_PID, syslog.LOG_DAEMON)
-    syslog.syslog(syslog.LOG_INFO, 'Bridge setup\n')
-    msg = 'Multiple configured eth devices found, cannot resolve ambiguity\n'
-    syslog.syslog(syslog.LOG_ERR, msg)
-    syslog.closelog()
-    sys.exit(1)
+	syslog.openlog('BR_SETUP]', syslog.LOG_PID, syslog.LOG_DAEMON)
+	syslog.syslog(syslog.LOG_INFO, 'Bridge setup\n')
+	msg = 'Multiple configured eth devices found, cannot resolve ambiguity\n'
+	syslog.syslog(syslog.LOG_ERR, msg)
+	syslog.closelog()
+	sys.exit(1)
 
 if numConfInterf &lt; 1:
-    syslog.openlog('BR_SETUP]', syslog.LOG_PID, syslog.LOG_DAEMON)
-    syslog.syslog(syslog.LOG_INFO, 'Bridge setup\n')
-    msg = 'No eth interface configured, cannot setup bridge\n'
-    syslog.syslog(syslog.LOG_ERR, msg)
-    syslog.closelog()
-    sys.exit(1)
+	syslog.openlog('BR_SETUP]', syslog.LOG_PID, syslog.LOG_DAEMON)
+	syslog.syslog(syslog.LOG_INFO, 'Bridge setup\n')
+	msg = 'No eth interface configured, cannot setup bridge\n'
+	syslog.syslog(syslog.LOG_ERR, msg)
+	syslog.closelog()
+	sys.exit(1)
 
 # Get the configured IP address (includes the subnet mask)
 interfConf = confFiles[0]
@@ -35,9 +35,9 @@ interfaceName = interfConf.split('-')[-1]
 lines = open(interfConf, 'r').readlines()
 ipAddr = None
 for ln in lines:
-    if ln.find('IPADDR') != -1:
-        ipAddr = ln.strip().split('=')[-1]
-        break
+	if ln.find('IPADDR') != -1:
+		ipAddr = ln.strip().split('=')[-1]
+		break
 
 # Stop the running network services
 os.system('/etc/init.d/dhcpd stop &gt;&amp; /dev/null')
@@ -50,6 +50,7 @@ brCfg.write(&quot;BOOTPROTO='static'\n&quot;)
 brCfg.write(&quot;BRIDGE='yes'\n&quot;)
 brCfg.write(&quot;BRIDGE_PORTS='%s'\n&quot; %interfaceName)
 brCfg.write(&quot;BRIDGE_STP='off'\n&quot;)
+brCfg.write(&quot;BRIDGE_FORWARDDELAY=0\n&quot;)
 brCfg.write(&quot;BROADCAST=''\n&quot;)
 brCfg.write(&quot;ETHTOOL_OPTIONS=''\n&quot;)
 brCfg.write(&quot;IPADDR=%s\n&quot; %ipAddr)
@@ -67,12 +68,28 @@ brCfg.close()
 lines = open('/etc/sysconfig/dhcpd', 'r').readlines()
 conf = open('/etc/sysconfig/dhcpd', 'w')
 for ln in lines:
-    if ln.find('DHCPD_INTERFACE') != -1:
-        conf.write('DHCPD_INTERFACE=&quot;br0&quot;\n')
-        continue
-    conf.write(ln)
+	if ln.find('DHCPD_INTERFACE') != -1:
+		conf.write('DHCPD_INTERFACE=&quot;br0&quot;\n')
+		continue
+	conf.write(ln)
 conf.close()
-                   
+
+# Modify the sunstone init script
+lines = open('/etc/init.d/sunstone', 'r').readlines()
+sServInit = open('/etc/init.d/sunstone', 'w')
+for ln in lines:
+	if ln.find('HOST=') != -1:
+		ip = ipAddr.split('/')[0][1:]
+		sServInit.write('HOST=&quot;%s&quot;\n' %ip)
+		sServInit.write('ONE_AUTH=/var/lib/one/.one/one_auth\n')
+		sServInit.write('export ONE_AUTH\n')
+		continue
+	if ln.find('ONE_AUTH') != -1:
+		# Removing the placeholder
+		continue
+	sServInit.write(ln)
+sServInit.close()
+		
 # Run the configuration setup
 os.system('/sbin/SuSEconfig &gt;&amp; /dev/null')
 
@@ -90,3 +107,6 @@ os.system('chown oneadmin:cloud /var/lib/one/.one/one_auth')
 os.system('env ONE_AUTH=/var/lib/one/.one/one_auth /etc/init.d/one start &gt;&amp; /dev/null')
 os.system('/sbin/insserv one')
 os.system('/etc/init.d/one stop &gt;&amp; /dev/null')
+# Insert the Web-UI server
+os.system('/sbin/insserv sunstone')
+
diff --git a/doc/examples/extras/suse-12.1/suse-nebula-cloud/cloud_head/config.xml b/doc/examples/extras/suse-12.1/suse-nebula-cloud/cloud_head/config.xml
index 51b3f2f..2e2c282 100644
--- a/doc/examples/extras/suse-12.1/suse-nebula-cloud/cloud_head/config.xml
+++ b/doc/examples/extras/suse-12.1/suse-nebula-cloud/cloud_head/config.xml
@@ -15,7 +15,7 @@
                 &lt;oem-unattended&gt;true&lt;/oem-unattended&gt;
 			&lt;/oemconfig&gt;
 		&lt;/type&gt;
-		&lt;version&gt;1.1.0&lt;/version&gt;
+		&lt;version&gt;1.2.0&lt;/version&gt;
 		&lt;packagemanager&gt;zypper&lt;/packagemanager&gt;
 		&lt;rpm-check-signatures&gt;false&lt;/rpm-check-signatures&gt;
 		&lt;rpm-force&gt;true&lt;/rpm-force&gt;
@@ -29,7 +29,7 @@
 		&lt;source path=&quot;<A HREF="opensuse://12.1/repo/oss/">opensuse://12.1/repo/oss/</A>&quot;/&gt;
 	&lt;/repository&gt;
     &lt;repository type=&quot;rpm-md&quot;&gt;
-        &lt;source path=&quot;<A HREF="http://download.opensuse.org/repositories/Virtualization:/Cloud:/OpenNebula/openSUSE_12.1">http://download.opensuse.org/repositories/Virtualization:/Cloud:/OpenNebula/openSUSE_12.1</A>&quot;/&gt;
+        &lt;source path=&quot;<A HREF="opensuse://repositories/Virtualization:/Cloud:/OpenNebula/openSUSE_12.1">opensuse://repositories/Virtualization:/Cloud:/OpenNebula/openSUSE_12.1</A>&quot;/&gt;
     &lt;/repository&gt;
     &lt;repository type=&quot;rpm-md&quot;&gt;
         &lt;source path=&quot;<A HREF="opensuse://12.1/repo/oss/suse/">opensuse://12.1/repo/oss/suse/</A>&quot;/&gt;
@@ -47,6 +47,7 @@
 		&lt;package name=&quot;kernel-default&quot;/&gt;
         &lt;package name=&quot;nfs-kernel-server&quot;/&gt;
         &lt;package name=&quot;opennebula&quot;/&gt;
+        &lt;package name=&quot;opennebula-sunstone&quot;/&gt;
         &lt;package name=&quot;openssh&quot;/&gt;
         &lt;package name=&quot;openssl&quot;/&gt;
         &lt;package name=&quot;python&quot;/&gt;
diff --git a/doc/examples/extras/suse-12.1/suse-nebula-cloud/cloud_head/root/etc/init.d/cloudinfo b/doc/examples/extras/suse-12.1/suse-nebula-cloud/cloud_head/root/etc/init.d/cloudinfo
index c43dc01..de81289 100755
--- a/doc/examples/extras/suse-12.1/suse-nebula-cloud/cloud_head/root/etc/init.d/cloudinfo
+++ b/doc/examples/extras/suse-12.1/suse-nebula-cloud/cloud_head/root/etc/init.d/cloudinfo
@@ -8,7 +8,7 @@
 #
 ### BEGIN INIT INFO
 # Provides:       cloudinfo
-# Required-Start: $remote_fs $syslog network
+# Required-Start: $remote_fs $syslog $network
 # Required-Stop:  $remote_fs $syslog
 # Default-Start:  3 5
 # Default-Stop:   0 1 2 6
diff --git a/doc/examples/extras/suse-12.1/suse-nebula-cloud/cloud_head/root/etc/init.d/noderegistrar b/doc/examples/extras/suse-12.1/suse-nebula-cloud/cloud_head/root/etc/init.d/noderegistrar
index b2ecaca..7f827d9 100755
--- a/doc/examples/extras/suse-12.1/suse-nebula-cloud/cloud_head/root/etc/init.d/noderegistrar
+++ b/doc/examples/extras/suse-12.1/suse-nebula-cloud/cloud_head/root/etc/init.d/noderegistrar
@@ -8,7 +8,7 @@
 #
 ### BEGIN INIT INFO
 # Provides:       noderegistrar
-# Required-Start: $remote_fs $syslog network
+# Required-Start: $remote_fs $syslog $network
 # Required-Stop:  $remote_fs $syslog
 # Should-Start:   cloudinfo
 # Default-Start:  3 5
diff --git a/doc/examples/extras/suse-12.1/suse-nebula-cloud/cloud_head/root/usr/share/firstboot/scripts/finalizeSetup b/doc/examples/extras/suse-12.1/suse-nebula-cloud/cloud_head/root/usr/share/firstboot/scripts/finalizeSetup
index 20a45bb..97ca916 100755
--- a/doc/examples/extras/suse-12.1/suse-nebula-cloud/cloud_head/root/usr/share/firstboot/scripts/finalizeSetup
+++ b/doc/examples/extras/suse-12.1/suse-nebula-cloud/cloud_head/root/usr/share/firstboot/scripts/finalizeSetup
@@ -14,20 +14,20 @@ import syslog
 confFiles = glob.glob('/etc/sysconfig/network/ifcfg-eth*')
 numConfInterf = len(confFiles)
 if numConfInterf &gt; 1:
-    syslog.openlog('BR_SETUP]', syslog.LOG_PID, syslog.LOG_DAEMON)
-    syslog.syslog(syslog.LOG_INFO, 'Bridge setup\n')
-    msg = 'Multiple configured eth devices found, cannot resolve ambiguity\n'
-    syslog.syslog(syslog.LOG_ERR, msg)
-    syslog.closelog()
-    sys.exit(1)
+	syslog.openlog('BR_SETUP]', syslog.LOG_PID, syslog.LOG_DAEMON)
+	syslog.syslog(syslog.LOG_INFO, 'Bridge setup\n')
+	msg = 'Multiple configured eth devices found, cannot resolve ambiguity\n'
+	syslog.syslog(syslog.LOG_ERR, msg)
+	syslog.closelog()
+	sys.exit(1)
 
 if numConfInterf &lt; 1:
-    syslog.openlog('BR_SETUP]', syslog.LOG_PID, syslog.LOG_DAEMON)
-    syslog.syslog(syslog.LOG_INFO, 'Bridge setup\n')
-    msg = 'No eth interface configured, cannot setup bridge\n'
-    syslog.syslog(syslog.LOG_ERR, msg)
-    syslog.closelog()
-    sys.exit(1)
+	syslog.openlog('BR_SETUP]', syslog.LOG_PID, syslog.LOG_DAEMON)
+	syslog.syslog(syslog.LOG_INFO, 'Bridge setup\n')
+	msg = 'No eth interface configured, cannot setup bridge\n'
+	syslog.syslog(syslog.LOG_ERR, msg)
+	syslog.closelog()
+	sys.exit(1)
 
 # Get the configured IP address (includes the subnet mask)
 interfConf = confFiles[0]
@@ -35,9 +35,9 @@ interfaceName = interfConf.split('-')[-1]
 lines = open(interfConf, 'r').readlines()
 ipAddr = None
 for ln in lines:
-    if ln.find('IPADDR') != -1:
-        ipAddr = ln.strip().split('=')[-1]
-        break
+	if ln.find('IPADDR') != -1:
+		ipAddr = ln.strip().split('=')[-1]
+		break
 
 # Stop the running network services
 os.system('/etc/init.d/dhcpd stop &gt;&amp; /dev/null')
@@ -50,6 +50,7 @@ brCfg.write(&quot;BOOTPROTO='static'\n&quot;)
 brCfg.write(&quot;BRIDGE='yes'\n&quot;)
 brCfg.write(&quot;BRIDGE_PORTS='%s'\n&quot; %interfaceName)
 brCfg.write(&quot;BRIDGE_STP='off'\n&quot;)
+brCfg.write(&quot;BRIDGE_FORWARDDELAY=0\n&quot;)
 brCfg.write(&quot;BROADCAST=''\n&quot;)
 brCfg.write(&quot;ETHTOOL_OPTIONS=''\n&quot;)
 brCfg.write(&quot;IPADDR=%s\n&quot; %ipAddr)
@@ -67,12 +68,28 @@ brCfg.close()
 lines = open('/etc/sysconfig/dhcpd', 'r').readlines()
 conf = open('/etc/sysconfig/dhcpd', 'w')
 for ln in lines:
-    if ln.find('DHCPD_INTERFACE') != -1:
-        conf.write('DHCPD_INTERFACE=&quot;br0&quot;\n')
-        continue
-    conf.write(ln)
+	if ln.find('DHCPD_INTERFACE') != -1:
+		conf.write('DHCPD_INTERFACE=&quot;br0&quot;\n')
+		continue
+	conf.write(ln)
 conf.close()
-                   
+
+# Modify the sunstone init script
+lines = open('/etc/init.d/sunstone', 'r').readlines()
+sServInit = open('/etc/init.d/sunstone', 'w')
+for ln in lines:
+	if ln.find('HOST=') != -1:
+		ip = ipAddr.split('/')[0][1:]
+		sServInit.write('HOST=&quot;%s&quot;\n' %ip)
+		sServInit.write('ONE_AUTH=/var/lib/one/.one/one_auth\n')
+		sServInit.write('export ONE_AUTH\n')
+		continue
+	if ln.find('ONE_AUTH') != -1:
+		# Removing the placeholder
+		continue
+	sServInit.write(ln)
+sServInit.close()
+		
 # Run the configuration setup
 os.system('/sbin/SuSEconfig &gt;&amp; /dev/null')
 
@@ -90,3 +107,6 @@ os.system('chown oneadmin:cloud /var/lib/one/.one/one_auth')
 os.system('env ONE_AUTH=/var/lib/one/.one/one_auth /etc/init.d/one start &gt;&amp; /dev/null')
 os.system('/sbin/insserv one')
 os.system('/etc/init.d/one stop &gt;&amp; /dev/null')
+# Insert the Web-UI server
+os.system('/sbin/insserv sunstone')
+


hooks/post-receive
-- 
Project kiwi at BerliOS

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="003616.html">[Kiwi-devel] Improving the OpenNebula example
</A></li>
	<LI>Next message: <A HREF="003617.html">[Kiwi-devel] [Git]Project kiwi at BerliOS branch, master,	updated. d0de4ea55c360979d09286bb7edac7c58c6a8ae1
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3615">[ date ]</a>
              <a href="thread.html#3615">[ thread ]</a>
              <a href="subject.html#3615">[ subject ]</a>
              <a href="author.html#3615">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/kiwi-devel">More information about the Kiwi-devel
mailing list</a><br>
</body></html>

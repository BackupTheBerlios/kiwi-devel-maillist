<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Kiwi-devel] [Git]Project kiwi at BerliOS branch, master,	updated. 0b96fbcc3cc2c4848c8f64da3c840279ca8c240d
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/kiwi-devel/2011-April/index.html" >
   <LINK REL="made" HREF="mailto:kiwi-devel%40lists.berlios.de?Subject=Re%3A%20%5BKiwi-devel%5D%20%5BGit%5DProject%20kiwi%20at%20BerliOS%20branch%2C%20master%2C%0A%09updated.%200b96fbcc3cc2c4848c8f64da3c840279ca8c240d&In-Reply-To=%3C20110403191535.E73CA480C90%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="003284.html">
   <LINK REL="Next"  HREF="003287.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Kiwi-devel] [Git]Project kiwi at BerliOS branch, master,	updated. 0b96fbcc3cc2c4848c8f64da3c840279ca8c240d</H1>
    <B>marcus_schaefer at BerliOS</B> 
    <A HREF="mailto:kiwi-devel%40lists.berlios.de?Subject=Re%3A%20%5BKiwi-devel%5D%20%5BGit%5DProject%20kiwi%20at%20BerliOS%20branch%2C%20master%2C%0A%09updated.%200b96fbcc3cc2c4848c8f64da3c840279ca8c240d&In-Reply-To=%3C20110403191535.E73CA480C90%40sheep.berlios.de%3E"
       TITLE="[Kiwi-devel] [Git]Project kiwi at BerliOS branch, master,	updated. 0b96fbcc3cc2c4848c8f64da3c840279ca8c240d">marcus_schaefer at mail.berlios.de
       </A><BR>
    <I>Sun Apr  3 21:15:35 CEST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="003284.html">[Kiwi-devel] XML test refinement
</A></li>
        <LI>Next message: <A HREF="003287.html">[Kiwi-devel] kiwi: Weekly report 2011-03-27 - 2011-04-01...
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3286">[ date ]</a>
              <a href="thread.html#3286">[ thread ]</a>
              <a href="subject.html#3286">[ subject ]</a>
              <a href="author.html#3286">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>This is an automated email from the git hooks/post-receive script. It was
generated because a ref change was pushed to the repository containing
the project &quot;Project kiwi at BerliOS&quot;.

The branch, master has been updated
       via  0b96fbcc3cc2c4848c8f64da3c840279ca8c240d (commit)
       via  1fa62210fdffc48f8346663769aa05f5d1d9934b (commit)
       via  92d1a7358cc1152f4831f4be32192d65419540a0 (commit)
      from  c8b8dce8bc1ea227b9606fd4c238877129c43491 (commit)

Those revisions listed above that are new to this repository have
not appeared on any other notification email; so we list those
revisions in full, below.

- Log -----------------------------------------------------------------
commit 0b96fbcc3cc2c4848c8f64da3c840279ca8c240d
Author: Marcus Sch&#195;&#164;fer &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/kiwi-devel">ms at novell.com</A>&gt;
Date:   Sun Apr 3 20:39:09 2011 +0200

    - update spec file, added jing as recommended package

commit 1fa62210fdffc48f8346663769aa05f5d1d9934b
Author: Marcus Sch&#195;&#164;fer &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/kiwi-devel">ms at novell.com</A>&gt;
Date:   Sun Apr 3 20:37:45 2011 +0200

    - added unit tests for the new KIWIXMLInfo object. Also
      break up the bigger tests into smaller test cases

commit 92d1a7358cc1152f4831f4be32192d65419540a0
Author: Marcus Sch&#195;&#164;fer &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/kiwi-devel">ms at novell.com</A>&gt;
Date:   Sun Apr 3 20:36:00 2011 +0200

    - added a new KIWIXMLInfo object and eliminate the
      listXMLInfo() function from kiwi.pl

-----------------------------------------------------------------------

Summary of changes:
diff --git a/kiwi.pl b/kiwi.pl
index 8a09162..9004e4f 100755
--- a/kiwi.pl
+++ b/kiwi.pl
@@ -44,6 +44,7 @@ use KIWIOverlay;
 use KIWIQX;
 use KIWIRuntimeChecker;
 use KIWIImageFormat;
+use KIWIXMLInfo;
 use KIWIXMLValidator;
 
 #============================================
@@ -193,8 +194,6 @@ our $LogPort;               # specify alternative log server port
 our $GzipCmd;               # command to run to gzip things
 our $PrebuiltBootImage;     # directory where a prepared boot image may be found
 our $PreChrootCall;         # program name called before chroot switch
-our $listXMLInfo;           # list XML information for this operation
-our @listXMLInfoSelection;  # info selection for listXMLInfo
 our $CreatePassword;        # create crypted password
 our $ISOCheck;              # create checkmedia boot entry
 our $FSBlockSize;           # filesystem block size
@@ -1160,8 +1159,11 @@ sub init {
 	$SIG{&quot;TERM&quot;}     = \&quit;
 	$SIG{&quot;INT&quot;}      = \&quit;
 	my $Help;
-	my $Version;
+	my $ListXMLInfo;           # list XML information for this operation
+	my @ListXMLInfoSelection;  # info selection for listXMLInfo
 	my $PackageManager;
+	my $Version;
+
 	my $kiwi = new KIWILog(&quot;tiny&quot;);
 	$cmdL = new KIWICommandLine($kiwi);
 	#==========================================
@@ -1223,8 +1225,8 @@ sub init {
 		&quot;package-manager=s&quot;     =&gt; \$PackageManager,
 		&quot;prebuiltbootimage=s&quot;   =&gt; \$PrebuiltBootImage,
 		&quot;prechroot-call=s&quot;      =&gt; \$PreChrootCall,
-		&quot;info|i=s&quot;              =&gt; \$listXMLInfo,
-		&quot;select=s&quot;              =&gt; \@listXMLInfoSelection,
+		&quot;info|i=s&quot;              =&gt; \$ListXMLInfo,
+		&quot;select=s&quot;              =&gt; \@ListXMLInfoSelection,
 		&quot;fs-blocksize=i&quot;        =&gt; \$FSBlockSize,
 		&quot;fs-journalsize=i&quot;      =&gt; \$FSJournalSize,
 		&quot;fs-inodesize=i&quot;        =&gt; \$FSInodeSize,
@@ -1247,6 +1249,66 @@ sub init {
 		&quot;help|h&quot;                =&gt; \$Help
 	);
 	#========================================
+	# check if repositories are to be added
+	#----------------------------------------
+	if (defined @AddRepository) {
+		my $res = $cmdL -&gt; setAdditionalRepos(
+			\@AddRepository,
+			\@AddRepositoryAlias,
+			\@AddRepositoryPriority,
+			\@AddRepositoryType
+		);
+		if (! $res) {
+			my $code = kiwiExit (1); return $code;
+		}
+	}
+	#========================================
+	# check if repositories are to be ignored
+	#----------------------------------------
+	if (defined $IgnoreRepos) {
+		$cmdL -&gt; setIgnoreRepos(1);
+	}
+	#========================================
+	# check if we are doing caching
+	#----------------------------------------
+	if (defined $InitCache) {
+		$cmdL -&gt; setAdditionalRepos(
+			\@AddRepository,
+			\@AddRepositoryAlias,
+			\@AddRepositoryPriority,
+			\@AddRepositoryType
+		);
+		$cmdL -&gt; setBuildProfiles(\@Profiles);
+		$cmdL -&gt; setConfigDir($InitCache);
+		my $res = $cmdL -&gt; setIgnoreRepos($IgnoreRepos);
+		if (! $res) {
+			my $code = kiwiExit (1); return $code;
+		}
+		if (defined $LogFile) {
+			$res = $cmdL -&gt; setLogFile($LogFile);
+		}
+		if (defined $PackageManager) {
+			$res = $cmdL -&gt; setPackageManager($PackageManager);
+		}
+		if (defined $SetRepository) {
+			$res = $cmdL -&gt; setReplacementRepo(
+				$SetRepository,
+				$SetRepositoryAlias,
+				$SetRepositoryPriority,
+				$SetRepositoryType
+			);
+		}
+		if (! $res) {
+			my $code = kiwiExit (1); return $code;
+		}
+	}
+	#========================================
+	# check if a specifc logfile has been defined
+	#----------------------------------------
+	if (defined $LogFile) {
+		$cmdL -&gt; setLogFile($LogFile);
+	}
+	#========================================
 	# check if a package manager is specified
 	#----------------------------------------
 	if (defined $PackageManager) {
@@ -1261,6 +1323,20 @@ sub init {
 	if (defined $RecycleRoot) {
 		$RecycleRoot = $RootTree;
 	}
+	#========================================
+	# check replacement repo information
+	#----------------------------------------
+	if (defined $SetRepository) {
+		my $result = $cmdL -&gt; setReplacementRepo(
+			$SetRepository,
+			$SetRepositoryAlias,
+			$SetRepositoryPriority,
+			$SetRepositoryType
+		);
+		if (! $result) {
+			my $code = kiwiExit (1); return $code;
+		}
+	}
 	#============================================
 	# check Partitioner according to device
 	#--------------------------------------------
@@ -1394,7 +1470,7 @@ sub init {
 		(! defined $BootVMDisk)         &amp;&amp;
 		(! defined $Migrate)            &amp;&amp;
 		(! defined $InstallStick)       &amp;&amp;
-		(! defined $listXMLInfo)        &amp;&amp;
+		(! defined $ListXMLInfo)        &amp;&amp;
 		(! defined $CreatePassword)     &amp;&amp;
 		(! defined $BootCD)             &amp;&amp;
 		(! defined $BootUSB)            &amp;&amp;
@@ -1410,6 +1486,7 @@ sub init {
 		$kiwi -&gt; warning (&quot;Logfile set to terminal in init-cache mode&quot;);
 		$kiwi -&gt; done ();
 		$LogFile = &quot;terminal&quot;;
+		$cmdL -&gt; setLogFile($LogFile);
 	}
 	if (($targetDevice) &amp;&amp; (! -b $targetDevice)) {
 		$kiwi -&gt; error (&quot;Target device $targetDevice doesn't exist&quot;);
@@ -1421,11 +1498,6 @@ sub init {
 		$kiwi -&gt; failed ();
 		my $code = kiwiExit (1); return $code;
 	}
-	if ((defined @AddRepository) &amp;&amp; (! defined @AddRepositoryType)) {
-		$kiwi -&gt; error (&quot;No repository type specified&quot;);
-		$kiwi -&gt; failed ();
-		my $code = kiwiExit (1); return $code;
-	}
 	if ((defined $RootTree) &amp;&amp; ($RootTree !~ /^\//)) {
 		my $workingDir = qxx ( &quot;pwd&quot; ); chomp $workingDir;
 		$RootTree = $workingDir.&quot;/&quot;.$RootTree;
@@ -1469,8 +1541,45 @@ sub init {
 	} elsif (defined $Build) {
 		$cmdL -&gt; setTargetDirsForBuild();
 	}
-	if (defined $listXMLInfo) {
-		listXMLInfo();
+	if (defined $ListXMLInfo) {
+		$cmdL -&gt; setAdditionalRepos(
+			\@AddRepository,
+			\@AddRepositoryAlias,
+			\@AddRepositoryPriority,
+			\@AddRepositoryType
+		);
+		$cmdL -&gt; setBuildProfiles(\@Profiles);
+		$cmdL -&gt; setConfigDir($ListXMLInfo);
+		my $res = $cmdL -&gt; setIgnoreRepos($IgnoreRepos);
+		if (! $res) {
+			my $code = kiwiExit (1); return $code;
+		}
+		if (defined $LogFile) {
+			$res = $cmdL -&gt; setLogFile($LogFile);
+		}
+		if (defined $PackageManager) {
+			$res = $cmdL -&gt; setPackageManager($PackageManager);
+		}
+		if (defined $SetRepository) {
+			$res = $cmdL -&gt; setReplacementRepo(
+				$SetRepository,
+				$SetRepositoryAlias,
+				$SetRepositoryPriority,
+				$SetRepositoryType
+			);
+		}
+		if (! $res) {
+			my $code = kiwiExit (1); return $code;
+		}
+		my $info = new KIWIXMLInfo($kiwi, $cmdL);
+		if (! $info) {
+			my $code = kiwiExit (1); return $code;
+		}
+		$res = $info -&gt; printXMLInfo(\@ListXMLInfoSelection);
+		if (! $res) {
+			my $code = kiwiExit (1); return $code;
+		}
+		my $code = kiwiExit (0); return $code;
 	}
 	if (defined $SetImageType) {
 		$cmdL -&gt; setBuildType($SetImageType);
@@ -1763,349 +1872,6 @@ sub checkConfig {
 }
 
 #==========================================
-# listXMLInfo
-#------------------------------------------
-sub listXMLInfo {
-	# ...
-	# print information about the XML description. The
-	# information listed here is for information only
-	# before a prepare and/or create command is called
-	# ---
-	my $internal = shift;
-	my %select;
-	my $gotselection = 0;
-	my $meta;
-	my $delete;
-	my $solfile;
-	my $satlist;
-	my $solp;
-	my $rpat;
-	#==========================================
-	# Create info block description
-	#------------------------------------------
-	$select{&quot;repo-patterns&quot;} = &quot;List available patterns from repos&quot;;
-	$select{&quot;patterns&quot;}      = &quot;List configured patterns&quot;;
-	$select{&quot;types&quot;}         = &quot;List configured types&quot;;
-	$select{&quot;sources&quot;}       = &quot;List configured source URLs&quot;;
-	$select{&quot;size&quot;}          = &quot;List install/delete size estimation&quot;;
-	$select{&quot;packages&quot;}      = &quot;List of packages to become installed&quot;;
-	$select{&quot;profiles&quot;}      = &quot;List profiles&quot;;
-	$select{&quot;version&quot;}       = &quot;List name and version&quot;;
-	#==========================================
-	# Create log object
-	#------------------------------------------
-	if (! defined $kiwi) {
-		$kiwi = new KIWILog(&quot;tiny&quot;);
-	}
-	#==========================================
-	# Setup logging location
-	#------------------------------------------
-	if (defined $LogFile) {
-		if ((! defined $Survive) || ($Survive ne &quot;yes&quot;)) {
-			$kiwi -&gt; info (&quot;Setting log file to: $LogFile\n&quot;);
-			if (! $kiwi -&gt; setLogFile ( $LogFile )) {
-				exit 1;
-			}
-		}
-	}
-	#==========================================
-	# Check selection list
-	#------------------------------------------
-	foreach my $info (@listXMLInfoSelection) {
-		if (defined $select{$info}) {
-			$gotselection = 1; last;
-		}
-	}
-	if (! $gotselection) {
-		$kiwi -&gt; error  (&quot;Can't find info for given selection&quot;);
-		$kiwi -&gt; failed ();
-		$kiwi -&gt; info   (&quot;Choose between the following:\n&quot;);
-		foreach my $info (keys %select) {
-			my $s = sprintf (&quot;--&gt; %-15s:%s\n&quot;,$info,$select{$info});
-			$kiwi -&gt; info ($s); 
-		}
-		exit 1;
-	}
-	$kiwi -&gt; info (&quot;Reading image description [ListXMLInfo]...\n&quot;);
-	my $xml  = new KIWIXML (
-		$kiwi,$listXMLInfo,undef,\@Profiles
-	);
-	if (! defined $xml) {
-		exit 1;
-	}
-	my $pkgMgr = $cmdL -&gt; getPackageManager();
-	if ($pkgMgr) {
-		$xml -&gt; setPackageManager($pkgMgr);
-	}
-	#==========================================
-	# Check for ignore-repos option
-	#------------------------------------------
-	if (defined $IgnoreRepos) {
-		$xml -&gt; ignoreRepositories ();
-	}
-	#==========================================
-	# Check for set-repo option
-	#------------------------------------------
-	if (defined $SetRepository) {
-		$xml -&gt; setRepository (
-			$SetRepositoryType,$SetRepository,
-			$SetRepositoryAlias,$SetRepositoryPriority
-		);
-	}
-	#==========================================
-	# Check for add-repo option
-	#------------------------------------------
-	if (defined @AddRepository) {
-		$xml -&gt; addRepository (
-			\@AddRepositoryType,\@AddRepository,
-			\@AddRepositoryAlias,\@AddRepositoryPriority
-		);
-	}
-	#==========================================
-	# Setup loop sources
-	#------------------------------------------
-	my @mountInfolist = ();
-	if ($xml-&gt;{urlhash}) {
-		foreach my $source (keys %{$xml-&gt;{urlhash}}) {
-			#==========================================
-			# <A HREF="iso://">iso://</A> sources
-			#------------------------------------------
-			if ($source =~ /^iso:\/\/(.*)/) {
-				my $iso  = $1;
-				my $dir  = $xml-&gt;{urlhash}-&gt;{$source};
-				my $data = qxx (&quot;mkdir -p $dir; mount -o loop $iso $dir 2&gt;&amp;1&quot;);
-				my $code = $? &gt;&gt; 8;
-				if ($code != 0) {
-					$kiwi -&gt; failed ();
-					$kiwi -&gt; error  (&quot;Failed to loop mount ISO path: $data&quot;);
-					$kiwi -&gt; failed ();
-					rmdir $dir;
-					exit 1;
-				}
-				push (@mountInfolist,$dir);
-			}
-		}
-	}
-	sub newCleanMount {
-		my @list = shift;
-		return sub {
-			foreach my $dir (@list) {
-				next if ! defined $dir;
-				qxx (&quot;umount $dir ; rmdir $dir 2&gt;&amp;1&quot;);
-			}
-		}
-	}
-	*cleanInfoMount = newCleanMount (@mountInfolist);
-	#==========================================
-	# Initialize XML imagescan element
-	#------------------------------------------
-	my $scan = new XML::LibXML::Element (&quot;imagescan&quot;);
-	#==========================================
-	# Walk through selection list
-	#------------------------------------------
-	foreach my $info (@listXMLInfoSelection) {
-		SWITCH: for ($info) {
-			#==========================================
-			# repo-patterns
-			#------------------------------------------
-			/^repo-patterns/ &amp;&amp; do {
-				if (! $meta) {
-					($meta,$delete,$solfile,$satlist,$solp,$rpat) =
-						$xml-&gt;getInstallSize();
-					if (! $meta) {
-						$kiwi -&gt; failed();
-						cleanInfoMount();
-						exit 1;
-					}
-				}
-				if (! $rpat) {
-					$kiwi -&gt; info (&quot;No patterns in repo solvable\n&quot;);
-				} else {
-					foreach my $p (@{$rpat}) {
-						next if ($p eq &quot;\n&quot;);
-						$p =~ s/^\s+//;
-						$p =~ s/\s+$//;
-						my $pattern = new XML::LibXML::Element (&quot;repopattern&quot;);
-						$pattern -&gt; setAttribute (&quot;name&quot;,&quot;$p&quot;);
-						$scan -&gt; appendChild ($pattern);
-					}
-				}
-				last SWITCH;
-			};
-			#==========================================
-			# patterns
-			#------------------------------------------
-			/^patterns/      &amp;&amp; do {
-				if (! $meta) {
-					($meta,$delete,$solfile,$satlist,$solp) =
-						$xml-&gt;getInstallSize();
-					if (! $meta) {
-						$kiwi -&gt; failed();
-						cleanInfoMount();
-						exit 1;
-					}
-				}
-				if (! keys %{$meta}) {
-					$kiwi -&gt; info (&quot;No packages/patterns solved\n&quot;);
-				} else {
-					foreach my $p (sort keys %{$meta}) {
-						if ($p =~ /pattern:(.*)/) {
-							my $name = $1;
-							my $pattern = new XML::LibXML::Element (&quot;pattern&quot;);
-							$pattern -&gt; setAttribute (&quot;name&quot;,&quot;$name&quot;);
-							$scan -&gt; appendChild ($pattern);
-						}
-					}
-				}
-				last SWITCH;
-			};
-			#==========================================
-			# types
-			#------------------------------------------
-			/^types/         &amp;&amp; do {
-				foreach my $t ($xml -&gt; getTypes()) {
-					my %type = %{$t};
-					my $type = new XML::LibXML::Element (&quot;type&quot;);
-					$type -&gt; setAttribute (&quot;name&quot;,&quot;$type{type}&quot;);
-					$type -&gt; setAttribute (&quot;primary&quot;,&quot;$type{primary}&quot;);
-					if (defined $type{boot}) {
-						$type -&gt; setAttribute (&quot;boot&quot;,&quot;$type{boot}&quot;);
-					}
-					$scan -&gt; appendChild ($type);
-				}
-				last SWITCH;
-			};
-			#==========================================
-			# sources
-			#------------------------------------------
-			/^sources/       &amp;&amp; do {
-				my %repos = $xml -&gt; getRepository();
-				foreach my $url (keys %repos) {
-					my $source = new XML::LibXML::Element (&quot;source&quot;);
-					$source -&gt; setAttribute (&quot;path&quot;,&quot;$url&quot;);
-					$source -&gt; setAttribute (&quot;type&quot;,$repos{$url}-&gt;[0]);
-					$scan -&gt; appendChild ($source);
-				}
-				last SWITCH;
-			};
-			#==========================================
-			# size
-			#------------------------------------------
-			/^size/          &amp;&amp; do {
-				if (! $meta) {
-					($meta,$delete,$solfile,$satlist,$solp) =
-						$xml-&gt;getInstallSize();
-					if (! $meta) {
-						$kiwi -&gt; failed();
-						cleanInfoMount();
-						exit 1;
-					}
-				}
-				my $size = 0;
-				my %meta = %{$meta};
-				foreach my $p (keys %meta) {
-					my @metalist = split (/:/,$meta{$p});
-					$size += $metalist[0];
-				}
-				my $sizenode = new XML::LibXML::Element (&quot;size&quot;);
-				if ($size &gt; 0) {
-					$sizenode -&gt; setAttribute (&quot;rootsizeKB&quot;,&quot;$size&quot;);
-				}
-				$size = 0;
-				if ($delete) {
-					foreach my $del (@{$delete}) {
-						if ($meta{$del}) {
-							my @metalist = split (/:/,$meta{$del});
-							$size += $metalist[0];
-						}
-					}
-				}
-				if ($size &gt; 0) {
-					$sizenode -&gt; setAttribute (&quot;deletionsizeKB&quot;,&quot;$size&quot;);
-				}
-				$scan -&gt; appendChild ($sizenode);
-				last SWITCH;
-			};
-			#==========================================
-			# packages
-			#------------------------------------------
-			/^packages/     &amp;&amp; do {
-				if (! $meta) {
-					($meta,$delete,$solfile,$satlist,$solp) =
-						$xml-&gt;getInstallSize();
-					if (! $meta) {
-						$kiwi -&gt; failed();
-						cleanInfoMount();
-						exit 1;
-					}
-				}
-				if (! keys %{$meta}) {
-					$kiwi -&gt; info (&quot;No packages/patterns solved\n&quot;);
-				} else {
-					foreach my $p (sort keys %{$meta}) {
-						if ($p =~ /pattern:.*/) {
-							next;
-						}
-						my @m = split (/:/,$meta-&gt;{$p});
-						my $pacnode = new XML::LibXML::Element (&quot;package&quot;);
-						$pacnode -&gt; setAttribute (&quot;name&quot;,&quot;$p&quot;);
-						$pacnode -&gt; setAttribute (&quot;arch&quot;,&quot;$m[1]&quot;);
-						$pacnode -&gt; setAttribute (&quot;version&quot;,&quot;$m[2]&quot;);
-						$scan -&gt; appendChild ($pacnode);
-					}
-				}
-				last SWITCH;
-			};
-			#==========================================
-			# profiles
-			#------------------------------------------
-			/^profiles/      &amp;&amp; do {
-				my @profiles = $xml -&gt; getProfiles ();
-				if ((scalar @profiles) == 0) {
-					$kiwi -&gt; info (&quot;No profiles available\n&quot;);
-				} else {
-					foreach my $profile (@profiles) {
-						my $name = $profile -&gt; {name};
-						my $desc = $profile -&gt; {description};
-						my $pnode = new XML::LibXML::Element (&quot;profile&quot;);
-						$pnode -&gt; setAttribute (&quot;name&quot;,&quot;$name&quot;);
-						$pnode -&gt; setAttribute (&quot;description&quot;,&quot;$desc&quot;);
-						$scan -&gt; appendChild ($pnode);
-					}
-				}
-				last SWITCH;
-			};
-			#==========================================
-			# version
-			#------------------------------------------
-			/^version/       &amp;&amp; do {
-				my $version = $xml -&gt; getImageVersion();
-				my $appname = $xml -&gt; getImageName();
-				my $vnode = new XML::LibXML::Element (&quot;image&quot;);
-				$vnode -&gt; setAttribute (&quot;version&quot;,&quot;$version&quot;);
-				$vnode -&gt; setAttribute (&quot;name&quot;,&quot;$appname&quot;);
-				$scan -&gt; appendChild ($vnode);
-			};
-		}
-	}
-	#==========================================
-	# Cleanup mount list
-	#------------------------------------------
-	cleanInfoMount();
-	#==========================================
-	# print scan results
-	#------------------------------------------
-	if ($internal) {
-		return $scan;
-	} else {
-		open (my $F, &quot;|xsltproc $main::Pretty -&quot;);
-		print $F $scan-&gt;toString();
-		close $F;
-		exit 0;
-	}
-}
-
-#==========================================
 # cloneImage
 #------------------------------------------
 sub cloneImage {
@@ -3055,15 +2821,14 @@ sub initializeCache {
 	#==========================================
 	# Create image package list
 	#------------------------------------------
-	$listXMLInfo = $mode;
-	@listXMLInfoSelection = (&quot;packages&quot;,&quot;sources&quot;);
-	$CacheScan = listXMLInfo (&quot;internal&quot;);
+	$cmdL -&gt; setConfigDir($mode);
+	my $info = new KIWIXMLInfo($kiwi, $cmdL);
+	my @infoReq = ('packages', 'sources');
+	$CacheScan = $info -&gt; getXMLInfoTree(\@infoReq);
 	if (! $CacheScan) {
 		undef $ImageCache;
 		return undef;
 	}
-	undef $listXMLInfo;
-	undef @listXMLInfoSelection;
 	#==========================================
 	# Return result list
 	#------------------------------------------
diff --git a/modules/KIWICommandLine.pm b/modules/KIWICommandLine.pm
index 9a03797..865c8fa 100644
--- a/modules/KIWICommandLine.pm
+++ b/modules/KIWICommandLine.pm
@@ -20,6 +20,7 @@ package KIWICommandLine;
 use strict;
 use warnings;
 require Exporter;
+use File::Spec;
 use KIWILog;
 
 #==========================================
@@ -51,20 +52,20 @@ sub new {
 	if (! defined $kiwi) {
 		$kiwi = new KIWILog(&quot;tiny&quot;);
 	}
+	my @supportedRepos = qw(
+		apt-deb apt-rpm deb-dir mirrors red-carpet
+		rpm-dir rpm-md slack-site up2date-mirrors
+		urpmi yast2
+	);
 	#==========================================
 	# Object initialize object member data
 	#------------------------------------------
-	$this-&gt;{addPackages}   = ''; # Holds array ref
-	$this-&gt;{addPatterns}   = ''; # Holds array ref
-	$this-&gt;{addRepos}      = ''; # Holds array ref
-	$this-&gt;{buildType}     = '';
-	$this-&gt;{buildProfiles} = ''; # Holds array ref
-	$this-&gt;{configDir}     = '';
-	$this-&gt;{imageTgtDir}   = '';
-	$this-&gt;{kiwi}          = $kiwi;
-	$this-&gt;{packageMgr}    = '';
-	$this-&gt;{rootTgtDir}    = '';
-
+	$this-&gt;{addPackages}        = ''; # Holds array ref
+	$this-&gt;{addPatterns}        = ''; # Holds array ref
+	$this-&gt;{imageTgtDir}        = '';
+	$this-&gt;{kiwi}               = $kiwi;
+	$this-&gt;{rootTgtDir}         = '';
+	$this-&gt;{supportedRepoTypes} = \@supportedRepos;
 	return $this;
 }
 
@@ -84,6 +85,12 @@ sub getAdditionalPatterns {
 # getAdditionalRepos
 #------------------------------------------
 sub getAdditionalRepos {
+	# ...
+	# Return the information about additional repositories set by the user
+	# on the command line.
+	# ---
+	my $this = shift;
+	return $this -&gt; {additionalRepos};
 }
 
 #==========================================
@@ -120,6 +127,17 @@ sub getConfigDir {
 }
 
 #==========================================
+# getIgnoreRepos
+#------------------------------------------
+sub getIgnoreRepos {
+	# ...
+	# Return the user requested state about ignoring configured repositories
+	# ---
+	my $this = shift;
+	return $this -&gt; {ignoreRepos};
+}
+
+#==========================================
 # getImageTargetDir
 #------------------------------------------
 sub getImageTargetDir {
@@ -131,6 +149,17 @@ sub getImageTargetDir {
 }
 
 #==========================================
+# getLogFile
+#------------------------------------------
+sub getLogFile {
+	# ...
+	# Return the path of the logfile specified on the command line
+	# ---
+	my $this = shift;
+	return $this -&gt; {logFile};
+}
+
+#==========================================
 # getPackageManager
 #------------------------------------------
 sub getPackageManager {
@@ -142,7 +171,19 @@ sub getPackageManager {
 }
 
 #==========================================
-# getPrepTargetDir
+# getReplacementRepo
+#------------------------------------------
+sub getReplacementRepo {
+	# ...
+	# Return the repository information for the repo specified by the user
+	# to replace the first configured repository
+	# ---
+	my $this = shift;
+	return $this -&gt; {replacementRepo};
+}
+
+#==========================================
+# getRootTargetDir
 #------------------------------------------
 sub getRootTargetDir {
 	# ...
@@ -168,6 +209,110 @@ sub setAdditionalPatterns {
 # setAdditionalRepos
 #------------------------------------------
 sub setAdditionalRepos {
+	# ...
+	# Set repository information for added repositories specified on
+	# the command line.
+	# ---
+	my $this      = shift;
+	my $repos     = shift;
+	my $repoAlias = shift;
+	my $repoPrios = shift;
+	my $repoTypes = shift;
+	my $kiwi = $this-&gt;{kiwi};
+	if (! $repos) {
+		my $msg = 'setAdditionalRepos method called without specifying '
+		. 'repositories';
+		$kiwi -&gt; error ($msg);
+		$kiwi -&gt; failed();
+		return undef;
+	}
+	if (! ref $repos) {
+		my $msg = 'setAdditionalRepos method expecting ARRAY_REF as '
+			. 'first argument.';
+		$kiwi -&gt; error ($msg);
+		$kiwi -&gt; failed();
+		return undef;
+	}
+	if (($repoAlias) &amp;&amp; (! ref $repoAlias)) {
+		my $msg = 'setAdditionalRepos method expecting ARRAY_REF as '
+			. 'second argument.';
+		$kiwi -&gt; error ($msg);
+		$kiwi -&gt; failed();
+		return undef;
+	}
+	if (($repoPrios) &amp;&amp; (! ref $repoPrios)) {
+		my $msg = 'setAdditionalRepos method expecting ARRAY_REF as '
+			. 'third argument.';
+		$kiwi -&gt; error ($msg);
+		$kiwi -&gt; failed();
+		return undef;
+	}
+	if (! $repoTypes) {
+		my $msg = 'setAdditionalRepos method called without specifying '
+		. 'repository types';
+		$kiwi -&gt; error ($msg);
+		$kiwi -&gt; failed();
+		return undef;
+	}
+	if (! ref $repoTypes) {
+		my $msg = 'setAdditionalRepos method expecting ARRAY_REF as '
+			. 'fourth argument.';
+		$kiwi -&gt; error ($msg);
+		$kiwi -&gt; failed();
+		return undef;
+	}
+	my @reposit = @{$repos};
+	my $numRepos = @reposit;
+	my @repositAlias;
+	if ($repoAlias) {
+		@repositAlias = @{$repoAlias};
+		my $numAlias = @repositAlias;
+		if ($numRepos != $numAlias) {
+			my $msg = 'Number of specified repositories does not match number '
+				. 'of provided alias, cannot form proper match.';
+			$kiwi -&gt; error ($msg);
+			$kiwi -&gt; failed();
+			return undef;
+		}
+	}
+	my @repositPrio;
+	if ($repoPrios) {
+		@repositPrio = @{$repoPrios};
+		my $numPrios = @repositPrio;
+		if ($numRepos != $numPrios) {
+			my $msg = 'Number of specified repositories does not match number '
+				. 'of provided priorities, cannot form proper match.';
+			$kiwi -&gt; error ($msg);
+			$kiwi -&gt; failed();
+			return undef;
+		}
+	}
+	my @repositTypes = @{$repoTypes};
+	my $numTypes = @repositTypes;
+	if ($numRepos != $numTypes) {
+		my $msg = 'Number of specified repositories does not match number '
+		. 'of provided types, cannot form proper match.';
+		$kiwi -&gt; error ($msg);
+		$kiwi -&gt; failed();
+		return undef;
+	}
+	my @supportedTypes = @{$this-&gt;{supportedRepoTypes}};
+	for my $type (@repositTypes) {
+		if (! grep /$type/, @supportedTypes ) {
+			my $msg = &quot;Specified repository type $type not supported.&quot;;
+			$kiwi -&gt; error ($msg);
+			$kiwi -&gt; failed();
+			return undef;
+		}
+	}
+	my %repoInfo;
+	$repoInfo{repositories}         = $repos;
+	$repoInfo{repositoryAlia}       = $repoAlias;
+	$repoInfo{repositoryPriorities} = $repoPrios;
+	$repoInfo{repositoryTypes}      = $repoTypes;
+	$this -&gt; {additionalRepos} = \%repoInfo;
+
+	return 1;
 }
 
 #==========================================
@@ -192,6 +337,19 @@ sub setBuildProfiles {
 	# ---
 	my $this    = shift;
 	my $profRef = shift;
+	if (! $profRef) {
+		my $msg = 'setBuildProfiles method called without specifying '
+			. 'profiles in ARRAY_REF';
+		$this -&gt; {kiwi} -&gt; error ($msg);
+		$this -&gt; {kiwi} -&gt; failed();
+		return undef;
+	}
+	if (! ref $profRef) {
+		my $msg = 'setBuildProfiles method expecting ARRAY_REF as argument';
+		$this -&gt; {kiwi} -&gt; error ($msg);
+		$this -&gt; {kiwi} -&gt; failed();
+		return undef;
+	}
 	$this -&gt; {buildProfiles} = $profRef;
 	return 1;
 }
@@ -204,12 +362,56 @@ sub setConfigDir {
 	# Set the location of the configuration directory
 	# ---
 	my $this = shift;
-	$this -&gt; {configDir} = shift;
+	my $dir  = shift;
+	if (! $dir) {
+		my $msg = 'setConfigDir method called without specifying a '
+			. 'configuration directory.';
+		$this -&gt; {kiwi} -&gt; error ($msg);
+		$this -&gt; {kiwi} -&gt; failed();
+		return undef;
+	}
+	if (! -d $dir) {
+		my $msg = 'Specified configuration directory &quot;'
+			. &quot;$dir&quot;
+			. '&quot; could not be found.';
+		$this -&gt; {kiwi} -&gt; error ($msg);
+		$this -&gt; {kiwi} -&gt; failed();
+		return undef;
+	}
+	if (! -r $dir) {
+		my $msg = 'No read access to specified configuration directory &quot;'
+			. &quot;$dir&quot;
+			. '&quot;.';
+		$this -&gt; {kiwi} -&gt; error ($msg);
+		$this -&gt; {kiwi} -&gt; failed();
+		return undef;
+	}
+	$this -&gt; {configDir} = $dir;
 	return 1;
 }
 
 #==========================================
-# setImasetarsetDir
+# setIgnoreRepos
+#------------------------------------------
+sub setIgnoreRepos {
+	# ...
+	# Set the state for ignoring configured repositories
+	# ---
+	my $this = shift;
+	my $val = shift;
+	if ($val &amp;&amp; $this -&gt; {replacementRepo}) {
+		my $msg = 'Conflicting command line arguments; ignore repos and '
+			. 'set repos';
+		$this -&gt; {kiwi} -&gt; error ($msg);
+		$this -&gt; {kiwi} -&gt; failed ();
+		return undef;
+	}
+	$this -&gt; {ignoreRepos} = $val;
+	return 1;
+}
+
+#==========================================
+# setImagetargetDir
 #------------------------------------------
 sub setImagetargetDir {
 	# ...
@@ -221,6 +423,34 @@ sub setImagetargetDir {
 }
 
 #==========================================
+# setLogFile
+#------------------------------------------
+sub setLogFile {
+	# ...
+	# Set the path of the logfile specified on the command line
+	# ---
+	my $this    = shift;
+	my $logPath = shift;
+	if (! $logPath) {
+		my $msg = 'setLogFileName method called without specifying '
+			. 'a log file path.';
+		$this -&gt; {kiwi} -&gt; error ($msg);
+		$this -&gt; {kiwi} -&gt; failed();
+		return undef;
+	}
+	my $absPath = File::Spec-&gt;rel2abs($logPath);
+	my ($volume, $path, $file) = File::Spec-&gt;splitpath($logPath);
+	if (! -w $path) {
+		my $msg = &quot;Unable to write to location $path, cannot create log file.&quot;;
+		$this -&gt; {kiwi} -&gt; error ($msg);
+		$this -&gt; {kiwi} -&gt; failed();
+		return undef;
+	}
+	$this -&gt; {logFile} = $logPath;
+	return 1;
+}
+
+#==========================================
 # setPackageManager
 #------------------------------------------
 sub setPackageManager {
@@ -248,6 +478,60 @@ sub setPackageManager {
 }
 
 #==========================================
+# setReplacementRepo
+#------------------------------------------
+sub setReplacementRepo {
+	# ...
+	# Set the repository information for the repo
+	# to replace the first configured repository
+	# ---
+	my $this      = shift;
+	my $repo      = shift;
+	my $repoAlias = shift;
+	my $repoPrio  = shift;
+	my $repoType  = shift;
+	my $kiwi = $this -&gt; {kiwi};
+	my %replRepo;
+	if ($this -&gt; {ignoreRepos}){
+		my $msg = 'Conflicting command line arguments; ignore repos and '
+			. 'set repos';
+		$this -&gt; {kiwi} -&gt; error ($msg);
+		$this -&gt; {kiwi} -&gt; failed ();
+		return undef;
+	}
+	if (! $repo) {
+		my $msg = 'setReplacementRepo method called without specifying '
+		. 'a repository.';
+		$kiwi -&gt; error ($msg);
+		$kiwi -&gt; failed();
+		return undef;
+	}
+	if (! $repoAlias) {
+		my $msg = &quot;No repo alias defined, generating time based name.\n&quot;;
+		$kiwi -&gt; loginfo ($msg);
+		my $curTime = time;
+		$repoAlias = 'genName_' . &quot;$curTime&quot;;
+	}
+	if (! $repoPrio) {
+		my $msg = &quot;No repo priority specified, using default value '10'\n&quot;;
+		$kiwi -&gt; loginfo ($msg);
+		$repoPrio = 10;
+	}
+	if (($repoType) &amp;&amp; (! grep /$repoType/, @{$this-&gt;{supportedRepoTypes}})) {
+		my $msg = &quot;Specified repository type $repoType not supported.&quot;;
+		$kiwi -&gt; error ($msg);
+		$kiwi -&gt; failed();
+		return undef;
+	}
+	$replRepo{repository}         = $repo;
+	$replRepo{repositoryAlias}    = $repoAlias;
+	$replRepo{repositoryPriority} = $repoPrio;
+	$replRepo{repositoryType}     = $repoType;
+	$this -&gt; {replacementRepo} = \%replRepo;
+	return 1;
+}
+
+#==========================================
 # setRootTargetDir
 #------------------------------------------
 sub setRootTargetDir {
diff --git a/modules/KIWIXMLInfo.pm b/modules/KIWIXMLInfo.pm
new file mode 100644
index 0000000..9cce145
--- /dev/null
+++ b/modules/KIWIXMLInfo.pm
@@ -0,0 +1,538 @@
+#================
+# FILE          : KIWIXMLInfo.pm
+#----------------
+# PROJECT       : OpenSUSE Build-Service
+# COPYRIGHT     : (c) 2011 SUSE LINUX Products GmbH, Germany
+#               :
+# AUTHOR        : Robert Schweikert &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/kiwi-devel">rschweikert at novell.com</A>&gt;
+#               :
+# BELONGS TO    : Operating System images
+#               :
+# DESCRIPTION   : This module is used to upgrade and validate the
+#               : XML file, describing the image to be created
+#               :
+# STATUS        : Development
+#----------------
+package KIWIXMLInfo;
+#==========================================
+# Modules
+#------------------------------------------
+use strict;
+use warnings;
+require Exporter;
+use XML::LibXML;
+# KIWI modules
+use KIWICommandLine;
+use KIWILog;
+use KIWIQX;
+use KIWIXML;
+
+#==========================================
+# Exports
+#------------------------------------------
+our @ISA    = qw (Exporter);
+our @EXPORT = qw ();
+
+#==========================================
+# Constructor
+#------------------------------------------
+sub new {
+	# ...
+	# Create the info object.
+	# ---
+	#==========================================
+	# Object setup
+	#------------------------------------------
+	my $this  = {};
+	my $class = shift;
+	bless $this,$class;
+	#==========================================
+	# Module Parameters
+	#------------------------------------------
+	my $kiwi = shift;
+	my $cmdL = shift;
+	#==========================================
+	# Constructor setup
+	#------------------------------------------
+	if (! defined $kiwi) {
+		$kiwi = new KIWILog(&quot;tiny&quot;);
+	}
+	#==========================================
+	# Check pre-conditions
+	#------------------------------------------
+	if (! defined $cmdL) {
+		my $msg = 'KIWIXMLInfo: expecting KIWICommandLine object as '
+			. 'second argument.';
+		$kiwi -&gt; error ($msg);
+		$kiwi -&gt; failed();
+		return undef;
+	}
+	my $configDir = $cmdL -&gt; getConfigDir();
+	if (! defined $configDir) {
+		my $msg = 'Invalid KIWICommandLine object, no configuration '
+			. 'directory.';
+		$kiwi -&gt; error ($msg);
+		$kiwi -&gt; failed();
+		return undef;
+	}
+	#==========================================
+	# Reset logging target if requested
+	#------------------------------------------
+	my $logFile = $cmdL -&gt; getLogFile();
+	if ($logFile) {
+		$kiwi -&gt; info (&quot;Setting log file to: $logFile\n&quot;);
+			if (! $kiwi -&gt; setLogFile ( $logFile )) {
+				return undef;
+			}
+	}
+	#==========================================
+	# Store object data
+	#------------------------------------------
+	$this-&gt;{addlRepos}      = $cmdL -&gt; getAdditionalRepos();
+	$this-&gt;{buildProfiles}  = $cmdL -&gt; getBuildProfiles();
+	$this-&gt;{configDir}      = $configDir;
+	$this-&gt;{ignoreRepos}    = $cmdL -&gt; getIgnoreRepos();
+	$this-&gt;{kiwi}           = $kiwi;
+	$this-&gt;{packageManager} = $cmdL -&gt; getPackageManager();
+	$this-&gt;{replRepo}       = $cmdL -&gt; getReplacementRepo();
+
+	return $this;
+}
+
+#==========================================
+# getXMLInfoTree
+#------------------------------------------
+sub getXMLInfoTree {
+	# ...
+	# Return the tree object
+	# ---
+	my $this     = shift;
+	my $requests = shift;
+	my $infoRequests = $this -&gt; __checkRequests($requests);
+	if (! $infoRequests) {
+		return undef;
+	}
+	return $this -&gt; __getTree($infoRequests);
+}
+
+#==========================================
+# printXMLInfo
+#------------------------------------------
+sub printXMLInfo {
+	# ...
+	# Print the XML information
+	# ---
+	my $this     = shift;
+	my $requests = shift;
+	my $infoRequests = $this -&gt; __checkRequests($requests);
+	if (! $infoRequests) {
+		return undef;
+	}
+	$this -&gt; {kiwi} -&gt; info (&quot;Reading image description [ListXMLInfo]...\n&quot;);
+	my $infoTree = $this -&gt; __getTree($infoRequests);
+	if (! $infoTree) {
+		return undef;
+	}
+	# TODO eliminate access to global, this should be in the locator
+	open (my $F, &quot;|xsltproc $main::Pretty -&quot;);
+	print $F $infoTree -&gt; toString();
+	close $F;
+	return 1;
+}
+
+#==========================================
+# Private helper methods
+#------------------------------------------
+#==========================================
+# __checkRequests
+#------------------------------------------
+sub __checkRequests {
+	# ...
+	# Verify that the information requested is a supported request
+	# ---
+	my $this     = shift;
+	my $requests = shift;
+	my $kiwi = $this -&gt; {kiwi};
+	if (! $requests) {
+		my $msg = 'No information requested, nothing todo.';
+		$kiwi -&gt; error ($msg);
+		$kiwi -&gt; failed ();
+		return undef;
+	}
+	if (! ref $requests) {
+		my $msg = 'Expecting ARRAY_REF as first argument for info requests.';
+		$kiwi -&gt; error ($msg);
+		$kiwi -&gt; failed ();
+		return undef;
+	}
+	my @infoReq = @{$requests};
+	#==========================================
+	# Verify the requested information is available
+	#------------------------------------------
+	my %supportedInfoReq;
+	$supportedInfoReq{'packages'}      = 'List of packages to be installed';
+	$supportedInfoReq{'patterns'}      = 'List configured patterns';
+	$supportedInfoReq{'profiles'}      = 'List profiles';
+	$supportedInfoReq{'repo-patterns'} = 'List available patterns from repos';
+	$supportedInfoReq{'size'}          = 'List install/delete size estimation';
+	$supportedInfoReq{'sources'}       = 'List configured source URLs';
+	$supportedInfoReq{'types'}         = 'List configured types';
+	$supportedInfoReq{'version'}       = 'List name and version';
+	my @infoList;
+	for my $info (@infoReq) {
+		if (defined $supportedInfoReq{$info}) {
+			push @infoList, $info;
+			next;
+		}
+		my $msg = &quot;Requested information option $info not supported, &quot;
+			. 'ignoring.';
+		$kiwi -&gt; warning ($msg);
+		$kiwi -&gt; skipped();
+	}
+	if (! @infoList) {
+		my $msg = 'None of the specified information options are available.';
+		$kiwi -&gt; error ($msg);
+		$kiwi -&gt; failed ();
+		$kiwi -&gt; info   (&quot;Choose between the following:\n&quot;);
+		for my $info (sort keys %supportedInfoReq) {
+			my $s = sprintf (&quot;--&gt; %-15s:%s\n&quot;,$info,$supportedInfoReq{$info});
+			$kiwi -&gt; info ($s);
+		}
+		return undef;
+	}
+	return \@infoList;
+}
+
+#==========================================
+# __cleanMountPnts
+#------------------------------------------
+sub __cleanMountPnts {
+	# ...
+	# Clean up any mount points, i.e. unmount and remove the directory
+	# ---
+	my $this   = shift;
+	my $mounts = shift;
+	my @mountPnts = @{$mounts};
+	my $kiwi = $this-&gt;{kiwi};
+
+	for my $dir (@mountPnts) {
+		next if ! defined $dir;
+		qxx (&quot;umount $dir ; rmdir $dir 2&gt;&amp;1&quot;);
+		my $code = $? &gt;&gt; 8;
+		if ($code != 0) {
+			my $msg = 'Could not clean mount point &quot;'
+				. &quot;$dir&quot;
+				. '&quot;. Please unmount manually and remove the directory.';
+			$kiwi -&gt; warning ($msg);
+			$kiwi -&gt; skipped();
+		}
+	}
+	return 1;
+}
+
+#==========================================
+# __getTree
+#------------------------------------------
+sub __getTree {
+	# ...
+	# Create the information XML tree
+	# ---
+	my $this     = shift;
+	my $requests = shift;
+	my $kiwi = $this -&gt; {kiwi};
+	my $xml = $this -&gt; __xmlSetup();
+	my $mountDirs = $this -&gt; __setupRepoMounts($xml);
+	if (! $mountDirs) {
+		return undef;
+	}
+	my @infoRequests = @{$requests};
+	my $meta;
+	my $delete;
+	my $solfile;
+	my $satlist;
+	my $solp;
+	my $rpat;
+	#==========================================
+	# Initialize XML imagescan element
+	#------------------------------------------
+	my $scan = new XML::LibXML::Element (&quot;imagescan&quot;);
+	#==========================================
+	# Walk through selection list
+	#------------------------------------------
+	for my $info (@infoRequests) {
+		SWITCH: for ($info) {
+			#==========================================
+			# repo-patterns
+			#------------------------------------------
+			/^repo-patterns/ &amp;&amp; do {
+				if (! $meta) {
+					($meta,$delete,$solfile,$satlist,$solp,$rpat) =
+						$xml-&gt;getInstallSize();
+					if (! $meta) {
+						$kiwi -&gt; failed();
+						$this -&gt; __cleanMountPnts($mountDirs);
+						return undef;
+					}
+				}
+				if (! $rpat) {
+					$kiwi -&gt; info (&quot;No patterns in repo solvable\n&quot;);
+				} else {
+					foreach my $p (@{$rpat}) {
+						next if ($p eq &quot;\n&quot;);
+						$p =~ s/^\s+//;
+						$p =~ s/\s+$//;
+						my $pattern = new XML::LibXML::Element (&quot;repopattern&quot;);
+						$pattern -&gt; setAttribute (&quot;name&quot;,&quot;$p&quot;);
+						$scan -&gt; appendChild ($pattern);
+					}
+				}
+				last SWITCH;
+			};
+			#==========================================
+			# patterns
+			#------------------------------------------
+			/^patterns/      &amp;&amp; do {
+				if (! $meta) {
+					($meta,$delete,$solfile,$satlist,$solp) =
+						$xml-&gt;getInstallSize();
+					if (! $meta) {
+						$kiwi -&gt; failed();
+						$this -&gt; __cleanMountPnts($mountDirs);
+						return undef;
+					}
+				}
+				if (! keys %{$meta}) {
+					$kiwi -&gt; info (&quot;No packages/patterns solved\n&quot;);
+				} else {
+					foreach my $p (sort keys %{$meta}) {
+						if ($p =~ /pattern:(.*)/) {
+							my $name = $1;
+							my $pattern = new XML::LibXML::Element (&quot;pattern&quot;);
+							$pattern -&gt; setAttribute (&quot;name&quot;,&quot;$name&quot;);
+							$scan -&gt; appendChild ($pattern);
+						}
+					}
+				}
+				last SWITCH;
+			};
+			#==========================================
+			# types
+			#------------------------------------------
+			/^types/         &amp;&amp; do {
+				foreach my $t ($xml -&gt; getTypes()) {
+					my %type = %{$t};
+					my $type = new XML::LibXML::Element (&quot;type&quot;);
+					$type -&gt; setAttribute (&quot;name&quot;,&quot;$type{type}&quot;);
+					$type -&gt; setAttribute (&quot;primary&quot;,&quot;$type{primary}&quot;);
+					if (defined $type{boot}) {
+						$type -&gt; setAttribute (&quot;boot&quot;,&quot;$type{boot}&quot;);
+					}
+					$scan -&gt; appendChild ($type);
+				}
+				last SWITCH;
+			};
+			#==========================================
+			# sources
+			#------------------------------------------
+			/^sources/       &amp;&amp; do {
+				my %repos = $xml -&gt; getRepository();
+				for my $url (keys %repos) {
+					my $source = new XML::LibXML::Element (&quot;source&quot;);
+					$source -&gt; setAttribute (&quot;path&quot;,&quot;$url&quot;);
+					$source -&gt; setAttribute (&quot;type&quot;,$repos{$url}-&gt;[0]);
+					$scan -&gt; appendChild ($source);
+				}
+				last SWITCH;
+			};
+			#==========================================
+			# size
+			#------------------------------------------
+			/^size/          &amp;&amp; do {
+				if (! $meta) {
+					($meta,$delete,$solfile,$satlist,$solp) =
+						$xml-&gt;getInstallSize();
+					if (! $meta) {
+						$kiwi -&gt; failed();
+						$this -&gt; __cleanMountPnts($mountDirs);
+						return undef;
+					}
+				}
+				my $size = 0;
+				my %meta = %{$meta};
+				foreach my $p (keys %meta) {
+					my @metalist = split (/:/,$meta{$p});
+					$size += $metalist[0];
+				}
+				my $sizenode = new XML::LibXML::Element (&quot;size&quot;);
+				if ($size &gt; 0) {
+					$sizenode -&gt; setAttribute (&quot;rootsizeKB&quot;,&quot;$size&quot;);
+				}
+				$size = 0;
+				if ($delete) {
+					foreach my $del (@{$delete}) {
+						if ($meta{$del}) {
+							my @metalist = split (/:/,$meta{$del});
+							$size += $metalist[0];
+						}
+					}
+				}
+				if ($size &gt; 0) {
+					$sizenode -&gt; setAttribute (&quot;deletionsizeKB&quot;,&quot;$size&quot;);
+				}
+				$scan -&gt; appendChild ($sizenode);
+				last SWITCH;
+			};
+			#==========================================
+			# packages
+			#------------------------------------------
+			/^packages/     &amp;&amp; do {
+				if (! $meta) {
+					($meta,$delete,$solfile,$satlist,$solp) =
+						$xml-&gt;getInstallSize();
+					if (! $meta) {
+						$kiwi -&gt; failed();
+						$this -&gt; __cleanMountPnts($mountDirs);
+						return undef;
+					}
+				}
+				if (! keys %{$meta}) {
+					$kiwi -&gt; info (&quot;No packages/patterns solved\n&quot;);
+				} else {
+					foreach my $p (sort keys %{$meta}) {
+						if ($p =~ /pattern:.*/) {
+							next;
+						}
+						my @m = split (/:/,$meta-&gt;{$p});
+						my $pacnode = new XML::LibXML::Element (&quot;package&quot;);
+						$pacnode -&gt; setAttribute (&quot;name&quot;,&quot;$p&quot;);
+						$pacnode -&gt; setAttribute (&quot;arch&quot;,&quot;$m[1]&quot;);
+						$pacnode -&gt; setAttribute (&quot;version&quot;,&quot;$m[2]&quot;);
+						$scan -&gt; appendChild ($pacnode);
+					}
+				}
+				last SWITCH;
+			};
+			#==========================================
+			# profiles
+			#------------------------------------------
+			/^profiles/      &amp;&amp; do {
+				my @profiles = $xml -&gt; getProfiles ();
+				if ((scalar @profiles) == 0) {
+					$kiwi -&gt; info (&quot;No profiles available\n&quot;);
+				} else {
+					foreach my $profile (@profiles) {
+						my $name = $profile -&gt; {name};
+						my $desc = $profile -&gt; {description};
+						my $pnode = new XML::LibXML::Element (&quot;profile&quot;);
+						$pnode -&gt; setAttribute (&quot;name&quot;,&quot;$name&quot;);
+						$pnode -&gt; setAttribute (&quot;description&quot;,&quot;$desc&quot;);
+						$scan -&gt; appendChild ($pnode);
+					}
+				}
+				last SWITCH;
+			};
+			#==========================================
+			# version
+			#------------------------------------------
+			/^version/       &amp;&amp; do {
+				my $version = $xml -&gt; getImageVersion();
+				my $appname = $xml -&gt; getImageName();
+				my $vnode = new XML::LibXML::Element (&quot;image&quot;);
+				$vnode -&gt; setAttribute (&quot;version&quot;,&quot;$version&quot;);
+				$vnode -&gt; setAttribute (&quot;name&quot;,&quot;$appname&quot;);
+				$scan -&gt; appendChild ($vnode);
+			};
+		}
+	}
+	$this -&gt; __cleanMountPnts($mountDirs);
+
+	return $scan;
+}
+
+#==========================================
+# __setupRepoMounts
+#------------------------------------------
+sub __setupRepoMounts {
+	# ...
+	# Setup mount points and mount any repositories that need to be mounted
+	# locally
+	# ---
+	my $this = shift;
+	my $xml  = shift;
+	my $kiwi = $this-&gt;{kiwi};
+	my @mountPnts;
+	if ($xml-&gt;{urlhash}) {
+		for my $source (keys %{$xml-&gt;{urlhash}}) {
+			#==========================================
+			# <A HREF="iso://">iso://</A> sources
+			#------------------------------------------
+			if ($source =~ /^iso:\/\/(.*)/) {
+				my $iso  = $1;
+				my $dir  = $xml-&gt;{urlhash}-&gt;{$source};
+				my $data = qxx (&quot;mkdir -p $dir; mount -o loop $iso $dir 2&gt;&amp;1&quot;);
+				my $code = $? &gt;&gt; 8;
+				if ($code != 0) {
+					$kiwi -&gt; failed ();
+					$kiwi -&gt; error  (&quot;Failed to loop mount ISO path: $data&quot;);
+					$kiwi -&gt; failed ();
+					rmdir $dir;
+					if (@mountPnts) {
+						$this -&gt; __cleanMountPnts(\@mountPnts);
+					}
+					return undef;
+				}
+				push @mountPnts, $dir;
+			}
+		}
+	}
+	return \@mountPnts;
+}
+
+#==========================================
+# __xmlSetup
+#------------------------------------------
+sub __xmlSetup {
+	# ...
+	# Configure the XML object to suitably collect all requested information
+	# ---
+	my $this = shift;
+	my $kiwi = $this-&gt;{kiwi};
+
+	#==========================================
+	# Setup the XML
+	#------------------------------------------
+	my $buildProfs = $this -&gt; {buildProfiles};
+	my $configDir  = $this -&gt; {configDir};
+	# TODO change when XML becomes stateless
+	my $xml = new KIWIXML ($kiwi, $configDir, undef, $buildProfs);
+	if (! defined $xml) {
+		return undef;
+	}
+	my $pkgMgr = $this -&gt; {packageManager};
+	if ($pkgMgr) {
+		$xml -&gt; setPackageManager($pkgMgr);
+	}
+	my $ignore = $this -&gt; {ignoreRepos};
+	if ($ignore) {
+		$xml -&gt; ignoreRepositories ();
+	}
+	if ($this -&gt; {replRepo}) {
+		my %replRepo = %{$this -&gt; {replRepo}};
+		$xml -&gt; setRepository ($replRepo{repositoryType},
+							$replRepo{repository},
+							$replRepo{repositoryAlias},
+							$replRepo{respositoryPriority}
+							);
+	}
+	if ($this -&gt; {addlRepos}) {
+		my %addlRepos = %{$this -&gt; {addlRepos}};
+		$xml -&gt; addRepository ($addlRepos{repositoryTypes},
+							$addlRepos{repositories},
+							$addlRepos{repositoryAlia},
+							$addlRepos{repositoryPriorities}
+							);
+	}
+	return $xml;
+}
+
+1;
diff --git a/rpm/kiwi.spec b/rpm/kiwi.spec
index 600637a..6b9bfcb 100644
--- a/rpm/kiwi.spec
+++ b/rpm/kiwi.spec
@@ -73,6 +73,7 @@ Source1:        %{name}-rpmlintrc
 Source2:        %{name}-docu.tar.bz2
 Source3:        %{name}-repo.tar.bz2
 BuildRoot:      %{_tmppath}/%{name}-%{version}-build
+Recommends:     jing
 Recommends:     zypper
 Provides:       kiwi-desc-usbboot
 Obsoletes:      kiwi-desc-usbboot
diff --git a/tests/unit/KIWIXML.t b/tests/unit/KIWIXML.t
index 988ec79..179bd55 100644
--- a/tests/unit/KIWIXML.t
+++ b/tests/unit/KIWIXML.t
@@ -34,4 +34,4 @@ our $SchemaCVT = &quot;$FindBin::Bin/../../xsl/master.xsl&quot;;
 # END variable hack
 
 my $runner = Test::Unit::HarnessUnit-&gt;new();
-$runner-&gt;start( 'Test::xml' );
+$runner-&gt;start( 'Test::kiwiXML' );
diff --git a/tests/unit/KIWIXML.t b/tests/unit/KIWIXMLInfo.t
similarity index 94%
copy from tests/unit/KIWIXML.t
copy to tests/unit/KIWIXMLInfo.t
index 988ec79..072c360 100644
--- a/tests/unit/KIWIXML.t
+++ b/tests/unit/KIWIXMLInfo.t
@@ -1,5 +1,5 @@
 #================
-# FILE          : KIWIXML.t
+# FILE          : KIWIXMLInfo.t
 #----------------
 # PROJECT       : OpenSUSE Build-Service
 # COPYRIGHT     : (c) 2011 Novell Inc.
@@ -34,4 +34,4 @@ our $SchemaCVT = &quot;$FindBin::Bin/../../xsl/master.xsl&quot;;
 # END variable hack
 
 my $runner = Test::Unit::HarnessUnit-&gt;new();
-$runner-&gt;start( 'Test::xml' );
+$runner-&gt;start( 'Test::kiwiXMLInfo');
diff --git a/tests/unit/data/xml/defPkgMgr/config.xml b/tests/unit/data/kiwiXML/defPkgMgr/config.xml
similarity index 100%
rename from tests/unit/data/xml/defPkgMgr/config.xml
rename to tests/unit/data/kiwiXML/defPkgMgr/config.xml
diff --git a/tests/unit/data/xml/multiPkgMgrWithProf/config.xml b/tests/unit/data/kiwiXML/multiPkgMgrWithProf/config.xml
similarity index 97%
rename from tests/unit/data/xml/multiPkgMgrWithProf/config.xml
rename to tests/unit/data/kiwiXML/multiPkgMgrWithProf/config.xml
index 63f5465..c890ad5 100644
--- a/tests/unit/data/xml/multiPkgMgrWithProf/config.xml
+++ b/tests/unit/data/kiwiXML/multiPkgMgrWithProf/config.xml
@@ -22,7 +22,7 @@
 		&lt;keytable&gt;us.map.gz&lt;/keytable&gt;
 	&lt;/preferences&gt;
 	&lt;preferences profiles=&quot;specPkgMgr&quot;&gt;
-		&lt;packagemanager&gt;zypper&lt;/packagemanager&gt;
+		&lt;packagemanager&gt;smart&lt;/packagemanager&gt;
 	&lt;/preferences&gt;
 	&lt;users group=&quot;users&quot;&gt;
 		&lt;user pwd=&quot;$1$wYJUgpM5$RXMMeASDc035eX.NbYWFl0&quot; home=&quot;/home/tux&quot; name=&quot;tux&quot;/&gt;
diff --git a/tests/unit/data/xml/specPkgMgr/config.xml b/tests/unit/data/kiwiXML/specPkgMgr/config.xml
similarity index 97%
rename from tests/unit/data/xml/specPkgMgr/config.xml
rename to tests/unit/data/kiwiXML/specPkgMgr/config.xml
index a9db267..b08805f 100644
--- a/tests/unit/data/xml/specPkgMgr/config.xml
+++ b/tests/unit/data/kiwiXML/specPkgMgr/config.xml
@@ -17,7 +17,6 @@
 		&lt;rpm-force&gt;true&lt;/rpm-force&gt;
 		&lt;locale&gt;en_US&lt;/locale&gt;
 		&lt;keytable&gt;us.map.gz&lt;/keytable&gt;
-		&lt;packagemanager&gt;zypper&lt;/packagemanager&gt;
 	&lt;/preferences&gt;
 	&lt;users group=&quot;users&quot;&gt;
 		&lt;user pwd=&quot;$1$wYJUgpM5$RXMMeASDc035eX.NbYWFl0&quot; home=&quot;/home/tux&quot; name=&quot;tux&quot;/&gt;
diff --git a/tests/unit/data/xmlInfo/config.xml b/tests/unit/data/xmlInfo/config.xml
new file mode 100644
index 0000000..f43e7d3
--- /dev/null
+++ b/tests/unit/data/xmlInfo/config.xml
@@ -0,0 +1,39 @@
+&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
+
+&lt;image schemaversion=&quot;5.2&quot; name=&quot;test-xml-infod&quot;&gt;
+	&lt;description type=&quot;system&quot;&gt;
+		&lt;author&gt;Robert Schweikert&lt;/author&gt;
+		&lt;contact&gt;<A HREF="https://lists.berlios.de/mailman/listinfo/kiwi-devel">rschweikert at novell.com</A>&lt;/contact&gt;
+		&lt;specification&gt;test case for the XMLInfo object&lt;/specification&gt;
+	&lt;/description&gt;
+	&lt;profiles&gt;
+		&lt;profile name=&quot;first&quot; description=&quot;a profile&quot;/&gt;
+		&lt;profile name=&quot;second&quot; description=&quot;another profile&quot;/&gt;
+	&lt;/profiles&gt;
+	&lt;preferences&gt;
+		&lt;type image=&quot;iso&quot; boot=&quot;isoboot/suse-11.4&quot;/&gt;
+		&lt;type image=&quot;oem&quot; boot=&quot;oemboot/suse-11.4&quot; filesystem=&quot;ext4&quot; installiso=&quot;true&quot;&gt;
+			&lt;oemconfig&gt;
+				&lt;oem-swap&gt;true&lt;/oem-swap&gt;
+				&lt;oem-swapsize&gt;1024&lt;/oem-swapsize&gt;
+			&lt;/oemconfig&gt;
+		&lt;/type&gt;
+		&lt;type image=&quot;xfs&quot;/&gt;
+		&lt;packagemanager&gt;zypper&lt;/packagemanager&gt;
+		&lt;rpm-check-signatures&gt;false&lt;/rpm-check-signatures&gt;
+		&lt;rpm-force&gt;true&lt;/rpm-force&gt;
+		&lt;locale&gt;en_US&lt;/locale&gt;
+		&lt;keytable&gt;us.map.gz&lt;/keytable&gt;
+		&lt;version&gt;1.0.0&lt;/version&gt;
+	&lt;/preferences&gt;
+	&lt;users group=&quot;root&quot;&gt;
+		&lt;user pwd=&quot;$1$wYJUgpM5$RXMMeASDc035eX.NbYWFl0&quot; home=&quot;/root&quot; name=&quot;root&quot;/&gt;
+	&lt;/users&gt;
+	&lt;repository type=&quot;rpm-dir&quot;&gt;
+		&lt;source path=&quot;/tmp&quot;/&gt;
+	&lt;/repository&gt;
+	&lt;packages type=&quot;image&quot; patternType=&quot;onlyRequired&quot;&gt;
+		&lt;package name=&quot;sash&quot;/&gt;
+		&lt;opensusePattern name=&quot;base&quot;/&gt;
+	&lt;/packages&gt;
+&lt;/image&gt;
diff --git a/tests/unit/lib/Common/ktLog.pm b/tests/unit/lib/Common/ktLog.pm
index 5d684be..29b5c11 100644
--- a/tests/unit/lib/Common/ktLog.pm
+++ b/tests/unit/lib/Common/ktLog.pm
@@ -110,10 +110,31 @@ sub getErrorMessage {
 	# In general the getMessage method should be used. However, under certain
 	# test conditions it is unavoidable to have multiple messages in the log
 	# object. For these rare occasions the log allows access to the specific
-	# message types directly.
+	# message types directly. The message type is reset, the final call in a
+	# test should always be to getMessage() to assure no unexpected messages
+	# are present.
 	# ---
 	my $this = shift;
-	return $this -&gt; {errMsg};
+	my $msg = $this -&gt; {errMsg};
+	$this -&gt; {errMsg} = '';
+	return $msg;
+}
+
+#==========================================
+# getErrorState
+#------------------------------------------
+sub getErrorState {
+	# ...
+	# Retrieve the state of the error flag.
+	# Generally the getState method should be used. However, under certain
+	# circumstances the code issues a set of messages together. The individual
+	# get*State methods allow to retrieve the expected state and clear the
+	# flag for this state. THe final call in any test should always be to
+	# getState to assure there are no unexpected messages.
+	my $this = shift;
+	my $val = $this -&gt; {failed} ? 'failed' : 0;
+	$this -&gt; {failed} = 0;
+	return $val;
 }
 
 #==========================================
@@ -125,10 +146,14 @@ sub getInfoMessage {
 	# In general the getMessage method should be used. However, under certain
 	# test conditions it is unavoidable to have multiple messages in the log
 	# object. For these rare occasions the log allows access to the specific
-	# message types directly.
+	# message types directly. The message type is reset, the final call in a
+	# test should always be to getMessage() to assure no unexpected messages
+	# are present.
 	# ---
 	my $this = shift;
-	return $this -&gt; {infoMsg};
+	my $msg = $this -&gt; {infoMsg};
+	$this -&gt; {infoMsg} = '';
+	return $msg;
 }
 
 #==========================================
@@ -140,10 +165,14 @@ sub getLogInfoMessage {
 	# In general the getMessage method should be used. However, under certain
 	# test conditions it is unavoidable to have multiple messages in the log
 	# object. For these rare occasions the log allows access to the specific
-	# message types directly.
+	# message types directly. The message type is reset, the final call in a
+	# test should always be to getMessage() to assure no unexpected messages
+	# are present.
 	# ---
 	my $this = shift;
-	return $this -&gt; {logInfoMsg};
+	my $msg = $this -&gt; {logInfoMsg};
+	$this -&gt; {logInfoMsg} = '';
+	return $msg;
 }
 
 #==========================================
@@ -151,14 +180,35 @@ sub getLogInfoMessage {
 #------------------------------------------
 sub getWarningMessage {
 	# ...
-	# Retrieve the error message.
+	# Retrieve the warning message.
 	# In general the getMessage method should be used. However, under certain
 	# test conditions it is unavoidable to have multiple messages in the log
 	# object. For these rare occasions the log allows access to the specific
-	# message types directly.
+	# message types directly. The message type is reset, the final call in a
+	# test should always be to getMessage() to assure no unexpected messages
+	# are present.
 	# ---
 	my $this = shift;
-	return $this -&gt; {warnMsg};
+	my $msg = $this -&gt; {warnMsg};
+	$this -&gt; {warnMsg} = '';
+	return $msg;
+}
+
+#==========================================
+# getWarningState
+#------------------------------------------
+sub getWarningState {
+	# ...
+	# Retrieve the state of the skipped flag.
+	# Generally the getState method should be used. However, under certain
+	# circumstances the code issues a set of messages together. The individual
+	# get*State methods allow to retrieve the expected state and clear the
+	# flag for this state. THe final call in any test should always be to
+	# getState to assure there are no unexpected messages.
+	my $this = shift;
+	my $val = $this -&gt; {skipped} ? 'skipped' : 0;
+	$this -&gt; {skipped} = 0;
+	return $val;
 }
 
 #==========================================
@@ -249,7 +299,11 @@ sub info {
 	# Set the information message
 	# ---
 	my $this = shift;
-	$this -&gt; {infoMsg} = shift;
+	if ($this -&gt; {infoMsg}) {
+		$this -&gt; {infoMsg} = $this -&gt; {infoMsg} . shift;
+	} else {
+		$this -&gt; {infoMsg} = shift;
+	}
 	$this -&gt; {msgType} = 'info';
 	return $this;
 }
diff --git a/tests/unit/lib/Test/kiwiCommandLine.pm b/tests/unit/lib/Test/kiwiCommandLine.pm
index a7ae0ca..af1f53c 100644
--- a/tests/unit/lib/Test/kiwiCommandLine.pm
+++ b/tests/unit/lib/Test/kiwiCommandLine.pm
@@ -8,7 +8,7 @@
 #               :
 # BELONGS TO    : Operating System images
 #               :
-# DESCRIPTION   : Unit test implementation for the KIWICommandLine module..
+# DESCRIPTION   : Unit test implementation for the KIWICommandLine module.
 #               :
 # STATUS        : Development
 #----------------
@@ -58,6 +58,287 @@ sub test_ctor {
 }
 
 #==========================================
+# test_cmdAddRepos_improperAlias
+#------------------------------------------
+sub test_cmdAddRepos_improperAlias {
+	# ...
+	# Test the AdditionalRepo storage
+	# ---
+	my $this = shift;
+	my $kiwi = $this -&gt; {kiwi};
+	my $cmd = $this -&gt; __getCmdObj();
+	# Provide improper argument
+	my @repos = ('os11.3');
+	my @alias = ('alias');
+	my $res = $cmd -&gt; setAdditionalRepos(\@repos, @alias);
+	my $msg = $kiwi -&gt; getMessage();
+	my $expectedMsg = 'setAdditionalRepos method expecting ARRAY_REF as '
+		. 'second argument.';
+	$this -&gt; assert_str_equals($expectedMsg, $msg);
+	my $msgT = $kiwi -&gt; getMessageType();
+	$this -&gt; assert_str_equals('error', $msgT);
+	my $state = $kiwi -&gt; getState();
+	$this -&gt; assert_str_equals('failed', $state);
+	$this -&gt; assert_null($res);
+}
+
+#==========================================
+# test_cmdAddRepos_improperPrio
+#------------------------------------------
+sub test_cmdAddRepos_improperPrio {
+	# ...
+	# Test the AdditionalRepo storage
+	# ---
+	my $this = shift;
+	my $kiwi = $this -&gt; {kiwi};
+	my $cmd = $this -&gt; __getCmdObj();
+	# Provide improper argument
+	my @repos = ('os11.3');
+	my @prio = (1);
+	my $res = $cmd -&gt; setAdditionalRepos(\@repos, undef, @prio);
+	my $msg = $kiwi -&gt; getMessage();
+	my $expectedMsg = 'setAdditionalRepos method expecting ARRAY_REF as '
+		. 'third argument.';
+	$this -&gt; assert_str_equals($expectedMsg, $msg);
+	my $msgT = $kiwi -&gt; getMessageType();
+	$this -&gt; assert_str_equals('error', $msgT);
+	my $state = $kiwi -&gt; getState();
+	$this -&gt; assert_str_equals('failed', $state);
+	$this -&gt; assert_null($res);
+}
+
+#==========================================
+# test_cmdAddRepos_improperRepo
+#------------------------------------------
+sub test_cmdAddRepos_improperRepo {
+	# ...
+	# Test the AdditionalRepo storage
+	# ---
+	my $this = shift;
+	my $kiwi = $this -&gt; {kiwi};
+	my $cmd = $this -&gt; __getCmdObj();
+	# Provide improper argument
+	my @repos = ('os11.3');
+	my $res = $cmd -&gt; setAdditionalRepos(@repos);
+	my $msg = $kiwi -&gt; getMessage();
+	my $expectedMsg = 'setAdditionalRepos method expecting ARRAY_REF as '
+		. 'first argument.';
+	$this -&gt; assert_str_equals($expectedMsg, $msg);
+	my $msgT = $kiwi -&gt; getMessageType();
+	$this -&gt; assert_str_equals('error', $msgT);
+	my $state = $kiwi -&gt; getState();
+	$this -&gt; assert_str_equals('failed', $state);
+	$this -&gt; assert_null($res);
+}
+
+#==========================================
+# test_cmdAddRepos_improperTypes
+#------------------------------------------
+sub test_cmdAddRepos_improperTypes {
+	# ...
+	# Test the AdditionalRepo storage
+	# ---
+	my $this = shift;
+	my $kiwi = $this -&gt; {kiwi};
+	my $cmd = $this -&gt; __getCmdObj();
+	# Provide improper argument
+	my @repos = ('os11.3');
+	my @types = ('yast2');
+	my $res = $cmd -&gt; setAdditionalRepos(\@repos, undef, undef, @types);
+	my $msg = $kiwi -&gt; getMessage();
+	my $expectedMsg = 'setAdditionalRepos method expecting ARRAY_REF as '
+		. 'fourth argument.';
+	$this -&gt; assert_str_equals($expectedMsg, $msg);
+	my $msgT = $kiwi -&gt; getMessageType();
+	$this -&gt; assert_str_equals('error', $msgT);
+	my $state = $kiwi -&gt; getState();
+	$this -&gt; assert_str_equals('failed', $state);
+	$this -&gt; assert_null($res);
+}
+
+#==========================================
+# test_cmdAddRepos_mismatchRepoAli
+#------------------------------------------
+sub test_cmdAddRepos_mismatchRepoAli {
+	# ...
+	# Test the AdditionalRepo storage
+	# ---
+	my $this = shift;
+	my $kiwi = $this -&gt; {kiwi};
+	my $cmd = $this -&gt; __getCmdObj();
+	# Provide improper argument
+	my @repos = ('os11.3', 'os11.3-non-oss');
+	my @alias = ('alias');
+	my @types = ('yast2');
+	my $res = $cmd -&gt; setAdditionalRepos(\@repos, \@alias, undef, \@types);
+	my $msg = $kiwi -&gt; getMessage();
+	my $expectedMsg = 'Number of specified repositories does not match number '
+		. 'of provided alias, cannot form proper match.';
+	$this -&gt; assert_str_equals($expectedMsg, $msg);
+	my $msgT = $kiwi -&gt; getMessageType();
+	$this -&gt; assert_str_equals('error', $msgT);
+	my $state = $kiwi -&gt; getState();
+	$this -&gt; assert_str_equals('failed', $state);
+	$this -&gt; assert_null($res);
+}
+
+#==========================================
+# test_cmdAddRepos_mismatchRepoPrio
+#------------------------------------------
+sub test_cmdAddRepos_mismatchRepoPrio {
+	# ...
+	# Test the AdditionalRepo storage
+	# ---
+	my $this = shift;
+	my $kiwi = $this -&gt; {kiwi};
+	my $cmd = $this -&gt; __getCmdObj();
+	# Provide improper argument
+	my @repos = ('os11.3', 'os11.3-non-oss');
+	my @prio = (1);
+	my @types = ('yast2');
+	my $res = $cmd -&gt; setAdditionalRepos(\@repos, undef, \@prio, \@types);
+	my $msg = $kiwi -&gt; getMessage();
+	my $expectedMsg = 'Number of specified repositories does not match number '
+		. 'of provided priorities, cannot form proper match.';
+	$this -&gt; assert_str_equals($expectedMsg, $msg);
+	my $msgT = $kiwi -&gt; getMessageType();
+	$this -&gt; assert_str_equals('error', $msgT);
+	my $state = $kiwi -&gt; getState();
+	$this -&gt; assert_str_equals('failed', $state);
+	$this -&gt; assert_null($res);
+}
+
+#==========================================
+# test_cmdAddRepos_mismatchRepoTypes
+#------------------------------------------
+sub test_cmdAddRepos_mismatchRepoTypes {
+	# ...
+	# Test the AdditionalRepo storage
+	# ---
+	my $this = shift;
+	my $kiwi = $this -&gt; {kiwi};
+	my $cmd = $this -&gt; __getCmdObj();
+	# Provide improper argument
+	my @repos = ('os11.3', 'os11.3-non-oss');
+	my @types = ('yast2');
+	my $res = $cmd -&gt; setAdditionalRepos(\@repos, undef, undef, \@types);
+	my $msg = $kiwi -&gt; getMessage();
+	my $expectedMsg = 'Number of specified repositories does not match number '
+		. 'of provided types, cannot form proper match.';
+	$this -&gt; assert_str_equals($expectedMsg, $msg);
+	my $msgT = $kiwi -&gt; getMessageType();
+	$this -&gt; assert_str_equals('error', $msgT);
+	my $state = $kiwi -&gt; getState();
+	$this -&gt; assert_str_equals('failed', $state);
+	$this -&gt; assert_null($res);
+}
+
+#==========================================
+# test_cmdAddRepos_noRepo
+#------------------------------------------
+sub test_cmdAddRepos_noRepo {
+	# ...
+	# Test the AdditionalRepo storage
+	# ---
+	my $this = shift;
+	my $kiwi = $this -&gt; {kiwi};
+	my $cmd = $this -&gt; __getCmdObj();
+	# Test that there are no default repos
+	my $defRepos = $cmd -&gt; getAdditionalRepos();
+	$this -&gt; assert_null($defRepos);
+	# Provide no arguments
+	my $res = $cmd -&gt; setAdditionalRepos();
+	my $msg = $kiwi -&gt; getMessage();
+	my $expectedMsg = 'setAdditionalRepos method called without specifying '
+		. 'repositories';
+	$this -&gt; assert_str_equals($expectedMsg, $msg);
+	my $msgT = $kiwi -&gt; getMessageType();
+	$this -&gt; assert_str_equals('error', $msgT);
+	my $state = $kiwi -&gt; getState();
+	$this -&gt; assert_str_equals('failed', $state);
+	$this -&gt; assert_null($res);
+}
+
+#==========================================
+# test_cmdAddRepos_noTypes
+#------------------------------------------
+sub test_cmdAddRepos_noTypes {
+	# ...
+	# Test the AdditionalRepo storage
+	# ---
+	my $this = shift;
+	my $kiwi = $this -&gt; {kiwi};
+	my $cmd = $this -&gt; __getCmdObj();
+	# Provide no arguments
+	my @repos = ('os11.3');
+	my $res = $cmd -&gt; setAdditionalRepos(\@repos, undef, undef);
+	my $msg = $kiwi -&gt; getMessage();
+	my $expectedMsg = 'setAdditionalRepos method called without specifying '
+		. 'repository types';
+	$this -&gt; assert_str_equals($expectedMsg, $msg);
+	my $msgT = $kiwi -&gt; getMessageType();
+	$this -&gt; assert_str_equals('error', $msgT);
+	my $state = $kiwi -&gt; getState();
+	$this -&gt; assert_str_equals('failed', $state);
+	$this -&gt; assert_null($res);
+}
+
+#==========================================
+# test_cmdAddRepos_unssupType
+#------------------------------------------
+sub test_cmdAddRepos_unssupType {
+	# ...
+	# Test the AdditionalRepo storage
+	# ---
+	my $this = shift;
+	my $kiwi = $this -&gt; {kiwi};
+	my $cmd = $this -&gt; __getCmdObj();
+	# Provide improper argument
+	my @repos = ('os11.3', 'os11.3-non-oss');
+	my @types = ('yast2', 'foo');
+	my $res = $cmd -&gt; setAdditionalRepos(\@repos, undef, undef, \@types);
+	my $msg = $kiwi -&gt; getMessage();
+	my $expectedMsg = 'Specified repository type foo not supported.';
+	$this -&gt; assert_str_equals($expectedMsg, $msg);
+	my $msgT = $kiwi -&gt; getMessageType();
+	$this -&gt; assert_str_equals('error', $msgT);
+	my $state = $kiwi -&gt; getState();
+	$this -&gt; assert_str_equals('failed', $state);
+	$this -&gt; assert_null($res);
+}
+
+#==========================================
+# test_cmdAddRepos_valid
+#------------------------------------------
+sub test_cmdAddRepos_valid {
+	# ...
+	# Test the AdditionalRepo storage
+	# ---
+	my $this = shift;
+	my $kiwi = $this -&gt; {kiwi};
+	my $cmd = $this -&gt; __getCmdObj();
+	# Provide improper argument
+	my @repos = ('os11.3', 'os11.3-non-oss');
+	my @alias = ('name1', 'name2');
+	my @prios = (1, 2);
+	my @types = ('yast2', 'rpm-md');
+	my $res = $cmd -&gt; setAdditionalRepos(\@repos, \@alias, \@prios, \@types);
+	my $msg = $kiwi -&gt; getMessage();
+	$this -&gt; assert_str_equals('No messages set', $msg);
+	my $msgT = $kiwi -&gt; getMessageType();
+	$this -&gt; assert_str_equals('none', $msgT);
+	my $state = $kiwi -&gt; getState();
+	$this -&gt; assert_str_equals('No state set', $state);
+	$this -&gt; assert_not_null($res);
+	# Make sure we get our data back
+	my %repoInfo = %{$cmd -&gt; getAdditionalRepos()};
+	$this -&gt; assert_array_equal(\@repos, $repoInfo{repositories});
+	$this -&gt; assert_array_equal(\@alias, $repoInfo{repositoryAlia});
+	$this -&gt; assert_array_equal(\@prios, $repoInfo{repositoryPriorities});
+	$this -&gt; assert_array_equal(\@types, $repoInfo{repositoryTypes});
+}
+
+#==========================================
 # test_cmdBuildTypeUsage
 #------------------------------------------
 sub test_cmdBuildTypeUsage {
@@ -67,6 +348,9 @@ sub test_cmdBuildTypeUsage {
 	my $this = shift;
 	my $kiwi = $this -&gt; {kiwi};
 	my $cmd = $this -&gt; __getCmdObj();
+	# Test that there is no default
+	my $defBT = $cmd -&gt; getBuildType();
+	$this -&gt; assert_null($defBT);
 	# Use valid data to set a type information
 	my $res = $cmd -&gt; setBuildType('reiserfs');
 	my $msg = $kiwi -&gt; getMessage();
@@ -82,15 +366,239 @@ sub test_cmdBuildTypeUsage {
 }
 
 #==========================================
-# test_cmdPackageMgrUsage
+# test_cmdConfDirUsage_noArg
+#------------------------------------------
+sub test_cmdConfDirUsage_noArg {
+	# ...
+	# Test the storage and verification of the configuration directory data
+	# ---
+	my $this = shift;
+	my $kiwi = $this -&gt; {kiwi};
+	my $cmd = $this -&gt; __getCmdObj();
+	# Test that there is no default
+	my $defDir = $cmd -&gt; getConfigDir();
+	$this -&gt; assert_null($defDir);
+	# No argument specified
+	my $res = $cmd -&gt; setConfigDir();
+	my $msg = $kiwi -&gt; getMessage();
+	my $expectedMsg = 'setConfigDir method called without specifying a '
+		. 'configuration directory.';
+	$this -&gt; assert_str_equals($expectedMsg, $msg);
+	my $msgT = $kiwi -&gt; getMessageType();
+	$this -&gt; assert_str_equals('error', $msgT);
+	my $state = $kiwi -&gt; getState();
+	$this -&gt; assert_str_equals('failed', $state);
+	$this -&gt; assert_null($res);
+}
+
+#==========================================
+# test_cmdConfDirUsage_noDirExist
+#------------------------------------------
+sub test_cmdConfDirUsage_noDirExist {
+	# ...
+	# Test the storage and verification of the configuration directory data
+	# ---
+	my $this = shift;
+	my $kiwi = $this -&gt; {kiwi};
+	my $cmd = $this -&gt; __getCmdObj();
+	# Directory does not exist
+	my $res = $cmd -&gt; setConfigDir('ola');
+	my $msg = $kiwi -&gt; getMessage();
+	my $expectedMsg = 'Specified configuration directory &quot;ola&quot; could '
+		. 'not be found.';
+	$this -&gt; assert_str_equals($expectedMsg, $msg);
+	my $msgT = $kiwi -&gt; getMessageType();
+	$this -&gt; assert_str_equals('error', $msgT);
+	my $state = $kiwi -&gt; getState();
+	$this -&gt; assert_str_equals('failed', $state);
+	$this -&gt; assert_null($res);
+}
+
+#==========================================
+# test_cmdConfDirUsage_noDirRead
+#------------------------------------------
+sub test_cmdConfDirUsage_noDirRead {
+	# ...
+	# Test the storage and verification of the configuration directory data
+	# ---
+	my $this = shift;
+	my $kiwi = $this -&gt; {kiwi};
+	my $cmd = $this -&gt; __getCmdObj();
+	# Directory has no read access
+	# If the test is run a root the test will fail
+	my $res = $cmd -&gt; setConfigDir('/root');
+	my $msg = $kiwi -&gt; getMessage();
+	my $expectedMsg = 'No read access to specified configuration directory '
+		. '&quot;/root&quot;.';
+	$this -&gt; assert_str_equals($expectedMsg, $msg);
+	my $msgT = $kiwi -&gt; getMessageType();
+	$this -&gt; assert_str_equals('error', $msgT);
+	my $state = $kiwi -&gt; getState();
+	$this -&gt; assert_str_equals('failed', $state);
+	$this -&gt; assert_null($res);
+}
+
+#==========================================
+# test_cmdConfDirUsage_valid
+#------------------------------------------
+sub test_cmdConfDirUsage_valid {
+	# ...
+	# Test the storage and verification of the configuration directory data
+	# ---
+	my $this = shift;
+	my $kiwi = $this -&gt; {kiwi};
+	my $cmd = $this -&gt; __getCmdObj();
+	# Expecting success
+	my $res = $cmd -&gt; setConfigDir('/tmp');
+	my $msg = $kiwi -&gt; getMessage();
+	$this -&gt; assert_str_equals('No messages set', $msg);
+	my $msgT = $kiwi -&gt; getMessageType();
+	$this -&gt; assert_str_equals('none', $msgT);
+	my $state = $kiwi -&gt; getState();
+	$this -&gt; assert_str_equals('No state set', $state);
+	$this -&gt; assert_not_null($res);
+	# Make sure we get our data back
+	my $dir = $cmd -&gt; getConfigDir();
+	$this -&gt; assert_str_equals('/tmp', $dir);
+}
+
+#==========================================
+# test_cmdIgnoreRepoUsage
+#------------------------------------------
+sub test_cmdIgnoreRepoUsage {
+	# ...
+	# Test the storage of the repo ignore state information
+	# ---
+	my $this = shift;
+	my $kiwi = $this -&gt; {kiwi};
+	my $cmd = $this -&gt; __getCmdObj();
+	# Test that the default state if false
+	my $defIgnore = $cmd -&gt; getIgnoreRepos();
+	$this -&gt; assert_null($defIgnore);
+	# Test that passing no argument does not change the state
+	$cmd -&gt; setIgnoreRepos();
+	my $ignore = $cmd -&gt; getIgnoreRepos();
+	$this -&gt; assert_null($defIgnore);
+	# Test we get our value back
+	$cmd -&gt; setIgnoreRepos(1);
+	$ignore = $cmd -&gt; getIgnoreRepos();
+	$this -&gt; assert_equals(1, $ignore);
+}
+
+#==========================================
+# test_cmdIgnoreRepoUsage_conflict
+#------------------------------------------
+sub test_cmdIgnoreRepoUsage_conflict {
+	# ...
+	# Test the storage of the repo ignore state information
+	# ---
+	my $this = shift;
+	my $kiwi = $this -&gt; {kiwi};
+	my $cmd = $this -&gt; __getCmdObj();
+	# Test that passing no argument does not change the state
+	$cmd -&gt; setReplacementRepo('os11.3', 'alias', 1, 'yast2');
+	my $res = $cmd -&gt; setIgnoreRepos();
+	$this -&gt; assert_not_null($res);
+	# Create conflicting settings
+	$res = $cmd -&gt; setIgnoreRepos(1);
+	my $msg = $kiwi -&gt; getMessage();
+	my $expectedMsg = 'Conflicting command line arguments; ignore repos and '
+		. 'set repos';
+	$this -&gt; assert_str_equals($expectedMsg, $msg);
+	my $msgT = $kiwi -&gt; getMessageType();
+	$this -&gt; assert_str_equals('error', $msgT);
+	my $state = $kiwi -&gt; getState();
+	$this -&gt; assert_str_equals('failed', $state);
+	$this -&gt; assert_null($res);
+}
+
+#==========================================
+# test_cmdLogFileUsage_noArg
+#------------------------------------------
+sub test_cmdLogFileUsage_noArg {
+	# ...
+	# Test the storage of the logfile path
+	# ---
+	my $this = shift;
+	my $kiwi = $this -&gt; {kiwi};
+	my $cmd = $this -&gt; __getCmdObj();
+	# Test that the command line object has no default
+	my $defLog = $cmd -&gt; getLogFile();
+	$this -&gt; assert_null($defLog);
+	# Test improper call no argument
+	my $res = $cmd -&gt; setLogFile();
+	my $msg = $kiwi -&gt; getMessage();
+	my $expectedMsg = 'setLogFileName method called without specifying a '
+		. 'log file path.';
+	$this -&gt; assert_str_equals($expectedMsg, $msg);
+	my $msgT = $kiwi -&gt; getMessageType();
+	$this -&gt; assert_str_equals('error', $msgT);
+	my $state = $kiwi -&gt; getState();
+	$this -&gt; assert_str_equals('failed', $state);
+	$this -&gt; assert_null($res);
+}
+
+#==========================================
+# test_cmdLogFileUsage_noWrite
+#------------------------------------------
+sub test_cmdLogFileUsagee_noWrite {
+	# ...
+	# Test the storage of the logfile path
+	# ---
+	my $this = shift;
+	my $kiwi = $this -&gt; {kiwi};
+	my $cmd = $this -&gt; __getCmdObj();
+	# Test no write permission
+	# If the test is executed as root this test will fail
+	my $res = $cmd -&gt; setLogFile('/usr/cmdlTestLog.log');
+	my $msg = $kiwi -&gt; getMessage();
+	my $expectedMsg = 'Unable to write to location /usr/, cannot create log '
+		. 'file.';
+	$this -&gt; assert_str_equals($expectedMsg, $msg);
+	my $msgT = $kiwi -&gt; getMessageType();
+	$this -&gt; assert_str_equals('error', $msgT);
+	my $state = $kiwi -&gt; getState();
+	$this -&gt; assert_str_equals('failed', $state);
+	$this -&gt; assert_null($res);
+}
+
+#==========================================
+# test_cmdLogFileUsage_valid
+#------------------------------------------
+sub test_cmdLogFileUsage_valid {
+	# ...
+	# Test the storage of the logfile path
+	# ---
+	my $this = shift;
+	my $kiwi = $this -&gt; {kiwi};
+	my $cmd = $this -&gt; __getCmdObj();
+	# Test proper use
+	my $res = $cmd -&gt; setLogFile('/tmp/cmdlTestLog.log');
+	my $msg = $kiwi -&gt; getMessage();
+	$this -&gt; assert_str_equals('No messages set', $msg);
+	my $msgT = $kiwi -&gt; getMessageType();
+	$this -&gt; assert_str_equals('none', $msgT);
+	my $state = $kiwi -&gt; getState();
+	$this -&gt; assert_str_equals('No state set', $state);
+	$this -&gt; assert_not_null($res);
+	# Make sure we get our data back
+	my $logFile = $cmd -&gt; getLogFile();
+	$this -&gt; assert_str_equals('/tmp/cmdlTestLog.log', $logFile);
+}
+
+#==========================================
+# test_cmdPackageMgrUsage_improper
 #------------------------------------------
-sub test_cmdPackageMgrUsage {
+sub test_cmdPackageMgrUsage_improper {
 	# ...
 	# Test the storage of the package manager
 	# ---
 	my $this = shift;
 	my $kiwi = $this -&gt; {kiwi};
 	my $cmd = $this -&gt; __getCmdObj();
+	# Test that the command line object has no default
+	my $defMgr = $cmd -&gt; getPackageManager();
+	$this -&gt; assert_null($defMgr);
 	# Test improper call
 	my $res = $cmd -&gt; setPackageManager();
 	my $msg = $kiwi -&gt; getMessage();
@@ -102,23 +610,47 @@ sub test_cmdPackageMgrUsage {
 	my $state = $kiwi -&gt; getState();
 	$this -&gt; assert_str_equals('failed', $state);
 	$this -&gt; assert_null($res);
+}
+
+#==========================================
+# test_cmdPackageMgrUsage_noSupport
+#------------------------------------------
+sub test_cmdPackageMgrUsage_noSupport {
+	# ...
+	# Test the storage of the package manager
+	# ---
+	my $this = shift;
+	my $kiwi = $this -&gt; {kiwi};
+	my $cmd = $this -&gt; __getCmdObj();
 	# Test unsupported package manager
-	$res = $cmd -&gt; setPackageManager('pablo');
-	$msg = $kiwi -&gt; getMessage();
-	$expectedMsg = 'Unsupported package manager specified: pablo';
+	my $res = $cmd -&gt; setPackageManager('pablo');
+	my $msg = $kiwi -&gt; getMessage();
+	my $expectedMsg = 'Unsupported package manager specified: pablo';
 	$this -&gt; assert_str_equals($expectedMsg, $msg);
-	$msgT = $kiwi -&gt; getMessageType();
+	my $msgT = $kiwi -&gt; getMessageType();
 	$this -&gt; assert_str_equals('error', $msgT);
-	$state = $kiwi -&gt; getState();
+	my $state = $kiwi -&gt; getState();
 	$this -&gt; assert_str_equals('failed', $state);
 	$this -&gt; assert_null($res);
+}
+
+#==========================================
+# test_cmdPackageMgrUsage_valid
+#------------------------------------------
+sub test_cmdPackageMgrUsage_valid {
+	# ...
+	# Test the storage of the package manager
+	# ---
+	my $this = shift;
+	my $kiwi = $this -&gt; {kiwi};
+	my $cmd = $this -&gt; __getCmdObj();
 	# Make sure we can get our data back
-	$res = $cmd -&gt; setPackageManager('zypper');
-	$msg = $kiwi -&gt; getMessage();
+	my $res = $cmd -&gt; setPackageManager('zypper');
+	my $msg = $kiwi -&gt; getMessage();
 	$this -&gt; assert_str_equals('No messages set', $msg);
-	$msgT = $kiwi -&gt; getMessageType();
+	my $msgT = $kiwi -&gt; getMessageType();
 	$this -&gt; assert_str_equals('none', $msgT);
-	$state = $kiwi -&gt; getState();
+	my $state = $kiwi -&gt; getState();
 	$this -&gt; assert_str_equals('No state set', $state);
 	$this -&gt; assert_not_null($res);
 	my $pckMgr = $cmd -&gt; getPackageManager();
@@ -126,9 +658,35 @@ sub test_cmdPackageMgrUsage {
 }
 
 #==========================================
-# test_cmdProfileUsage
+# test_cmdProfileUsage_invalid
+#------------------------------------------
+sub test_cmdProfileUsage_invalid {
+	# ...
+	# Test the storage for profile data
+	# ---
+	my $this = shift;
+	my $kiwi = $this -&gt; {kiwi};
+	my $cmd = $this -&gt; __getCmdObj();
+	# Test that there are no default profiles
+	my $defProfs = $cmd -&gt; getBuildProfiles();
+	$this -&gt; assert_null($defProfs);
+	# Test improper call no argument
+	my $res = $cmd -&gt; setBuildProfiles();
+	my $msg = $kiwi -&gt; getMessage();
+	my $expectedMsg = 'setBuildProfiles method called without specifying '
+		. 'profiles in ARRAY_REF';
+	$this -&gt; assert_str_equals($expectedMsg, $msg);
+	my $msgT = $kiwi -&gt; getMessageType();
+	$this -&gt; assert_str_equals('error', $msgT);
+	my $state = $kiwi -&gt; getState();
+	$this -&gt; assert_str_equals('failed', $state);
+	$this -&gt; assert_null($res);
+}
+
+#==========================================
+# test_cmdProfileUsage_improper
 #------------------------------------------
-sub test_cmdProfileUsage {
+sub test_cmdProfileUsage_improper {
 	# ...
 	# Test the storage for profile data
 	# ---
@@ -137,6 +695,32 @@ sub test_cmdProfileUsage {
 	my $cmd = $this -&gt; __getCmdObj();
 	# Set some list data
 	my @profiles = qw(first second);
+	# Test improper argument type
+	my $res = $cmd -&gt; setBuildProfiles(@profiles);
+	my $msg = $kiwi -&gt; getMessage();
+	my $expectedMsg = 'setBuildProfiles method expecting ARRAY_REF as '
+		. 'argument';
+	$this -&gt; assert_str_equals($expectedMsg, $msg);
+	my $msgT = $kiwi -&gt; getMessageType();
+	$this -&gt; assert_str_equals('error', $msgT);
+	my $state = $kiwi -&gt; getState();
+	$this -&gt; assert_str_equals('failed', $state);
+	$this -&gt; assert_null($res);
+}
+
+#==========================================
+# test_cmdProfileUsage_valid
+#------------------------------------------
+sub test_cmdProfileUsage_valid {
+	# ...
+	# Test the storage for profile data
+	# ---
+	my $this = shift;
+	my $kiwi = $this -&gt; {kiwi};
+	my $cmd = $this -&gt; __getCmdObj();
+	# Set some list data
+	my @profiles = qw(first second);
+	# Proper use, make sure we get our array back
 	my $res = $cmd -&gt; setBuildProfiles(\@profiles);
 	my $msg = $kiwi -&gt; getMessage();
 	$this -&gt; assert_str_equals('No messages set', $msg);
@@ -151,6 +735,175 @@ sub test_cmdProfileUsage {
 }
 
 #==========================================
+# test_cmdReplaceRepo_conflict
+#------------------------------------------
+sub test_cmdReplaceRepo_conflict {
+	# ...
+	# Test the storage of the replacement repo information
+	# ---
+	my $this = shift;
+	my $kiwi = $this -&gt; {kiwi};
+	my $cmd = $this -&gt; __getCmdObj();
+	# Test improper call no argument
+	$cmd -&gt; setIgnoreRepos(1);
+	my $res = $cmd -&gt; setReplacementRepo('os11.3', 'alias', 1, 'yast2');
+	my $msg = $kiwi -&gt; getMessage();
+	my $expectedMsg = 'Conflicting command line arguments; ignore repos '
+		. 'and set repos';
+	$this -&gt; assert_str_equals($expectedMsg, $msg);
+	my $msgT = $kiwi -&gt; getMessageType();
+	$this -&gt; assert_str_equals('error', $msgT);
+	my $state = $kiwi -&gt; getState();
+	$this -&gt; assert_str_equals('failed', $state);
+	$this -&gt; assert_null($res);
+}
+
+#==========================================
+# test_cmdReplaceRepo_noAlias
+#------------------------------------------
+sub test_cmdReplaceRepo_noAlias {
+	# ...
+	# Test the storage of the replacement repo information
+	# ---
+	my $this = shift;
+	my $kiwi = $this -&gt; {kiwi};
+	my $cmd = $this -&gt; __getCmdObj();
+	# Test improper call no argument
+	my $res = $cmd -&gt; setReplacementRepo('os11.3', undef, 1, 'yast2');
+	my $msg = $kiwi -&gt; getMessage();
+	my $expectedMsg = &quot;No repo alias defined, generating time based name.\n&quot;;
+	$this -&gt; assert_str_equals($expectedMsg, $msg);
+	my $msgT = $kiwi -&gt; getMessageType();
+	$this -&gt; assert_str_equals('info', $msgT);
+	my $state = $kiwi -&gt; getState();
+	$this -&gt; assert_str_equals('No state set', $state);
+	$this -&gt; assert_not_null($res);
+}
+
+#==========================================
+# test_cmdReplaceRepo_noPrio
+#------------------------------------------
+sub test_cmdReplaceRepo_noPrio {
+	# ...
+	# Test the storage of the replacement repo information
+	# ---
+	my $this = shift;
+	my $kiwi = $this -&gt; {kiwi};
+	my $cmd = $this -&gt; __getCmdObj();
+	# Test improper call no argument
+	my $res = $cmd -&gt; setReplacementRepo('os11.3', 'alias', undef, 'yast2');
+	my $msg = $kiwi -&gt; getMessage();
+	my $expectedMsg = &quot;No repo priority specified, using default value '10'\n&quot;;
+	$this -&gt; assert_str_equals($expectedMsg, $msg);
+	my $msgT = $kiwi -&gt; getMessageType();
+	$this -&gt; assert_str_equals('info', $msgT);
+	my $state = $kiwi -&gt; getState();
+	$this -&gt; assert_str_equals('No state set', $state);
+	$this -&gt; assert_not_null($res);
+	# Verify the default priority
+	my %repoInfo = %{$cmd -&gt; getReplacementRepo()};
+	$this -&gt; assert_equals(10, $repoInfo{repositoryPriority});
+}
+
+#==========================================
+# test_cmdReplaceRepo_noRepo
+#------------------------------------------
+sub test_cmdReplaceRepo_noRepo {
+	# ...
+	# Test the storage of the replacement repo information
+	# ---
+	my $this = shift;
+	my $kiwi = $this -&gt; {kiwi};
+	my $cmd = $this -&gt; __getCmdObj();
+	# Test that commandline object has no default setting
+	my $defRepo = $cmd -&gt; getReplacementRepo();
+	$this -&gt; assert_null($defRepo);
+	# Test improper call no argument
+	my $res = $cmd -&gt; setReplacementRepo();
+	my $msg = $kiwi -&gt; getMessage();
+	my $expectedMsg = 'setReplacementRepo method called without specifying '
+		. 'a repository.';
+	$this -&gt; assert_str_equals($expectedMsg, $msg);
+	my $msgT = $kiwi -&gt; getMessageType();
+	$this -&gt; assert_str_equals('error', $msgT);
+	my $state = $kiwi -&gt; getState();
+	$this -&gt; assert_str_equals('failed', $state);
+	$this -&gt; assert_null($res);
+}
+
+#==========================================
+# test_cmdReplaceRepo_noRepoType
+#------------------------------------------
+sub test_cmdReplaceRepo_noRepoType {
+	# ...
+	# Test the storage of the replacement repo information
+	# ---
+	my $this = shift;
+	my $kiwi = $this -&gt; {kiwi};
+	my $cmd = $this -&gt; __getCmdObj();
+	# Test improper call no argument
+	my $res = $cmd -&gt; setReplacementRepo('os11.3', 'alias', 1);
+	my $msg = $kiwi -&gt; getMessage();
+	my $expectedMsg = 'setReplacementRepo method called without specifying '
+		. 'a repository type.';
+	$this -&gt; assert_str_equals($expectedMsg, $msg);
+	my $msgT = $kiwi -&gt; getMessageType();
+	$this -&gt; assert_str_equals('error', $msgT);
+	my $state = $kiwi -&gt; getState();
+	$this -&gt; assert_str_equals('failed', $state);
+	$this -&gt; assert_null($res);
+}
+
+#==========================================
+# test_cmdReplaceRepo_unsupRepoType
+#------------------------------------------
+sub test_cmdReplaceRepo_unsupRepoType {
+	# ...
+	# Test the storage of the replacement repo information
+	# ---
+	my $this = shift;
+	my $kiwi = $this -&gt; {kiwi};
+	my $cmd = $this -&gt; __getCmdObj();
+	# Test improper call no argument
+	my $res = $cmd -&gt; setReplacementRepo('os11.3', 'alias', 1, 'foo');
+	my $msg = $kiwi -&gt; getMessage();
+	my $expectedMsg = 'Specified repository type foo not supported.';
+	$this -&gt; assert_str_equals($expectedMsg, $msg);
+	my $msgT = $kiwi -&gt; getMessageType();
+	$this -&gt; assert_str_equals('error', $msgT);
+	my $state = $kiwi -&gt; getState();
+	$this -&gt; assert_str_equals('failed', $state);
+	$this -&gt; assert_null($res);
+}
+
+#==========================================
+# test_cmdReplaceRepo_valid
+#------------------------------------------
+sub test_cmdReplaceRepo_valid {
+	# ...
+	# Test the storage of the replacement repo information
+	# ---
+	my $this = shift;
+	my $kiwi = $this -&gt; {kiwi};
+	my $cmd = $this -&gt; __getCmdObj();
+	# Test improper call no argument
+	my $res = $cmd -&gt; setReplacementRepo('os11.3', 'alias', 1, 'yast2');
+	my $msg = $kiwi -&gt; getMessage();
+	$this -&gt; assert_str_equals('No messages set', $msg);
+	my $msgT = $kiwi -&gt; getMessageType();
+	$this -&gt; assert_str_equals('none', $msgT);
+	my $state = $kiwi -&gt; getState();
+	$this -&gt; assert_str_equals('No state set', $state);
+	$this -&gt; assert_not_null($res);
+	# Check we get the expected result
+	my %repoInfo = %{$cmd -&gt; getReplacementRepo()};
+	$this -&gt; assert_str_equals('os11.3', $repoInfo{repository});
+	$this -&gt; assert_str_equals('alias', $repoInfo{repositoryAlias});
+	$this -&gt; assert_equals(1, $repoInfo{repositoryPriority});
+	$this -&gt; assert_str_equals('yast2', $repoInfo{repositoryType});
+}
+
+#==========================================
 # Private helper methods
 #------------------------------------------
 #==========================================
diff --git a/tests/unit/lib/Test/kiwiRuntimeChecker.pm b/tests/unit/lib/Test/kiwiRuntimeChecker.pm
index e1720f0..ccc69c9 100644
--- a/tests/unit/lib/Test/kiwiRuntimeChecker.pm
+++ b/tests/unit/lib/Test/kiwiRuntimeChecker.pm
@@ -41,9 +41,9 @@ sub new {
 }
 
 #==========================================
-# test_ctor
+# test_ctor_noArg1
 #------------------------------------------
-sub test_ctor {
+sub test_ctor_noArg1 {
 	# ...
 	# Test the runtime checker constructor
 	# ---
@@ -61,26 +61,49 @@ sub test_ctor {
 	$this -&gt; assert_str_equals('failed', $state);
 	# Test this condition last to get potential error messages
 	$this -&gt; assert_null($checker);
+}
+
+#==========================================
+# test_ctor_noArg2
+#------------------------------------------
+sub test_ctor_noArg2 {
+	# ...
+	# Test the runtime checker constructor
+	# ---
+	my $this = shift;
+	my $kiwi = $this -&gt; {kiwi};
 	# Test missing third argument
 	my $cmd = $this -&gt; __getCommandLineObj();
-	$checker = new KIWIRuntimeChecker($kiwi, $cmd);
-	$msg = $kiwi -&gt; getMessage();
-	$expected = 'Expecting reference to KIWIXML object as third argument.';
+	my $checker = new KIWIRuntimeChecker($kiwi, $cmd);
+	my $msg = $kiwi -&gt; getMessage();
+	my $expected = 'Expecting reference to KIWIXML object as third argument.';
 	$this -&gt; assert_str_equals($expected, $msg);
-	$msgT = $kiwi -&gt; getMessageType();
+	my $msgT = $kiwi -&gt; getMessageType();
 	$this -&gt; assert_str_equals('error', $msgT);
-	$state = $kiwi -&gt; getState();
+	my $state = $kiwi -&gt; getState();
 	$this -&gt; assert_str_equals('failed', $state);
 	# Test this condition last to get potential error messages
 	$this -&gt; assert_null($checker);
+}
+
+#==========================================
+# test_ctor_valid
+#------------------------------------------
+sub test_ctor_valid {
+	# ...
+	# Test the runtime checker constructor
+	# ---
+	my $this = shift;
+	my $kiwi = $this -&gt; {kiwi};
 	# No error construction
+	my $cmd = $this -&gt; __getCommandLineObj();
 	my $xml = $this -&gt; __getXMLObj( $this -&gt; {dataDir} );
-	$checker = new KIWIRuntimeChecker($kiwi, $cmd, $xml);
-	$msg = $kiwi -&gt; getMessage();
+	my $checker = new KIWIRuntimeChecker($kiwi, $cmd, $xml);
+	my $msg = $kiwi -&gt; getMessage();
 	$this -&gt; assert_str_equals('No messages set', $msg);
-	$msgT = $kiwi -&gt; getMessageType();
+	my $msgT = $kiwi -&gt; getMessageType();
 	$this -&gt; assert_str_equals('none', $msgT);
-	$state = $kiwi -&gt; getState();
+	my $state = $kiwi -&gt; getState();
 	$this -&gt; assert_str_equals('No state set', $state);
 	# Test this condition last to get potential error messages
 	$this -&gt; assert_not_null($checker);
@@ -413,7 +436,7 @@ sub test_noBuildType {
 #==========================================
 # test_packageManagerCheck
 #------------------------------------------
-sub test_packageManagerCheck {
+sub test_packageManagerCheck_ens {
 	# ...
 	# Test that the runtime check for package manager tool existence behaves
 	# properly.
@@ -452,14 +475,26 @@ sub test_packageManagerCheck {
 		$this -&gt; assert_str_equals('failed', $state);
 		$this -&gt; assert_null($res);
 	}
+}
+
+#==========================================
+# test_packageManagerCheck_ens
+#------------------------------------------
+sub test_packageManagerCheck_zypp {
+	# ...
+	# Test that the runtime check for package manager tool existence behaves
+	# properly.
+	# ---
+	my $this = shift;
+	my $kiwi = $this -&gt; {kiwi};
+	my $cmd = $this -&gt; __getCommandLineObj();
 	# Test the most likely use case, zypper set as package manager in
 	# config.xml, this test should succeed
-	$cmd = $this -&gt; __getCommandLineObj();
-	$xml = $this -&gt; __getXMLObj( $this -&gt; {dataDir} );
-	$checker = new KIWIRuntimeChecker($kiwi, $cmd, $xml);
-	$res = $checker -&gt; prepareChecks();
+	my $xml = $this -&gt; __getXMLObj( $this -&gt; {dataDir} );
+	my $checker = new KIWIRuntimeChecker($kiwi, $cmd, $xml);
+	my $res = $checker -&gt; prepareChecks();
 
-	$locator = new KIWILocator($kiwi);
+	my $locator = new KIWILocator($kiwi);
 	my $haveZypper = $locator -&gt; getExecPath('zypper');
 	if ($haveZypper) {
 		my $msg = $kiwi -&gt; getMessage();
@@ -548,4 +583,5 @@ sub __getXMLObj {
 	}
 	return $xml;
 }
+
 1;
diff --git a/tests/unit/lib/Test/xml.pm b/tests/unit/lib/Test/kiwiXML.pm
similarity index 70%
rename from tests/unit/lib/Test/xml.pm
rename to tests/unit/lib/Test/kiwiXML.pm
index d3b5c4d..dad9df5 100644
--- a/tests/unit/lib/Test/xml.pm
+++ b/tests/unit/lib/Test/kiwiXML.pm
@@ -12,7 +12,7 @@
 #               :
 # STATUS        : Development
 #----------------
-package Test::xml;
+package Test::kiwiXML;
 
 use strict;
 use warnings;
@@ -38,7 +38,7 @@ sub new {
 	# Construct new test case
 	# ---
 	my $this = shift -&gt; SUPER::new(@_);
-	$this -&gt; {dataDir} = $this -&gt; getDataDir() . '/xml/';
+	$this -&gt; {dataDir} = $this -&gt; getDataDir() . '/kiwiXML/';
 	$this -&gt; {kiwi} = new  Common::ktLog();
 
 	return $this;
@@ -58,6 +58,25 @@ sub test_packageManagerInfoHasConfigValue {
 	my $xml = new KIWIXML($this -&gt; {kiwi}, $confDir, undef, undef);
 	my $pkgMgr = $xml -&gt; getPackageManager();
 	$this -&gt; assert_str_equals('zypper', $pkgMgr);
+	my $msg = $kiwi -&gt; getMessage();
+	$this -&gt; assert_str_equals('No messages set', $msg);
+	my $msgT = $kiwi -&gt; getMessageType();
+	$this -&gt; assert_str_equals('none', $msgT);
+	my $state = $kiwi -&gt; getState();
+	$this -&gt; assert_str_equals('No state set', $state);
+}
+
+#==========================================
+# test_packageManagerSet_noArg
+#------------------------------------------
+sub test_packageManagerSet_noArg {
+	# ...
+	# Verify of setPackageManager method error condition
+	# ---
+	my $this = shift;
+	my $kiwi = $this -&gt; {kiwi};
+	my $confDir = $this-&gt;{dataDir} . 'specPkgMgr';
+	my $xml = new KIWIXML($this -&gt; {kiwi}, $confDir, undef, undef);
 	# Call set without argument, expect error
 	my $res = $xml -&gt; setPackageManager();
 	my $msg = $kiwi -&gt; getMessage();
@@ -70,36 +89,21 @@ sub test_packageManagerInfoHasConfigValue {
 	$this -&gt; assert_str_equals('failed', $state);
 	# Test this condition last to get potential error messages
 	$this -&gt; assert_null($res);
-	# Set the package manager to be yum
-	$res = $xml -&gt; setPackageManager('smart');
-	$msg = $kiwi -&gt; getMessage();
-	$this -&gt; assert_str_equals('No messages set', $msg);
-	$msgT = $kiwi -&gt; getMessageType();
-	$this -&gt; assert_str_equals('none', $msgT);
-	$state = $kiwi -&gt; getState();
-	$this -&gt; assert_str_equals('No state set', $state);
-	# Test this condition last to get potential error messages
-	$this -&gt; assert_not_null($res);
-	my $newPkgMgr = $xml -&gt; getPackageManager();
-	$this -&gt; assert_str_equals('smart', $newPkgMgr);
 }
 
 #==========================================
-# test_packageManagerInfoHasProfs
+# test_packageManagerSet_noArg
 #------------------------------------------
-sub test_packageManagerInfoHasProfs {
+sub test_packageManagerSet_valid {
 	# ...
-	# Verify that the default package manager is provided if no package manager
-	# is set in the configuration
+	# Verify setPackageManager works as expected
 	# ---
 	my $this = shift;
 	my $kiwi = $this -&gt; {kiwi};
-	my $confDir = $this-&gt;{dataDir} . 'multiPkgMgrWithProf';
+	my $confDir = $this-&gt;{dataDir} . 'specPkgMgr';
 	my $xml = new KIWIXML($this -&gt; {kiwi}, $confDir, undef, undef);
-	my $pkgMgr = $xml -&gt; getPackageManager();
-	$this -&gt; assert_str_equals('zypper', $pkgMgr);
-	# Set the package manager to be yum
-	my $res = $xml -&gt; setPackageManager('yum');
+	# Set the package manager to be smart
+	my $res = $xml -&gt; setPackageManager('smart');
 	my $msg = $kiwi -&gt; getMessage();
 	$this -&gt; assert_str_equals('No messages set', $msg);
 	my $msgT = $kiwi -&gt; getMessageType();
@@ -109,53 +113,37 @@ sub test_packageManagerInfoHasProfs {
 	# Test this condition last to get potential error messages
 	$this -&gt; assert_not_null($res);
 	my $newPkgMgr = $xml -&gt; getPackageManager();
-	$this -&gt; assert_str_equals('yum', $newPkgMgr);
-	# Use the profile that has a package manager specified
-	my @profiles = ('specPkgMgr');
-	$xml = new KIWIXML($this -&gt; {kiwi}, $confDir, undef, \@profiles);
-	$pkgMgr = $xml -&gt; getPackageManager();
-	$this -&gt; assert_str_equals('zypper', $pkgMgr);
-	$msg = $kiwi -&gt; getMessage();
-	$this -&gt; assert_str_equals('Using profile(s): specPkgMgr', $msg);
-	$msgT = $kiwi -&gt; getMessageType();
-	$this -&gt; assert_str_equals('info', $msgT);
-	$state = $kiwi -&gt; getState();
-	$this -&gt; assert_str_equals('completed', $state);
-	# Set the package manager to be yum
-	$res = $xml -&gt; setPackageManager('yum');
-	$msg = $kiwi -&gt; getMessage();
-	$this -&gt; assert_str_equals('No messages set', $msg);
-	$msgT = $kiwi -&gt; getMessageType();
-	$this -&gt; assert_str_equals('none', $msgT);
-	$state = $kiwi -&gt; getState();
-	$this -&gt; assert_str_equals('No state set', $state);
-	# Test this condition last to get potential error messages
-	$this -&gt; assert_not_null($res);
-	$newPkgMgr = $xml -&gt; getPackageManager();
-	$this -&gt; assert_str_equals('yum', $newPkgMgr);
+	$this -&gt; assert_str_equals('smart', $newPkgMgr);
 }
 
 #==========================================
-# test_packageManagerInfoNoConfigValue
+# test_packageManagerInfoHasProfs
 #------------------------------------------
-sub test_packageManagerInfoNoConfigValue {
+sub test_packageManagerInfoHasProfs {
 	# ...
-	# Verify that the default package manager is provided if no package manager
-	# is set in the configuration
+	# Verify package manager override works as expected
 	# ---
 	my $this = shift;
 	my $kiwi = $this -&gt; {kiwi};
-	my $confDir = $this-&gt;{dataDir} . 'defPkgMgr';
-	my $xml = new KIWIXML($this -&gt; {kiwi}, $confDir, undef, undef);
+	my $confDir = $this-&gt;{dataDir} . 'multiPkgMgrWithProf';
+	my @profiles = ('specPkgMgr');
+	# Verify we get the specified manager
+	my $xml = new KIWIXML($this -&gt; {kiwi}, $confDir, undef,\@profiles);
 	my $pkgMgr = $xml -&gt; getPackageManager();
-	$this -&gt; assert_str_equals('zypper', $pkgMgr);
-	# Set the package manager to be yum
-	my $res = $xml -&gt; setPackageManager('yum');
+	$this -&gt; assert_str_equals('smart', $pkgMgr);
 	my $msg = $kiwi -&gt; getMessage();
-	$this -&gt; assert_str_equals('No messages set', $msg);
+	$this -&gt; assert_str_equals('Using profile(s): specPkgMgr', $msg);
 	my $msgT = $kiwi -&gt; getMessageType();
-	$this -&gt; assert_str_equals('none', $msgT);
+	$this -&gt; assert_str_equals('info', $msgT);
 	my $state = $kiwi -&gt; getState();
+	$this -&gt; assert_str_equals('completed', $state);
+	# Override the specified package manager with yum
+	my $res = $xml -&gt; setPackageManager('yum');
+	$msg = $kiwi -&gt; getMessage();
+	$this -&gt; assert_str_equals('No messages set', $msg);
+	$msgT = $kiwi -&gt; getMessageType();
+	$this -&gt; assert_str_equals('none', $msgT);
+	$state = $kiwi -&gt; getState();
 	$this -&gt; assert_str_equals('No state set', $state);
 	# Test this condition last to get potential error messages
 	$this -&gt; assert_not_null($res);
@@ -163,5 +151,4 @@ sub test_packageManagerInfoNoConfigValue {
 	$this -&gt; assert_str_equals('yum', $newPkgMgr);
 }
 
-
 1;
diff --git a/tests/unit/lib/Test/kiwiXMLInfo.pm b/tests/unit/lib/Test/kiwiXMLInfo.pm
new file mode 100644
index 0000000..20b0368
--- /dev/null
+++ b/tests/unit/lib/Test/kiwiXMLInfo.pm
@@ -0,0 +1,413 @@
+#================
+# FILE          : kiwiXMLInfo.pm
+#----------------
+# PROJECT       : OpenSUSE Build-Service
+# COPYRIGHT     : (c) 2011 Novell Inc.
+#               :
+# AUTHOR        : Robert Schweikert &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/kiwi-devel">rschweikert at novell.com</A>&gt;
+#               :
+# BELONGS TO    : Operating System images
+#               :
+# DESCRIPTION   : Unit test implementation for the KIWIXMLInfo module.
+#               : Certain queries require root priveleges, thus these queries
+#               : are not implemented as unit tests. Manual testing is required
+#               : to verify query functionality for
+#               :     -- packages
+#               :     -- patterns
+#               :     -- repo-patterns
+#               :     -- size
+#               :
+# STATUS        : Development
+#----------------
+package Test::kiwiXMLInfo;
+
+use strict;
+use warnings;
+use XML::LibXML;
+
+use Common::ktLog;
+use Common::ktTestCase;
+use base qw /Common::ktTestCase/;
+
+use KIWICommandLine;
+use KIWIXMLInfo;
+
+#==========================================
+# Constructor
+#------------------------------------------
+sub new {
+	# ...
+	# Construct new test case
+	# ---
+	my $this = shift -&gt; SUPER::new(@_);
+	my $baseDir = $this -&gt; getDataDir() . '/xmlInfo/';
+	$this -&gt; {baseDir} = $baseDir;
+	$this -&gt; {kiwi}    = new Common::ktLog();
+
+	return $this;
+}
+
+#==========================================
+# test_ctor_improperArg
+#------------------------------------------
+sub test_ctor_improperArg {
+	# ...
+	# Test the XMLInfo object constructor
+	# ---
+	my $this = shift;
+	my $kiwi = $this -&gt; {kiwi};
+	my $cmdL = new KIWICommandLine($kiwi);
+	# No argument for CommandLine object
+	my $info = new KIWIXMLInfo($kiwi, $cmdL);
+	my $msg = $kiwi -&gt; getMessage();
+	my $expectedMsg = 'Invalid KIWICommandLine object, no configuration '
+		. 'directory.';
+	$this -&gt; assert_str_equals($expectedMsg, $msg);
+	my $msgT = $kiwi -&gt; getMessageType();
+	$this -&gt; assert_str_equals('error', $msgT);
+	my $state = $kiwi -&gt; getState();
+	$this -&gt; assert_str_equals('failed', $state);
+	# Test this condition last to get potential error messages
+	$this -&gt; assert_null($info);
+}
+
+#==========================================
+# test_ctor_missArg
+#------------------------------------------
+sub test_ctor_missArg {
+	# ...
+	# Test the XMLInfo object constructor
+	# ---
+	my $this = shift;
+	my $kiwi = $this -&gt; {kiwi};
+	# No argument for CommandLine object
+	my $info = new KIWIXMLInfo($kiwi);
+	my $msg = $kiwi -&gt; getMessage();
+	my $expectedMsg = 'KIWIXMLInfo: expecting KIWICommandLine object as '
+		. 'second argument.';
+	$this -&gt; assert_str_equals($expectedMsg, $msg);
+	my $msgT = $kiwi -&gt; getMessageType();
+	$this -&gt; assert_str_equals('error', $msgT);
+	my $state = $kiwi -&gt; getState();
+	$this -&gt; assert_str_equals('failed', $state);
+	# Test this condition last to get potential error messages
+	$this -&gt; assert_null($info);
+}
+
+#==========================================
+# test_getTree_improperArg
+#------------------------------------------
+sub test_getTree_improperArg {
+	# ...
+	# Test getting a tree
+	# ---
+	my $this = shift;
+	my $kiwi = $this -&gt; {kiwi};
+	my $cmd  = $this -&gt; __getCmdl();
+	$cmd -&gt; setConfigDir($this -&gt; {baseDir});
+	my $info = $this -&gt; __getInfoObj($cmd);
+	# Supply improper argument
+	my @invalidOpts = ('ola');
+	my $res = $info -&gt; getXMLInfoTree(@invalidOpts);
+	my $msg = $kiwi -&gt; getMessage();
+	my $expectedMsg = 'Expecting ARRAY_REF as first argument for info '
+		. 'requests.';
+	$this -&gt; assert_str_equals($expectedMsg, $msg);
+	my $msgT = $kiwi -&gt; getMessageType();
+	$this -&gt; assert_str_equals('error', $msgT);
+	my $state = $kiwi -&gt; getState();
+	$this -&gt; assert_str_equals('failed', $state);
+	$this -&gt; assert_null($res);
+}
+
+#==========================================
+# test_getTree_invalidReq
+#------------------------------------------
+sub test_getTree_invalidReq {
+	# ...
+	# Test getting a tree
+	# ---
+	my $this = shift;
+	my $kiwi = $this -&gt; {kiwi};
+	my $cmd  = $this -&gt; __getCmdl();
+	$cmd -&gt; setConfigDir($this -&gt; {baseDir});
+	my $info = $this -&gt; __getInfoObj($cmd);
+	# Supply improper argument
+	my @invalidOpts = ('ola');
+	my $res = $info -&gt; getXMLInfoTree(\@invalidOpts);
+	my $expectedMsg = 'Requested information option ola not supported, '
+		. 'ignoring.';
+	my $warnMsg = $kiwi -&gt; getWarningMessage();
+	$this -&gt; assert_str_equals($expectedMsg, $warnMsg);
+	my $state = $kiwi -&gt; getWarningState();
+	$this -&gt; assert_equals('skipped', $state);
+	my $errMsg = $kiwi -&gt; getErrorMessage();
+	$expectedMsg = 'None of the specified information options are available.';
+	$this -&gt; assert_str_equals($expectedMsg, $errMsg);
+	my $msg = $kiwi -&gt; getMessage();
+	$expectedMsg = &quot;Choose between the following:\n&quot;
+		. &quot;--&gt; packages       :List of packages to be installed\n&quot;
+		. &quot;--&gt; patterns       :List configured patterns\n&quot;
+		. &quot;--&gt; profiles       :List profiles\n&quot;
+		. &quot;--&gt; repo-patterns  :List available patterns from repos\n&quot;
+		. &quot;--&gt; size           :List install/delete size estimation\n&quot;
+		. &quot;--&gt; sources        :List configured source URLs\n&quot;
+		. &quot;--&gt; types          :List configured types\n&quot;
+		. &quot;--&gt; version        :List name and version\n&quot;;
+	$this -&gt; assert_str_equals($expectedMsg, $msg);
+	$state = $kiwi -&gt; getState();
+	$this -&gt; assert_str_equals('failed', $state);
+	$this -&gt; assert_null($res);
+}
+
+#==========================================
+# test_getTree_noArg
+#------------------------------------------
+sub test_getTree_noArg {
+	# ...
+	# Test getting a tree
+	# ---
+	my $this = shift;
+	my $kiwi = $this -&gt; {kiwi};
+	my $cmd  = $this -&gt; __getCmdl();
+	$cmd -&gt; setConfigDir($this -&gt; {baseDir});
+	my $info = $this -&gt; __getInfoObj($cmd);
+	# Do not supply an argument
+	my $res = $info -&gt; getXMLInfoTree();
+	my $msg = $kiwi -&gt; getMessage();
+	my $expectedMsg = 'No information requested, nothing todo.';
+	$this -&gt; assert_str_equals($expectedMsg, $msg);
+	my $msgT = $kiwi -&gt; getMessageType();
+	$this -&gt; assert_str_equals('error', $msgT);
+	my $state = $kiwi -&gt; getState();
+	$this -&gt; assert_str_equals('failed', $state);
+	$this -&gt; assert_null($res);
+}
+
+#==========================================
+# test_printTree_improperArg
+#------------------------------------------
+sub test_printTree_improperArg {
+	# ...
+	# Test getting a tree
+	# ---
+	my $this = shift;
+	my $kiwi = $this -&gt; {kiwi};
+	my $cmd  = $this -&gt; __getCmdl();
+	$cmd -&gt; setConfigDir($this -&gt; {baseDir});
+	my $info = $this -&gt; __getInfoObj($cmd);
+	# Supply improper argument
+	my @invalidOpts = ('ola');
+	my $res = $info -&gt; printXMLInfo(@invalidOpts);
+	my $msg = $kiwi -&gt; getMessage();
+	my $expectedMsg = 'Expecting ARRAY_REF as first argument for info '
+		. 'requests.';
+	$this -&gt; assert_str_equals($expectedMsg, $msg);
+	my $msgT = $kiwi -&gt; getMessageType();
+	$this -&gt; assert_str_equals('error', $msgT);
+	my $state = $kiwi -&gt; getState();
+	$this -&gt; assert_str_equals('failed', $state);
+	$this -&gt; assert_null($res);
+}
+
+#==========================================
+# test_printTree_invalidReq
+#------------------------------------------
+sub test_printTree_invalidReq {
+	# ...
+	# Test getting a tree
+	# ---
+	my $this = shift;
+	my $kiwi = $this -&gt; {kiwi};
+	my $cmd  = $this -&gt; __getCmdl();
+	$cmd -&gt; setConfigDir($this -&gt; {baseDir});
+	my $info = $this -&gt; __getInfoObj($cmd);
+	# Supply improper argument
+	my @invalidOpts = ('ola');
+	my $res = $info -&gt; printXMLInfo(\@invalidOpts);
+	my $expectedMsg = 'Requested information option ola not supported, '
+		. 'ignoring.';
+	my $warnMsg = $kiwi -&gt; getWarningMessage();
+	$this -&gt; assert_str_equals($expectedMsg, $warnMsg);
+	my $state = $kiwi -&gt; getWarningState();
+	$this -&gt; assert_equals('skipped', $state);
+	my $errMsg = $kiwi -&gt; getErrorMessage();
+	$expectedMsg = 'None of the specified information options are available.';
+	$this -&gt; assert_str_equals($expectedMsg, $errMsg);
+	my $msg = $kiwi -&gt; getMessage();
+	$expectedMsg = &quot;Choose between the following:\n&quot;
+		. &quot;--&gt; packages       :List of packages to be installed\n&quot;
+		. &quot;--&gt; patterns       :List configured patterns\n&quot;
+		. &quot;--&gt; profiles       :List profiles\n&quot;
+		. &quot;--&gt; repo-patterns  :List available patterns from repos\n&quot;
+		. &quot;--&gt; size           :List install/delete size estimation\n&quot;
+		. &quot;--&gt; sources        :List configured source URLs\n&quot;
+		. &quot;--&gt; types          :List configured types\n&quot;
+		. &quot;--&gt; version        :List name and version\n&quot;;
+	$this -&gt; assert_str_equals($expectedMsg, $msg);
+	$state = $kiwi -&gt; getState();
+	$this -&gt; assert_str_equals('failed', $state);
+	$this -&gt; assert_null($res);
+}
+
+#==========================================
+# test_printTree_noArg
+#------------------------------------------
+sub test_printTree_noArg {
+	# ...
+	# Test getting a tree
+	# ---
+	my $this = shift;
+	my $kiwi = $this -&gt; {kiwi};
+	my $cmd  = $this -&gt; __getCmdl();
+	$cmd -&gt; setConfigDir($this -&gt; {baseDir});
+	my $info = $this -&gt; __getInfoObj($cmd);
+	# Do not supply an argument
+	my $res = $info -&gt; printXMLInfo();
+	my $msg = $kiwi -&gt; getMessage();
+	my $expectedMsg = 'No information requested, nothing todo.';
+	$this -&gt; assert_str_equals($expectedMsg, $msg);
+	my $msgT = $kiwi -&gt; getMessageType();
+	$this -&gt; assert_str_equals('error', $msgT);
+	my $state = $kiwi -&gt; getState();
+	$this -&gt; assert_str_equals('failed', $state);
+	$this -&gt; assert_null($res);
+}
+
+#==========================================
+# test_profileInfo
+#------------------------------------------
+sub test_profileInfo {
+	# ...
+	# Test to ensure we get the proper profile information
+	# ---
+	my $this = shift;
+	my $kiwi = $this -&gt; {kiwi};
+	my $cmd  = $this -&gt; __getCmdl();
+	$cmd -&gt; setConfigDir($this -&gt; {baseDir});
+	my $info = $this -&gt; __getInfoObj($cmd);
+	my @requests = ('profiles');
+	my $tree = $info -&gt; getXMLInfoTree(\@requests);
+	my $expectedMsg = '&lt;imagescan&gt;&lt;profile name=&quot;first&quot; description=&quot;a '
+		. 'profile&quot;/&gt;&lt;profile name=&quot;second&quot; description=&quot;another profile&quot;/&gt;'
+		.  '&lt;/imagescan&gt;';
+	$this -&gt; assert_not_null($tree);
+	$this -&gt; assert_str_equals($expectedMsg, $tree -&gt; toString());
+	my $msg = $kiwi -&gt; getMessage();
+	$this -&gt; assert_str_equals('No messages set', $msg);
+	my $msgT = $kiwi -&gt; getMessageType();
+	$this -&gt; assert_str_equals('none', $msgT);
+	my $state = $kiwi -&gt; getState();
+	$this -&gt; assert_str_equals('No state set', $state);
+}
+
+#==========================================
+# test_typesInfo
+#------------------------------------------
+sub test_typesInfo {
+	# ...
+	# Test to ensure we get the proper type information back
+	# ---
+	my $this = shift;
+	my $kiwi = $this -&gt; {kiwi};
+	my $cmd  = $this -&gt; __getCmdl();
+	$cmd -&gt; setConfigDir($this -&gt; {baseDir});
+	my $info = $this -&gt; __getInfoObj($cmd);
+	my @requests = ('types');
+	my $tree = $info -&gt; getXMLInfoTree(\@requests);
+	my $expectedMsg = '&lt;imagescan&gt;&lt;type name=&quot;iso&quot; primary=&quot;true&quot; '
+		. 'boot=&quot;isoboot/suse-11.4&quot;/&gt;&lt;type name=&quot;oem&quot; primary=&quot;false&quot; '
+		. 'boot=&quot;oemboot/suse-11.4&quot;/&gt;&lt;type name=&quot;xfs&quot; primary=&quot;false&quot;/&gt;'
+		. '&lt;/imagescan&gt;';
+	$this -&gt; assert_not_null($tree);
+	$this -&gt; assert_str_equals($expectedMsg, $tree -&gt; toString());
+	my $msg = $kiwi -&gt; getMessage();
+	$this -&gt; assert_str_equals('No messages set', $msg);
+	my $msgT = $kiwi -&gt; getMessageType();
+	$this -&gt; assert_str_equals('none', $msgT);
+	my $state = $kiwi -&gt; getState();
+	$this -&gt; assert_str_equals('No state set', $state);
+}
+
+#==========================================
+# test_sourcesInfo
+#------------------------------------------
+sub test_sourcesInfo {
+	# ...
+	# Test to ensure we get the proper source information
+	# ---
+	my $this = shift;
+	my $kiwi = $this -&gt; {kiwi};
+	my $cmd  = $this -&gt; __getCmdl();
+	$cmd -&gt; setConfigDir($this -&gt; {baseDir});
+	my $info = $this -&gt; __getInfoObj($cmd);
+	my @requests = ('sources');
+	my $tree = $info -&gt; getXMLInfoTree(\@requests);
+	my $expectedMsg = '&lt;imagescan&gt;&lt;source path=&quot;/tmp&quot; type=&quot;rpm-dir&quot;/&gt;'
+		. '&lt;/imagescan&gt;';
+	$this -&gt; assert_not_null($tree);
+	$this -&gt; assert_str_equals($expectedMsg, $tree -&gt; toString());
+	my $msg = $kiwi -&gt; getMessage();
+	$this -&gt; assert_str_equals('No messages set', $msg);
+	my $msgT = $kiwi -&gt; getMessageType();
+	$this -&gt; assert_str_equals('none', $msgT);
+	my $state = $kiwi -&gt; getState();
+	$this -&gt; assert_str_equals('No state set', $state);
+}
+
+#==========================================
+# test_versionInfo
+#------------------------------------------
+sub test_versionInfo {
+	# ...
+	# Test to ensure we get the proper version information
+	# ---
+	my $this = shift;
+	my $kiwi = $this -&gt; {kiwi};
+	my $cmd  = $this -&gt; __getCmdl();
+	$cmd -&gt; setConfigDir($this -&gt; {baseDir});
+	my $info = $this -&gt; __getInfoObj($cmd);
+	my @requests = ('version');
+	my $tree = $info -&gt; getXMLInfoTree(\@requests);
+	my $expectedMsg = '&lt;imagescan&gt;&lt;image version=&quot;1.0.0&quot; '
+		. 'name=&quot;test-xml-infod&quot;/&gt;&lt;/imagescan&gt;';
+	$this -&gt; assert_not_null($tree);
+	$this -&gt; assert_str_equals($expectedMsg, $tree -&gt; toString());
+	my $msg = $kiwi -&gt; getMessage();
+	$this -&gt; assert_str_equals('No messages set', $msg);
+	my $msgT = $kiwi -&gt; getMessageType();
+	$this -&gt; assert_str_equals('none', $msgT);
+	my $state = $kiwi -&gt; getState();
+	$this -&gt; assert_str_equals('No state set', $state);
+}
+
+#==========================================
+# Private helper methods
+#------------------------------------------
+#==========================================
+# __getInfoObj
+#------------------------------------------
+sub __getInfoObj {
+	# ...
+	# Helper mehod to create a valid XMLInfo object
+	# ---
+	my $this = shift;
+	my $cmd  = shift;
+	my $info = new KIWIXMLInfo($this -&gt; {kiwi}, $cmd);
+
+	return $info;
+}
+
+#==========================================
+# __getCmdl
+#------------------------------------------
+sub __getCmdl {
+	# ...
+	# Helper to create a command line object
+	# ---
+	my $this = shift;
+	return new KIWICommandLine($this -&gt; {kiwi});
+}
+
+
+1;


hooks/post-receive
-- 
Project kiwi at BerliOS

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="003284.html">[Kiwi-devel] XML test refinement
</A></li>
	<LI>Next message: <A HREF="003287.html">[Kiwi-devel] kiwi: Weekly report 2011-03-27 - 2011-04-01...
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3286">[ date ]</a>
              <a href="thread.html#3286">[ thread ]</a>
              <a href="subject.html#3286">[ subject ]</a>
              <a href="author.html#3286">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/kiwi-devel">More information about the Kiwi-devel
mailing list</a><br>
</body></html>

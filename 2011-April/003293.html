<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Kiwi-devel] [Git]Project kiwi at BerliOS branch, master,	updated. ba8ac290984e01ff41a652ba2ce13dcfc9b29b30
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/kiwi-devel/2011-April/index.html" >
   <LINK REL="made" HREF="mailto:kiwi-devel%40lists.berlios.de?Subject=Re%3A%20%5BKiwi-devel%5D%20%5BGit%5DProject%20kiwi%20at%20BerliOS%20branch%2C%20master%2C%0A%09updated.%20ba8ac290984e01ff41a652ba2ce13dcfc9b29b30&In-Reply-To=%3C20110404171844.93F2C480CFC%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="003292.html">
   <LINK REL="Next"  HREF="003295.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Kiwi-devel] [Git]Project kiwi at BerliOS branch, master,	updated. ba8ac290984e01ff41a652ba2ce13dcfc9b29b30</H1>
    <B>marcus_schaefer at BerliOS</B> 
    <A HREF="mailto:kiwi-devel%40lists.berlios.de?Subject=Re%3A%20%5BKiwi-devel%5D%20%5BGit%5DProject%20kiwi%20at%20BerliOS%20branch%2C%20master%2C%0A%09updated.%20ba8ac290984e01ff41a652ba2ce13dcfc9b29b30&In-Reply-To=%3C20110404171844.93F2C480CFC%40sheep.berlios.de%3E"
       TITLE="[Kiwi-devel] [Git]Project kiwi at BerliOS branch, master,	updated. ba8ac290984e01ff41a652ba2ce13dcfc9b29b30">marcus_schaefer at mail.berlios.de
       </A><BR>
    <I>Mon Apr  4 19:18:43 CEST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="003292.html">[Kiwi-devel] [Git]Project kiwi at BerliOS branch, master,	updated. 7954bf3bed5845f4ece4991ef17f8f2978c8fbee
</A></li>
        <LI>Next message: <A HREF="003295.html">[Kiwi-devel] new unit test methods
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3293">[ date ]</a>
              <a href="thread.html#3293">[ thread ]</a>
              <a href="subject.html#3293">[ subject ]</a>
              <a href="author.html#3293">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>This is an automated email from the git hooks/post-receive script. It was
generated because a ref change was pushed to the repository containing
the project &quot;Project kiwi at BerliOS&quot;.

The branch, master has been updated
       via  ba8ac290984e01ff41a652ba2ce13dcfc9b29b30 (commit)
      from  7954bf3bed5845f4ece4991ef17f8f2978c8fbee (commit)

Those revisions listed above that are new to this repository have
not appeared on any other notification email; so we list those
revisions in full, below.

- Log -----------------------------------------------------------------
commit ba8ac290984e01ff41a652ba2ce13dcfc9b29b30
Author: Marcus Sch&#195;&#164;fer &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/kiwi-devel">ms at novell.com</A>&gt;
Date:   Mon Apr 4 19:17:19 2011 +0200

    - created a repo to support new tests for size query and package
      install query. Additionally the common test case base class
      gets new methods to create a writable directory and to clean
      it up after the test

-----------------------------------------------------------------------

Summary of changes:
diff --git a/tests/unit/cleanup.sh b/tests/unit/cleanup.sh
index 603c4f4..d24761a 100755
--- a/tests/unit/cleanup.sh
+++ b/tests/unit/cleanup.sh
@@ -10,3 +10,5 @@ echo &quot;Cleaning up artifacts&quot;
 for i in `find . -name &quot;*.converted.xml&quot;`;do \
     rm $i ;\
 done
+
+rm -rf /tmp/kiwiDevTests
diff --git a/tests/unit/data/xmlInfo/config.xml b/tests/unit/data/kiwiXMLInfo/config.xml
similarity index 93%
rename from tests/unit/data/xmlInfo/config.xml
rename to tests/unit/data/kiwiXMLInfo/config.xml
index f43e7d3..dad9daf 100644
--- a/tests/unit/data/xmlInfo/config.xml
+++ b/tests/unit/data/kiwiXMLInfo/config.xml
@@ -33,7 +33,7 @@
 		&lt;source path=&quot;/tmp&quot;/&gt;
 	&lt;/repository&gt;
 	&lt;packages type=&quot;image&quot; patternType=&quot;onlyRequired&quot;&gt;
-		&lt;package name=&quot;sash&quot;/&gt;
-		&lt;opensusePattern name=&quot;base&quot;/&gt;
+		&lt;package name=&quot;kiwi-test-dummy&quot;/&gt;
+		&lt;!--&lt;opensusePattern name=&quot;base&quot;/&gt;--&gt;
 	&lt;/packages&gt;
 &lt;/image&gt;
diff --git a/tests/unit/data/kiwiXMLInfo/repo/kiwi-test-dummy-0.0.1-1.noarch.rpm b/tests/unit/data/kiwiXMLInfo/repo/kiwi-test-dummy-0.0.1-1.noarch.rpm
new file mode 100644
index 0000000..bbfa48e
Binary files /dev/null and b/tests/unit/data/kiwiXMLInfo/repo/kiwi-test-dummy-0.0.1-1.noarch.rpm differ
diff --git a/tests/unit/data/kiwiXMLInfo/repo/repodata/2b3a4f40e6fb774953f55d6493041ce084dc56bc4d41e0d636511880410279c0-other.xml.gz b/tests/unit/data/kiwiXMLInfo/repo/repodata/2b3a4f40e6fb774953f55d6493041ce084dc56bc4d41e0d636511880410279c0-other.xml.gz
new file mode 100644
index 0000000..7dbea64
Binary files /dev/null and b/tests/unit/data/kiwiXMLInfo/repo/repodata/2b3a4f40e6fb774953f55d6493041ce084dc56bc4d41e0d636511880410279c0-other.xml.gz differ
diff --git a/tests/unit/data/kiwiXMLInfo/repo/repodata/5af0d5b3a068bb018f9e7bdea89e04cb15e2e7807b785097615427e9f525ca8a-filelists.xml.gz b/tests/unit/data/kiwiXMLInfo/repo/repodata/5af0d5b3a068bb018f9e7bdea89e04cb15e2e7807b785097615427e9f525ca8a-filelists.xml.gz
new file mode 100644
index 0000000..821ed40
Binary files /dev/null and b/tests/unit/data/kiwiXMLInfo/repo/repodata/5af0d5b3a068bb018f9e7bdea89e04cb15e2e7807b785097615427e9f525ca8a-filelists.xml.gz differ
diff --git a/tests/unit/data/kiwiXMLInfo/repo/repodata/c4e421230e679730aca94ae538152adaee3b83b9e6d9755215c6265a257a0cdb-primary.xml.gz b/tests/unit/data/kiwiXMLInfo/repo/repodata/c4e421230e679730aca94ae538152adaee3b83b9e6d9755215c6265a257a0cdb-primary.xml.gz
new file mode 100644
index 0000000..7098d90
Binary files /dev/null and b/tests/unit/data/kiwiXMLInfo/repo/repodata/c4e421230e679730aca94ae538152adaee3b83b9e6d9755215c6265a257a0cdb-primary.xml.gz differ
diff --git a/tests/unit/data/kiwiXMLInfo/repo/repodata/repomd.xml b/tests/unit/data/kiwiXMLInfo/repo/repodata/repomd.xml
new file mode 100644
index 0000000..c68b490
--- /dev/null
+++ b/tests/unit/data/kiwiXMLInfo/repo/repodata/repomd.xml
@@ -0,0 +1,28 @@
+&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
+&lt;repomd xmlns=&quot;<A HREF="http://linux.duke.edu/metadata/repo">http://linux.duke.edu/metadata/repo</A>&quot; xmlns:rpm=&quot;<A HREF="http://linux.duke.edu/metadata/rpm">http://linux.duke.edu/metadata/rpm</A>&quot; xmlns:suse=&quot;<A HREF="http://novell.com/package/metadata/suse/common">http://novell.com/package/metadata/suse/common</A>&quot;&gt;
+  &lt;revision&gt;1301933691&lt;/revision&gt;
+  &lt;data type=&quot;other&quot;&gt;
+    &lt;checksum type=&quot;sha256&quot;&gt;2b3a4f40e6fb774953f55d6493041ce084dc56bc4d41e0d636511880410279c0&lt;/checksum&gt;
+    &lt;timestamp&gt;1301933691&lt;/timestamp&gt;
+    &lt;size&gt;317&lt;/size&gt;
+    &lt;open-size&gt;429&lt;/open-size&gt;
+    &lt;open-checksum type=&quot;sha256&quot;&gt;8f81c7b48c647fbd3cac74d27853e54c46259446947fab4c45aeebd70ce16b38&lt;/open-checksum&gt;
+    &lt;location href=&quot;repodata/2b3a4f40e6fb774953f55d6493041ce084dc56bc4d41e0d636511880410279c0-other.xml.gz&quot;/&gt;
+  &lt;/data&gt;
+  &lt;data type=&quot;filelists&quot;&gt;
+    &lt;checksum type=&quot;sha256&quot;&gt;5af0d5b3a068bb018f9e7bdea89e04cb15e2e7807b785097615427e9f525ca8a&lt;/checksum&gt;
+    &lt;timestamp&gt;1301933691&lt;/timestamp&gt;
+    &lt;size&gt;290&lt;/size&gt;
+    &lt;open-size&gt;410&lt;/open-size&gt;
+    &lt;open-checksum type=&quot;sha256&quot;&gt;3e2f3c7b7ed194cdd96d4b9d48e13754a6f6bec84331b916f6da3050a58c3e18&lt;/open-checksum&gt;
+    &lt;location href=&quot;repodata/5af0d5b3a068bb018f9e7bdea89e04cb15e2e7807b785097615427e9f525ca8a-filelists.xml.gz&quot;/&gt;
+  &lt;/data&gt;
+  &lt;data type=&quot;primary&quot;&gt;
+    &lt;checksum type=&quot;sha256&quot;&gt;c4e421230e679730aca94ae538152adaee3b83b9e6d9755215c6265a257a0cdb&lt;/checksum&gt;
+    &lt;timestamp&gt;1301933691&lt;/timestamp&gt;
+    &lt;size&gt;709&lt;/size&gt;
+    &lt;open-size&gt;1389&lt;/open-size&gt;
+    &lt;open-checksum type=&quot;sha256&quot;&gt;2eb7e20f280e86232b6adb12357f5ebc6eb82ef9790118acc5a422aa5bb90f3c&lt;/open-checksum&gt;
+    &lt;location href=&quot;repodata/c4e421230e679730aca94ae538152adaee3b83b9e6d9755215c6265a257a0cdb-primary.xml.gz&quot;/&gt;
+  &lt;/data&gt;
+&lt;/repomd&gt;
diff --git a/tests/unit/lib/Common/ktTestCase.pm b/tests/unit/lib/Common/ktTestCase.pm
index b702d6d..97dc2b8 100644
--- a/tests/unit/lib/Common/ktTestCase.pm
+++ b/tests/unit/lib/Common/ktTestCase.pm
@@ -61,6 +61,21 @@ return;
 }
 
 #==========================================
+# createTestTmpDir
+#------------------------------------------
+sub createTestTmpDir {
+	# ...
+	# Create a directory to allow tests to write data
+	# ---
+	my $this = shift;
+	# Lets assume /tmp exists
+	my $testDir = '/tmp/kiwiDevTests';
+	my $res = mkdir $testDir;
+	$this -&gt; assert_equals(1, $res);
+	return $testDir;
+}
+
+#==========================================
 # getBaseDir
 #------------------------------------------
 sub getBaseDir {
@@ -82,4 +97,15 @@ sub getDataDir {
 	return $dir;
 }
 
+#==========================================
+# removeTestTmpDir
+#------------------------------------------
+sub removeTestTmpDir {
+	# ...
+	# Remove the test temporary directory
+	# ---
+	system 'rm -rf /tmp/kiwiDevTests';
+	return 1;
+}
+
 1;
diff --git a/tests/unit/lib/Test/kiwiCommandLine.pm b/tests/unit/lib/Test/kiwiCommandLine.pm
index 98338b2..f40fed0 100644
--- a/tests/unit/lib/Test/kiwiCommandLine.pm
+++ b/tests/unit/lib/Test/kiwiCommandLine.pm
@@ -421,11 +421,15 @@ sub test_cmdConfDirUsage_noDirRead {
 	# ...
 	# Test the storage and verification of the configuration directory data
 	# ---
+	if ($&lt; == 0) {
+		print &quot;\t\tInfo: user root, skipping test_cmdConfDirUsage_noDirRead\n&quot;;
+		return;
+	}
 	my $this = shift;
 	my $kiwi = $this -&gt; {kiwi};
 	my $cmd = $this -&gt; __getCmdObj();
 	# Directory has no read access
-	# If the test is run a root the test will fail
+	# If the test is run a root the test is skipped
 	my $res = $cmd -&gt; setConfigDir('/root');
 	my $msg = $kiwi -&gt; getMessage();
 	my $expectedMsg = 'No read access to specified configuration directory '
@@ -545,11 +549,15 @@ sub test_cmdLogFileUsagee_noWrite {
 	# ...
 	# Test the storage of the logfile path
 	# ---
+	if ($&lt; == 0) {
+		print &quot;\t\tInfo: user root, skipping test_cmdLogFileUsagee_noWrite\n&quot;;
+		return;
+	}
 	my $this = shift;
 	my $kiwi = $this -&gt; {kiwi};
 	my $cmd = $this -&gt; __getCmdObj();
 	# Test no write permission
-	# If the test is executed as root this test will fail
+	# If the test is executed as root this test is skipped
 	my $res = $cmd -&gt; setLogFile('/usr/cmdlTestLog.log');
 	my $msg = $kiwi -&gt; getMessage();
 	my $expectedMsg = 'Unable to write to location /usr/, cannot create log '
diff --git a/tests/unit/lib/Test/kiwiXMLInfo.pm b/tests/unit/lib/Test/kiwiXMLInfo.pm
index 20b0368..70e84e0 100644
--- a/tests/unit/lib/Test/kiwiXMLInfo.pm
+++ b/tests/unit/lib/Test/kiwiXMLInfo.pm
@@ -10,11 +10,10 @@
 #               :
 # DESCRIPTION   : Unit test implementation for the KIWIXMLInfo module.
 #               : Certain queries require root priveleges, thus these queries
-#               : are not implemented as unit tests. Manual testing is required
-#               : to verify query functionality for
+#               : only get tested when this test is executed as root.
 #               :     -- packages
-#               :     -- patterns
-#               :     -- repo-patterns
+#               :     -- patterns       (TBI)
+#               :     -- repo-patterns  (TBI)
 #               :     -- size
 #               :
 # STATUS        : Development
@@ -40,7 +39,7 @@ sub new {
 	# Construct new test case
 	# ---
 	my $this = shift -&gt; SUPER::new(@_);
-	my $baseDir = $this -&gt; getDataDir() . '/xmlInfo/';
+	my $baseDir = $this -&gt; getDataDir() . '/kiwiXMLInfo/';
 	$this -&gt; {baseDir} = $baseDir;
 	$this -&gt; {kiwi}    = new Common::ktLog();
 
@@ -185,6 +184,42 @@ sub test_getTree_noArg {
 }
 
 #==========================================
+# test_packagesInfo
+#------------------------------------------
+sub test_packagesInfo {
+	# ...
+	# Test to ensure we get the proper package information
+	# skip test if not root
+	# ---
+	if ($&lt; != 0) {
+		print &quot;\t\tInfo: Not root, skipping test_packagesInfo\n&quot;;
+		return;
+	}
+	my $this = shift;
+	my $kiwi = $this -&gt; {kiwi};
+	# Setup directory to operate as repository
+	my $repoDir = $this -&gt; createTestTmpDir();
+	my $pckgOrig = $this -&gt; {baseDir} . 'repo';
+	system &quot;cp -r $pckgOrig/* $repoDir&quot;;
+	my $cmd  = $this -&gt; __getCmdl();
+	$cmd -&gt; setConfigDir($this -&gt; {baseDir});
+	# Replace the repo from the config file with the previously setup repo
+	$cmd -&gt; setReplacementRepo($repoDir, 'testRepo', 1, 'rpm-md');
+	my $info = $this -&gt; __getInfoObj($cmd);
+	my @requests = ('packages');
+	my $tree = $info -&gt; getXMLInfoTree(\@requests);
+	my $expectedMsg = '&lt;imagescan&gt;&lt;package name=&quot;kiwi-test-dummy&quot; '
+		. 'arch=&quot;noarch&quot; version=&quot;0.0.1-1&quot;/&gt;&lt;/imagescan&gt;';
+	$this -&gt; assert_str_equals($expectedMsg, $tree -&gt; toString());
+	$this -&gt; assert_not_null($tree);
+	# Setting up SaT generates a number of meesges that are not useful
+	# for this test, just make sure everything in the log object gets reset
+	$kiwi -&gt; getState();
+	# Clean up
+	$this -&gt; removeTestTmpDir();
+}
+
+#==========================================
 # test_printTree_improperArg
 #------------------------------------------
 sub test_printTree_improperArg {
@@ -330,6 +365,41 @@ sub test_typesInfo {
 }
 
 #==========================================
+# test_sizeInfo
+#------------------------------------------
+sub test_sizeInfo {
+	# ...
+	# Test to ensure we get the proper package information
+	# skip test if not root
+	# ---
+	if ($&lt; != 0) {
+		print &quot;\t\tInfo: Not root, skipping test_sizeInfo\n&quot;;
+		return;
+	}
+	my $this = shift;
+	my $kiwi = $this -&gt; {kiwi};
+	# Setup directory to operate as repository
+	my $repoDir = $this -&gt; createTestTmpDir();
+	my $pckgOrig = $this -&gt; {baseDir} . 'repo';
+	system &quot;cp -r $pckgOrig/* $repoDir&quot;;
+	my $cmd  = $this -&gt; __getCmdl();
+	$cmd -&gt; setConfigDir($this -&gt; {baseDir});
+	# Replace the repo from the config file with the previously setup repo
+	$cmd -&gt; setReplacementRepo($repoDir, 'testRepo', 1, 'rpm-md');
+	my $info = $this -&gt; __getInfoObj($cmd);
+	my @requests = ('size');
+	my $tree = $info -&gt; getXMLInfoTree(\@requests);
+	my $expectedMsg = '&lt;imagescan&gt;&lt;size rootsizeKB=&quot;1&quot;/&gt;&lt;/imagescan&gt;';
+	$this -&gt; assert_str_equals($expectedMsg, $tree -&gt; toString());
+	$this -&gt; assert_not_null($tree);
+	# Setting up SaT generates a number of meesges that are not useful
+	# for this test, just make sure everything in the log object gets reset
+	$kiwi -&gt; getState();
+	# Clean up
+	$this -&gt; removeTestTmpDir();
+}
+
+#==========================================
 # test_sourcesInfo
 #------------------------------------------
 sub test_sourcesInfo {


hooks/post-receive
-- 
Project kiwi at BerliOS

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="003292.html">[Kiwi-devel] [Git]Project kiwi at BerliOS branch, master,	updated. 7954bf3bed5845f4ece4991ef17f8f2978c8fbee
</A></li>
	<LI>Next message: <A HREF="003295.html">[Kiwi-devel] new unit test methods
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3293">[ date ]</a>
              <a href="thread.html#3293">[ thread ]</a>
              <a href="subject.html#3293">[ subject ]</a>
              <a href="author.html#3293">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/kiwi-devel">More information about the Kiwi-devel
mailing list</a><br>
</body></html>

<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Kiwi-devel] [Git]Project kiwi at BerliOS branch,	KIWI-485-SuSE-11-1-SLE-SP-Devel,	updated. 829a5b217081506a4d6e9f7d0f83200e16b22ede
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/kiwi-devel/2011-April/index.html" >
   <LINK REL="made" HREF="mailto:kiwi-devel%40lists.berlios.de?Subject=Re%3A%20%5BKiwi-devel%5D%20%5BGit%5DProject%20kiwi%20at%20BerliOS%20branch%2C%0A%09KIWI-485-SuSE-11-1-SLE-SP-Devel%2C%0A%09updated.%20829a5b217081506a4d6e9f7d0f83200e16b22ede&In-Reply-To=%3C20110411150957.82CC04813A4%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="003317.html">
   <LINK REL="Next"  HREF="003319.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Kiwi-devel] [Git]Project kiwi at BerliOS branch,	KIWI-485-SuSE-11-1-SLE-SP-Devel,	updated. 829a5b217081506a4d6e9f7d0f83200e16b22ede</H1>
    <B>marcus_schaefer at BerliOS</B> 
    <A HREF="mailto:kiwi-devel%40lists.berlios.de?Subject=Re%3A%20%5BKiwi-devel%5D%20%5BGit%5DProject%20kiwi%20at%20BerliOS%20branch%2C%0A%09KIWI-485-SuSE-11-1-SLE-SP-Devel%2C%0A%09updated.%20829a5b217081506a4d6e9f7d0f83200e16b22ede&In-Reply-To=%3C20110411150957.82CC04813A4%40sheep.berlios.de%3E"
       TITLE="[Kiwi-devel] [Git]Project kiwi at BerliOS branch,	KIWI-485-SuSE-11-1-SLE-SP-Devel,	updated. 829a5b217081506a4d6e9f7d0f83200e16b22ede">marcus_schaefer at mail.berlios.de
       </A><BR>
    <I>Mon Apr 11 17:09:57 CEST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="003317.html">[Kiwi-devel] [Git]Project kiwi at BerliOS branch, master,	updated. 231d04e529130d9e8b87fa9b6099b0fcc0855a6f
</A></li>
        <LI>Next message: <A HREF="003319.html">[Kiwi-devel] [Git]Project kiwi at BerliOS branch, master,	updated. 7f27744d0fed5538c1d3e0a636a7cc05b3cee979
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3318">[ date ]</a>
              <a href="thread.html#3318">[ thread ]</a>
              <a href="subject.html#3318">[ subject ]</a>
              <a href="author.html#3318">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>This is an automated email from the git hooks/post-receive script. It was
generated because a ref change was pushed to the repository containing
the project &quot;Project kiwi at BerliOS&quot;.

The branch, KIWI-485-SuSE-11-1-SLE-SP-Devel has been updated
       via  829a5b217081506a4d6e9f7d0f83200e16b22ede (commit)
       via  e83b947681a1ffac36fef414f5ae227b18e3bed5 (commit)
       via  3783839ea883d534f000446829fa1f86e0164bc9 (commit)
       via  657d55d1fee28f01cff7cae3eefc9bae8a3f4915 (commit)
       via  3c1d6c8e3fd97239704424c8a82ca57fd6a5fb51 (commit)
      from  b82be2a682d9f2a0e24714b3ca62adad2f2c81dc (commit)

Those revisions listed above that are new to this repository have
not appeared on any other notification email; so we list those
revisions in full, below.

- Log -----------------------------------------------------------------
commit 829a5b217081506a4d6e9f7d0f83200e16b22ede
Author: Marcus Sch&#195;&#164;fer &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/kiwi-devel">ms at novell.com</A>&gt;
Date:   Mon Apr 11 16:56:01 2011 +0200

    - fixed the --lvm option. The option now adds a systemdisk
      element and behaves the same as if the users would have
      modified the XML accordingly

commit e83b947681a1ffac36fef414f5ae227b18e3bed5
Author: Marcus Sch&#195;&#164;fer &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/kiwi-devel">ms at novell.com</A>&gt;
Date:   Mon Apr 11 15:49:18 2011 +0200

    - make sure installBootLoader() is called for vmxboot
      image if a root overlay filesystem structure is used
    - move resetBootBind() into installBootLoader()

commit 3783839ea883d534f000446829fa1f86e0164bc9
Author: Marcus Sch&#195;&#164;fer &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/kiwi-devel">ms at novell.com</A>&gt;
Date:   Mon Apr 11 12:41:27 2011 +0200

    - call setupBootPartition() only on first boot

commit 657d55d1fee28f01cff7cae3eefc9bae8a3f4915
Author: Marcus Sch&#195;&#164;fer &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/kiwi-devel">ms at novell.com</A>&gt;
Date:   Mon Apr 11 11:48:02 2011 +0200

    - added evaluation of kiwi_ramonly element for vmx too
    - added evaluation of kiwi_ramonly element for ppc and s390 arch
    - added evaluation of kiwi_ramonly element for non LVM setup

commit 3c1d6c8e3fd97239704424c8a82ca57fd6a5fb51
Author: Marcus Sch&#195;&#164;fer &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/kiwi-devel">ms at novell.com</A>&gt;
Date:   Mon Apr 11 11:01:52 2011 +0200

    - fixed subsequent mount procedure of a clicfs based image.
      The resize2fs call has to happen in any case if the image
      is a ramonly system

-----------------------------------------------------------------------

Summary of changes:
diff --git a/kiwi.pl b/kiwi.pl
index 5b44615..d5d9152 100755
--- a/kiwi.pl
+++ b/kiwi.pl
@@ -1116,7 +1116,7 @@ sub main {
 		}
 		$boot = new KIWIBoot (
 			$kiwi,$BootVMDisk,$BootVMSystem,
-			$BootVMSize,undef,$LVM,\@ProfilesOrig
+			$BootVMSize,undef,\@ProfilesOrig
 		);
 		if (! defined $boot) {
 			my $code = kiwiExit (1); return $code;
@@ -2189,6 +2189,13 @@ sub checkType {
 		$xml -&gt; __setTypeAttribute (&quot;bootloader&quot;,&quot;syslinux&quot;);
 		$xml -&gt; __setSystemDiskElement ();
 		$xml -&gt; writeXMLDescription ($root);
+	} elsif (defined $main::LVM) {
+		# /.../
+		# if the option --lvm is set, we add/update a systemdisk
+		# element which triggers the use of LVM
+		# ----
+		$xml -&gt; __setSystemDiskElement ();
+		$xml -&gt; writeXMLDescription ($root);
 	}
 	#==========================================
 	# check for required filesystem tool(s)
diff --git a/modules/KIWIBoot.pm b/modules/KIWIBoot.pm
index 6b4d5e3..bc431bb 100644
--- a/modules/KIWIBoot.pm
+++ b/modules/KIWIBoot.pm
@@ -57,7 +57,6 @@ sub new {
 	my $system = shift;
 	my $vmsize = shift;
 	my $device = shift;
-	my $lvm    = shift;
 	my $profile= shift;
 	#==========================================
 	# Constructor setup
@@ -450,7 +449,6 @@ sub new {
 	$this-&gt;{arch}      = $arch;
 	$this-&gt;{ptool}     = $main::Partitioner;
 	$this-&gt;{chainload} = $main::GrubChainload;
-	$this-&gt;{lvm}       = $lvm;
 	$this-&gt;{vga}       = $vga;
 	$this-&gt;{xml}       = $xml;
 	$this-&gt;{xendomain} = $xendomain;
diff --git a/modules/KIWIImageFormat.pm b/modules/KIWIImageFormat.pm
index 5f7f1f9..a9a229c 100644
--- a/modules/KIWIImageFormat.pm
+++ b/modules/KIWIImageFormat.pm
@@ -72,7 +72,7 @@ sub new {
 	#------------------------------------------
 	if (! defined $xml) {
 		my $boot = new KIWIBoot (
-			$kiwi,undef,$image,undef,undef,undef,\@main::ProfilesOrig
+			$kiwi,undef,$image,undef,undef,\@main::ProfilesOrig
 		);
 		if ($boot) {
 			$xml = $boot-&gt;{xml};
diff --git a/modules/KIWILinuxRC.sh b/modules/KIWILinuxRC.sh
index 1333758..6c499a9 100644
--- a/modules/KIWILinuxRC.sh
+++ b/modules/KIWILinuxRC.sh
@@ -670,6 +670,7 @@ function installBootLoader {
 	# The selection of the bootloader happens according to
 	# the architecture of the system
 	# ----
+	resetBootBind
 	local arch=`uname -m`
 	if [ -z &quot;$loader&quot; ];then
 		loader=&quot;grub&quot;
@@ -915,7 +916,6 @@ function setupSUSEInitrd {
 		systemIntegrity=unknown
 		bootLoaderOK=0
 	fi
-	resetBootBind
 }
 #======================================
 # callSUSEInitrdScripts
@@ -4300,7 +4300,7 @@ function mountSystemClicFS {
 	if [ ! $LOCAL_BOOT = &quot;no&quot; ];then
 		e2fsck -p $roDir/fsdata.ext3
 	fi
-	if [ $LOCAL_BOOT = &quot;no&quot; ];then
+	if [ $LOCAL_BOOT = &quot;no&quot; ] || [ $ramOnly = 1 ];then
 		resize2fs $roDir/fsdata.ext3 $size&quot;s&quot;
 	fi
 	mount -o loop,noatime,nodiratime,errors=remount-ro,barrier=0 \
@@ -4526,7 +4526,7 @@ function mountSystem {
 	# setup boot partition
 	#--------------------------------------
 	if [ ! &quot;$arch&quot; = &quot;ppc64&quot; ];then
-		if [ $retval = 0 ] &amp;&amp; [ -z &quot;$RESTORE&quot; ];then
+		if [ &quot;$LOCAL_BOOT&quot; = &quot;no&quot; ] &amp;&amp; [ $retval = 0 ] &amp;&amp; [ -z &quot;$RESTORE&quot; ];then
 			setupBootPartition
 		fi
 	fi
diff --git a/system/boot/ix86/oemboot/suse-linuxrc b/system/boot/ix86/oemboot/suse-linuxrc
index 5a1b365..ab7662a 100755
--- a/system/boot/ix86/oemboot/suse-linuxrc
+++ b/system/boot/ix86/oemboot/suse-linuxrc
@@ -69,6 +69,9 @@ function setupInitialDeviceNames {
 	# Set default filesystem device names
 	#--------------------------------------
 	export imageRWDevice=$(ddn $imageDiskDevice 2)
+	if [ ! -z &quot;$kiwi_ramonly&quot; ];then
+		export imageRWDevice=/dev/ram1
+	fi
 	export imageRODevice=$(ddn $imageDiskDevice 1)
 	export imageIOWRDevice=$imageRWDevice
 	#======================================
diff --git a/system/boot/ix86/vmxboot/suse-linuxrc b/system/boot/ix86/vmxboot/suse-linuxrc
index 62e92f2..1a18074 100755
--- a/system/boot/ix86/vmxboot/suse-linuxrc
+++ b/system/boot/ix86/vmxboot/suse-linuxrc
@@ -141,6 +141,9 @@ Echo &quot;Found boot device: $imageDiskDevice&quot;
 #--------------------------------------
 export imageRootDevice=$(ddn $imageDiskDevice 1)
 export imageRWDevice=$(ddn $imageDiskDevice 2)
+if [ ! -z &quot;$kiwi_ramonly&quot; ];then
+	export imageRWDevice=/dev/ram1
+fi
 export imageRODevice=$(ddn $imageDiskDevice 1)
 if [ -z &quot;$imageDiskDevice&quot; ];then
 	systemException \
@@ -155,6 +158,9 @@ if searchVolumeGroup; then
 		export imageRootDevice=/dev/$VGROUP/LVRoot
 	fi
 	export imageRWDevice=/dev/$VGROUP/LVRoot
+	if [ ! -z &quot;$kiwi_ramonly&quot; ];then
+		export imageRWDevice=/dev/ram1
+	fi
 	export imageRODevice=/dev/$VGROUP/LVComp
 	export imageBootDevice=$(ddn $imageDiskDevice 1)
 fi
diff --git a/system/boot/ix86/vmxboot/suse-preinit b/system/boot/ix86/vmxboot/suse-preinit
index 8759f80..cb1af12 100755
--- a/system/boot/ix86/vmxboot/suse-preinit
+++ b/system/boot/ix86/vmxboot/suse-preinit
@@ -60,7 +60,15 @@ fi
 # 7) create initrd on diskful
 #--------------------------------------
 if [ -z &quot;$UNIONFS_CONFIG&quot; ] &amp;&amp; [ -z &quot;$COMBINED_IMAGE&quot; ]; then
+	#======================================
+	# use distro initrd via mkinitrd
+	#--------------------------------------
 	setupSUSEInitrd
+else
+	#======================================
+	# use kiwi initrd from RW partition
+	#--------------------------------------
+	bootLoaderOK=1
 fi
 
 #======================================
diff --git a/system/boot/ppc/vmxboot/suse-linuxrc b/system/boot/ppc/vmxboot/suse-linuxrc
index 3e44ea5..77ec94a 100755
--- a/system/boot/ppc/vmxboot/suse-linuxrc
+++ b/system/boot/ppc/vmxboot/suse-linuxrc
@@ -142,6 +142,9 @@ Echo &quot;Found boot device: $imageDiskDevice&quot;
 #--------------------------------------
 export imageRootDevice=$(ddn $imageDiskDevice 2)
 export imageRWDevice=$(ddn $imageDiskDevice 3)
+if [ ! -z &quot;$kiwi_ramonly&quot; ];then
+	export imageRWDevice=/dev/ram1
+fi
 export imageRODevice=$(ddn $imageDiskDevice 2)
 if [ -z &quot;$imageDiskDevice&quot; ];then
 	systemException \
@@ -156,6 +159,9 @@ if searchVolumeGroup; then
 		export imageRootDevice=/dev/$VGROUP/LVRoot
 	fi
 	export imageRWDevice=/dev/$VGROUP/LVRoot
+	if [ ! -z &quot;$kiwi_ramonly&quot; ];then
+		export imageRWDevice=/dev/ram1
+	fi
 	export imageRODevice=/dev/$VGROUP/LVComp
 	export imageBootDevice=$(ddn $imageDiskDevice 2)
 fi
diff --git a/system/boot/ppc/vmxboot/suse-preinit b/system/boot/ppc/vmxboot/suse-preinit
index 8759f80..cb1af12 100755
--- a/system/boot/ppc/vmxboot/suse-preinit
+++ b/system/boot/ppc/vmxboot/suse-preinit
@@ -60,7 +60,15 @@ fi
 # 7) create initrd on diskful
 #--------------------------------------
 if [ -z &quot;$UNIONFS_CONFIG&quot; ] &amp;&amp; [ -z &quot;$COMBINED_IMAGE&quot; ]; then
+	#======================================
+	# use distro initrd via mkinitrd
+	#--------------------------------------
 	setupSUSEInitrd
+else
+	#======================================
+	# use kiwi initrd from RW partition
+	#--------------------------------------
+	bootLoaderOK=1
 fi
 
 #======================================
diff --git a/system/boot/s390/vmxboot/suse-linuxrc b/system/boot/s390/vmxboot/suse-linuxrc
index 5cc1d1d..43cbe6b 100755
--- a/system/boot/s390/vmxboot/suse-linuxrc
+++ b/system/boot/s390/vmxboot/suse-linuxrc
@@ -145,6 +145,9 @@ Echo &quot;Found boot device: $imageDiskDevice&quot;
 #--------------------------------------
 export imageRootDevice=$(ddn $imageDiskDevice 1)
 export imageRWDevice=$(ddn $imageDiskDevice 2)
+if [ ! -z &quot;$kiwi_ramonly&quot; ];then
+	export imageRWDevice=/dev/ram1
+fi
 export imageRODevice=$(ddn $imageDiskDevice 1)
 if [ -z &quot;$imageDiskDevice&quot; ];then
 	systemException \
@@ -159,6 +162,9 @@ if searchVolumeGroup; then
 		export imageRootDevice=/dev/$VGROUP/LVRoot
 	fi
 	export imageRWDevice=/dev/$VGROUP/LVRoot
+	if [ ! -z &quot;$kiwi_ramonly&quot; ];then
+		export imageRWDevice=/dev/ram1
+	fi
 	export imageRODevice=/dev/$VGROUP/LVComp
 	export imageBootDevice=$(ddn $imageDiskDevice 1)
 fi
diff --git a/system/boot/s390/vmxboot/suse-preinit b/system/boot/s390/vmxboot/suse-preinit
index ffbbee3..698bed0 100755
--- a/system/boot/s390/vmxboot/suse-preinit
+++ b/system/boot/s390/vmxboot/suse-preinit
@@ -70,7 +70,15 @@ fi
 # 8) create initrd on diskful
 #--------------------------------------
 if [ -z &quot;$UNIONFS_CONFIG&quot; ] &amp;&amp; [ -z &quot;$COMBINED_IMAGE&quot; ]; then
+	#======================================
+	# use distro initrd via mkinitrd
+	#--------------------------------------
 	setupSUSEInitrd
+else
+	#======================================
+	# use kiwi initrd from RW partition
+	#--------------------------------------
+	bootLoaderOK=1
 fi
 
 #======================================


hooks/post-receive
-- 
Project kiwi at BerliOS

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="003317.html">[Kiwi-devel] [Git]Project kiwi at BerliOS branch, master,	updated. 231d04e529130d9e8b87fa9b6099b0fcc0855a6f
</A></li>
	<LI>Next message: <A HREF="003319.html">[Kiwi-devel] [Git]Project kiwi at BerliOS branch, master,	updated. 7f27744d0fed5538c1d3e0a636a7cc05b3cee979
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3318">[ date ]</a>
              <a href="thread.html#3318">[ thread ]</a>
              <a href="subject.html#3318">[ subject ]</a>
              <a href="author.html#3318">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/kiwi-devel">More information about the Kiwi-devel
mailing list</a><br>
</body></html>

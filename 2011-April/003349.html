<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Kiwi-devel] [Git]Project kiwi at BerliOS branch,	KIWI-485-SuSE-11-1-SLE-SP-Devel,	updated. 8e62c024a6b281f3c3098e18165bf2fd1181dae6
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/kiwi-devel/2011-April/index.html" >
   <LINK REL="made" HREF="mailto:kiwi-devel%40lists.berlios.de?Subject=Re%3A%20%5BKiwi-devel%5D%20%5BGit%5DProject%20kiwi%20at%20BerliOS%20branch%2C%0A%09KIWI-485-SuSE-11-1-SLE-SP-Devel%2C%0A%09updated.%208e62c024a6b281f3c3098e18165bf2fd1181dae6&In-Reply-To=%3C20110420085818.04C164813DD%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="003348.html">
   <LINK REL="Next"  HREF="003350.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Kiwi-devel] [Git]Project kiwi at BerliOS branch,	KIWI-485-SuSE-11-1-SLE-SP-Devel,	updated. 8e62c024a6b281f3c3098e18165bf2fd1181dae6</H1>
    <B>marcus_schaefer at BerliOS</B> 
    <A HREF="mailto:kiwi-devel%40lists.berlios.de?Subject=Re%3A%20%5BKiwi-devel%5D%20%5BGit%5DProject%20kiwi%20at%20BerliOS%20branch%2C%0A%09KIWI-485-SuSE-11-1-SLE-SP-Devel%2C%0A%09updated.%208e62c024a6b281f3c3098e18165bf2fd1181dae6&In-Reply-To=%3C20110420085818.04C164813DD%40sheep.berlios.de%3E"
       TITLE="[Kiwi-devel] [Git]Project kiwi at BerliOS branch,	KIWI-485-SuSE-11-1-SLE-SP-Devel,	updated. 8e62c024a6b281f3c3098e18165bf2fd1181dae6">marcus_schaefer at mail.berlios.de
       </A><BR>
    <I>Wed Apr 20 10:58:17 CEST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="003348.html">[Kiwi-devel] [Git]Project kiwi at BerliOS branch, master,	updated. e5fd6bd11e41666cd1c2559a0897f9dcc2231103
</A></li>
        <LI>Next message: <A HREF="003350.html">[Kiwi-devel] move some code
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3349">[ date ]</a>
              <a href="thread.html#3349">[ thread ]</a>
              <a href="subject.html#3349">[ subject ]</a>
              <a href="author.html#3349">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>This is an automated email from the git hooks/post-receive script. It was
generated because a ref change was pushed to the repository containing
the project &quot;Project kiwi at BerliOS&quot;.

The branch, KIWI-485-SuSE-11-1-SLE-SP-Devel has been updated
       via  8e62c024a6b281f3c3098e18165bf2fd1181dae6 (commit)
       via  0aacb7d662739c004c4b6ac0bc6a36776c2737b3 (commit)
       via  b00720e11134a24e9942c4d5cf1a8aa3fdc0f7d6 (commit)
      from  e291021c7cce9d3f1cf39e6a415501ba6f6ebdfe (commit)

Those revisions listed above that are new to this repository have
not appeared on any other notification email; so we list those
revisions in full, below.

- Log -----------------------------------------------------------------
commit 8e62c024a6b281f3c3098e18165bf2fd1181dae6
Author: Marcus Sch&#195;&#164;fer &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/kiwi-devel">ms at novell.com</A>&gt;
Date:   Wed Apr 20 10:45:52 2011 +0200

    - changed xsl 51 to 52 conversion. The obsolete usb image type
      is removed from the XML input. this image type can be either
      replaced by an iso hybrid type or by an oem type. As there is
      a choice for the user the stylesheet will not make a decision
      here.

commit 0aacb7d662739c004c4b6ac0bc6a36776c2737b3
Author: Marcus Sch&#195;&#164;fer &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/kiwi-devel">ms at novell.com</A>&gt;
Date:   Wed Apr 20 10:15:28 2011 +0200

    - netboot: added preLoadConfiguration hook:
      preLoadConfiguration: is called before the client.&lt;MAC&gt; is
      loaded by kiwi and thus can be used to inject alternative code
      for loading the client configuration.
    
    - netboot: added postLoadConfiguration hook:
      postLoadConfiguration: is called after the client configuration
      has been loaded and imported and can be used for any action
      after the client configuration has exported its variables into
      the boot environment
    
    - netboot: renamed the default register file which is put on
      the pxe boot server if there is client configuration found.
      kiwi now put a file called: upload/client.$DHCPCHADDR
      which doesn't conflict with the files SLEPOS uses for
      registration
    
    - netboot: removed SLEPOS related code, posbios calls and
      the evaluation of the WORKSTATION_LDAP_IP variable. All
      this will be part of product specific hook scripts

commit b00720e11134a24e9942c4d5cf1a8aa3fdc0f7d6
Author: Marcus Sch&#195;&#164;fer &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/kiwi-devel">ms at novell.com</A>&gt;
Date:   Wed Apr 20 10:14:28 2011 +0200

    - allow parameters to be passed to hook scripts

-----------------------------------------------------------------------

Summary of changes:
diff --git a/modules/KIWILinuxRC.sh b/modules/KIWILinuxRC.sh
index 96cbaa9..07eebc2 100644
--- a/modules/KIWILinuxRC.sh
+++ b/modules/KIWILinuxRC.sh
@@ -4720,7 +4720,7 @@ function searchHardwareMapHardwareAddress {
 function runHook {
 	HOOK=&quot;/kiwi-hooks/$1.sh&quot;
 	if [ -e $HOOK ]; then
-		. $HOOK
+		. $HOOK $@
 	fi
 }
 #======================================
@@ -6592,24 +6592,14 @@ function pxeSetupSystemHWInfoFile {
 function pxeSetupSystemHWTypeFile {
 	# /.../
 	# collects information about the alias name the
-	# architecture the BIOS version and more and stores
-	# that into a file suffixed by the hardware address of the
-	# network card. Obtaining the BIOS information requires
-	# the posbios tool to be installed in the initrd
+	# architecture and more and stores that into a
+	# file suffixed by the hardware address of the
+	# network card.
 	# ----
 	echo &quot;NCNAME=$SYSALIAS&quot;   &gt;&gt; hwtype.$DHCPCHADDR
 	echo &quot;CRNAME=$SYSALIAS&quot;   &gt;&gt; hwtype.$DHCPCHADDR
 	echo &quot;IPADDR=$IPADDR&quot;     &gt;&gt; hwtype.$DHCPCHADDR
 	echo &quot;ARCHITECTURE=$ARCH&quot; &gt;&gt; hwtype.$DHCPCHADDR
-	#========================================
-	# Try to get BIOS data if tools are there
-	#----------------------------------------
-	if [ -f /sbin/posbios ];then
-		HWBIOS=`/sbin/posbios -b`
-		echo &quot;HWBIOS=$HWBIOS&quot; &gt;&gt; hwtype.$DHCPCHADDR
-		HWTYPE=`/sbin/posbios -ms`
-		echo &quot;HWTYPE=$HWTYPE&quot; &gt;&gt; hwtype.$DHCPCHADDR
-	fi
 }
 #======================================
 # pxeSizeToMB
diff --git a/system/boot/ix86/netboot/suse-linuxrc b/system/boot/ix86/netboot/suse-linuxrc
index b63952d..f24fce3 100755
--- a/system/boot/ix86/netboot/suse-linuxrc
+++ b/system/boot/ix86/netboot/suse-linuxrc
@@ -145,11 +145,17 @@ if [ $LOCAL_BOOT = &quot;no&quot; ];then
 	if [ ! -z &quot;$NBDROOT&quot; ];then
 		KLIST[0]=&quot;NBDROOT=$NBDROOT&quot;;
 	fi
+	Echo &quot;Checking for config file...&quot;
 	#======================================
-	# Connection/access check for SERVER
+	# hook: preLoadConfiguration
 	#--------------------------------------
-	Echo &quot;Checking for config file: config.$DHCPCHADDR&quot;
-	fetchFile KIWI/config.$DHCPCHADDR $CONFIG
+	runHook preLoadConfiguration
+	#======================================
+	# Load config.&lt;MAC&gt;
+	#--------------------------------------
+	if [ ! -s $CONFIG ] ; then
+		fetchFile KIWI/config.$DHCPCHADDR $CONFIG
+	fi
 	#======================================
 	# Check alternative config names
 	#--------------------------------------
@@ -174,17 +180,6 @@ if [ $LOCAL_BOOT = &quot;no&quot; ];then
 		searchHardwareMapConfig
 		IMPORTED=1
 	fi
-	#========================================
-	# Compare current IP and IP from config 
-	#----------------------------------------
-	NEWIP=0
-	if [ ! -z &quot;$WORKSTATION_LDAP_IP&quot; ]; then
-		WSNR=`echo $WORKSTATION_LDAP_IP | sed -r -e 's/(^|\.)0*/\1/g'`
-		IPNR=`echo $IPADDR | sed -r -e 's/(^|\.)0*/\1/g'`
-		if [ &quot;$WSNR&quot; != &quot;$IPNR&quot; ];then 
-			NEWIP=1
-		fi
-	fi
 	#======================================
 	# No config found register new client
 	#--------------------------------------
@@ -199,8 +194,7 @@ if [ $LOCAL_BOOT = &quot;no&quot; ];then
 		#======================================
 		# Put files on the boot server
 		#--------------------------------------
-		putFile hwtype.$DHCPCHADDR upload/hwtype.$DHCPCHADDR
-		putFile hwinfo.$DHCPCHADDR upload/hwinfo.$DHCPCHADDR
+		putFile hwtype.$DHCPCHADDR upload/client.$DHCPCHADDR
 		echo
 		Echo &quot;Registered as: $DHCPCHADDR&quot;
 		Echo &quot;Waiting for configuration...&quot;
@@ -227,17 +221,6 @@ if [ $LOCAL_BOOT = &quot;no&quot; ];then
 		done
 	fi
 	#======================================
-	# Config found but DHCP IP setup change
-	#--------------------------------------
-	if [ $NEWIP -eq 1 ];then
-		Echo &quot;Outdated IP address, notify new client setup...&quot;
-		pxeSetupSystemAliasName
-		pxeSetupSystemHWTypeFile
-		putFile hwtype.$DHCPCHADDR upload/hwtype.$DHCPCHADDR
-		echo
-		Echo &quot;Notified: $DHCPCHADDR&quot;
-	fi
-	#======================================
 	# import latest configuration
 	#--------------------------------------
 	if [ $IMPORTED -eq 0 ];then
@@ -256,6 +239,10 @@ if [ $LOCAL_BOOT = &quot;no&quot; ];then
 			eval export \&quot;$i\&quot;
 		done
 	fi
+	#======================================
+	# hook: postLoadConfiguration
+	#--------------------------------------
+	runHook postLoadConfiguration
 fi
 
 #======================================
diff --git a/xsl/convert51to52.xsl b/xsl/convert51to52.xsl
index db8cd80..350df3f 100644
--- a/xsl/convert51to52.xsl
+++ b/xsl/convert51to52.xsl
@@ -25,4 +25,16 @@
 	&lt;/image&gt;
 &lt;/xsl:template&gt;
 
+&lt;!-- remove obsolete usb image type --&gt;
+&lt;xsl:template match=&quot;type&quot; mode=&quot;conv51to52&quot;&gt;
+	&lt;xsl:choose&gt;
+		&lt;xsl:when test=&quot;@image!='usb'&quot;&gt;
+			&lt;type&gt;
+			&lt;xsl:copy-of select=&quot;@*&quot;/&gt;
+			&lt;xsl:apply-templates mode=&quot;conv51to52&quot;/&gt;
+			&lt;/type&gt;
+		&lt;/xsl:when&gt;
+	&lt;/xsl:choose&gt;
+&lt;/xsl:template&gt;
+
 &lt;/xsl:stylesheet&gt;


hooks/post-receive
-- 
Project kiwi at BerliOS

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="003348.html">[Kiwi-devel] [Git]Project kiwi at BerliOS branch, master,	updated. e5fd6bd11e41666cd1c2559a0897f9dcc2231103
</A></li>
	<LI>Next message: <A HREF="003350.html">[Kiwi-devel] move some code
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3349">[ date ]</a>
              <a href="thread.html#3349">[ thread ]</a>
              <a href="subject.html#3349">[ subject ]</a>
              <a href="author.html#3349">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/kiwi-devel">More information about the Kiwi-devel
mailing list</a><br>
</body></html>

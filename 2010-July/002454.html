<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Kiwi-devel] [Git]Project kiwi at BerliOS branch,	KIWI-443-SuSE-11-3-Devel,	updated. 4279f8eec4829a2b8ec3fb75e77fef0ff33e0f1d
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/kiwi-devel/2010-July/index.html" >
   <LINK REL="made" HREF="mailto:kiwi-devel%40lists.berlios.de?Subject=Re%3A%20%5BKiwi-devel%5D%20%5BGit%5DProject%20kiwi%20at%20BerliOS%20branch%2C%0A%09KIWI-443-SuSE-11-3-Devel%2C%0A%09updated.%204279f8eec4829a2b8ec3fb75e77fef0ff33e0f1d&In-Reply-To=%3C20100727205119.1FDFF480086%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002453.html">
   <LINK REL="Next"  HREF="002455.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Kiwi-devel] [Git]Project kiwi at BerliOS branch,	KIWI-443-SuSE-11-3-Devel,	updated. 4279f8eec4829a2b8ec3fb75e77fef0ff33e0f1d</H1>
    <B>marcus_schaefer at BerliOS</B> 
    <A HREF="mailto:kiwi-devel%40lists.berlios.de?Subject=Re%3A%20%5BKiwi-devel%5D%20%5BGit%5DProject%20kiwi%20at%20BerliOS%20branch%2C%0A%09KIWI-443-SuSE-11-3-Devel%2C%0A%09updated.%204279f8eec4829a2b8ec3fb75e77fef0ff33e0f1d&In-Reply-To=%3C20100727205119.1FDFF480086%40sheep.berlios.de%3E"
       TITLE="[Kiwi-devel] [Git]Project kiwi at BerliOS branch,	KIWI-443-SuSE-11-3-Devel,	updated. 4279f8eec4829a2b8ec3fb75e77fef0ff33e0f1d">marcus_schaefer at mail.berlios.de
       </A><BR>
    <I>Tue Jul 27 22:51:19 CEST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="002453.html">[Kiwi-devel] [Git]Project kiwi at BerliOS branch, master,	updated. 34d22d402bcd4db699b209d787ff218119c80586
</A></li>
        <LI>Next message: <A HREF="002455.html">[Kiwi-devel] [Git]Project kiwi at BerliOS branch, master,	updated. 53b7e71dca9dcf14cef1b061487ee2fb21aff14e
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2454">[ date ]</a>
              <a href="thread.html#2454">[ thread ]</a>
              <a href="subject.html#2454">[ subject ]</a>
              <a href="author.html#2454">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>This is an automated email from the git hooks/post-receive script. It was
generated because a ref change was pushed to the repository containing
the project &quot;Project kiwi at BerliOS&quot;.

The branch, KIWI-443-SuSE-11-3-Devel has been updated
       via  4279f8eec4829a2b8ec3fb75e77fef0ff33e0f1d (commit)
       via  727986298a2c2bad589d2d736dfb60c6cc376606 (commit)
       via  9c8a225cac76c19075bd7858ad333d0b31f84fb0 (commit)
       via  d0d9ec43aaf92c38f290a14180445b77a2cd4e43 (commit)
       via  891eb07daffb01830e5e8d0f21ac1242c59654ce (commit)
       via  1724b5586e7916ea6480b1e055b3bc453fe22656 (commit)
      from  fc4b9e3688983ffee7ee9829737f5afba39e44cf (commit)

Those revisions listed above that are new to this repository have
not appeared on any other notification email; so we list those
revisions in full, below.

- Log -----------------------------------------------------------------
commit 4279f8eec4829a2b8ec3fb75e77fef0ff33e0f1d
Author: Marcus Sch&#195;&#164;fer &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/kiwi-devel">ms at novell.com</A>&gt;
Date:   Tue Jul 27 22:42:50 2010 +0200

    - fixed PARTED_VER setup and tests. If the parted version
      is below or equal 1.8.8 we switch to fdisk. This applies for
      sle10 where parted doesn't have some options which we require

commit 727986298a2c2bad589d2d736dfb60c6cc376606
Author: Marcus Sch&#195;&#164;fer &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/kiwi-devel">ms at novell.com</A>&gt;
Date:   Tue Jul 27 15:35:04 2010 +0200

    - fixed solvable cache if only one solvable is created it
      was removed and not cached

commit 9c8a225cac76c19075bd7858ad333d0b31f84fb0
Author: Marcus Sch&#195;&#164;fer &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/kiwi-devel">ms at novell.com</A>&gt;
Date:   Tue Jul 27 14:53:12 2010 +0200

    - fixed use of uninitialized value for $dir

commit d0d9ec43aaf92c38f290a14180445b77a2cd4e43
Author: Marcus Sch&#195;&#164;fer &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/kiwi-devel">ms at novell.com</A>&gt;
Date:   Tue Jul 27 08:11:21 2010 +0200

    - fixed suse-11.3/suse-min-gnome example, added missing
      icewm and a terminal :)

commit 891eb07daffb01830e5e8d0f21ac1242c59654ce
Author: Marcus Sch&#195;&#164;fer &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/kiwi-devel">ms at novell.com</A>&gt;
Date:   Tue Jul 27 08:06:14 2010 +0200

    - don't create splash initrd if it already exists

commit 1724b5586e7916ea6480b1e055b3bc453fe22656
Author: Marcus Sch&#195;&#164;fer &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/kiwi-devel">ms at novell.com</A>&gt;
Date:   Tue Jul 27 08:05:41 2010 +0200

    - fixed use of uninitialized value for $overlay

-----------------------------------------------------------------------

Summary of changes:
diff --git a/doc/examples/suse-11.3/suse-min-gnome/config.xml b/doc/examples/suse-11.3/suse-min-gnome/config.xml
index 57f9bf0..e37346e 100644
--- a/doc/examples/suse-11.3/suse-min-gnome/config.xml
+++ b/doc/examples/suse-11.3/suse-min-gnome/config.xml
@@ -44,6 +44,8 @@
 		&lt;package name=&quot;preload&quot;/&gt;
 		&lt;package name=&quot;tomboy&quot;/&gt;
 		&lt;package name=&quot;vim&quot;/&gt;
+		&lt;package name=&quot;xterm&quot;/&gt;
+		&lt;package name=&quot;icewm&quot;/&gt;
 		&lt;package name=&quot;xorg-x11-server&quot;/&gt;
 		&lt;opensusePattern name=&quot;base&quot;/&gt;
 	&lt;/packages&gt;
diff --git a/kiwi.pl b/kiwi.pl
index 7f85dfb..43be898 100755
--- a/kiwi.pl
+++ b/kiwi.pl
@@ -652,7 +652,7 @@ sub main {
 				$kiwi -&gt; failed ();
 				$kiwi -&gt; info   (&quot;No destination directory specified&quot;);
 				$kiwi -&gt; failed ();
-				if (defined $BaseRoot) {
+				if ((defined $BaseRoot) &amp;&amp; ($overlay)) {
 					$overlay -&gt; resetOverlay();
 				}
 				my $code = kiwiExit (1); return $code;
@@ -1878,6 +1878,7 @@ sub listXMLInfo {
 		my @list = shift;
 		return sub {
 			foreach my $dir (@list) {
+				next if ! defined $dir;
 				qxx (&quot;umount $dir ; rmdir $dir 2&gt;&amp;1&quot;);
 			}
 		}
diff --git a/modules/KIWIBoot.pm b/modules/KIWIBoot.pm
index 502d5f6..7c96c6f 100644
--- a/modules/KIWIBoot.pm
+++ b/modules/KIWIBoot.pm
@@ -3341,6 +3341,24 @@ sub setupSplash {
 	my $newird;
 	my $result;
 	#==========================================
+	# check if compressed and setup splash.gz
+	#------------------------------------------
+	if ($initrd =~ /\.gz$/) {
+		$zipped = 1;
+	}
+	if ($zipped) {
+		$newird = $initrd; $newird =~ s/\.gz/\.splash.gz/;
+	} else {
+		$newird = $initrd.&quot;.splash.gz&quot;;
+	}
+	#==========================================
+	# check if splash initrd is already there
+	#------------------------------------------
+	if ((! -l $newird) &amp;&amp; (-f $newird)) {
+		# splash initrd already created...
+		return $newird;
+	}
+	#==========================================
 	# create temp dir for operations
 	#------------------------------------------
 	$kiwi -&gt; info (&quot;Setting up splash screen...&quot;);
@@ -3354,17 +3372,7 @@ sub setupSplash {
 	}
 	chomp $spldir;
 	my $irddir = &quot;$spldir/initrd&quot;;
-	#==========================================
-	# check if compressed and setup splash.gz
-	#------------------------------------------
-	if ($initrd =~ /\.gz$/) {
-		$zipped = 1;
-	}
-	if ($zipped) {
-		$newird = $initrd; $newird =~ s/\.gz/\.splash.gz/;
-	} else {
-		$newird = $initrd.&quot;.splash.gz&quot;;
-	}
+
 	#==========================================
 	# unpack initrd files
 	#------------------------------------------
diff --git a/modules/KIWIImage.pm b/modules/KIWIImage.pm
index c243d23..7c50a59 100644
--- a/modules/KIWIImage.pm
+++ b/modules/KIWIImage.pm
@@ -1017,6 +1017,10 @@ sub createImageUSB {
 			$lookup = $main::PrebuiltBootImage.&quot;/&quot;;
 		}
 		my $pinitrd = $lookup.$main::ImageName.&quot;.gz&quot;;
+		my $psplash;
+		if (-f $lookup.$main::ImageName.&quot;.splash.gz&quot;) {
+			$psplash = $lookup.$main::ImageName.&quot;.splash.gz&quot;;
+		}
 		my $plinux  = $lookup.$main::ImageName.&quot;.kernel&quot;;
 		if (! -f $pinitrd) {
 			$pinitrd = $lookup.$main::ImageName;
@@ -1035,6 +1039,9 @@ sub createImageUSB {
 				$kiwi -&gt; done();
 				$pblt = 1;
 			} else {
+				if ($psplash) {
+					qxx (&quot;cp -a $psplash $main::Destination 2&gt;&amp;1&quot;);
+				}
 				my $data = qxx (&quot;cp -a $pinitrd $main::Destination 2&gt;&amp;1&quot;);
 				my $code = $? &gt;&gt; 8;
 				if ($code != 0) {
diff --git a/modules/KIWILinuxRC.sh b/modules/KIWILinuxRC.sh
index 25d6cfb..1b1a561 100644
--- a/modules/KIWILinuxRC.sh
+++ b/modules/KIWILinuxRC.sh
@@ -47,8 +47,12 @@ if [ -x /sbin/blogd ];then
 	test -z &quot;$CONSOLE&quot;            &amp;&amp; export CONSOLE=/dev/console
 	test -z &quot;$REDIRECT&quot;           &amp;&amp; export REDIRECT=/dev/tty1
 fi
-if [ -z &quot;$PARTED_VERSION&quot; ];then
-	export PARTED_VER=$(parted -v | head -n 1 | cut -f4 -d&quot; &quot; | cut -f1-2 -d.)
+if [ -z &quot;$PARTED_VER&quot; ];then
+	PARTED_VER=$(parted -v|head -n 1 | cut -f4 -d&quot; &quot; | cut -f1-3 -d. | tr -d .)
+	export PARTED_VER
+fi
+if [ $PARTED_VER -le 188 ];then
+	export PARTITIONER=sfdisk
 fi
 
 #======================================
@@ -5290,7 +5294,7 @@ function partedWrite {
 	local device=$1
 	local cmds=$2
 	local opts
-	if [ $PARTED_VER = &quot;2.2&quot; ];then
+	if [ $PARTED_VER -ge 220 ];then
 		opts=&quot;-a cyl&quot;
 	fi
 	if ! parted $opts -m $device unit cyl $cmds;then
diff --git a/modules/KIWIXML.pm b/modules/KIWIXML.pm
index 6c3bd59..f14e19e 100644
--- a/modules/KIWIXML.pm
+++ b/modules/KIWIXML.pm
@@ -3811,15 +3811,17 @@ sub getInstSourceSatSolvable {
 	# merge all solvables into one
 	#------------------------------------------
 	if ($count &gt; 1) {
-		my $data = qxx (&quot;mergesolv @index &gt; $solv&quot;);
+		my $data = qxx (&quot;mergesolv @index &gt; $solv.system&quot;);
 		my $code = $? &gt;&gt; 8;
 		if ($code != 0) {
 			$kiwi -&gt; error  (&quot;--&gt; Couldn't merge solve files&quot;);
 			$kiwi -&gt; failed ();
 			return undef
 		}
+	} else {
+		qxx (&quot;cp $solv $solv.system 2&gt;&amp;1&quot;);
 	}
-	return $solv;
+	return $solv.&quot;.system&quot;;
 }
 
 #==========================================
diff --git a/rpm/kiwi.changes b/rpm/kiwi.changes
index 0c58396..94af3e6 100644
--- a/rpm/kiwi.changes
+++ b/rpm/kiwi.changes
@@ -1,5 +1,14 @@
 -------------------------------------------------------------------
-Mon Jul 26 17:17:48 CEST 2010 - <A HREF="https://lists.berlios.de/mailman/listinfo/kiwi-devel">ms at suse.de</A>
+Tue Jul 27 07:23:38 CEST 2010 - <A HREF="https://lists.berlios.de/mailman/listinfo/kiwi-devel">ms at suse.de</A>
+
+- fixed PARTED_VER setup and tests. If the parted version
+  is below or equal 1.8.8 we switch to fdisk. This applies for
+  sle10 where parted doesn't have some options which we require
+- don't create splash initrd if it already exists
+- fixed use of uninitialized value for $overlay
+
+-------------------------------------------------------------------
+Mon Jul 26 16:42:38 CEST 2010 - <A HREF="https://lists.berlios.de/mailman/listinfo/kiwi-devel">ms at suse.de</A>
 
 - fixed setupBootPartition() to return with a bootid
   export in _any_ case. Default bootid is 1 (bnc #625379)


hooks/post-receive
-- 
Project kiwi at BerliOS

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002453.html">[Kiwi-devel] [Git]Project kiwi at BerliOS branch, master,	updated. 34d22d402bcd4db699b209d787ff218119c80586
</A></li>
	<LI>Next message: <A HREF="002455.html">[Kiwi-devel] [Git]Project kiwi at BerliOS branch, master,	updated. 53b7e71dca9dcf14cef1b061487ee2fb21aff14e
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2454">[ date ]</a>
              <a href="thread.html#2454">[ thread ]</a>
              <a href="subject.html#2454">[ subject ]</a>
              <a href="author.html#2454">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/kiwi-devel">More information about the Kiwi-devel
mailing list</a><br>
</body></html>

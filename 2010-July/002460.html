<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Kiwi-devel] [Git]Project kiwi at BerliOS branch, master,	updated. 50b090399b4e012a1629a5690e5c84e7047e66d8
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/kiwi-devel/2010-July/index.html" >
   <LINK REL="made" HREF="mailto:kiwi-devel%40lists.berlios.de?Subject=Re%3A%20%5BKiwi-devel%5D%20%5BGit%5DProject%20kiwi%20at%20BerliOS%20branch%2C%20master%2C%0A%09updated.%2050b090399b4e012a1629a5690e5c84e7047e66d8&In-Reply-To=%3C20100729104347.5B6E3480BEA%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002459.html">
   <LINK REL="Next"  HREF="002461.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Kiwi-devel] [Git]Project kiwi at BerliOS branch, master,	updated. 50b090399b4e012a1629a5690e5c84e7047e66d8</H1>
    <B>marcus_schaefer at BerliOS</B> 
    <A HREF="mailto:kiwi-devel%40lists.berlios.de?Subject=Re%3A%20%5BKiwi-devel%5D%20%5BGit%5DProject%20kiwi%20at%20BerliOS%20branch%2C%20master%2C%0A%09updated.%2050b090399b4e012a1629a5690e5c84e7047e66d8&In-Reply-To=%3C20100729104347.5B6E3480BEA%40sheep.berlios.de%3E"
       TITLE="[Kiwi-devel] [Git]Project kiwi at BerliOS branch, master,	updated. 50b090399b4e012a1629a5690e5c84e7047e66d8">marcus_schaefer at mail.berlios.de
       </A><BR>
    <I>Thu Jul 29 12:43:46 CEST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="002459.html">[Kiwi-devel] [Git]Project kiwi at BerliOS branch,	KIWI-443-SuSE-11-3-Devel,	updated. a9759804becd13d77f1e2df1fc8a989fc74192f1
</A></li>
        <LI>Next message: <A HREF="002461.html">[Kiwi-devel] [Git]Project kiwi at BerliOS branch, master,	updated. bd67d7de922aec169b935ab284c28e778723ebfd
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2460">[ date ]</a>
              <a href="thread.html#2460">[ thread ]</a>
              <a href="subject.html#2460">[ subject ]</a>
              <a href="author.html#2460">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>This is an automated email from the git hooks/post-receive script. It was
generated because a ref change was pushed to the repository containing
the project &quot;Project kiwi at BerliOS&quot;.

The branch, master has been updated
       via  50b090399b4e012a1629a5690e5c84e7047e66d8 (commit)
       via  b49fb7a8c29525bb1448c27daf517365f939c222 (commit)
      from  4d9ba69f36887bcc0470b9481aebef67a0266813 (commit)

Those revisions listed above that are new to this repository have
not appeared on any other notification email; so we list those
revisions in full, below.

- Log -----------------------------------------------------------------
commit 50b090399b4e012a1629a5690e5c84e7047e66d8
Author: Marcus Sch&#195;&#164;fer &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/kiwi-devel">ms at novell.com</A>&gt;
Date:   Thu Jul 29 12:42:31 2010 +0200

    - add changelog entry for last commit
    - recreate documentation

commit b49fb7a8c29525bb1448c27daf517365f939c222
Author: Marcus Sch&#195;&#164;fer &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/kiwi-devel">ms at novell.com</A>&gt;
Date:   Tue Jul 27 22:35:31 2010 +0200

    - added support for image caching. With this feature you can
      provide a cache directory along with the option --cache.
      kiwi in prepare step looks into the directory if it finds
      a cache serving as the base-root for the system image.
      If it can't find one it creates caches based on the
      patterns used in the image description which speeds
      up subsequent prepare calls for this and other images

-----------------------------------------------------------------------

Summary of changes:
diff --git a/doc/kiwi-man/KIWI::config.sh.1 b/doc/kiwi-man/KIWI::config.sh.1
index 32e6257..1d0d51a 100644
--- a/doc/kiwi-man/KIWI::config.sh.1
+++ b/doc/kiwi-man/KIWI::config.sh.1
@@ -1,161 +1,13 @@
+'\&quot; t
 .\&quot;     Title: kiwi::config.sh
 .\&quot;    Author: Marcus Sch&#195;&#164;fer &lt;ms (AT) suse.de&gt;
-.\&quot; Generator: DocBook XSL Stylesheets v1.74.0 &lt;<A HREF="http://docbook.sf.net/">http://docbook.sf.net/</A>&gt;
-.\&quot;      Date: Created: 07/26/2010
+.\&quot; Generator: DocBook XSL Stylesheets v1.75.2 &lt;<A HREF="http://docbook.sf.net/">http://docbook.sf.net/</A>&gt;
+.\&quot;      Date: Created: 07/29/2010
 .\&quot;    Manual: KIWI Manualpage
 .\&quot;    Source: KIWI 4.51
 .\&quot;  Language: English
 .\&quot;
-.TH &quot;KIWI::CONFIG\&amp;.SH&quot; &quot;1&quot; &quot;Created: 07/26/2010&quot; &quot;KIWI 4\&amp;.51&quot; &quot;KIWI Manualpage&quot;
-.\&quot; -----------------------------------------------------------------
-.\&quot; * (re)Define some macros
-.\&quot; -----------------------------------------------------------------
-.\&quot; ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
-.\&quot; toupper - uppercase a string (locale-aware)
-.\&quot; ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
-.de toupper
-.tr aAbBcCdDeEfFgGhHiIjJkKlLmMnNoOpPqQrRsStTuUvVwWxXyYzZ
-\\$*
-.tr aabbccddeeffgghhiijjkkllmmnnooppqqrrssttuuvvwwxxyyzz
-..
-.\&quot; ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
-.\&quot; SH-xref - format a cross-reference to an SH section
-.\&quot; ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
-.de SH-xref
-.ie n \{\
-.\}
-.toupper \\$*
-.el \{\
-\\$*
-.\}
-..
-.\&quot; ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
-.\&quot; SH - level-one heading that works better for non-TTY output
-.\&quot; ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
-.de1 SH
-.\&quot; put an extra blank line of space above the head in non-TTY output
-.if t \{\
-.sp 1
-.\}
-.sp \\n[PD]u
-.nr an-level 1
-.set-an-margin
-.nr an-prevailing-indent \\n[IN]
-.fi
-.in \\n[an-margin]u
-.ti 0
-.HTML-TAG &quot;.NH \\n[an-level]&quot;
-.it 1 an-trap
-.nr an-no-space-flag 1
-.nr an-break-flag 1
-\.&quot; make the size of the head bigger
-.ps +3
-.ft B
-.ne (2v + 1u)
-.ie n \{\
-.\&quot; if n (TTY output), use uppercase
-.toupper \\$*
-.\}
-.el \{\
-.nr an-break-flag 0
-.\&quot; if not n (not TTY), use normal case (not uppercase)
-\\$1
-.in \\n[an-margin]u
-.ti 0
-.\&quot; if not n (not TTY), put a border/line under subheading
-.sp -.6
-\l'\n(.lu'
-.\}
-..
-.\&quot; ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
-.\&quot; SS - level-two heading that works better for non-TTY output
-.\&quot; ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
-.de1 SS
-.sp \\n[PD]u
-.nr an-level 1
-.set-an-margin
-.nr an-prevailing-indent \\n[IN]
-.fi
-.in \\n[IN]u
-.ti \\n[SN]u
-.it 1 an-trap
-.nr an-no-space-flag 1
-.nr an-break-flag 1
-.ps \\n[PS-SS]u
-\.&quot; make the size of the head bigger
-.ps +2
-.ft B
-.ne (2v + 1u)
-.if \\n[.$] \&amp;\\$*
-..
-.\&quot; ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
-.\&quot; BB/BE - put background/screen (filled box) around block of text
-.\&quot; ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
-.de BB
-.if t \{\
-.sp -.5
-.br
-.in +2n
-.ll -2n
-.gcolor red
-.di BX
-.\}
-..
-.de EB
-.if t \{\
-.if &quot;\\$2&quot;adjust-for-leading-newline&quot; \{\
-.sp -1
-.\}
-.br
-.di
-.in
-.ll
-.gcolor
-.nr BW \\n(.lu-\\n(.i
-.nr BH \\n(dn+.5v
-.ne \\n(BHu+.5v
-.ie &quot;\\$2&quot;adjust-for-leading-newline&quot; \{\
-\M[\\$1]\h'1n'\v'+.5v'\D'P \\n(BWu 0 0 \\n(BHu -\\n(BWu 0 0 -\\n(BHu'\M[]
-.\}
-.el \{\
-\M[\\$1]\h'1n'\v'-.5v'\D'P \\n(BWu 0 0 \\n(BHu -\\n(BWu 0 0 -\\n(BHu'\M[]
-.\}
-.in 0
-.sp -.5v
-.nf
-.BX
-.in
-.sp .5v
-.fi
-.\}
-..
-.\&quot; ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
-.\&quot; BM/EM - put colored marker in margin next to block of text
-.\&quot; ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
-.de BM
-.if t \{\
-.br
-.ll -2n
-.gcolor red
-.di BX
-.\}
-..
-.de EM
-.if t \{\
-.br
-.di
-.ll
-.gcolor
-.nr BH \\n(dn
-.ne \\n(BHu
-\M[\\$1]\D'P -.75n 0 0 \\n(BHu -(\\n[.i]u - \\n(INu - .75n) 0 0 -\\n(BHu'\M[]
-.in 0
-.nf
-.BX
-.in
-.fi
-.\}
-..
+.TH &quot;KIWI::CONFIG\&amp;.SH&quot; &quot;1&quot; &quot;Created: 07/29/2010&quot; &quot;KIWI 4\&amp;.51&quot; &quot;KIWI Manualpage&quot;
 .\&quot; -----------------------------------------------------------------
 .\&quot; * set default formatting
 .\&quot; -----------------------------------------------------------------
@@ -166,9 +18,9 @@
 .\&quot; -----------------------------------------------------------------
 .\&quot; * MAIN CONTENT STARTS HERE *
 .\&quot; -----------------------------------------------------------------
-.SH &quot;Name&quot;
+.SH &quot;NAME&quot;
 KIWI::config.sh \- Configuration File for KIWI image description
-.SH &quot;Description&quot;
+.SH &quot;DESCRIPTION&quot;
 .PP
 The kiwi image description allows to have an optional config\&amp;.sh script in place\&amp;. This script should be designed to take over control of adding the image operating system configuration\&amp;. Configuration in that sense means stuff like activating services, creating configuration files, prepare an environment for a firstboot workflow, etc\&amp;. What you shouldn\'t do in config\&amp;.sh is breaking your systems integrity by for example removing packages or pieces of software\&amp;. Something like that can be done in images\&amp;.sh\&amp;. config\&amp;.sh is called
 \fIafter\fR
@@ -179,15 +31,7 @@ the user and groups have been set up\&amp;. If there are SUSE Linux related YaST xml
 .if n \{\
 .RS 4
 .\}
-.fam C
-.ps -1
 .nf
-.if t \{\
-.sp -1
-.\}
-.BB lightgray adjust-for-leading-newline
-.sp -1
-
 #======================================
 # Functions\&amp;.\&amp;.\&amp;.
 #\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-
@@ -208,17 +52,11 @@ echo &quot;Configure image: [$kiwi_iname]\&amp;.\&amp;.\&amp;.&quot;
 # Exit safely
 #\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-
 exit
-.EB lightgray adjust-for-leading-newline
-.if t \{\
-.sp 1
-.\}
 .fi
-.fam
-.ps +1
 .if n \{\
 .RE
 .\}
-.SH &quot;Common functions&quot;
+.SH &quot;COMMON FUNCTIONS&quot;
 .PP
 The \&amp;.kconfig file allows to make use of a common set of functions\&amp;. Those which are SUSE Linux specific starts with the name
 \fIsuse\fR\&amp;. Those which are common to all linux systems starts with the name
@@ -393,7 +231,7 @@ This function will use zypper to search for the installed product and install al
 .RS 4
 Remove smart o zypper packages and db files Also remove rpm package and db if &quot;\-a&quot; given
 .RE
-.SH &quot;Profile environment variables&quot;
+.SH &quot;PROFILE ENVIRONMENT VARIABLES&quot;
 .PP
 The \&amp;.profile environment file contains a specific set of variables which are listed below\&amp;. Some of the functions above makes use of the variables\&amp;.
 .PP
@@ -451,7 +289,7 @@ The contents of the timezone setup as done in config\&amp;.xml
 .RS 4
 The basic image type\&amp;. Can be a simply filesystem image type of ext2 ext3 reiserfs squashfs cpio or one of the following complex image types: iso split usb vmx oem xen pxe
 .RE
-.SH &quot;Author&quot;
+.SH &quot;AUTHOR&quot;
 .PP
 \fBMarcus Sch&#195;&#164;fer\fR &lt;\&amp;ms (AT) suse\&amp;.de\&amp;&gt;
 .RS 4
diff --git a/doc/kiwi-man/KIWI::images.sh.1 b/doc/kiwi-man/KIWI::images.sh.1
index 16243c5..13c5da7 100644
--- a/doc/kiwi-man/KIWI::images.sh.1
+++ b/doc/kiwi-man/KIWI::images.sh.1
@@ -1,161 +1,13 @@
+'\&quot; t
 .\&quot;     Title: kiwi::images.sh
 .\&quot;    Author: Marcus Sch&#195;&#164;fer &lt;ms (AT) suse.de&gt;
-.\&quot; Generator: DocBook XSL Stylesheets v1.74.0 &lt;<A HREF="http://docbook.sf.net/">http://docbook.sf.net/</A>&gt;
-.\&quot;      Date: Created: 07/26/2010
+.\&quot; Generator: DocBook XSL Stylesheets v1.75.2 &lt;<A HREF="http://docbook.sf.net/">http://docbook.sf.net/</A>&gt;
+.\&quot;      Date: Created: 07/29/2010
 .\&quot;    Manual: KIWI Manualpage
 .\&quot;    Source: KIWI 4.51
 .\&quot;  Language: English
 .\&quot;
-.TH &quot;KIWI::IMAGES\&amp;.SH&quot; &quot;1&quot; &quot;Created: 07/26/2010&quot; &quot;KIWI 4\&amp;.51&quot; &quot;KIWI Manualpage&quot;
-.\&quot; -----------------------------------------------------------------
-.\&quot; * (re)Define some macros
-.\&quot; -----------------------------------------------------------------
-.\&quot; ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
-.\&quot; toupper - uppercase a string (locale-aware)
-.\&quot; ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
-.de toupper
-.tr aAbBcCdDeEfFgGhHiIjJkKlLmMnNoOpPqQrRsStTuUvVwWxXyYzZ
-\\$*
-.tr aabbccddeeffgghhiijjkkllmmnnooppqqrrssttuuvvwwxxyyzz
-..
-.\&quot; ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
-.\&quot; SH-xref - format a cross-reference to an SH section
-.\&quot; ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
-.de SH-xref
-.ie n \{\
-.\}
-.toupper \\$*
-.el \{\
-\\$*
-.\}
-..
-.\&quot; ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
-.\&quot; SH - level-one heading that works better for non-TTY output
-.\&quot; ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
-.de1 SH
-.\&quot; put an extra blank line of space above the head in non-TTY output
-.if t \{\
-.sp 1
-.\}
-.sp \\n[PD]u
-.nr an-level 1
-.set-an-margin
-.nr an-prevailing-indent \\n[IN]
-.fi
-.in \\n[an-margin]u
-.ti 0
-.HTML-TAG &quot;.NH \\n[an-level]&quot;
-.it 1 an-trap
-.nr an-no-space-flag 1
-.nr an-break-flag 1
-\.&quot; make the size of the head bigger
-.ps +3
-.ft B
-.ne (2v + 1u)
-.ie n \{\
-.\&quot; if n (TTY output), use uppercase
-.toupper \\$*
-.\}
-.el \{\
-.nr an-break-flag 0
-.\&quot; if not n (not TTY), use normal case (not uppercase)
-\\$1
-.in \\n[an-margin]u
-.ti 0
-.\&quot; if not n (not TTY), put a border/line under subheading
-.sp -.6
-\l'\n(.lu'
-.\}
-..
-.\&quot; ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
-.\&quot; SS - level-two heading that works better for non-TTY output
-.\&quot; ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
-.de1 SS
-.sp \\n[PD]u
-.nr an-level 1
-.set-an-margin
-.nr an-prevailing-indent \\n[IN]
-.fi
-.in \\n[IN]u
-.ti \\n[SN]u
-.it 1 an-trap
-.nr an-no-space-flag 1
-.nr an-break-flag 1
-.ps \\n[PS-SS]u
-\.&quot; make the size of the head bigger
-.ps +2
-.ft B
-.ne (2v + 1u)
-.if \\n[.$] \&amp;\\$*
-..
-.\&quot; ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
-.\&quot; BB/BE - put background/screen (filled box) around block of text
-.\&quot; ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
-.de BB
-.if t \{\
-.sp -.5
-.br
-.in +2n
-.ll -2n
-.gcolor red
-.di BX
-.\}
-..
-.de EB
-.if t \{\
-.if &quot;\\$2&quot;adjust-for-leading-newline&quot; \{\
-.sp -1
-.\}
-.br
-.di
-.in
-.ll
-.gcolor
-.nr BW \\n(.lu-\\n(.i
-.nr BH \\n(dn+.5v
-.ne \\n(BHu+.5v
-.ie &quot;\\$2&quot;adjust-for-leading-newline&quot; \{\
-\M[\\$1]\h'1n'\v'+.5v'\D'P \\n(BWu 0 0 \\n(BHu -\\n(BWu 0 0 -\\n(BHu'\M[]
-.\}
-.el \{\
-\M[\\$1]\h'1n'\v'-.5v'\D'P \\n(BWu 0 0 \\n(BHu -\\n(BWu 0 0 -\\n(BHu'\M[]
-.\}
-.in 0
-.sp -.5v
-.nf
-.BX
-.in
-.sp .5v
-.fi
-.\}
-..
-.\&quot; ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
-.\&quot; BM/EM - put colored marker in margin next to block of text
-.\&quot; ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
-.de BM
-.if t \{\
-.br
-.ll -2n
-.gcolor red
-.di BX
-.\}
-..
-.de EM
-.if t \{\
-.br
-.di
-.ll
-.gcolor
-.nr BH \\n(dn
-.ne \\n(BHu
-\M[\\$1]\D'P -.75n 0 0 \\n(BHu -(\\n[.i]u - \\n(INu - .75n) 0 0 -\\n(BHu'\M[]
-.in 0
-.nf
-.BX
-.in
-.fi
-.\}
-..
+.TH &quot;KIWI::IMAGES\&amp;.SH&quot; &quot;1&quot; &quot;Created: 07/29/2010&quot; &quot;KIWI 4\&amp;.51&quot; &quot;KIWI Manualpage&quot;
 .\&quot; -----------------------------------------------------------------
 .\&quot; * set default formatting
 .\&quot; -----------------------------------------------------------------
@@ -166,9 +18,9 @@
 .\&quot; -----------------------------------------------------------------
 .\&quot; * MAIN CONTENT STARTS HERE *
 .\&quot; -----------------------------------------------------------------
-.SH &quot;Name&quot;
+.SH &quot;NAME&quot;
 KIWI::images.sh \- Configuration File for KIWI image description
-.SH &quot;Description&quot;
+.SH &quot;DESCRIPTION&quot;
 .PP
 The kiwi image description allows to have an optional images\&amp;.sh script in place\&amp;. This script is called at the beginning of the kiwi create step\&amp;. It is allowed to remove software there to shrink down the size of the image\&amp;. Most often images\&amp;.sh is used for boot images because they needs to be small\&amp;. As images\&amp;.sh is called in the create step you should be aware to design the script in a way that it can be called multiple times without shooting itself into its knee\&amp;. As kiwi allows to create different image types from one previosly prepared tree one needs to take into account that images\&amp;.sh can be called more than one time\&amp;. If you exit images\&amp;.sh with an exit code != 0 kiwi will exit with an error too\&amp;.
 .PP
@@ -177,15 +29,7 @@ The kiwi image description allows to have an optional images\&amp;.sh script in plac
 .if n \{\
 .RS 4
 .\}
-.fam C
-.ps -1
 .nf
-.if t \{\
-.sp -1
-.\}
-.BB lightgray adjust-for-leading-newline
-.sp -1
-
 #======================================
 # Functions\&amp;.\&amp;.\&amp;.
 #\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-
@@ -206,17 +50,11 @@ echo &quot;Configure image: [$kiwi_iname]\&amp;.\&amp;.\&amp;.&quot;
 # Exit safely
 #\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-
 exit
-.EB lightgray adjust-for-leading-newline
-.if t \{\
-.sp 1
-.\}
 .fi
-.fam
-.ps +1
 .if n \{\
 .RE
 .\}
-.SH &quot;Common functions&quot;
+.SH &quot;COMMON FUNCTIONS&quot;
 .PP
 The \&amp;.kconfig file allows to make use of a common set of functions\&amp;. Those which are SUSE Linux specific starts with the name
 \fIsuse\fR\&amp;. Those which are common to all linux systems starts with the name
@@ -276,7 +114,7 @@ Helper function to print a message to the controling terminal
 .RS 4
 Helper function to print a message if the variable DEBUG is set to 1
 .RE
-.SH &quot;Profile environment variables&quot;
+.SH &quot;PROFILE ENVIRONMENT VARIABLES&quot;
 .PP
 The \&amp;.profile environment file contains a specific set of variables which are listed below\&amp;. Some of the functions above makes use of the variables\&amp;.
 .PP
@@ -334,7 +172,7 @@ The value of the compressed attribute set in the type element in config\&amp;.xml
 .RS 4
 The basic image type\&amp;. Can be a simply filesystem image type of ext2 ext3 reiserfs squashfs cpio or one of the following complex image types: iso split usb vmx oem xen pxe
 .RE
-.SH &quot;Author&quot;
+.SH &quot;AUTHOR&quot;
 .PP
 \fBMarcus Sch&#195;&#164;fer\fR &lt;\&amp;ms (AT) suse\&amp;.de\&amp;&gt;
 .RS 4
diff --git a/doc/kiwi-man/KIWI::kiwirc.1 b/doc/kiwi-man/KIWI::kiwirc.1
index 0f9e6f6..2a9c0c4 100644
--- a/doc/kiwi-man/KIWI::kiwirc.1
+++ b/doc/kiwi-man/KIWI::kiwirc.1
@@ -1,161 +1,13 @@
+'\&quot; t
 .\&quot;     Title: kiwi::kiwirc
 .\&quot;    Author: Robert Schweikert &lt;rschweikert (AT) novell.com&gt;
-.\&quot; Generator: DocBook XSL Stylesheets v1.74.0 &lt;<A HREF="http://docbook.sf.net/">http://docbook.sf.net/</A>&gt;
-.\&quot;      Date: Created: 07/26/2010
+.\&quot; Generator: DocBook XSL Stylesheets v1.75.2 &lt;<A HREF="http://docbook.sf.net/">http://docbook.sf.net/</A>&gt;
+.\&quot;      Date: Created: 07/29/2010
 .\&quot;    Manual: KIWI Manualpage
 .\&quot;    Source: &gt;KIWI 4.51
 .\&quot;  Language: English
 .\&quot;
-.TH &quot;KIWI::KIWIRC&quot; &quot;1&quot; &quot;Created: 07/26/2010&quot; &quot;&gt;KIWI 4\&amp;.51&quot; &quot;KIWI Manualpage&quot;
-.\&quot; -----------------------------------------------------------------
-.\&quot; * (re)Define some macros
-.\&quot; -----------------------------------------------------------------
-.\&quot; ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
-.\&quot; toupper - uppercase a string (locale-aware)
-.\&quot; ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
-.de toupper
-.tr aAbBcCdDeEfFgGhHiIjJkKlLmMnNoOpPqQrRsStTuUvVwWxXyYzZ
-\\$*
-.tr aabbccddeeffgghhiijjkkllmmnnooppqqrrssttuuvvwwxxyyzz
-..
-.\&quot; ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
-.\&quot; SH-xref - format a cross-reference to an SH section
-.\&quot; ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
-.de SH-xref
-.ie n \{\
-.\}
-.toupper \\$*
-.el \{\
-\\$*
-.\}
-..
-.\&quot; ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
-.\&quot; SH - level-one heading that works better for non-TTY output
-.\&quot; ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
-.de1 SH
-.\&quot; put an extra blank line of space above the head in non-TTY output
-.if t \{\
-.sp 1
-.\}
-.sp \\n[PD]u
-.nr an-level 1
-.set-an-margin
-.nr an-prevailing-indent \\n[IN]
-.fi
-.in \\n[an-margin]u
-.ti 0
-.HTML-TAG &quot;.NH \\n[an-level]&quot;
-.it 1 an-trap
-.nr an-no-space-flag 1
-.nr an-break-flag 1
-\.&quot; make the size of the head bigger
-.ps +3
-.ft B
-.ne (2v + 1u)
-.ie n \{\
-.\&quot; if n (TTY output), use uppercase
-.toupper \\$*
-.\}
-.el \{\
-.nr an-break-flag 0
-.\&quot; if not n (not TTY), use normal case (not uppercase)
-\\$1
-.in \\n[an-margin]u
-.ti 0
-.\&quot; if not n (not TTY), put a border/line under subheading
-.sp -.6
-\l'\n(.lu'
-.\}
-..
-.\&quot; ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
-.\&quot; SS - level-two heading that works better for non-TTY output
-.\&quot; ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
-.de1 SS
-.sp \\n[PD]u
-.nr an-level 1
-.set-an-margin
-.nr an-prevailing-indent \\n[IN]
-.fi
-.in \\n[IN]u
-.ti \\n[SN]u
-.it 1 an-trap
-.nr an-no-space-flag 1
-.nr an-break-flag 1
-.ps \\n[PS-SS]u
-\.&quot; make the size of the head bigger
-.ps +2
-.ft B
-.ne (2v + 1u)
-.if \\n[.$] \&amp;\\$*
-..
-.\&quot; ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
-.\&quot; BB/BE - put background/screen (filled box) around block of text
-.\&quot; ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
-.de BB
-.if t \{\
-.sp -.5
-.br
-.in +2n
-.ll -2n
-.gcolor red
-.di BX
-.\}
-..
-.de EB
-.if t \{\
-.if &quot;\\$2&quot;adjust-for-leading-newline&quot; \{\
-.sp -1
-.\}
-.br
-.di
-.in
-.ll
-.gcolor
-.nr BW \\n(.lu-\\n(.i
-.nr BH \\n(dn+.5v
-.ne \\n(BHu+.5v
-.ie &quot;\\$2&quot;adjust-for-leading-newline&quot; \{\
-\M[\\$1]\h'1n'\v'+.5v'\D'P \\n(BWu 0 0 \\n(BHu -\\n(BWu 0 0 -\\n(BHu'\M[]
-.\}
-.el \{\
-\M[\\$1]\h'1n'\v'-.5v'\D'P \\n(BWu 0 0 \\n(BHu -\\n(BWu 0 0 -\\n(BHu'\M[]
-.\}
-.in 0
-.sp -.5v
-.nf
-.BX
-.in
-.sp .5v
-.fi
-.\}
-..
-.\&quot; ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
-.\&quot; BM/EM - put colored marker in margin next to block of text
-.\&quot; ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
-.de BM
-.if t \{\
-.br
-.ll -2n
-.gcolor red
-.di BX
-.\}
-..
-.de EM
-.if t \{\
-.br
-.di
-.ll
-.gcolor
-.nr BH \\n(dn
-.ne \\n(BHu
-\M[\\$1]\D'P -.75n 0 0 \\n(BHu -(\\n[.i]u - \\n(INu - .75n) 0 0 -\\n(BHu'\M[]
-.in 0
-.nf
-.BX
-.in
-.fi
-.\}
-..
+.TH &quot;KIWI::KIWIRC&quot; &quot;1&quot; &quot;Created: 07/29/2010&quot; &quot;&gt;KIWI 4\&amp;.51&quot; &quot;KIWI Manualpage&quot;
 .\&quot; -----------------------------------------------------------------
 .\&quot; * set default formatting
 .\&quot; -----------------------------------------------------------------
@@ -166,9 +18,9 @@
 .\&quot; -----------------------------------------------------------------
 .\&quot; * MAIN CONTENT STARTS HERE *
 .\&quot; -----------------------------------------------------------------
-.SH &quot;Name&quot;
+.SH &quot;NAME&quot;
 KIWI::kiwirc \- Resource file for the Kiwi imaging system
-.SH &quot;Description&quot;
+.SH &quot;DESCRIPTION&quot;
 .PP
 The Kiwi imaging toolchain supports the use of an optional resource file named \&amp;.kiwirc located in the users home directory\&amp;.
 .PP
@@ -179,31 +31,17 @@ The file is sourced by a Perl process and thus Perl compatible syntax for the su
 .if n \{\
 .RS 4
 .\}
-.fam C
-.ps -1
 .nf
-.if t \{\
-.sp -1
-.\}
-.BB lightgray adjust-for-leading-newline
-.sp -1
-
 $BasePath=\'/usr/share/kiwi\';
 $Gzip=\'bzip2\';
 $LogServerPort=\'4455\';
 $System=\'/usr/share/kiwi/image\';
     
-.EB lightgray adjust-for-leading-newline
-.if t \{\
-.sp 1
-.\}
 .fi
-.fam
-.ps +1
 .if n \{\
 .RE
 .\}
-.SH &quot;Supported resource settings&quot;
+.SH &quot;SUPPORTED RESOURCE SETTINGS&quot;
 .PP
 Kiwi recognizes the BasePath, Gzip, LogServerPort, LuksCipher, and System settings in the \&amp;.kiwirc file\&amp;.
 .PP
@@ -239,7 +77,7 @@ Specify the location of the Kiwi system image description\&amp;.
 .sp
 The default value is the value of BasePath concatenated with /image\&amp;.
 .RE
-.SH &quot;Author&quot;
+.SH &quot;AUTHOR&quot;
 .PP
 \fBRobert Schweikert\fR &lt;\&amp;rschweikert (AT) novell\&amp;.com\&amp;&gt;
 .RS 4
diff --git a/doc/kiwi-man/kiwi-man.xml b/doc/kiwi-man/kiwi-man.xml
index 70c2928..f499c96 100644
--- a/doc/kiwi-man/kiwi-man.xml
+++ b/doc/kiwi-man/kiwi-man.xml
@@ -120,6 +120,8 @@
         &lt;arg choice=&quot;plain&quot;&gt;-r&lt;/arg&gt;
         &lt;arg choice=&quot;plain&quot;&gt;--root&lt;/arg&gt;
         &lt;replaceable&gt;image-root&lt;/replaceable&gt;
+        &lt;arg choice=&quot;plain&quot;&gt;--chache&lt;/arg&gt;
+        &lt;replaceable&gt;directory&lt;/replaceable&gt;
       &lt;/group&gt;
     &lt;/cmdsynopsis&gt;
 
@@ -161,6 +163,7 @@
       &lt;/group&gt;
       &lt;arg choice=&quot;plain&quot;&gt;&lt;replaceable&gt;image-root&lt;/replaceable&gt;&lt;/arg&gt;
       &lt;arg choice=&quot;opt&quot;&gt;--add-package&lt;replaceable&gt;name&lt;/replaceable&gt;&lt;/arg&gt;
+      &lt;arg choice=&quot;opt&quot;&gt;--add-pattern&lt;replaceable&gt;name&lt;/replaceable&gt;&lt;/arg&gt;
     &lt;/cmdsynopsis&gt;
   &lt;/refsect1&gt;
 
@@ -594,6 +597,17 @@
   &lt;refsect1 id=&quot;kiwi.prepare.upgrade.options&quot;&gt;
     &lt;title&gt;Image Upgrade/Preparation Options&lt;/title&gt;
 	&lt;variablelist&gt;
+    &lt;varlistentry&gt;
+        &lt;term&gt;&lt;optional&gt;&lt;option&gt;--cache&lt;/option&gt; &lt;replaceable&gt;directory&lt;/replaceable&gt;
+        &lt;/optional&gt;&lt;/term&gt;
+        &lt;listitem&gt;
+        &lt;para&gt;
+            When specifying a cache directory kiwi will create a cache each for
+			patterns and packages and re-use them if possible for subsequent
+            root tree preparations of this and/or other images 
+        &lt;/para&gt;
+        &lt;/listitem&gt;
+    &lt;/varlistentry&gt;
 	&lt;varlistentry&gt;
 		&lt;term&gt;&lt;optional&gt;&lt;option&gt;--add-package&lt;/option&gt; &lt;replaceable&gt;package&lt;/replaceable&gt;
 		&lt;/optional&gt;&lt;/term&gt;
@@ -605,6 +619,18 @@
 		&lt;/para&gt;
 		&lt;/listitem&gt;
 	&lt;/varlistentry&gt;
+    &lt;varlistentry&gt;
+        &lt;term&gt;&lt;optional&gt;&lt;option&gt;--add-pattern&lt;/option&gt; &lt;replaceable&gt;name&lt;/replaceable&gt;
+        &lt;/optional&gt;&lt;/term&gt;
+        &lt;listitem&gt;
+        &lt;para&gt;
+            Add the given pattern name to the list of image packages
+            multiple --add-pattern options are possible. The change
+            will not be written to the xml description. Patterns can be handled
+            by SuSE based repositories only.
+        &lt;/para&gt;
+        &lt;/listitem&gt;
+    &lt;/varlistentry&gt;
 	&lt;varlistentry&gt;
 		&lt;term&gt;&lt;optional&gt;&lt;option&gt;--del-package&lt;/option&gt; &lt;replaceable&gt;package&lt;/replaceable&gt;
 		&lt;/optional&gt;&lt;/term&gt;
diff --git a/doc/kiwi-man/kiwi.1 b/doc/kiwi-man/kiwi.1
index 0713de6..7dcdffb 100644
--- a/doc/kiwi-man/kiwi.1
+++ b/doc/kiwi-man/kiwi.1
@@ -1,161 +1,13 @@
+'\&quot; t
 .\&quot;     Title: kiwi
 .\&quot;    Author: Marcus Schaefer &lt;ms (AT) suse.de&gt;
-.\&quot; Generator: DocBook XSL Stylesheets v1.74.0 &lt;<A HREF="http://docbook.sf.net/">http://docbook.sf.net/</A>&gt;
-.\&quot;      Date: Created: 07/26/2010
+.\&quot; Generator: DocBook XSL Stylesheets v1.75.2 &lt;<A HREF="http://docbook.sf.net/">http://docbook.sf.net/</A>&gt;
+.\&quot;      Date: Created: 07/29/2010
 .\&quot;    Manual: KIWI Manualpage
 .\&quot;    Source: KIWI 4.51
 .\&quot;  Language: English
 .\&quot;
-.TH &quot;KIWI&quot; &quot;1&quot; &quot;Created: 07/26/2010&quot; &quot;KIWI 4\&amp;.51&quot; &quot;KIWI Manualpage&quot;
-.\&quot; -----------------------------------------------------------------
-.\&quot; * (re)Define some macros
-.\&quot; -----------------------------------------------------------------
-.\&quot; ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
-.\&quot; toupper - uppercase a string (locale-aware)
-.\&quot; ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
-.de toupper
-.tr aAbBcCdDeEfFgGhHiIjJkKlLmMnNoOpPqQrRsStTuUvVwWxXyYzZ
-\\$*
-.tr aabbccddeeffgghhiijjkkllmmnnooppqqrrssttuuvvwwxxyyzz
-..
-.\&quot; ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
-.\&quot; SH-xref - format a cross-reference to an SH section
-.\&quot; ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
-.de SH-xref
-.ie n \{\
-.\}
-.toupper \\$*
-.el \{\
-\\$*
-.\}
-..
-.\&quot; ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
-.\&quot; SH - level-one heading that works better for non-TTY output
-.\&quot; ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
-.de1 SH
-.\&quot; put an extra blank line of space above the head in non-TTY output
-.if t \{\
-.sp 1
-.\}
-.sp \\n[PD]u
-.nr an-level 1
-.set-an-margin
-.nr an-prevailing-indent \\n[IN]
-.fi
-.in \\n[an-margin]u
-.ti 0
-.HTML-TAG &quot;.NH \\n[an-level]&quot;
-.it 1 an-trap
-.nr an-no-space-flag 1
-.nr an-break-flag 1
-\.&quot; make the size of the head bigger
-.ps +3
-.ft B
-.ne (2v + 1u)
-.ie n \{\
-.\&quot; if n (TTY output), use uppercase
-.toupper \\$*
-.\}
-.el \{\
-.nr an-break-flag 0
-.\&quot; if not n (not TTY), use normal case (not uppercase)
-\\$1
-.in \\n[an-margin]u
-.ti 0
-.\&quot; if not n (not TTY), put a border/line under subheading
-.sp -.6
-\l'\n(.lu'
-.\}
-..
-.\&quot; ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
-.\&quot; SS - level-two heading that works better for non-TTY output
-.\&quot; ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
-.de1 SS
-.sp \\n[PD]u
-.nr an-level 1
-.set-an-margin
-.nr an-prevailing-indent \\n[IN]
-.fi
-.in \\n[IN]u
-.ti \\n[SN]u
-.it 1 an-trap
-.nr an-no-space-flag 1
-.nr an-break-flag 1
-.ps \\n[PS-SS]u
-\.&quot; make the size of the head bigger
-.ps +2
-.ft B
-.ne (2v + 1u)
-.if \\n[.$] \&amp;\\$*
-..
-.\&quot; ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
-.\&quot; BB/BE - put background/screen (filled box) around block of text
-.\&quot; ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
-.de BB
-.if t \{\
-.sp -.5
-.br
-.in +2n
-.ll -2n
-.gcolor red
-.di BX
-.\}
-..
-.de EB
-.if t \{\
-.if &quot;\\$2&quot;adjust-for-leading-newline&quot; \{\
-.sp -1
-.\}
-.br
-.di
-.in
-.ll
-.gcolor
-.nr BW \\n(.lu-\\n(.i
-.nr BH \\n(dn+.5v
-.ne \\n(BHu+.5v
-.ie &quot;\\$2&quot;adjust-for-leading-newline&quot; \{\
-\M[\\$1]\h'1n'\v'+.5v'\D'P \\n(BWu 0 0 \\n(BHu -\\n(BWu 0 0 -\\n(BHu'\M[]
-.\}
-.el \{\
-\M[\\$1]\h'1n'\v'-.5v'\D'P \\n(BWu 0 0 \\n(BHu -\\n(BWu 0 0 -\\n(BHu'\M[]
-.\}
-.in 0
-.sp -.5v
-.nf
-.BX
-.in
-.sp .5v
-.fi
-.\}
-..
-.\&quot; ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
-.\&quot; BM/EM - put colored marker in margin next to block of text
-.\&quot; ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
-.de BM
-.if t \{\
-.br
-.ll -2n
-.gcolor red
-.di BX
-.\}
-..
-.de EM
-.if t \{\
-.br
-.di
-.ll
-.gcolor
-.nr BH \\n(dn
-.ne \\n(BHu
-\M[\\$1]\D'P -.75n 0 0 \\n(BHu -(\\n[.i]u - \\n(INu - .75n) 0 0 -\\n(BHu'\M[]
-.in 0
-.nf
-.BX
-.in
-.fi
-.\}
-..
+.TH &quot;KIWI&quot; &quot;1&quot; &quot;Created: 07/29/2010&quot; &quot;KIWI 4\&amp;.51&quot; &quot;KIWI Manualpage&quot;
 .\&quot; -----------------------------------------------------------------
 .\&quot; * set default formatting
 .\&quot; -----------------------------------------------------------------
@@ -166,121 +18,85 @@
 .\&quot; -----------------------------------------------------------------
 .\&quot; * MAIN CONTENT STARTS HERE *
 .\&quot; -----------------------------------------------------------------
-.SH &quot;Name&quot;
+.SH &quot;NAME&quot;
 kiwi \- Creating Operating System Images
-.SH &quot;Synopsis&quot;
-.fam C
+.SH &quot;SYNOPSIS&quot;
 .HP \w'\fBkiwi\fR\ 'u
 \fBkiwi\fR {\-l | \-\-list}
-.fam
-.fam C
 .HP \w'\fBkiwi\fR\ 'u
 \fBkiwi\fR {\-o | \-\-clone} \fIimage\-path\fR {\-d} \fIdestination\fR
-.fam
-.fam C
 .HP \w'\fBkiwi\fR\ 'u
 \fBkiwi\fR {\-b | \-\-build} \fIimage\-path\fR {\-d} \fIdestination\fR
-.fam
-.SH &quot;Basics&quot;
+.SH &quot;BASICS&quot;
 .PP
 KIWI is a complete imaging solution that is based on an image description\&amp;. Such a description is represented by a directory which includes at least one
-\FCconfig\&amp;.xml\F[]
+config\&amp;.xml
 file and may as well include other files like scripts or configuration data\&amp;. The kiwi\-templates package provides example descriptions based on a JeOS system\&amp;. JeOS means Just enough Operating System\&amp;. KIWI provides image templates based on that axiom which means a JeOS is a small, text only based image including a predefined remote source setup to allow installation of missing software components at a later point in time\&amp;.
 .PP
 Detailed description of the kiwi image system exists in the system design document in
 \m[blue]\fB\%<A HREF="file:///usr/share/doc/packages/kiwi/kiwi.pdf\fR\m[">file:///usr/share/doc/packages/kiwi/kiwi.pdf\fR\m[</A>]\&amp;. KIWI always operates in two steps\&amp;. The kiwi \-\-build option just combines both steps into one to make it easier to start with kiwi\&amp;. The first step is the preparation step and if that step was successful, a creation step follows which is able to create different image output types\&amp;. If you have started with an example and want to add you own changes it might be a good idea to clone of from this example\&amp;. This can be done by simply copying the entire image description or you can let kiwi do that for you by using the kiwi \-\-clone command\&amp;.
 .PP
 In the preparation step, you prepare a directory including the contents of your new filesystem based on one or more software package source(s) The creation step is based on the result of the preparation step and uses the contents of the new image root tree to create the output image\&amp;. If the image type ISO was requested, the output image would be a file with the suffix
-\FC\&amp;.iso\F[]
+\&amp;.iso
 representing a live system on CD or DVD\&amp;. Other than that kiwi is able to create images for virtual and para\-virtual (Xen) environments as well as for USB stick, PXE network clients and OEM customized Linux systems\&amp;.
-.SH &quot;Image Preparation and Creation&quot;
-.fam C
+.SH &quot;IMAGE PREPARATION AND CREATION&quot;
 .HP \w'\fBkiwi\fR\ 'u
 \fBkiwi\fR {\-p | \-\-prepare} \fIimage\-path\fR
 .br
-[\-r | \-\-root\fIimage\-root\fR]
-.fam
-.fam C
+[\-r | \-\-root\fIimage\-root\fR | \-\-chache\fIdirectory\fR]
 .HP \w'\fBkiwi\fR\ 'u
 \fBkiwi\fR {\-c | \-\-create} \fIimage\-root\fR
 .br
 {\-d | \-\-destdir\fIdestination\fR} [\-\-type\ \fIimage\-type\fR]
-.fam
-.SH &quot;Image Upgrade&quot;
+.SH &quot;IMAGE UPGRADE&quot;
 .PP
 If the image root tree is stored and not removed, it can be used for upgrading the image according to the changes made in the repositories used for this image\&amp;. If a distributor provides an update channel for package updates and an image
-\FCconfig\&amp;.xml\F[]
+config\&amp;.xml
 includes this update channel as repository, it is useful to store the image root tree and upgrade the tree according to changes on the update channel\&amp;. Given that the root tree exists it\'s also possible to add or remove software and recreate the image of the desired type
-.fam C
 .HP \w'\fBkiwi\fR\ 'u
-\fBkiwi\fR {\-u | \-\-upgrade} \fIimage\-root\fR [\-\-add\-package\fIname\fR]
-.fam
-.SH &quot;System to Image Migration&quot;
+\fBkiwi\fR {\-u | \-\-upgrade} \fIimage\-root\fR [\-\-add\-package\fIname\fR] [\-\-add\-pattern\fIname\fR]
+.SH &quot;SYSTEM TO IMAGE MIGRATION&quot;
 .PP
 The migration module allows you to migrate your currently running system into an image description\&amp;. The module will check for files not managed by a package manager and also inspects your system for package pattern and file consistency according to the currently active repositories\&amp;. The system requires the zypper backend in order to work properly\&amp;. The migration process creates a cache file so that subsequent calls of the migration runs much faster\&amp;. Please have in mind that if your system has changed (files created/deleted, etc) the cache file might not be worth to become reused\&amp;. In this case you should remove the cache first and start from scratch\&amp;. The option \-\-nofiles will prevent the system from searching for unpackaged and packaged but modified files The option \-\-notemplate will prevent the creation of the image description files which are needed if you want to use kiwi to create a clone image from the result of the migration\&amp;. With the options \-\-exclud
 e and \-\-skip you can tell the system to ignore specific directories and/or packages\&amp;. This makes sense if you know before that some data is not worth to become migrated or can be restored easily later inside the cloned image like software repositories\&amp;. The migration process will always place it\'s result into the /tmp/$OptionValueOf\-m directory\&amp;. The reason for this is because /tmp is always excluded from the migration operation and therefore we can safely place new files there without influencing the migration itself\&amp;. You should have at least 50 MB free space for the cache file and the image description all the rest are just hard links\&amp;. As one result a HTML based report file is created which contains important information about the system\&amp;. You are free to ignore that information but with the risk that the migrated image does not represent the same system which is running at the moment\&amp;. The less issues left in the report the better is the result\&amp;. In most cas
 es a manual fine tuning is required\&amp;. This includes the repository selection and the unmanaged files along with the configuration details of your currently running operating system\&amp;. You should understand the module as a helper to migrate running servers into images\&amp;. The implementation is still under construction so expect better migration results in future releases :)
-.fam C
 .HP \w'\fBkiwi\fR\ 'u
 \fBkiwi\fR {\-m | \-\-migrate} \fIname\fR [\-\-exclude\ \fIdirectory\fR...] [\-\-skip\ \fIpackage\fR...] [\-\-nofiles] [\-\-notemplate]
-.fam
-.SH &quot;Image Postprocessing Modes&quot;
+.SH &quot;IMAGE POSTPROCESSING MODES&quot;
 .PP
 The KIWI post\-processing modes are used for special image deployment tasks, like installing the image on a USB stick\&amp;. So to say they are the third step after preparation and creation\&amp;. kiwi calls the postprocessing modules automatically according to the specified output image type and attributes but it\'s also possible to call them manually\&amp;.
-.fam C
 .HP \w'\fBkiwi\fR\ 'u
 \fBkiwi\fR \-\-bootstick\ \fIinitrd\fR [\-\-bootstick\-system\ \fIsystemImage\fR] [\-\-bootstick\-device\ \fIdevice\fR]
-.fam
-.fam C
 .HP \w'\fBkiwi\fR\ 'u
 \fBkiwi\fR \-\-bootvm\ \fIinitrd\fR \-\-bootvm\-system\ \fIsystemImage\fR [\-\-bootvm\-disksize\ \fIsize\fR]
-.fam
-.fam C
 .HP \w'\fBkiwi\fR\ 'u
 \fBkiwi\fR \-\-bootcd\ \fIinitrd\fR
-.fam
-.fam C
 .HP \w'\fBkiwi\fR\ 'u
 \fBkiwi\fR \-\-installcd\ \fIinitrd\fR \-\-installcd\-system\ \fIvmx\-system\-image\fR
-.fam
-.fam C
 .HP \w'\fBkiwi\fR\ 'u
 \fBkiwi\fR \-\-installstick\ \fIinitrd\fR \-\-installstick\-system\ \fIvmx\-system\-image\fR
-.fam
-.SH &quot;Image format conversion&quot;
+.SH &quot;IMAGE FORMAT CONVERSION&quot;
 .PP
 The KIWI format conversion is useful to perform the creation of another image output format like vmdk for VMware or ovf the open virtual machine format\&amp;. Along with the conversion kiwi also creates the virtual machine configuration according to the format if there is a machine section specified in the xml description
-.fam C
 .HP \w'\fBkiwi\fR\ 'u
 \fBkiwi\fR \-\-convert\ \fIsystemImage\fR [\-\-format\ \fIvmdk|ovf|qcow2\fR]
-.fam
-.SH &quot;Testsuite&quot;
+.SH &quot;TESTSUITE&quot;
 .PP
 The KIWI test suite is useful to perform basic quality checks on the image root directory\&amp;. The test cases are stored in subdirectories below
-\FC/usr/share/kiwi/tests\F[]\&amp;.
-.fam C
+/usr/share/kiwi/tests\&amp;.
 .HP \w'\fBkiwi\fR\ 'u
 \fBkiwi\fR \-\-testsuite\ \fIimage\-root\fR [\-\-test\ \fIname\fR...]
-.fam
-.SH &quot;Helper Tools&quot;
+.SH &quot;HELPER TOOLS&quot;
 .PP
 The helper tools provide optional functions like creating a crypted password string for the users section of the
-\FCconfig\&amp;.xml\F[]
+config\&amp;.xml
 file or signing the image description with an md5sum hash as well as adding splash data to the boot image used by the bootloader and the testsuite mode which allows testing the integrity of the new root tree\&amp;.
-.fam C
 .HP \w'\fBkiwi\fR\ 'u
 \fBkiwi\fR \-\-createpassword
-.fam
-.fam C
 .HP \w'\fBkiwi\fR\ 'u
 \fBkiwi\fR \-\-createhash\ \fIimage\-path\fR
-.fam
-.fam C
 .HP \w'\fBkiwi\fR\ 'u
 \fBkiwi\fR {\-i | \-\-info} \fIImagePath\fR {\-\-select\ \fI\ repo\-patterns|patterns|types|sources|size|profiles|packages\ \fR}
-.fam
-.fam C
 .HP \w'\fBkiwi\fR\ 'u
 \fBkiwi\fR \-\-setup\-splash\ \fIinitrd\fR
-.fam
 .PP
 The following list describes the helper tools more detailed
 .PP
@@ -292,7 +108,7 @@ Create a crypted password hash and prints it on the console\&amp;. The user can use
 [\fB\-\-createhash \fR\fB\fIimage\-path\fR\fR ]
 .RS 4
 Sign your image description with a md5sum\&amp;. The result is written to a file named
-\FC\&amp;.checksum\&amp;.md\F[]
+\&amp;.checksum\&amp;.md
 and is checked if kiwi creates an image from this description
 .RE
 .PP
@@ -312,7 +128,7 @@ List general information about the image description\&amp;. So far you can get infor
 .RS 4
 Create splash screen from the data inside the initrd and re\-create the initrd with the splash screen attached to the initrd cpio archive\&amp;. This enables the kernel to load the splash screen at boot time\&amp;. If splashy is used only a link to the original initrd will be created
 .RE
-.SH &quot;Global Options&quot;
+.SH &quot;GLOBAL OPTIONS&quot;
 .PP
 [\fB\-\-base\-root\fR \fIbase\-path\fR]
 .RS 4
@@ -354,7 +170,7 @@ Set/Overwrite priority for the first listed repo\&amp;. Works with the smart package
 Add the given repository and type for this run of an image prepare or upgrade process\&amp;. Multiple
 \fB\-\-add\-repo\fR/\fB\-\-add\-repotype\fR
 options are possible\&amp;. The change will not be written to the
-\FCconfig\&amp;.xml\F[]
+config\&amp;.xml
 file
 .RE
 .PP
@@ -403,14 +219,14 @@ Prints a stack trace in case of internal errors
 .RS 4
 Controls the verbosity level for the instsource module
 .RE
-.SH &quot;Image Preparation Options&quot;
+.SH &quot;IMAGE PREPARATION OPTIONS&quot;
 .PP
 [\fB\-r\fR | \fB\-\-root \fR\fB\fIRootPath\fR\fR]
 .RS 4
 Set up the physical extend, chroot system below the given root\-path path\&amp;. If no
 \fB\-\-root\fR
 option is given, KIWI will search for the attribute defaultroot in
-\FCconfig\&amp;.xml\F[]\&amp;. If no root directory is known, a
+config\&amp;.xml\&amp;. If no root directory is known, a
 \fBmktmp\fR
 directory will be created and used as root directory\&amp;.
 .RE
@@ -419,18 +235,28 @@ directory will be created and used as root directory\&amp;.
 .RS 4
 Force creation of new root directory\&amp;. If the directory already exists, it is deleted\&amp;.
 .RE
-.SH &quot;Image Upgrade/Preparation Options&quot;
+.SH &quot;IMAGE UPGRADE/PREPARATION OPTIONS&quot;
+.PP
+[\fB\-\-cache\fR \fIdirectory\fR ]
+.RS 4
+When specifying a cache directory kiwi will create a cache each for patterns and packages and re\-use them if possible for subsequent root tree preparations of this and/or other images
+.RE
 .PP
 [\fB\-\-add\-package\fR \fIpackage\fR ]
 .RS 4
 Add the given package name to the list of image packages multiple \-\-add\-package options are possible\&amp;. The change will not be written to the xml description\&amp;.
 .RE
 .PP
+[\fB\-\-add\-pattern\fR \fIname\fR ]
+.RS 4
+Add the given pattern name to the list of image packages multiple \-\-add\-pattern options are possible\&amp;. The change will not be written to the xml description\&amp;. Patterns can be handled by SuSE based repositories only\&amp;.
+.RE
+.PP
 [\fB\-\-del\-package\fR \fIpackage\fR ]
 .RS 4
 Removes the given package by adding it the list of packages to become removed\&amp;. The change will not be written to the xml description\&amp;.
 .RE
-.SH &quot;Image Creation Options&quot;
+.SH &quot;IMAGE CREATION OPTIONS&quot;
 .PP
 [\fB\-d\fR | \fB\-\-destdir \fR\fB\fIDestinationPath\fR\fR]
 .RS 4
@@ -439,7 +265,7 @@ Specify destination directory to store the image file(s) If not specified, KIWI
 which can be specified in the
 \fIpreferences\fR
 section of the
-\FCconfig\&amp;.xml\F[]
+config\&amp;.xml
 file\&amp;. If it exists its value is used as destination directory\&amp;. If no destination information can be found, an error occurs\&amp;.
 .RE
 .PP
@@ -448,7 +274,7 @@ file\&amp;. If it exists its value is used as destination directory\&amp;. If no destina
 Specify the output image type to use for this image\&amp;. Each type is described in a
 \fItype\fR
 section of the preferences section\&amp;. At least one type has to be specified in the
-\FCconfig\&amp;.xml\F[]
+config\&amp;.xml
 description\&amp;. By default, the types specifying the
 \fIprimary\fR
 attribute will be used\&amp;. If there is no primary attribute set, the first type section of the preferences section is the primary type\&amp;. The types are only evaluated when kiwi runs the
@@ -456,7 +282,7 @@ attribute will be used\&amp;. If there is no primary attribute set, the first type s
 step\&amp;. With the option
 \fB\-\-type\fR
 one can distinguish between the types stored in
-\FCconfig\&amp;.xml\F[]
+config\&amp;.xml
 .RE
 .PP
 [\fB\-s\fR | \fB\-\-strip\fR]
@@ -521,7 +347,7 @@ Select the tool to create partition tables\&amp;. Supported are fdisk (sfdisk) and p
 .RS 4
 Activates check for matching kernels between boot and system image\&amp;. The kernel check also tries to fix the boot image if no matching kernel was found\&amp;.
 .RE
-.SH &quot;For More Information&quot;
+.SH &quot;FOR MORE INFORMATION&quot;
 .PP
 More information about KIWI, its files can be found at:
 .PP
@@ -530,7 +356,7 @@ More information about KIWI, its files can be found at:
 KIWI wiki
 .RE
 .PP
-\FCconfig\&amp;.xml\F[]
+config\&amp;.xml
 .RS 4
 The configuration XML file that contains every aspect for the image creation\&amp;.
 .RE
@@ -549,7 +375,7 @@ The KIWI RelaxNG XML Schema documentation\&amp;.
 .RS 4
 The KIWI RelaxNG XML Schema documentation\&amp;.
 .RE
-.SH &quot;Author&quot;
+.SH &quot;AUTHOR&quot;
 .PP
 \fBMarcus Schaefer\fR &lt;\&amp;ms (AT) suse\&amp;.de\&amp;&gt;
 .RS 4
diff --git a/doc/kiwi.pdf b/doc/kiwi.pdf
index 8f108e8..09da514 100644
Binary files a/doc/kiwi.pdf and b/doc/kiwi.pdf differ
diff --git a/kiwi.pl b/kiwi.pl
index a0d553c..d3a5f53 100755
--- a/kiwi.pl
+++ b/kiwi.pl
@@ -168,6 +168,8 @@ our @AddRepositoryType;     # add repository type
 our @AddRepositoryAlias;    # alias name for the repository
 our @AddRepositoryPriority; # priority for the repository
 our @AddPackage;            # add packages to the image package list
+our @AddPattern;            # add patterns to the image package list
+our $ImageCache;            # build an image cache for later re-use
 our @RemovePackage;         # remove package by adding them to the remove list
 our $IgnoreRepos;           # ignore repositories specified so far
 our $SetRepository;         # set first repository for building physical extend
@@ -368,6 +370,9 @@ sub main {
 	# Prepare image and build chroot system
 	#----------------------------------------
 	if (defined $Prepare) {
+		#==========================================
+		# Process system image description
+		#------------------------------------------
 		$kiwi -&gt; info (&quot;Reading image description [Prepare]...\n&quot;);
 		my $xml = new KIWIXML ( $kiwi,$Prepare,\%ForeignRepo,undef,\@Profiles );
 		if (! defined $xml) {
@@ -377,10 +382,220 @@ sub main {
 			$kiwi -&gt; warning (&quot;Description provides no MD5 hash, check&quot;);
 			$kiwi -&gt; skipped ();
 		}
+		my %type = %{$xml-&gt;getImageTypeAndAttributes()};
+		#==========================================
+		# Setup image cache if requested (1)
+		#------------------------------------------
+		my $CacheDistro;   # cache base name
+		my @CachePatterns; # image patterns building the cache
+		my @CachePackages; # image packages building the cache
+		my $CacheScan;     # image scan, for cache package check
+		my %Cache;         # valid caches
+		if ($ImageCache) {
+			$kiwi -&gt; info (&quot;Setting up image pattern cache\n&quot;);
+			#==========================================
+			# Check if we have boot type for the cname
+			#------------------------------------------
+			if ($type{boot} =~ /.*\/(.*)/) {
+				$CacheDistro = $1;
+			} else {
+				$kiwi -&gt; warning (&quot;Can't setup cache without a boot type&quot;);
+				$kiwi -&gt; skipped ();
+				undef $ImageCache;
+			}
+			#==========================================
+			# Check for cachable patterns
+			#------------------------------------------
+			my @sections = (&quot;bootstrap&quot;,&quot;image&quot;);
+			foreach my $section (@sections) {
+				my @list = $xml -&gt; getList ($section);
+				foreach my $pac (@list) {
+					if ($pac =~ /^pattern:(.*)/) {
+						push @CachePatterns,$1;
+					} elsif ($pac =~ /^product:(.*)/) {
+						# no cache for products at the moment
+					} else {
+						push @CachePackages,$pac;
+					}
+				}
+			}
+			if (! @CachePatterns) {
+				$kiwi -&gt; warning (&quot;No cachable patterns used in this image&quot;);
+				$kiwi -&gt; skipped ();
+				undef $ImageCache;
+			}
+			#==========================================
+			# Create image package list
+			#------------------------------------------
+			$listXMLInfo = $Prepare;
+			@listXMLInfoSelection = (&quot;packages&quot;);
+			$CacheScan = listXMLInfo (&quot;internal&quot;);
+			if (! $CacheScan) {
+				undef $ImageCache;
+			}
+			undef $listXMLInfo;
+			undef @listXMLInfoSelection;
+		}
+		#==========================================
+		# Setup image cache if requested (2)
+		#------------------------------------------
+		if ($ImageCache) {
+			my $haveCache = 0;
+			my %plist = ();
+			#==========================================
+			# Search for a suitable cache
+			#------------------------------------------
+			my @packages = $CacheScan -&gt; getElementsByTagName (&quot;package&quot;);
+			foreach my $node (@packages) {
+				my $name = $node -&gt; getAttribute (&quot;name&quot;);
+				my $arch = $node -&gt; getAttribute (&quot;arch&quot;);
+				my $pver = $node -&gt; getAttribute (&quot;version&quot;);
+				$plist{&quot;$name-$pver.$arch&quot;} = $name;
+			}
+			my $pcnt = keys %plist;
+			my @file = ();
+			#==========================================
+			# setup cache file names...
+			#------------------------------------------
+			if (@CachePackages) {
+				my $cstr = $xml -&gt; getImageName();
+				my $cdir = $ImageCache.&quot;/&quot;.$CacheDistro.&quot;-&quot;.$cstr;
+				push @file,$cdir;
+			}
+			foreach my $pattern (@CachePatterns) {
+				my $cdir = $ImageCache.&quot;/&quot;.$CacheDistro.&quot;-&quot;.$pattern;
+				push @file,$cdir;
+			}
+			#==========================================
+			# walk through cache files
+			#------------------------------------------
+			foreach my $cdir (@file) {
+				#==========================================
+				# check cache files
+				#------------------------------------------
+				my $meta = $cdir.&quot;.cache&quot;;
+				my $CACHE_FD;
+				if ((! -d $cdir) || (! open ($CACHE_FD,$meta))) {
+					next;
+				}
+				#==========================================
+				# read cache file
+				#------------------------------------------
+				my @cpac = &lt;$CACHE_FD&gt;; chomp @cpac;
+				my $ccnt = @cpac; close $CACHE_FD;
+				$kiwi -&gt; loginfo (
+					&quot;Cache: $cdir $ccnt packages, Image: $pcnt packages\n&quot;
+				);
+				#==========================================
+				# check validity of cache
+				#------------------------------------------
+				my $invalid = 0;
+				if ($ccnt &gt; $pcnt) {
+					# cache is bigger than image solved list
+					$invalid = 1;
+				} else {
+					foreach my $p (@cpac) {
+						if (! defined $plist{$p}) {
+							# cache package not part of image solved list
+							$kiwi -&gt; loginfo (
+								&quot;Cache: $cdir $p not in image list\n&quot;
+							); 
+							$invalid = 1; last; 
+						}
+					}
+				}
+				#==========================================
+				# store valid cache
+				#------------------------------------------
+				if (! $invalid) {
+					$Cache{$cdir} = int (100 * ($ccnt / $pcnt));
+					$haveCache = 1;
+				}
+			}
+			#==========================================
+			# Use/select cache if possible
+			#------------------------------------------
+			if ($haveCache) {
+				my $max = 0;
+				#==========================================
+				# Find best match
+				#------------------------------------------
+				foreach my $cdir (keys %Cache) {
+					if ($Cache{$cdir} &gt; $max) {
+						$max = $Cache{$cdir};
+					}
+				}
+				#==========================================
+				# Setup overlay for best match
+				#------------------------------------------
+				foreach my $cdir (keys %Cache) {
+					if ($Cache{$cdir} == $max) {
+						$kiwi -&gt; info (&quot;Using cache overlay [ $max% ]: $cdir&quot;);
+						$BaseRoot = $cdir;
+						$BaseRootMode = &quot;copy&quot;;
+						$kiwi -&gt; done();
+						last;
+					}
+				}
+			}
+			#==========================================
+			# Build cache if no cache was found
+			#------------------------------------------
+			if (! $haveCache) {
+				qxx (&quot;mkdir -p $ImageCache 2&gt;&amp;1&quot;);
+				my $backupPrepare      = $main::Prepare;
+				my $backupRootTree     = $main::RootTree;
+				my $backupForceNewRoot = $main::ForceNewRoot;
+				my @backupPatterns     = @main::AddPattern;
+				my @backupPackages     = @main::AddPackage;
+				my $imageCacheDir      = $ImageCache;
+				undef $ImageCache;
+				if (! defined $LogFile) {
+					$kiwi -&gt; setRootLog (
+						$main::RootTree.&quot;.&quot;.&quot;$$&quot;.&quot;.screenrc.log&quot;
+					);
+				}
+				if (@CachePackages) {
+					push @CachePatterns,&quot;package-cache&quot;
+				}
+				foreach my $pattern (@CachePatterns) {
+					if ($pattern eq &quot;package-cache&quot;) {
+						$pattern = $xml -&gt; getImageName();
+						push @CachePackages,$xml-&gt;getPackageManager();
+						undef @main::AddPattern;
+						@main::AddPackage = @CachePackages;
+					} else {
+						@main::AddPackage = $xml-&gt;getPackageManager();
+						@main::AddPattern = $pattern;
+					}
+					$kiwi -&gt; info (
+						&quot;--&gt; Building cache file for pattern: $pattern\n&quot;
+					);
+					$main::Prepare      = $BasePath.&quot;/modules&quot;;
+					$main::RootTree     = $imageCacheDir.&quot;/&quot;;
+					$main::RootTree    .= $CacheDistro.&quot;-&quot;.$pattern;
+					$main::Survive      = &quot;yes&quot;;
+					$main::ForceNewRoot = 1;
+					if (! defined main::main()) {
+						$main::Survive = &quot;default&quot;;
+						my $code = kiwiExit (1); return $code;
+					}
+					my $meta   = $main::RootTree.&quot;.cache&quot;;
+					my $root   = $main::RootTree;
+					my $ignore = &quot;'gpg-pubkey|bundle-lang'&quot;;
+					qxx (&quot;rpm --root $root -qa | grep -vE $ignore &gt; $meta&quot;);
+				}
+				$main::Prepare      = $backupPrepare;
+				$main::ForceNewRoot = $backupForceNewRoot;
+				@main::AddPattern   = @backupPatterns;
+				@main::AddPackage   = @backupPackages;
+				$main::RootTree     = $backupRootTree;
+				$main::Survive      = &quot;default&quot;;
+			}
+		}
 		#==========================================
 		# Check for bootprofile in xml descr.
 		#------------------------------------------
-		my %type = %{$xml-&gt;getImageTypeAndAttributes()};
 		if (! @Profiles) {
 			if ($type{&quot;type&quot;} eq &quot;cpio&quot;) {
 				if ($type{bootprofile}) {
@@ -481,6 +696,12 @@ sub main {
 			$xml -&gt; addImagePackages (@AddPackage);
 		}
 		#==========================================
+		# Check for add-pattern option
+		#------------------------------------------
+		if (defined @AddPattern) {
+			$xml -&gt; addImagePatterns (@AddPattern);
+		}
+		#==========================================
 		# Check for del-package option
 		#------------------------------------------
 		if (defined @RemovePackage) {
@@ -1332,6 +1553,8 @@ sub init {
 		&quot;add-repoalias=s&quot;       =&gt; \@AddRepositoryAlias,
 		&quot;add-repopriority=i&quot;    =&gt; \@AddRepositoryPriority,
 		&quot;add-package=s&quot;         =&gt; \@AddPackage,
+		&quot;add-pattern=s&quot;         =&gt; \@AddPattern,
+		&quot;cache=s&quot;               =&gt; \$ImageCache,
 		&quot;del-package=s&quot;         =&gt; \@RemovePackage,
 		&quot;set-repo=s&quot;            =&gt; \$SetRepository,
 		&quot;set-repotype=s&quot;        =&gt; \$SetRepositoryType,
@@ -1569,12 +1792,12 @@ sub usage {
 	print &quot;    kiwi -b | --build &lt;image-path&gt; -d &lt;destination&gt;\n&quot;;
 	print &quot;Image Preparation/Creation in two steps:\n&quot;;
 	print &quot;    kiwi -p | --prepare &lt;image-path&gt;\n&quot;;
-	print &quot;       [ --root &lt;image-root&gt; ]\n&quot;;
+	print &quot;       [ --root &lt;image-root&gt; --cache &lt;dir&gt; ]\n&quot;;
 	print &quot;    kiwi -c | --create  &lt;image-root&gt; -d &lt;destination&gt;\n&quot;;
 	print &quot;       [ --type &lt;image-type&gt; ]\n&quot;;
 	print &quot;Image Upgrade:\n&quot;;
 	print &quot;    kiwi -u | --upgrade &lt;image-root&gt;\n&quot;;
-	print &quot;       [ --add-package &lt;name&gt; ]\n&quot;;
+	print &quot;       [ --add-package &lt;name&gt; --add-pattern &lt;name&gt; ]\n&quot;;
 	print &quot;System to Image migration:\n&quot;;
 	print &quot;    kiwi -m | --migrate &lt;name&gt;\n&quot;;
 	print &quot;       [ --exclude &lt;directory&gt; --exclude &lt;...&gt; ]\n&quot;;
@@ -1676,6 +1899,9 @@ sub usage {
 	print &quot;    [ --add-package &lt;package&gt; ]\n&quot;;
 	print &quot;      Adds the given package name to the list of image packages.\n&quot;;
 	print &quot;\n&quot;;
+	print &quot;    [ --add-pattern &lt;name&gt; ]\n&quot;;
+	print &quot;      Adds the given pattern name to the list of image patters.\n&quot;;
+	print &quot;\n&quot;;
 	print &quot;    [ --del-package &lt;package&gt; ]\n&quot;;
 	print &quot;      Removes the given package by adding it the list of packages\n&quot;;
 	print &quot;      to become removed.\n&quot;;
@@ -1780,6 +2006,7 @@ sub listXMLInfo {
 	# information listed here is for information only
 	# before a prepare and/or create command is called
 	# ---
+	my $internal = shift;
 	my %select;
 	my $gotselection = 0;
 	my $meta;
@@ -1852,7 +2079,7 @@ sub listXMLInfo {
 	#==========================================
 	# Setup loop sources
 	#------------------------------------------
-	my @mountlist = ();
+	my @mountInfolist = ();
 	if ($xml-&gt;{urlhash}) {
 		foreach my $source (keys %{$xml-&gt;{urlhash}}) {
 			#==========================================
@@ -1870,7 +2097,7 @@ sub listXMLInfo {
 					rmdir $dir;
 					exit 1;
 				}
-				push (@mountlist,$dir);
+				push (@mountInfolist,$dir);
 			}
 		}
 	}
@@ -1883,7 +2110,7 @@ sub listXMLInfo {
 			}
 		}
 	}
-	*cleanMount = newCleanMount (@mountlist);
+	*cleanInfoMount = newCleanMount (@mountInfolist);
 	#==========================================
 	# Initialize XML imagescan element
 	#------------------------------------------
@@ -1902,7 +2129,7 @@ sub listXMLInfo {
 						$xml-&gt;getInstallSize();
 					if (! $meta) {
 						$kiwi -&gt; failed();
-						cleanMount();
+						cleanInfoMount();
 						exit 1;
 					}
 				}
@@ -1929,7 +2156,7 @@ sub listXMLInfo {
 						$xml-&gt;getInstallSize();
 					if (! $meta) {
 						$kiwi -&gt; failed();
-						cleanMount();
+						cleanInfoMount();
 						exit 1;
 					}
 				}
@@ -1983,7 +2210,7 @@ sub listXMLInfo {
 						$xml-&gt;getInstallSize();
 					if (! $meta) {
 						$kiwi -&gt; failed();
-						cleanMount();
+						cleanInfoMount();
 						exit 1;
 					}
 				}
@@ -2021,7 +2248,7 @@ sub listXMLInfo {
 						$xml-&gt;getInstallSize();
 					if (! $meta) {
 						$kiwi -&gt; failed();
-						cleanMount();
+						cleanInfoMount();
 						exit 1;
 					}
 				}
@@ -2066,14 +2293,18 @@ sub listXMLInfo {
 	#==========================================
 	# Cleanup mount list
 	#------------------------------------------
-	cleanMount();
+	cleanInfoMount();
 	#==========================================
 	# print scan results
 	#------------------------------------------
-	open (my $F, &quot;|xsltproc $main::Pretty -&quot;);
-	print $F $scan-&gt;toString();
-	close $F;
-	exit 0;
+	if ($internal) {
+		return $scan;
+	} else {
+		open (my $F, &quot;|xsltproc $main::Pretty -&quot;);
+		print $F $scan-&gt;toString();
+		close $F;
+		exit 0;
+	}
 }
 
 #==========================================
diff --git a/modules/KIWICache.kiwi b/modules/KIWICache.kiwi
new file mode 100644
index 0000000..7619a3c
--- /dev/null
+++ b/modules/KIWICache.kiwi
@@ -0,0 +1,27 @@
+&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
+
+&lt;image schemaversion=&quot;4.7&quot; name=&quot;cache-builder&quot;&gt;
+	&lt;description type=&quot;system&quot;&gt;
+		&lt;author&gt;Marcus Sch&#195;&#164;fer&lt;/author&gt;
+		&lt;contact&gt;<A HREF="https://lists.berlios.de/mailman/listinfo/kiwi-devel">ms at novell.com</A>&lt;/contact&gt;
+		&lt;specification&gt;
+			cache template for building pattern based caches
+		&lt;/specification&gt;
+	&lt;/description&gt;
+	&lt;preferences&gt;
+		&lt;type image=&quot;ext2&quot;/&gt;
+		&lt;version&gt;1.1.1&lt;/version&gt;
+		&lt;packagemanager&gt;zypper&lt;/packagemanager&gt;
+		&lt;rpm-excludedocs&gt;true&lt;/rpm-excludedocs&gt;
+	&lt;/preferences&gt;
+	&lt;repository type=&quot;yast2&quot;&gt;
+		&lt;source path=&quot;some-repo-path&quot;/&gt;
+	&lt;/repository&gt;
+	&lt;packages type=&quot;image&quot;&gt;
+		&lt;!-- patterns for building the cache are added on the fly here --&gt;
+	&lt;/packages&gt;
+	&lt;packages type=&quot;bootstrap&quot;&gt;
+		&lt;package name=&quot;filesystem&quot;/&gt;
+		&lt;package name=&quot;glibc-locale&quot;/&gt;
+	&lt;/packages&gt;
+&lt;/image&gt;
diff --git a/modules/KIWIRoot.pm b/modules/KIWIRoot.pm
index 6e58974..cf00960 100644
--- a/modules/KIWIRoot.pm
+++ b/modules/KIWIRoot.pm
@@ -1057,6 +1057,11 @@ sub setupCacheMount {
 		qxx (&quot;mount --bind $cache $root/$cache 2&gt;&amp;1&quot;);
 		push (@mountList,&quot;$root/$cache&quot;);
 	}
+	if (! -f &quot;$root/proc/mounts&quot;) {
+		qxx (&quot;mkdir -p $root/proc&quot;);
+		qxx (&quot;mount -t proc proc $root/proc&quot;);
+		push (@mountList,&quot;$root/proc&quot;);
+	}
 	$this-&gt;{mountList} = \@mountList;
 	return @mountList;
 }
diff --git a/modules/KIWIXML.pm b/modules/KIWIXML.pm
index f14e19e..3aaf659 100644
--- a/modules/KIWIXML.pm
+++ b/modules/KIWIXML.pm
@@ -2388,6 +2388,42 @@ sub addPackages {
 }
 
 #==========================================
+# addPatterns
+#------------------------------------------
+sub addPatterns {
+	# ...
+	# Add the given pattern list to the specified packages
+	# type section of the xml description parse tree.
+	# ----
+	my $this  = shift;
+	my $ptype = shift;
+	my $nodes = shift;
+	my @patts = @_;
+	if (! defined $nodes) {
+		$nodes = $this-&gt;{packageNodeList};
+	}
+	my $nodeNumber = 1;
+	for (my $i=1;$i&lt;= $nodes-&gt;size();$i++) {
+		my $node = $nodes -&gt; get_node($i);
+		my $type = $node  -&gt; getAttribute (&quot;type&quot;);
+		if (! $this -&gt; requestedProfile ($node)) {
+			next;
+		}
+		if ($type eq $ptype) {
+			$nodeNumber = $i; last;
+		}
+	}
+	foreach my $pack (@patts) {
+		my $addElement = new XML::LibXML::Element (&quot;opensusePattern&quot;);
+		$addElement -&gt; setAttribute(&quot;name&quot;,$pack);
+		$nodes -&gt; get_node($nodeNumber)
+			-&gt; appendChild ($addElement);
+	}
+	$this -&gt; updateXML();
+	return $this;
+}
+
+#==========================================
 # addArchives
 #------------------------------------------
 sub addArchives {
@@ -2437,6 +2473,18 @@ sub addImagePackages {
 }
 
 #==========================================
+# addImagePatterns
+#------------------------------------------
+sub addImagePatterns {
+	# ...
+	# Add the given pattern list to the type=bootstrap packages
+	# section of the xml description parse tree.
+	# ----
+	my $this  = shift;
+	return $this -&gt; addPatterns (&quot;bootstrap&quot;<A HREF="https://lists.berlios.de/mailman/listinfo/kiwi-devel">,undef, at _</A>);
+}
+
+#==========================================
 # addRemovePackages
 #------------------------------------------
 sub addRemovePackages {
diff --git a/rpm/kiwi.changes b/rpm/kiwi.changes
index 79312d9..2b1237e 100644
--- a/rpm/kiwi.changes
+++ b/rpm/kiwi.changes
@@ -1,6 +1,13 @@
 -------------------------------------------------------------------
 Tue Jul 27 07:23:38 CEST 2010 - <A HREF="https://lists.berlios.de/mailman/listinfo/kiwi-devel">ms at suse.de</A>
 
+- added support for image caching. With this feature you can
+  provide a cache directory along with the option --cache.
+  kiwi in prepare step looks into the directory if it finds
+  a cache serving as the base-root for the system image.
+  If it can't find one it creates caches based on the
+  patterns used in the image description which speeds
+  up subsequent prepare calls for this and other images
 - fixed PARTED_VER setup and tests. If the parted version
   is below or equal 1.8.8 we switch to fdisk. This applies for
   sle10 where parted doesn't have some options which we require


hooks/post-receive
-- 
Project kiwi at BerliOS

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002459.html">[Kiwi-devel] [Git]Project kiwi at BerliOS branch,	KIWI-443-SuSE-11-3-Devel,	updated. a9759804becd13d77f1e2df1fc8a989fc74192f1
</A></li>
	<LI>Next message: <A HREF="002461.html">[Kiwi-devel] [Git]Project kiwi at BerliOS branch, master,	updated. bd67d7de922aec169b935ab284c28e778723ebfd
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2460">[ date ]</a>
              <a href="thread.html#2460">[ thread ]</a>
              <a href="subject.html#2460">[ subject ]</a>
              <a href="author.html#2460">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/kiwi-devel">More information about the Kiwi-devel
mailing list</a><br>
</body></html>

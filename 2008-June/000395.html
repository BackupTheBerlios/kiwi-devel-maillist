<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Kiwi-devel] [SVN:KIWI-Team] r1303 - in kiwi-head: doc/kiwi-man	modules rpm system/boot/isoboot/suse-10.1	system/boot/isoboot/suse-10.2 system/boot/isoboot/suse-10.3	system/boot/isoboot/suse-11.0 system/boot/isoboot/suse-SLED10	system/boot/isoboot/suse-SLED10-SP1 system/boot/isoboot/suse-SLES10	system/boot/isoboot/suse-SLES10-SP1
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/kiwi-devel/2008-June/index.html" >
   <LINK REL="made" HREF="mailto:kiwi-devel%40lists.berlios.de?Subject=Re%3A%20%5BKiwi-devel%5D%20%5BSVN%3AKIWI-Team%5D%20r1303%20-%20in%20kiwi-head%3A%20doc/kiwi-man%0A%09modules%20rpm%20system/boot/isoboot/suse-10.1%0A%09system/boot/isoboot/suse-10.2%20system/boot/isoboot/suse-10.3%0A%09system/boot/isoboot/suse-11.0%20system/boot/isoboot/suse-SLED10%0A%09system/boot/isoboot/suse-SLED10-SP1%20system/boot/isoboot/suse-SLES10%0A%09system/boot/isoboot/suse-SLES10-SP1&In-Reply-To=%3C200806031010.m53AASZA004896%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   
   <LINK REL="Next"  HREF="000396.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Kiwi-devel] [SVN:KIWI-Team] r1303 - in kiwi-head: doc/kiwi-man	modules rpm system/boot/isoboot/suse-10.1	system/boot/isoboot/suse-10.2 system/boot/isoboot/suse-10.3	system/boot/isoboot/suse-11.0 system/boot/isoboot/suse-SLED10	system/boot/isoboot/suse-SLED10-SP1 system/boot/isoboot/suse-SLES10	system/boot/isoboot/suse-SLES10-SP1</H1>
    <B>marcus_schaefer at BerliOS</B> 
    <A HREF="mailto:kiwi-devel%40lists.berlios.de?Subject=Re%3A%20%5BKiwi-devel%5D%20%5BSVN%3AKIWI-Team%5D%20r1303%20-%20in%20kiwi-head%3A%20doc/kiwi-man%0A%09modules%20rpm%20system/boot/isoboot/suse-10.1%0A%09system/boot/isoboot/suse-10.2%20system/boot/isoboot/suse-10.3%0A%09system/boot/isoboot/suse-11.0%20system/boot/isoboot/suse-SLED10%0A%09system/boot/isoboot/suse-SLED10-SP1%20system/boot/isoboot/suse-SLES10%0A%09system/boot/isoboot/suse-SLES10-SP1&In-Reply-To=%3C200806031010.m53AASZA004896%40sheep.berlios.de%3E"
       TITLE="[Kiwi-devel] [SVN:KIWI-Team] r1303 - in kiwi-head: doc/kiwi-man	modules rpm system/boot/isoboot/suse-10.1	system/boot/isoboot/suse-10.2 system/boot/isoboot/suse-10.3	system/boot/isoboot/suse-11.0 system/boot/isoboot/suse-SLED10	system/boot/isoboot/suse-SLED10-SP1 system/boot/isoboot/suse-SLES10	system/boot/isoboot/suse-SLES10-SP1">marcus_schaefer at mail.berlios.de
       </A><BR>
    <I>Tue Jun  3 12:10:28 CEST 2008</I>
    <P><UL>
        
        <LI>Next message: <A HREF="000396.html">[Kiwi-devel] [SVN:KIWI-Team] r1304 - in kiwi-head: rpm
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#395">[ date ]</a>
              <a href="thread.html#395">[ thread ]</a>
              <a href="subject.html#395">[ subject ]</a>
              <a href="author.html#395">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: marcus_schaefer
Date: Tue Jun  3 12:09:53 2008
New Revision: 1303

Modified:
   kiwi-head/doc/kiwi-man/kiwi.1
   kiwi-head/kiwi.pl
   kiwi-head/modules/KIWIConfig.sh
   kiwi-head/modules/KIWIImage.pm
   kiwi-head/modules/KIWILinuxRC.sh
   kiwi-head/rpm/kiwi.changes
   kiwi-head/rpm/kiwi.spec
   kiwi-head/system/boot/isoboot/suse-10.1/config.xml
   kiwi-head/system/boot/isoboot/suse-10.2/config.xml
   kiwi-head/system/boot/isoboot/suse-10.3/config.xml
   kiwi-head/system/boot/isoboot/suse-11.0/config.xml
   kiwi-head/system/boot/isoboot/suse-SLED10-SP1/config.xml
   kiwi-head/system/boot/isoboot/suse-SLED10/config.xml
   kiwi-head/system/boot/isoboot/suse-SLES10-SP1/config.xml
   kiwi-head/system/boot/isoboot/suse-SLES10/config.xml

Log:

- added checkmedia support for iso images. kiwi will sign each iso
  with an md5sum using the tagmedia program. If the option --isocheck
  is specified when calling the create step an additional boot
  menu entry is created which allows to check the media



Modified: kiwi-head/doc/kiwi-man/kiwi.1
==============================================================================
--- kiwi-head/doc/kiwi-man/kiwi.1	(original)
+++ kiwi-head/doc/kiwi-man/kiwi.1	Tue Jun  3 12:09:53 2008
@@ -1,11 +1,11 @@
 .\&quot;     Title: kiwi
 .\&quot;    Author: Marcus Sch&#228;fer &lt;ms (AT) suse.de&gt;
 .\&quot; Generator: DocBook XSL Stylesheets v1.73.2 &lt;<A HREF="http://docbook.sf.net/">http://docbook.sf.net/</A>&gt;
-.\&quot;      Date: Created: 04/08/2008
+.\&quot;      Date: Created: 06/03/2008
 .\&quot;    Manual: KIWI Manualpage
 .\&quot;    Source: KIWI v2.10, r938
 .\&quot;
-.TH &quot;KIWI&quot; &quot;1&quot; &quot;Created: 04/08/2008&quot; &quot;KIWI v2\.10, r938&quot; &quot;KIWI Manualpage&quot;
+.TH &quot;KIWI&quot; &quot;1&quot; &quot;Created: 06/03/2008&quot; &quot;KIWI v2\.10, r938&quot; &quot;KIWI Manualpage&quot;
 .\&quot; disable hyphenation
 .nh
 .\&quot; disable justification (adjust text to left margin only)
@@ -171,12 +171,17 @@
 Set the log server port\. By default port 9000 is used\. If multiple KIWI processes runs on one system it\'s recommended to set the logging port per process
 .RE
 .PP
-[\fB\-\-rebuiltbootimage \fR\fB\fIDirectory\fR\fR]
+[\fB\-\-prebuiltbootimage \fR\fB\fIDirectory\fR\fR]
 .RS 4
 Search in
 \fIDirectory\fR
 for pre\-built boot images\.
 .RE
+.PP
+[\fB\-\-isocheck\fR]
+.RS 4
+in case of an iso image the checkmedia program generates a md5sum into the iso header\. If the \-\-isocheck option is specified a new boot menu entry will be generated which allows to check this media
+.RE
 .SH &quot;FOR MORE INFORMATION&quot;
 .PP
 More information about KIWI, its files can be found at:

Modified: kiwi-head/kiwi.pl
==============================================================================
--- kiwi-head/kiwi.pl	(original)
+++ kiwi-head/kiwi.pl	Tue Jun  3 12:09:53 2008
@@ -173,6 +173,7 @@
 our $listXMLInfo;       # list XML information for this operation
 our $Compress;          # set compression level
 our $CreatePassword;    # create crypted password
+our $ISOCheck;          # create checkmedia boot entry
 our $kiwi;              # global logging handler object
 
 #============================================
@@ -1158,6 +1159,7 @@
 		&quot;installstick-system=s&quot; =&gt; \$InstallStickSystem,
 		&quot;strip|s&quot;               =&gt; \$StripImage,
 		&quot;createpassword&quot;        =&gt; \$CreatePassword,
+		&quot;isocheck&quot;              =&gt; \$ISOCheck,
 		&quot;createhash=s&quot;          =&gt; \$CreateHash,
 		&quot;setup-grub-splash=s&quot;   =&gt; \$SetupSplashForGrub,
 		&quot;list-profiles|i=s&quot;     =&gt; \$ListProfiles,
@@ -1332,6 +1334,7 @@
 	print &quot;     [ --base-root &lt;base-path&gt; ]\n&quot;;
 	print &quot;     [ --base-root-mode &lt;copy|union|recycle&gt; ]\n&quot;;
 	print &quot;     [ --prebuiltbootimage &lt;directory&gt;]\n&quot;;
+	print &quot;     [ --isocheck ]\n&quot;;
 	print &quot;Image Upgrade:\n&quot;;
 	print &quot;  kiwi -u | --upgrade &lt;image-root&gt;\n&quot;;
 	print &quot;     [ --base-root &lt;base-path&gt; ]\n&quot;;
@@ -1451,6 +1454,12 @@
 	print &quot;  [ --prebuiltbootimage &lt;directory&gt; ]\n&quot;;
 	print &quot;    search in &lt;directory&gt; for pre-built boot images\n&quot;;
 	print &quot;\n&quot;;
+	print &quot;  [ --isocheck ]\n&quot;;
+	print &quot;    in case of an iso image the checkmedia program generates\n&quot;;
+	print &quot;    a md5sum into the iso header. If the --isocheck option is\n&quot;;
+	print &quot;    specified a new boot menu entry will be generated which\n&quot;;
+	print &quot;    allows to check this media\n&quot;;
+	print &quot;\n&quot;;
 	print &quot;  [ --testsuite &lt;image-root&gt; [ --test name --test name ... ]\n&quot;;
 	print &quot;    run test(s) on prepared image root tree.\n&quot;;
 	print &quot;    If additional name is omitted default set of tests will be\n&quot;;

Modified: kiwi-head/modules/KIWIConfig.sh
==============================================================================
--- kiwi-head/modules/KIWIConfig.sh	(original)
+++ kiwi-head/modules/KIWIConfig.sh	Tue Jun  3 12:09:53 2008
@@ -727,7 +727,7 @@
 		udevsettle udevtrigger mknod stat path_id hwup scsi_id scsi_tur
 		usb_id ata_id vol_id edd_id setctsid dumpe2fs debugreiserfs
 		fuser udevadm blogd showconsole killproc curl tar cromfs-driver
-		cvcromfs ldd driveready
+		cvcromfs ldd driveready checkmedia
 	&quot;
 	tools=&quot;$tools $@&quot;
 	for path in /sbin /usr/sbin /usr/bin /bin;do

Modified: kiwi-head/modules/KIWIImage.pm
==============================================================================
--- kiwi-head/modules/KIWIImage.pm	(original)
+++ kiwi-head/modules/KIWIImage.pm	Tue Jun  3 12:09:53 2008
@@ -1393,6 +1393,26 @@
 	qxx (&quot;sed -i -e \&quot;s:Live-System:$label:\&quot; $destination/isolinux.cfg&quot;);
 	qxx (&quot;sed -i -e \&quot;s:Live-Failsafe:$lsafe:\&quot; $destination/isolinux.cfg&quot;);
 	#==========================================
+	# setup isolinux checkmedia boot entry
+	#------------------------------------------
+	if (defined $main::ISOCheck) {
+		if (! open (FD,&quot;&gt;&gt;$destination/isolinux.cfg&quot;)) {
+			$kiwi -&gt; error  (&quot;Couldn't open: $destination/isolinux.cfg: $!&quot;);
+			$kiwi -&gt; failed ();
+			if (! -d $main::RootTree.$baseSystem) {
+				qxx (&quot;rm -rf $main::RootTree&quot;);
+				qxx (&quot;rm -rf $tmpdir&quot;);
+			}
+			return undef;
+		}
+		print FD &quot;\n&quot;;
+		print FD &quot;# mediacheck\n&quot;;
+		print FD &quot;label mediachek\n&quot;;
+		print FD &quot;  kernel linux\n&quot;;
+		print FD &quot;  append initrd=initrd splash=silent mediacheck=1 showopts\n&quot;;
+		close FD;
+	}
+	#==========================================
 	# remove original kernel and initrd
 	#------------------------------------------
 	if (! $pblt) {
@@ -1451,9 +1471,32 @@
 	}
 	$kiwi -&gt; done();
 	if (! relocateCatalog ($this,$name)) {
+		if (! -d $main::RootTree.$baseSystem) {
+			qxx (&quot;rm -rf $main::RootTree&quot;);
+			qxx (&quot;rm -rf $tmpdir&quot;);
+		}
 		return undef;
 	}
 	#==========================================
+	# tag ISO image with tagmedia
+	#------------------------------------------
+	if (-x &quot;/usr/bin/tagmedia&quot;) {
+		$kiwi -&gt; info (&quot;Adding checkmedia tag...&quot;);
+		$data = qxx (&quot;tagmedia --md5 $name 2&gt;&amp;1&quot;);
+		$code = $? &gt;&gt; 8;
+		if ($code != 0) {
+			$kiwi -&gt; failed ();
+			$kiwi -&gt; error  (&quot;Failed to tag ISO image: $data&quot;);
+			$kiwi -&gt; failed ();
+			if (! -d $main::RootTree.$baseSystem) {
+				qxx (&quot;rm -rf $main::RootTree&quot;);
+				qxx (&quot;rm -rf $tmpdir&quot;);
+			}
+			return undef;
+		}
+		$kiwi -&gt; done();
+	}
+	#==========================================
 	# remove tmpdir with boot tree
 	#------------------------------------------
 	if (! -d $main::RootTree.$baseSystem) {

Modified: kiwi-head/modules/KIWILinuxRC.sh
==============================================================================
--- kiwi-head/modules/KIWILinuxRC.sh	(original)
+++ kiwi-head/modules/KIWILinuxRC.sh	Tue Jun  3 12:09:53 2008
@@ -1099,7 +1099,14 @@
 				mount $i /cdrom &gt;/dev/null
 			fi
 			if [ -f $LIVECD_CONFIG ];then
-				cddev=$i; echo; return
+				cddev=$i; echo;
+				if [ &quot;$mediacheck&quot; = 1 ]; then
+					test -e /proc/splash &amp;&amp; echo verbose &gt; /proc/splash
+					checkmedia $cddev
+					Echo -n &quot;Press any key for reboot: &quot;; read nope
+					systemException &quot;CheckMedia&quot; &quot;reboot&quot;
+				fi
+				return
 			fi
 			umount $i &amp;&gt;/dev/null
 		done

Modified: kiwi-head/rpm/kiwi.changes
==============================================================================
--- kiwi-head/rpm/kiwi.changes	(original)
+++ kiwi-head/rpm/kiwi.changes	Tue Jun  3 12:09:53 2008
@@ -1,4 +1,12 @@
 -------------------------------------------------------------------
+Tue Jun  3 11:51:49 CEST 2008 - <A HREF="https://lists.berlios.de/mailman/listinfo/kiwi-devel">ms at suse.de</A>
+
+- added checkmedia support for iso images. kiwi will sign each iso
+  with an md5sum using the tagmedia program. If the option --isocheck
+  is specified when calling the create step an additional boot 
+  menu entry is created which allows to check the media
+
+-------------------------------------------------------------------
 Sat May 31 12:18:53 CEST 2008 - <A HREF="https://lists.berlios.de/mailman/listinfo/kiwi-devel">ms at suse.de</A>
 
 - fixed USB stick identification code

Modified: kiwi-head/rpm/kiwi.spec
==============================================================================
--- kiwi-head/rpm/kiwi.spec	(original)
+++ kiwi-head/rpm/kiwi.spec	Tue Jun  3 12:09:53 2008
@@ -35,7 +35,7 @@
 %endif
 Requires:       perl = %{perl_version}
 Requires:       perl-XML-LibXML perl-libwww-perl screen coreutils
-Requires:       kiwi-tools libxslt
+Requires:       kiwi-tools libxslt checkmedia
 %if %{suse_version} &gt; 1030
 Requires:       satsolver-tools
 %endif
@@ -43,7 +43,7 @@
 Provides:       kiwi2 = 2.14
 Obsoletes:      kiwi2 = 2.14
 Version:        2.38
-Release:        75
+Release:        76
 Group:          System/Management
 License:        GPL v2 or later
 Source:         %{name}.tar.bz2

Modified: kiwi-head/system/boot/isoboot/suse-10.1/config.xml
==============================================================================
--- kiwi-head/system/boot/isoboot/suse-10.1/config.xml	(original)
+++ kiwi-head/system/boot/isoboot/suse-10.1/config.xml	Tue Jun  3 12:09:53 2008
@@ -81,6 +81,7 @@
 		&lt;package name=&quot;bootsplash&quot;/&gt;
 		&lt;package name=&quot;bootsplash-theme-SuSE&quot;/&gt;
 		&lt;package name=&quot;tar&quot;/&gt;
+		&lt;package name=&quot;checkmedia&quot;/&gt;
 	&lt;/packages&gt;
 	&lt;packages type=&quot;bootstrap&quot;&gt;
 		&lt;package name=&quot;filesystem&quot;/&gt;

Modified: kiwi-head/system/boot/isoboot/suse-10.2/config.xml
==============================================================================
--- kiwi-head/system/boot/isoboot/suse-10.2/config.xml	(original)
+++ kiwi-head/system/boot/isoboot/suse-10.2/config.xml	Tue Jun  3 12:09:53 2008
@@ -83,6 +83,7 @@
 		&lt;package name=&quot;bootsplash&quot;/&gt;
 		&lt;package name=&quot;bootsplash-theme-SuSE&quot;/&gt;
 		&lt;package name=&quot;tar&quot;/&gt;
+		&lt;package name=&quot;checkmedia&quot;/&gt;
 	&lt;/packages&gt;
 	&lt;packages type=&quot;bootstrap&quot;&gt;
 		&lt;package name=&quot;filesystem&quot;/&gt;

Modified: kiwi-head/system/boot/isoboot/suse-10.3/config.xml
==============================================================================
--- kiwi-head/system/boot/isoboot/suse-10.3/config.xml	(original)
+++ kiwi-head/system/boot/isoboot/suse-10.3/config.xml	Tue Jun  3 12:09:53 2008
@@ -86,6 +86,7 @@
 		&lt;package name=&quot;bootsplash&quot;/&gt;
 		&lt;package name=&quot;bootsplash-theme-SuSE&quot;/&gt;
 		&lt;package name=&quot;tar&quot;/&gt;
+		&lt;package name=&quot;checkmedia&quot;/&gt;
 	&lt;/packages&gt;
 	&lt;packages type=&quot;bootstrap&quot;&gt;
 		&lt;package name=&quot;filesystem&quot;/&gt;

Modified: kiwi-head/system/boot/isoboot/suse-11.0/config.xml
==============================================================================
--- kiwi-head/system/boot/isoboot/suse-11.0/config.xml	(original)
+++ kiwi-head/system/boot/isoboot/suse-11.0/config.xml	Tue Jun  3 12:09:53 2008
@@ -95,6 +95,7 @@
 		&lt;package name=&quot;cromfs&quot;/&gt;
 		&lt;package name=&quot;rpm&quot;/&gt;
 		&lt;package name=&quot;kiwi-tools&quot;/&gt;
+		&lt;package name=&quot;checkmedia&quot;/&gt;
 	&lt;/packages&gt;
 	&lt;packages type=&quot;delete&quot;&gt;
 		&lt;package name=&quot;ConsoleKit&quot;/&gt;

Modified: kiwi-head/system/boot/isoboot/suse-SLED10-SP1/config.xml
==============================================================================
--- kiwi-head/system/boot/isoboot/suse-SLED10-SP1/config.xml	(original)
+++ kiwi-head/system/boot/isoboot/suse-SLED10-SP1/config.xml	Tue Jun  3 12:09:53 2008
@@ -84,6 +84,7 @@
 		&lt;package name=&quot;bootsplash&quot;/&gt;
 		&lt;package name=&quot;bootsplash-theme-SuSE-NLD&quot;/&gt;
 		&lt;package name=&quot;tar&quot;/&gt;
+		&lt;package name=&quot;checkmedia&quot;/&gt;
 	&lt;/packages&gt;
 	&lt;packages type=&quot;bootstrap&quot;&gt;
 		&lt;package name=&quot;filesystem&quot;/&gt;

Modified: kiwi-head/system/boot/isoboot/suse-SLED10/config.xml
==============================================================================
--- kiwi-head/system/boot/isoboot/suse-SLED10/config.xml	(original)
+++ kiwi-head/system/boot/isoboot/suse-SLED10/config.xml	Tue Jun  3 12:09:53 2008
@@ -82,6 +82,7 @@
 		&lt;package name=&quot;bootsplash&quot;/&gt;
 		&lt;package name=&quot;bootsplash-theme-SuSE-NLD&quot;/&gt;
 		&lt;package name=&quot;tar&quot;/&gt;
+		&lt;package name=&quot;checkmedia&quot;/&gt;
 	&lt;/packages&gt;
 	&lt;packages type=&quot;bootstrap&quot;&gt;
 		&lt;package name=&quot;filesystem&quot;/&gt;

Modified: kiwi-head/system/boot/isoboot/suse-SLES10-SP1/config.xml
==============================================================================
--- kiwi-head/system/boot/isoboot/suse-SLES10-SP1/config.xml	(original)
+++ kiwi-head/system/boot/isoboot/suse-SLES10-SP1/config.xml	Tue Jun  3 12:09:53 2008
@@ -84,6 +84,7 @@
 		&lt;package name=&quot;bootsplash&quot;/&gt;
 		&lt;package name=&quot;bootsplash-theme-SuSE-SLES&quot;/&gt;
 		&lt;package name=&quot;tar&quot;/&gt;
+		&lt;package name=&quot;checkmedia&quot;/&gt;
 	&lt;/packages&gt;
 	&lt;packages type=&quot;bootstrap&quot;&gt;
 		&lt;package name=&quot;filesystem&quot;/&gt;

Modified: kiwi-head/system/boot/isoboot/suse-SLES10/config.xml
==============================================================================
--- kiwi-head/system/boot/isoboot/suse-SLES10/config.xml	(original)
+++ kiwi-head/system/boot/isoboot/suse-SLES10/config.xml	Tue Jun  3 12:09:53 2008
@@ -82,6 +82,7 @@
 		&lt;package name=&quot;bootsplash&quot;/&gt;
 		&lt;package name=&quot;bootsplash-theme-SuSE-SLES&quot;/&gt;
 		&lt;package name=&quot;tar&quot;/&gt;
+		&lt;package name=&quot;checkmedia&quot;/&gt;
 	&lt;/packages&gt;
 	&lt;packages type=&quot;bootstrap&quot;&gt;
 		&lt;package name=&quot;filesystem&quot;/&gt;

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	
	<LI>Next message: <A HREF="000396.html">[Kiwi-devel] [SVN:KIWI-Team] r1304 - in kiwi-head: rpm
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#395">[ date ]</a>
              <a href="thread.html#395">[ thread ]</a>
              <a href="subject.html#395">[ subject ]</a>
              <a href="author.html#395">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/kiwi-devel">More information about the Kiwi-devel
mailing list</a><br>
</body></html>
